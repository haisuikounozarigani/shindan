<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
<title>å†’é™ºè€…é€†å¢ƒåŠ›è¨ºæ–­ï¼ˆCD-RISCï¼GRIT-Sã«ç€æƒ³ãƒ»ç‹¬è‡ªç‰ˆï¼‰</title>
<meta name="theme-color" content="#fff8fb">
<style>
:root{
  --bg1:#fff8fb; --bg2:#f3f7ff; --card:#ffffff; --line:#ead9e8; --fg:#3f2e38; --muted:#8b6c78;
  --ac1:#ff8fb3; --ac2:#a796ff;
}
*{box-sizing:border-box}
body{margin:0;font-family:"Noto Sans JP",system-ui,-apple-system,sans-serif;color:var(--fg);
  background:linear-gradient(160deg,var(--bg1),var(--bg2))}
.wrap{max-width:960px;margin:12px auto 22px;padding:0 12px}
header{display:flex;align-items:center;justify-content:space-between;margin:8px 0 10px}
h1{margin:0;font-size:clamp(18px,5.2vw,24px);line-height:1.25}
a.back{font-size:.9em;color:#6b5560;text-decoration:none;border:1px solid var(--line);
  padding:6px 10px;border-radius:999px;background:#fff}
.card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:12px;margin:10px 0}
.muted{color:var(--muted)} .small{font-size:.92em}
.pill{display:inline-block;padding:6px 10px;border-radius:999px;border:1px solid #efdff4;background:#fff;font-weight:700}


/* è³ªå• */
.q{margin:10px 0;padding:10px;border:1px solid #f0e6f0;border-radius:12px;background:#fff}
.q.miss{animation:shake .3s linear 1;border-color:#ffb3c1}
@keyframes shake{0%{transform:translateX(0)}25%{transform:translateX(-2px)}50%{transform:translateX(2px)}75%{transform:translateX(-1px)}100%{transform:translateX(0)}}
.qtitle{font-weight:700;margin-bottom:6px}
.scaleRow{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.scaleRow .cap{color:#8f7f8a;font-size:.88em;margin-right:4px}
.opt{display:flex;gap:6px}
.opt input{position:absolute;opacity:0;pointer-events:none}
.opt label{
  display:inline-flex;align-items:center;justify-content:center;min-width:38px;height:38px;
  border:1px solid #e8ddee;background:#fff;border-radius:9px;cursor:pointer;
  font-weight:800;font-size:14px;padding:0 8px; user-select:none;
}
.opt input:checked + label{border-color:#b691ff;box-shadow:0 0 0 2px rgba(182,145,255,.18) inset}
.scaleHint{color:#8f7f8a;font-size:.82em;margin-top:4px}

/* çµæœãƒ˜ãƒƒãƒ€ï¼ˆãƒ¢ãƒã‚¤ãƒ«ã¯1ã‚«ãƒ©ãƒ ã§å¤§ããè¡¨ç¤ºï¼‰ */
.resultHead{display:grid;grid-template-columns:1fr;gap:12px;align-items:center;justify-items:center}
@media (min-width:720px){ .resultHead{grid-template-columns:420px 1fr;justify-items:stretch} }

/* ç”»åƒã‚’å¤§ãã‚ã«ï¼ˆã‚¹ãƒãƒ› 96vw / PC 420pxï¼‰ */
.art{
  width:min(96vw,480px);aspect-ratio:1/1;border-radius:12px;background:#f4f0fa;border:1px solid #e6def4;
  display:flex;align-items:center;justify-content:center;overflow:hidden
}
@media (min-width:720px){ .art{width:420px} }
.art picture,.art img{width:100%;height:100%;object-fit:contain;background:transparent;
  image-rendering:pixelated;image-rendering:crisp-edges}
.titleWrap{display:flex;flex-direction:column;gap:6px;width:100%}
.job{font-size:20px;font-weight:900}
.tag{font-size:.92em;color:#6b5560}
.catch{font-size:1em;color:#534050}
.hr{height:1px;background:#efebf3;margin:10px 0}
.desc{line-height:1.6}
.grid2{display:grid;grid-template-columns:1fr;gap:8px}
.block{background:#fff;border:1px solid #eee3f5;border-radius:12px;padding:10px}
.block h3{margin:0 0 6px;font-size:1em}
ul{margin:0;padding-left:18px}
.saveRow{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px;justify-content:center}
button{padding:11px 14px;border-radius:12px;border:1px solid #d9cbe0;background:#fff;cursor:pointer;font-weight:700}
button.primary{background:linear-gradient(90deg,var(--ac1),var(--ac2));color:#fff;border-color:transparent}
button.fakeDisabled{opacity:.55} /* æŠ¼ã›ã‚‹ã‘ã©è–„ãè¦‹ã›ã‚‹ */

.bars{display:grid;gap:8px;margin:8px 0}
.bar{display:grid;grid-template-columns:108px 1fr 52px;gap:8px;align-items:center}
.bar .name{font-weight:700}
.meter{height:10px;border-radius:999px;background:#f0e8f5;overflow:hidden;border:1px solid #eadff3}
.meter > i{display:block;height:100%;width:0;background:linear-gradient(90deg,#a796ff,#ff8fb3)}

@media (max-width:560px){
  .bar{grid-template-columns:100px 1fr 44px}
}

/* è¿‘ã„å€™è£œï¼ˆè¤‡æ•°è¡¨ç¤ºï¼‰ */
.nearWrap{margin-top:10px}
.nearWrap h3{margin:0 0 6px;font-size:1em}
.nearList{display:flex;gap:10px;overflow-x:auto;padding-bottom:6px}
.nearCard{min-width:180px;max-width:220px;border:1px solid #eee3f5;border-radius:12px;background:#fff}
.nearThumb{width:100%;aspect-ratio:1/1;border-bottom:1px solid #eee3f5;display:flex;align-items:center;justify-content:center;overflow:hidden}
.nearThumb img{width:100%;height:100%;object-fit:contain;image-rendering:pixelated;background:transparent}
.nearBody{padding:8px}
.nearName{font-weight:800}
.nearCatch{font-size:.9em;color:#6b5560;margin-top:2px}
/* === ãã›ã‚‚ã‚“é¢¨ ProgressBar === */
.progressShell{ display:flex; align-items:center; gap:8px; margin:12px 0 16px; }
.progressBar{ position:relative; flex:1; height:8px; border-radius:9999px; background:#e6e6e6; overflow:hidden; }
.progressBar .bar{ position:absolute; inset:0 auto 0 0; width:0%; background:linear-gradient(90deg,#79c0ff,#b47cff); transition:width .25s ease; }
#progCnt{ min-width:72px; text-align:right; font-variant-numeric:tabular-nums; font-size:12px; opacity:.8; }
@media (prefers-reduced-motion: reduce){
  .progressBar .bar{ transition:none; }
}
/* === sticky progress (kusemon-like) === */
.progressShell.is-sticky{
  position: sticky;
  top: 0;              /* ç”»é¢ã®æœ€ä¸Šéƒ¨ã«è²¼ã‚Šä»˜ã */
  z-index: 30;
  padding: 8px 12px;
  margin: 0 -12px 12px; /* .wrap ã®å·¦å³ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’ç›¸æ®ºã—ã¦æ¨ªã„ã£ã±ã„ã« */
  background: linear-gradient(160deg,var(--bg1),var(--bg2));
  border-bottom: 1px solid var(--line);
  backdrop-filter: blur(6px);
  -webkit-backdrop-filter: blur(6px);
}
@supports (top: env(safe-area-inset-top)){
  .progressShell.is-sticky{ top: max(0px, env(safe-area-inset-top)); }
}
</style>
</head>
<body data-id="adventure-shin">
<div class="wrap">
  <header>
  <h1>å†’é™ºè€…é€†å¢ƒåŠ›è¨ºæ–­</h1>
    <a class="back" href="/shindan/">ä¸€è¦§ã¸</a>
  </header>

    <p class="small muted">å‡ºã‚‹ã‚¿ã‚¤ãƒ—ï¼š<b>æˆ¦å£«ãƒ»é¨å£«ãƒ»é­”æ³•ä½¿ã„ãƒ»ç›—è³Šãƒ»ç‹©äººãƒ»æ ¼é—˜å®¶ãƒ»å•†äºº</b>ï¼ˆå…¨ä½“ãŒé«˜æ°´æº–ã®ã¨ãã¯<b>å‹‡è€…</b>ï¼‰ã€‚æ°—æ¥½ã«éŠã‚“ã§ã­ã€‚</p>
    <div id="progDock" class="progressShell is-sticky">
      <div class="progressBar"><i id="progBar" class="bar"></i></div>
      <span class="pill count" id="progCnt">0 / 28</span>
    </div>
  

  <section id="stage" class="card" aria-live="polite"></section>

  <div class="saveRow" id="actionRow">
    <button id="btnSubmit" class="primary fakeDisabled" type="button">çµæœã‚’è¦‹ã‚‹</button>
  </div>

  <section class="card" id="result" style="display:none">
    <div class="resultHead">
      <div class="art" id="art"><span id="fallbackIcon" style="font-size:48px">ğŸ›¡ï¸</span></div>
      <div class="titleWrap">
        <div class="job" id="jobLine">â€”</div>
        <div class="catch" id="catchLine">â€”</div>
        <div class="tag"><span class="pill" id="tierBadge">â€”</span> <span class="pill" id="scoreBadge">ç·åˆ 0</span></div>
      </div>
    </div>

    <div class="hr"></div>
    <div class="desc" id="desc">â€”</div>

    <div class="bars" id="bars"></div>

    <div class="grid2">
      <div class="block">
        <h3>å¼·ã¿</h3>
        <ul id="listStrength"></ul>
      </div>
      <div class="block">
        <h3>æ°—ã‚’ã¤ã‘ãŸã„ã“ã¨</h3>
        <ul id="listCaution"></ul>
      </div>
      <div class="block">
        <h3>æ—¥å¸¸ã‚¯ã‚¨ã‚¹ãƒˆ</h3>
        <ul id="listQuest"></ul>
      </div>
      <div class="block">
        <h3>è‚²æˆãƒ’ãƒ³ãƒˆ</h3>
        <ul id="listGrowth"></ul>
      </div>
    </div>

    <!-- è¿‘ã„å€™è£œï¼ˆè¤‡æ•°è¡¨ç¤ºï¼šå¿…è¦æ™‚ã®ã¿è¡¨ç¤ºï¼‰ -->
    <div id="nearby" class="nearWrap" style="display:none">
      <h3>è¿‘ã„å€™è£œ</h3>
      <div class="nearList" id="nearList"></div>
    </div>

    <div class="saveRow">
      <button id="btnSave" class="primary" type="button">çµæœã‚«ãƒ¼ãƒ‰ã‚’ç”»åƒä¿å­˜</button>
      <button id="btnRetry" type="button">æœ€åˆã‹ã‚‰</button>
    </div>

    <canvas id="cardCanvas" width="1080" height="1620" style="display:none"></canvas>
  </section>
</div>
<section class="card" id="intro">
  	<section id="legal-note" style="margin:8px 0 14px;background:#fff;border:1px solid var(--line);border-radius:12px;padding:10px 12px">
  <h2 style="margin:4px 0 6px;font-size:1rem;color:var(--fg)">ã”åˆ©ç”¨ã«ã‚ãŸã£ã¦</h2>
  <ul style="margin:6px 0 0 1.2em;line-height:1.8;color:var(--muted)">
    <li><strong>éææºãƒ»éå…¬å¼ï¼š</strong>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¯ç ”ç©¶ä¸€èˆ¬ã®çŸ¥è¦‹ï¼ˆ<span style="white-space:nowrap">CD-RISCï¼GRIT-S</span> ãªã©ï¼‰ã«<strong>ãƒ’ãƒ³ãƒˆã‚’å¾—ãŸç‹¬è‡ªåˆ¶ä½œ</strong>ã§ã™ã€‚ã“ã‚Œã‚‰ã®<strong>æ­£å¼ãªé …ç›®ãƒ»æ¡ç‚¹æ–¹æ³•ã¯ä½¿ç”¨ã—ã¦ãŠã‚‰ãš</strong>ã€æ¨©åˆ©è€…ã®æ‰¿èªãƒ»ææºãƒ»æ¨å¥¨ã‚’æ„å‘³ã—ã¾ã›ã‚“ã€‚</li>
    <li><strong>åŒ»ç™‚ç”¨é€”ã§ã¯ã‚ã‚Šã¾ã›ã‚“ï¼š</strong>å¨¯æ¥½ï¼‹è‡ªå·±ç†è§£ã®ç›®å®‰ã¨ã—ã¦ã®ã‚»ãƒ«ãƒ•ãƒã‚§ãƒƒã‚¯ã§ã‚ã‚Šã€åŒ»ç™‚çš„ãƒ»å¿ƒç†çš„ãª<strong>è¨ºæ–­ï¼æ²»ç™‚ï¼åŠ©è¨€ã‚’ç›®çš„ã¨ã—ã¾ã›ã‚“</strong>ã€‚å¼·ã„è‹¦ç—›ã‚„ä¸èª¿ãŒç¶šãå ´åˆã¯ã€åŒ»ç™‚æ©Ÿé–¢ã‚„å°‚é–€å®¶ã¸ã”ç›¸è«‡ãã ã•ã„ã€‚</li>
    <li><strong>ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ï¼š</strong>å›ç­”ã¯ãƒ–ãƒ©ã‚¦ã‚¶å†…ï¼ˆç«¯æœ«å†…ï¼‰ã§ã®ã¿å‡¦ç†ã•ã‚Œã€<strong>ã‚µãƒ¼ãƒãƒ¼é€ä¿¡ã¯è¡Œã„ã¾ã›ã‚“</strong>ã€‚çµæœã‚«ãƒ¼ãƒ‰ã®ç”»åƒç”Ÿæˆã‚‚ç«¯æœ«å†…ã§è¡Œã‚ã‚Œã¾ã™ã€‚</li>
    <li><strong>è¡¨ç¾ã«ã¤ã„ã¦ï¼š</strong>æœ¬ãƒšãƒ¼ã‚¸ã®ã€Œè·æ¥­ï¼ˆæˆ¦å£«ãƒ»é¨å£« ç­‰ï¼‰ã€ã€Œç­‰ç´šã€ãªã©ã¯<strong>æ¯”å–©ãƒ»ã‚²ãƒ¼ãƒŸãƒ•ã‚£ã‚±ãƒ¼ã‚·ãƒ§ãƒ³è¡¨ç¾</strong>ã§ã™ã€‚ç‰¹å®šã®å€‹äººãƒ»é›†å›£ã¸ã®ä¾¡å€¤åˆ¤æ–­ã‚„å·®åˆ¥ã‚’æ„å›³ã›ãšã€çµæœã‚’ã‚‚ã£ã¦ä»–è€…ã‚’æ–­å®šãƒ»ãƒ©ãƒ™ãƒªãƒ³ã‚°ã—ãªã„ã§ãã ã•ã„ã€‚</li>
    <li><strong>å…è²¬ï¼š</strong>æ³•ä»¤ã§èªã‚ã‚‰ã‚Œã‚‹ç¯„å›²ã§ã€æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®åˆ©ç”¨ã«ã‚ˆã‚Šç”Ÿã˜ãŸã„ã‹ãªã‚‹æå¤±ãƒ»æå®³ã«ã¤ã„ã¦ã‚‚ã€å½“ã‚µã‚¤ãƒˆã¯è²¬ä»»ã‚’è² ã„ã¾ã›ã‚“ã€‚</li>
  </ul>
</section>

<script>
/* ====== ã—ãã„å€¤ï¼ˆä½µè¨˜ã®æ¡ä»¶ï¼‰ ====== */
const NEAR_DELTA = 4;        // ãƒˆãƒƒãƒ—ã¨ã®å·®ãŒ4ç‚¹ä»¥å†…
const NEAR_MAX = 2;          // æœ€å¤§2è·ã¾ã§è¡¨ç¤º
const NEAR_MIN_OVERALL = 60; // ç·åˆãŒç†Ÿç·´(60)ä»¥ä¸Šã®ã¨ãã ã‘å€™è£œã‚’ä½µè¨˜

/* ====== 7å› å­ï¼ˆç•¥å·â†’è¡¨ç¤ºåï¼‰ ====== */
const FACTOR_NAMES = {
  GR:'ç²˜ã‚Šå¼·ã•', RF:'å›å¾©åŠ›', FX:'æŸ”è»Ÿæ€§', PL:'è¨ˆç”»æ€§', SS:'æ”¯æ´æ´»ç”¨', EF:'é›†ä¸­åŠ›', SE:'è‡ªå·±åŠ¹åŠ›æ„Ÿ'
};

/* ã‚¿ã‚¤ãƒ—è¨­å®šï¼ˆç”»åƒãƒ•ã‚©ãƒ«ãƒ€åã¯ GitHub ã¨ä¸€è‡´ï¼‰ */
const JOBS = [
  {key:'warrior', dir:'warrior', icon:'âš”ï¸', name:'æˆ¦å£«',
   w:{GR:.28, RF:.14, FX:.08, PL:.18, SS:.06, EF:.16, SE:.10},
   catch:'æŠ¼ã—ã¦ãƒ€ãƒ¡ãªã‚‰â€¦ã‚‚ã†ä¸€æŠ¼ã—',
   desc:'è¿·ã£ã¦ã‚‚å‰ã«é€²ã‚ã‚‹å®Ÿè¡ŒåŠ›ãŒå…‰ã‚‹ã€‚ç©ã¿ä¸Šã’ã§çªç ´ã™ã‚‹ã‚¿ã‚¤ãƒ—ã€‚',
   strengths:['ç¶šã‘ã‚‹ã®ãŒå¾—æ„','é€†é¢¨ã«å¼·ã„','ç´„æŸã‚„ç· åˆ‡ã‚’å®ˆã‚‹'],
   cautions:['è¦–é‡ãŒç‹­ããªã‚Šã‚„ã™ã„','ä¼‘ã‚€ã®ã‚’å¾Œå›ã—ã«ã—ãŒã¡'],
   quests:['æ¯æ—¥15åˆ†ã‚’7æ—¥ç¶šã‘ã‚‹','èª²é¡Œã‚’3åˆ†å‰²ã§ç€æ‰‹','çµ‚ã‚ã£ãŸã‚‰å°ã•ãªã”è¤’ç¾'],
   growth:['é€±1ã®å®Œå…¨ä¼‘é¤Š','ä»–æµè©¦åˆã§ã‚„ã‚Šæ–¹ã‚’å¢—ã‚„ã™']},

  {key:'knight', dir:'knight', icon:'ğŸ›¡ï¸', name:'é¨å£«',
   w:{GR:.22, RF:.22, FX:.08, PL:.18, SS:.14, EF:.10, SE:.06},
   catch:'ç´„æŸã¨å®ˆå‚™ã®äºŒåˆ€æµ',
   desc:'å®‰å®šæ„ŸãŒã‚ã‚Šè²¬ä»»ã®å ´é¢ã«å¼·ã„ã€‚ãƒãƒ¼ãƒ ã‚’å®ˆã‚‹å½¹å›ã‚ŠãŒå¾—æ„ã€‚',
   strengths:['è½ã¡ç€ã„ãŸåˆ¤æ–­','è¦å¾‹ã‚’å®ˆã‚‹','ä»²é–“æ€ã„'],
   cautions:['èé€šãŒåˆ©ã‹ãªã„ã¨ããŒã‚ã‚‹','æŠ±ãˆè¾¼ã¿ã‚„ã™ã„'],
   quests:['å½¹å‰²ã‚’ä¸€è¨€ã§å®šç¾©','æœã«ä»Šæ—¥ã®3ã‚¿ã‚¹ã‚¯å®£è¨€','å›°ã‚Šã”ã¨ã¯3åˆ†ä»¥å†…ã«ç›¸è«‡'],
   growth:['æ–­ã‚‹ç·´ç¿’ï¼ˆä»£æ¡ˆï¼‰','é€±1ã§è¦å‰‡å¤–ã®å°å®Ÿé¨“']},

  {key:'mage', dir:'mage', icon:'ğŸ”®', name:'é­”æ³•ä½¿ã„',
   w:{GR:.08, RF:.10, FX:.18, PL:.28, SS:.10, EF:.10, SE:.16},
   catch:'è€ƒãˆã¦å½“ã¦ã‚‹ã€æ®µå–ã‚Šã®é­”æ³•',
   desc:'å…ˆå›ã‚Šã®æ®µå–ã‚ŠãŒå¾—æ„ã€‚å­¦ã³ã‚’ç´ æ—©ãå½¢ã«ã™ã‚‹ã€‚',
   strengths:['æº–å‚™ãŒçš„ç¢º','å­¦ç¿’ãŒæ—©ã„','èª¬æ˜ã‚„è¦ç´„ãŒä¸Šæ‰‹'],
   cautions:['è¨ˆç”»å€’ã‚Œã«æ³¨æ„','ç€æ‰‹ãŒé…ã‚ŒãŒã¡'],
   quests:['5åˆ†ã§åˆ†è§£â†’æ¬¡ã®ä¸€æ‰‹','1æ—¥ã®å­¦ã³ã‚’1è¡Œãƒ­ã‚°','çµ‚ã‚ã‚Šæ™‚é–“ã‚’å…ˆã«æ±ºã‚ã‚‹'],
   growth:['60%ã§å®Ÿè¡Œé–‹å§‹','å®Œç’§ä¸»ç¾©ã®æ‰‹æ”¾ã—']},

  {key:'rogue', dir:'rogue', icon:'ğŸ—ï¸', name:'ç›—è³Š',
   w:{GR:.10, RF:.10, FX:.30, PL:.16, SS:.10, EF:.16, SE:.08},
   catch:'éµã‚ˆã‚Šå…ˆã«æŠœã‘é“ã‚’ç™ºè¦‹',
   desc:'å¤‰åŒ–ã«å¼·ãåˆ¥ãƒ«ãƒ¼ãƒˆã‚’ç´ æ—©ãè¦‹ã¤ã‘ã‚‹ã€‚çŠ¶æ³å¯¾å¿œãŒé€Ÿã„ã€‚',
   strengths:['æŸ”è»Ÿå¯¾å¿œãŒé€Ÿã„','ç™ºæƒ³ã®å¼•ãå‡ºã—ãŒå¤šã„','æ±ºæ–­ãŒé€Ÿã„'],
   cautions:['æ ¹æ°—ãŒåˆ‡ã‚Œã‚„ã™ã„','è©°ã‚ãŒç”˜ããªã‚‹ã“ã¨ãŒã‚ã‚‹'],
   quests:['åŒã˜èª²é¡Œã§åˆ¥æ¡ˆã‚’3ã¤','æ—¥æ›¿ã‚ã‚Šã®å°æŒ‘æˆ¦1ã¤','é€ä¿¡å‰ãƒã‚§ãƒƒã‚¯3é …ç›®'],
   growth:['é–‹å§‹ã®åˆå›³ã§ç¿’æ…£åŒ–','æœ€çµ‚ç¢ºèªã®æ™‚é–“æ ã‚’ç¢ºä¿']},

  {key:'ranger', dir:'ranger', icon:'ğŸ¹', name:'ç‹©äºº',
   w:{GR:.14, RF:.16, FX:.22, PL:.14, SS:.08, EF:.18, SE:.08},
   catch:'ç‹™ã£ã¦å½“ã¦ã‚‹ã€å¤–ã•ãªã„äºº',
   desc:'å‘¨ã‚Šã‚’ã‚ˆãè¦‹ã¦é›†ä¸­é…åˆ†ã€‚ç’°å¢ƒèª¿æ•´ãŒã†ã¾ã„ã€‚',
   strengths:['é›†ä¸­ã®ã‚ªãƒ³ã‚ªãƒ•ãŒä¸Šæ‰‹','çŠ¶æ³èª­ã¿ãŒæ—©ã„','è¦³å¯Ÿã‹ã‚‰ã®ä¿®æ­£ãŒåŠ¹ã'],
   cautions:['å˜ç‹¬è¡Œå‹•ã«ãªã‚ŠãŒã¡','å”åƒã®è©°ã‚ãŒå¼±ããªã‚‹'],
   quests:['ä½œæ¥­å‰5åˆ†ã§ç’°å¢ƒæ•´å‚™','25åˆ†é›†ä¸­ï¼‹5åˆ†ä¼‘æ†©Ã—3','è¦³å¯Ÿã‚’1è¡Œãƒ¡ãƒ¢'],
   growth:['å”åƒã‚¿ã‚¹ã‚¯ã‚’é€±1ã§è¨­å®š','å…±æœ‰ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã§è©°ã‚å¼·åŒ–']},

  {key:'monk', dir:'monk', icon:'ğŸ¥‹', name:'æ ¼é—˜å®¶',
   w:{GR:.22, RF:.26, FX:.12, PL:.08, SS:.06, EF:.12, SE:.14},
   catch:'ã‚¿ãƒ•ã•ã§æŠ¼ã—åˆ‡ã‚‹è‡ªå·±ãƒ¡ãƒ³ãƒ†è·äºº',
   desc:'ä½“åŠ›ãƒ»æ°—åŠ›ã®é…åˆ†ãŒä¸Šæ‰‹ã€‚é€†å¢ƒã§ã‚‚ç«‹ã¦ç›´ã›ã‚‹ã€‚',
   strengths:['å›å¾©ãŒæ—©ã„','ç¶™ç¶šç¨¼åƒã«å¼·ã„','è¸ã‚“å¼µã‚ŠãŒåŠ¹ã'],
   cautions:['æ°—åˆ†ã®æ³¢ãŒä½œæ¥­ã«å‡ºã‚„ã™ã„','è¨ˆç”»ã‚’è»½è¦–ã—ãŒã¡'],
   quests:['é–‹å§‹å‰ã«æ·±å‘¼å¸3å›','é‹å‹•orç¡çœ ã®ç›®æ¨™ã‚’1ã¤','æ¯æ—¥1ã¤å°é”æˆ'],
   growth:['é€±1ã§ä½œæˆ¦ä¼šè­°10åˆ†','å‰å¤œã«æ˜æ—¥ã®æ‰‹é †ã‚’3è¡Œ']},

  {key:'merchant', dir:'merchant', icon:'ğŸ’°', name:'å•†äºº',
   w:{GR:.08, RF:.08, FX:.16, PL:.20, SS:.30, EF:.06, SE:.12},
   catch:'ã¤ãªã’ã¦å›ã™ã€è¡—ãŒå‘³æ–¹',
   desc:'äººã¨æƒ…å ±ã‚’ã¤ãªã’ã¦ä¾¡å€¤ã‚’ç”Ÿã‚€ã€‚æ®µå–ã‚Šã¨é–¢ä¿‚ä½œã‚ŠãŒæ­¦å™¨ã€‚',
   strengths:['é–¢ä¿‚æ§‹ç¯‰ãŒã†ã¾ã„','ææ¡ˆã‚„äº¤æ¸‰ãŒå¾—æ„','å…ˆã‚’è¦‹ã¦æ®µå–ã‚Šã§ãã‚‹'],
   cautions:['æ™‚é–“ã‚’å–ã‚‰ã‚Œã‚„ã™ã„','æ±ºã‚åˆ‡ã‚ŠãŒé…ã‚Œã‚‹ã“ã¨ãŒã‚ã‚‹'],
   quests:['ç´¹ä»‹/ãŠç¤¼ã‚’1äººã«é€ã‚‹','ä¼šè­°å¾Œ3è¡Œã‚µãƒãƒªå…±æœ‰','æ¥é€±ã®é¢è«‡æ ã‚’å…ˆã«ç¢ºä¿'],
   growth:['NOï¼‹ä»£æ¡ˆã§æ™‚é–“ã‚’å®ˆã‚‹','ç· åˆ‡ã‚’å‰å€’ã—è¨­å®š']}
];

/* å‹‡è€…ï¼ˆé«˜æ°´æº–æ™‚ã®ã¿å‡ºã™ï¼å°æ–‡å­— hero/00.pngï¼‰ */
const HERO = {
  key:'hero', dir:'hero', icon:'ğŸ—¡ï¸âœ¨', name:'å‹‡è€…',
  catch:'ãœã‚“ã¶å¼·ã„ã€‚ãƒãƒ©ãƒ³ã‚¹ã§ç„¡åŒ',
  desc:'7ã¤ã®åŠ›ãŒã©ã‚Œã‚‚é«˜æ°´æº–ã€‚æœªçŸ¥ã®ã‚¯ã‚¨ã‚¹ãƒˆã§ã‚‚è‡ªåˆ†ã§é“ã‚’ä½œã‚Œã‚‹ã€‚',
  strengths:['ãƒãƒ©ãƒ³ã‚¹ã®è‰¯ã•','çŠ¶æ³ã«åˆã‚ã›ã¦èª¿æ•´ã§ãã‚‹','å­¦ã³ã®è»¢ç”¨ãŒæ—©ã„'],
  cautions:['ä½•ã§ã‚‚èƒŒè² ã„è¾¼ã¿ã‚„ã™ã„','ä¼‘ã‚€ã®ãŒè‹¦æ‰‹ã«ãªã‚ŠãŒã¡'],
  quests:['æœˆ1ã§é›£ã—ã‚é•·æœŸç›®æ¨™','å½¹å‰²ã‚’å§”ä»»ã—ã¦ãƒãƒ¼ãƒ åŒ–','æŒ‘æˆ¦ã¨ä¼‘æ¯ã®ãƒªã‚ºãƒ ä½œã‚Š'],
  growth:['å§”ä»»ã¨æ’¤é€€ãƒ©ã‚¤ãƒ³ã‚’æ±ºã‚ã‚‹','ç¡çœ ãƒ»é‹å‹•ãªã©ä¼‘æ¯ã‚‚æ•°å€¤åŒ–']
};
const HERO_RULE = { minEach:80, minOverall:85 };

/* 5ä»¶æ³•ï¼ˆå„è¨­å•ã«ãƒ’ãƒ³ãƒˆï¼‰ */
const SCALE = [
  {v:1,t:'å…¨ããªã„'},{v:2,t:'å°‘ãªã„'},{v:3,t:'ã©ã¡ã‚‰ã¨ã‚‚'},{v:4,t:'ã‚„ã‚„ã‚ã‚‹'},{v:5,t:'ã¨ã¦ã‚‚'}
];

/* å†’é™ºè€…ãƒ†ã‚¤ã‚¹ãƒˆã®è³ªå•ï¼ˆ7å› å­Ã—4=28ï¼‰ */
const SECTIONS = [
  { key:'GR', items:[
    {id:'gr1', text:'é•·ã„å†’é™ºã§ã‚‚æ¯æ—¥ã¡ã‚‡ã£ã¨ãšã¤é€²ã‚ã‚‰ã‚Œã‚‹', rev:false},
    {id:'gr2', text:'é¢å€’ã ã¨å¯„ã‚Šé“ã—ã¦ã—ã¾ã†', rev:true},
    {id:'gr3', text:'æˆæœãŒã™ãå‡ºãªãã¦ã‚‚ç¶šã‘ã¦ã„ã‘ã‚‹', rev:false},
    {id:'gr4', text:'å°ã•ãªå¤±æ•—ã§ã‚„ã‚‹æ°—ãŒã—ã¼ã¿ã‚„ã™ã„', rev:true},
  ]},
  { key:'RF', items:[
    {id:'rf1', text:'è½ã¡è¾¼ã‚“ã§ã‚‚ä¸€æ™©å¯ã‚Œã°æ°—æŒã¡ãŒæˆ»ã‚‹', rev:false},
    {id:'rf2', text:'äºˆæƒ³å¤–ã®å‡ºæ¥äº‹ã‚’é•·ãå¼•ããšã‚‹', rev:true},
    {id:'rf3', text:'å¤±æ•—ã‚’æ¬¡ã®ä¸€æ‰‹ã«åˆ‡ã‚Šæ›¿ãˆã‚„ã™ã„', rev:false},
    {id:'rf4', text:'ç·Šå¼µã§é ­ãŒçœŸã£ç™½ã«ãªã‚ŠãŒã¡', rev:true},
  ]},
  { key:'FX', items:[
    {id:'fx1', text:'ä½œæˆ¦ãŒå´©ã‚Œã¦ã‚‚ã™ãåˆ¥ã®ã‚„ã‚Šæ–¹ã«åˆ‡ã‚Šæ›¿ãˆã‚‰ã‚Œã‚‹', rev:false},
    {id:'fx2', text:'æ±ºã‚ãŸæ‰‹é †ã«å›ºåŸ·ã—ã¦ã—ã¾ã†', rev:true},
    {id:'fx3', text:'ä»²é–“ã®è¦–ç‚¹ã«ç«‹ã£ã¦è€ƒãˆç›´ã›ã‚‹', rev:false},
    {id:'fx4', text:'è¡Œãè©°ã¾ã£ãŸã‚‰åˆ¥ãƒ«ãƒ¼ãƒˆã‚’æ€ã„ã¤ã', rev:false},
  ]},
  { key:'PL', items:[
    {id:'pl1', text:'åœ°å›³ã‚’è¦‹ã¦å„ªå…ˆé †ã‚’æ±ºã‚ã¦å‹•ã‘ã‚‹', rev:false},
    {id:'pl2', text:'è¦‹ç©ã‚‚ã‚ŠãŒç”˜ãã€Œé›†åˆæ™‚é–“ã€ã«é…ã‚ŒãŒã¡', rev:true},
    {id:'pl3', text:'å¤§ããªä¾é ¼ã‚’å°ã•ãªã‚¿ã‚¹ã‚¯ã«åˆ†ã‘ã‚‰ã‚Œã‚‹', rev:false},
    {id:'pl4', text:'ãƒ¡ãƒ¢ã‚„æŒã¡ç‰©ãƒªã‚¹ãƒˆã§æŠœã‘æ¼ã‚Œã‚’é˜²ã’ã‚‹', rev:false},
  ]},
  { key:'SS', items:[
    {id:'ss1', text:'å›°ã£ãŸã‚‰ã‚®ãƒ«ãƒ‰ã‚„ä»²é–“ã«æ—©ã‚ã«ç›¸è«‡ã§ãã‚‹', rev:false},
    {id:'ss2', text:'åŠ©ã‘ã‚’æ±‚ã‚ã‚‹ã®ãŒæ°—ã¾ãšãã¦é¿ã‘ãŒã¡', rev:true},
    {id:'ss3', text:'äººã‚„æƒ…å ±ãªã©ã®ãƒªã‚½ãƒ¼ã‚¹ã‚’ä¸Šæ‰‹ãä½¿ãˆã‚‹', rev:false},
    {id:'ss4', text:'ã¤ã„ä¸€äººã§æŠ±ãˆè¾¼ã¿ãŒã¡', rev:true},
  ]},
  { key:'EF', items:[
    {id:'ef1', text:'é…’å ´ã®ã–ã‚ã¤ãã®ä¸­ã§ã‚‚ç›®ã®å‰ã«é›†ä¸­ã§ãã‚‹', rev:false},
    {id:'ef2', text:'é€šçŸ¥ã‚„èª˜æƒ‘ã§é›†ä¸­ãŒåˆ‡ã‚Œã‚„ã™ã„', rev:true},
    {id:'ef3', text:'çŸ­æ™‚é–“ã§ã‚‚ã‚°ãƒƒã¨é›†ä¸­ã‚’å…¥ã‚Œã‚‰ã‚Œã‚‹', rev:false},
    {id:'ef4', text:'ä½œæ¥­ä¸­ã™ãåˆ¥ã®ã“ã¨ã‚’å§‹ã‚ã¦ã—ã¾ã†', rev:true},
  ]},
  { key:'SE', items:[
    {id:'se1', text:'å·¥å¤«ã™ã‚Œã°ä½•ã¨ã‹ã§ãã‚‹ã¨æ„Ÿã˜ã‚‹', rev:false},
    {id:'se2', text:'è‡ªåˆ†ã®åˆ¤æ–­ã«è‡ªä¿¡ãŒæŒã¦ãªã„ã“ã¨ãŒå¤šã„', rev:true},
    {id:'se3', text:'åˆã‚ã¦ã®ãƒ€ãƒ³ã‚¸ãƒ§ãƒ³ã§ã‚‚æ‰‹æ¢ã‚Šã§é€²ã‚ã‚‹', rev:false},
    {id:'se4', text:'å¤±æ•—ã—ãã†ã§æ–°ã—ã„æŒ‘æˆ¦ã‚’é¿ã‘ãŒã¡', rev:true},
  ]},
];

/* ====== ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚° ====== */
const stage = document.getElementById('stage');
const btnSubmit = document.getElementById('btnSubmit');
const progBar = document.getElementById('progBar');
const cnt = document.getElementById('progCnt');
const actionRow = document.getElementById('actionRow');
const answers = Object.create(null);
const TITLE = 'å†’é™ºè€…é€†å¢ƒåŠ›è¨ºæ–­';

function renderAll(){
  const items = SECTIONS.flatMap(s=>s.items);
  let html = '';
  for (let i=0;i<items.length;i++){
    const it = items[i];
    html += `
      <div class="q" id="wrap_${it.id}">
        <div class="qtitle">Q${i+1}. ${it.text}</div>
        <div class="scaleRow">
          <span class="cap">é¸æŠï¼š</span>
          <div class="opt" role="radiogroup" aria-label="Q${i+1}">
            ${SCALE.map(sc=>{
              const rid = `${it.id}_${sc.v}`;
              return `
                <div>
                  <input id="${rid}" name="${it.id}" type="radio" value="${sc.v}">
                  <label for="${rid}" title="${sc.v}: ${sc.t}">${sc.t}</label>
                </div>
              `;
            }).join('')}
          </div>
        </div>
        <div class="scaleHint">ï¼ˆ${SCALE[0].t} â†”ï¸ ${SCALE[4].t}ï¼‰</div>
      </div>
    `;
  }
  stage.innerHTML = html;
  cnt.textContent = `0 / ${items.length}`;
}
renderAll();
restoreAnswers();   // â† å¾©å…ƒ
updateProgress();   // â† ãƒãƒ¼/ã‚«ã‚¦ãƒ³ãƒˆåæ˜ 

// ---- å›ç­”ã®ä¿å­˜/å¾©å…ƒï¼ˆkusemonäº’æ›ï¼‰ {ts, ans:{è¨­å•ID:å€¤}} ----
const SLUG   = 'adventure-shin';                   // æ—¢ã«ã‚ã‚‹ãªã‚‰é‡è¤‡å®šç¾©ã¯ä¸è¦
const ANS_KEY= 'specimens:'+SLUG+':answers';

function saveAnswers(){
  try{
    const out = {};
    document.querySelectorAll('#stage input[type="radio"]:checked').forEach(i=>{
      out[i.name] = parseInt(i.value,10);
    });
    localStorage.setItem(ANS_KEY, JSON.stringify({ts: Date.now(), ans: out}));
  }catch(e){}
}
function restoreAnswers(){
  try{
    const raw = localStorage.getItem(ANS_KEY);
    if(!raw) return;
    const data = JSON.parse(raw), ans = (data && data.ans) || {};
    Object.keys(ans).forEach(name=>{
      const v = ans[name];
      const input = document.getElementById(name + '_' + v);
      if(input){ input.checked = true; }
      // ãƒ¡ãƒ¢ãƒªå´ã«ã‚‚åæ˜ ï¼ˆé€ä¿¡ãƒœã‚¿ãƒ³æ´»æ€§åŒ–ã®ãŸã‚ï¼‰
      if(typeof answers === 'object'){ answers[name] = v; }
    });
  }catch(e){}
}
function wipeAnswers(){ try{ localStorage.removeItem(ANS_KEY); }catch(e){} }
/* å…¥åŠ›ãƒ»é€²æ— */
stage.addEventListener('change', (e)=>{
  if (e.target && e.target.type==='radio' && e.target.name){
    answers[e.target.name] = parseInt(e.target.value,10);
    const wrap = document.getElementById('wrap_'+e.target.name);
    if (wrap) wrap.classList.remove('miss');
    saveAnswers();     // â† è¿½åŠ ï¼šé¸ã¶ãŸã³ä¿å­˜
    updateProgress();
  }
});
function updateProgress(){
  const total   = SECTIONS.reduce((n,s)=>n+s.items.length,0);
  const filled  = Object.keys(answers).length;
  const pct     = Math.round(filled/total*100);

  // ãƒãƒ¼ã®è¦‹ãŸç›®
  var progBar = document.getElementById('progBar');
  if(progBar){
    progBar.style.width = pct + '%';
  }

  // æ•°å€¤è¡¨ç¤ºï¼ˆä¾‹ï¼š12 / 20ï¼‰
  var cnt = document.getElementById('progCnt') || document.getElementById('cnt');
  if(cnt){
    cnt.textContent = filled + ' / ' + total;
  }

  // é€ä¿¡ãƒœã‚¿ãƒ³ã®æ´»æ€§/éæ´»æ€§
  if (filled === total) btnSubmit.classList.remove('fakeDisabled');
  else                  btnSubmit.classList.add('fakeDisabled');

  // ARIAï¼ˆã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ï¼‰
  var shell = document.querySelector('.progressBar');
  if(shell){
    shell.setAttribute('role','progressbar');
    shell.setAttribute('aria-valuemin','0');
    shell.setAttribute('aria-valuemax', String(total));
    shell.setAttribute('aria-valuenow', String(filled));
    shell.setAttribute('aria-label', 'å›ç­”é€²æ—ï¼š' + filled + ' / ' + total);
  }
}

/* æ¡ç‚¹ï¼ˆé …ç›®æ•°ã«è‡ªå‹•å¯¾å¿œï¼‰ */
function scoreSection(sec){
  let raw=0, n=sec.items.length;
  for(const it of sec.items){
    const v = answers[it.id]??3;
    raw += it.rev ? (6-v) : v;
  }
  const pct = Math.round((raw - n) / (4 * n) * 100);
  return Math.max(0, Math.min(100, pct));
}

/* ãƒˆãƒƒãƒ—ã¨â€œè¿‘ã„å€™è£œâ€ã®ç®—å‡º */
function computeAll(){
  const pcts={};
  for(const sec of SECTIONS) pcts[sec.key]=scoreSection(sec);
  const overall = Math.round(Object.values(pcts).reduce((a,b)=>a+b,0)/SECTIONS.length);

  // å‹‡è€…ï¼ˆhero/00.pngï¼‰: å‹‡è€…ã®ã¿
  const minEach = Math.min(...Object.values(pcts));
  if (minEach>=HERO_RULE.minEach && overall>=HERO_RULE.minOverall){
    return {pcts, overall, job:HERO, tier:null, heroOnly:true, nearby:[], scores:[]};
  }

  // å„è·ã®é‡ã¿ä»˜ãã‚¹ã‚³ã‚¢ã‚’ç®—å‡º
  const scores = JOBS.map(j=>{
    const w=j.w;
    const sc =
      (pcts.GR||0)*(w.GR||0) + (pcts.RF||0)*(w.RF||0) + (pcts.FX||0)*(w.FX||0) +
      (pcts.PL||0)*(w.PL||0) + (pcts.SS||0)*(w.SS||0) + (pcts.EF||0)*(w.EF||0) +
      (pcts.SE||0)*(w.SE||0);
    return {job:j, score:Math.round(sc)};
  }).sort((a,b)=>b.score-a.score);

  const best = scores[0];
  const tier = tierOf(overall);

  // è¿‘ã„å€™è£œï¼ˆä¸Šä½ã¨ã®å·®ãŒ NEAR_DELTA ä»¥å†… & ç·åˆãŒä¸€å®šä»¥ä¸Šï¼‰
  let nearby=[];
  if (overall>=NEAR_MIN_OVERALL){
    nearby = scores.slice(1).filter(s=> (best.score - s.score) <= NEAR_DELTA )
                           .slice(0, NEAR_MAX);
  }

  return {pcts, overall, job:best.job, tier, heroOnly:false, nearby, scores};
}

function tierOf(overall){
  if (overall>=90) return {code:'05', name:'ä¼èª¬ç´š'};
  if (overall>=75) return {code:'04', name:'è‹±é›„'};
  if (overall>=60) return {code:'03', name:'ç†Ÿç·´'};
  if (overall>=40) return {code:'02', name:'ä¸€äººå‰'};
  return {code:'01', name:'è¦‹ç¿’ã„'};
}

/* çµæœè¡¨ç¤º */
const resultEl=document.getElementById('result');
const barsEl=document.getElementById('bars');
const jobLine=document.getElementById('jobLine');
const catchLine=document.getElementById('catchLine');
const tierBadge=document.getElementById('tierBadge');
const scoreBadge=document.getElementById('scoreBadge');
const descEl=document.getElementById('desc');
const art=document.getElementById('art');
const listStrength=document.getElementById('listStrength');
const listCaution=document.getElementById('listCaution');
const listQuest=document.getElementById('listQuest');
const listGrowth=document.getElementById('listGrowth');
const nearWrap=document.getElementById('nearby');
const nearList=document.getElementById('nearList');

btnSubmit.addEventListener('click', ()=>{
  saveAnswers(); // å¿µã®ãŸã‚ç›´å‰ä¿å­˜
  const total = SECTIONS.reduce((n,s)=>n+s.items.length,0);
  const filled = Object.keys(answers).length;
  if (filled!==total){
    const miss = SECTIONS.flatMap(s=>s.items).find(it=>answers[it.id]==null);
    if (miss){
      const w=document.getElementById('wrap_'+miss.id);
      if(w){ w.classList.add('miss'); w.scrollIntoView({behavior:'smooth', block:'center'}); }
    }
    return;
  }
  const R = computeAll();

  jobLine.textContent = `${R.job.name}`;
  catchLine.textContent = R.job.catch;
  scoreBadge.textContent = `ç·åˆ ${R.overall}`;
  tierBadge.textContent  = R.heroOnly ? 'å‹‡è€…' : `ç­‰ç´š ${R.tier.name}`;
  descEl.textContent     = R.job.desc;

  // èƒ½åŠ›ãƒãƒ¼
  barsEl.innerHTML='';
  for(const k of ['GR','RF','FX','PL','SS','EF','SE']){
    const v=R.pcts[k]||0;
    const row=document.createElement('div'); row.className='bar';
    row.innerHTML=`<div class="name">${FACTOR_NAMES[k]}</div>
                   <div class="meter"><i style="width:${v}%"></i></div>
                   <div style="text-align:right;font-variant-numeric:tabular-nums">${v}</div>`;
    barsEl.appendChild(row);
  }

  // ãƒªã‚¹ãƒˆ
  const fill = (elm, arr)=>{ elm.innerHTML=''; arr.forEach(t=>{ const li=document.createElement('li'); li.textContent=t; elm.appendChild(li); }); };
  fill(listStrength, R.job.strengths);
  fill(listCaution,  R.job.cautions);
  fill(listQuest,    R.job.quests);
  fill(listGrowth,   R.job.growth);

  // ãƒ¡ã‚¤ãƒ³ç”»åƒ
  renderArt(R);

  // è¿‘ã„å€™è£œ
  if (!R.heroOnly && R.nearby.length){
    nearWrap.style.display='';
    nearList.innerHTML='';
    R.nearby.forEach(({job})=>{
      const card=document.createElement('div');
      card.className='nearCard';
      const imgSrc = `/shindan/assets/results/adventure/${job.dir}/${R.tier.code}.png`;
      card.innerHTML = `
        <div class="nearThumb">
          <img src="${imgSrc}" alt="${job.name} ç”»åƒ" loading="lazy"
               onerror="this.alt='ç”»åƒãªã—';this.style.opacity=.3;">
        </div>
        <div class="nearBody">
          <div class="nearName">${job.name}</div>
          <div class="nearCatch">${job.catch}</div>
        </div>`;
      nearList.appendChild(card);
    });
  }else{
    nearWrap.style.display='none';
    nearList.innerHTML='';
  }

  // åˆ‡ã‚Šæ›¿ãˆ
  document.getElementById('intro').style.display='none';
  stage.style.display='none';
  actionRow.style.display='none';
  resultEl.style.display='';
var dock=document.getElementById('progDock'); if(dock) dock.style.display='none';
try{
  document.dispatchEvent(new Event('result:ready')); // â† ã“ã“ã‚Lvåˆå›³
  localStorage.setItem('specimens:last', JSON.stringify({ id: SLUG, title: TITLE, href: location.pathname }));
}catch(e){}
  // ãƒœã‚¿ãƒ³
  document.getElementById('btnSave').onclick=()=>saveCard(R);
  document.getElementById('btnRetry').onclick=resetAll;
});

function renderArt(R){
  const base = '/shindan/assets/results/adventure/';
  const imgPath = R.heroOnly
    ? `${base}${HERO.dir}/00.png`
    : `${base}${R.job.dir}/${R.tier.code}.png`;
  art.innerHTML = '';
  const pic = document.createElement('picture');
  const img = document.createElement('img');
  img.alt = `${R.job.name} ç”»åƒ`;
  img.decoding = 'async';
  img.loading = 'lazy';
  img.src = imgPath;
  img.onerror = ()=>{ art.innerHTML=''; const s=document.createElement('span'); s.textContent=R.job.icon; s.style.fontSize='64px'; art.appendChild(s); };
  pic.appendChild(img);
  art.appendChild(pic);
}

function resetAll(){
  for(const k in answers) delete answers[k];
  document.querySelectorAll('input[type=radio]').forEach(i=>i.checked=false);
  wipeAnswers(); // â† ãƒ­ãƒ¼ã‚«ãƒ«ã‚‚å‰Šé™¤
  document.getElementById('intro').style.display='';
  stage.style.display='';
  actionRow.style.display='';
  resultEl.style.display='none';
var dock=document.getElementById('progDock'); if(dock) dock.style.display='';
  updateProgress();
  window.scrollTo({top:0,behavior:'smooth'});
}

/* ç”»åƒä¿å­˜ï¼ˆçµæœã‚«ãƒ¼ãƒ‰ï¼‰ */
function wrapText(ctx,text,x,y,maxWidth,lineHeight){
  const chars=(text||'').split(''); let line='';
  for(let i=0;i<chars.length;i++){
    const test=line+chars[i];
    if(ctx.measureText(test).width>maxWidth && i>0){ ctx.fillText(line,x,y); line=chars[i]; y+=lineHeight; }
    else line=test;
  } ctx.fillText(line,x,y);
}
function saveCard(R){
  const canvas=document.getElementById('cardCanvas');
  const c=canvas.getContext('2d');
  const w=canvas.width,h=canvas.height;
  const g=c.createLinearGradient(0,0,0,h); g.addColorStop(0,'#fff8fb'); g.addColorStop(1,'#f3f7ff');
  c.fillStyle=g; c.fillRect(0,0,w,h);

  c.fillStyle='#2f2630'; c.font='700 44px system-ui'; c.fillText('å†’é™ºè€…é€†å¢ƒåŠ›è¨ºæ–­', 56, 88);
  c.font='600 26px system-ui'; c.fillStyle='#6f5f6a'; c.fillText('(CD-RISC/GRIT-Så‚è€ƒï¼7å› å­)', 520, 88);

  c.font='700 36px system-ui'; c.fillStyle='#2b2230'; c.fillText(`${R.job.name}`, 56, 150);
  c.font='600 26px system-ui'; c.fillStyle='#4b3d48'; c.fillText(R.job.catch, 56, 188);

  c.font='600 24px system-ui'; c.fillStyle='#3f2e38';
  const tierText = R.heroOnly ? 'å‹‡è€…' : `ç­‰ç´š ${R.tier.name}`;
  c.fillText(`ç·åˆ ${R.overall}ã€€${tierText}`, 56, 226);

  c.font='400 22px system-ui'; c.fillStyle='#4a3f4a';
  wrapText(c, R.job.desc, 56, 266, 970, 30);

  let y=360;
  for(const k of ['GR','RF','FX','PL','SS','EF','SE']){
    const v=R.pcts[k]||0;
    c.fillStyle='#3f2e38'; c.font='600 22px system-ui'; c.fillText(FACTOR_NAMES[k], 56, y);
    const X=210,Y=y-16,W=740,H=16;
    c.fillStyle='#efe7f5'; c.strokeStyle='#e5daef'; c.lineWidth=1;
    c.fillRect(X,Y,W,H); c.strokeRect(X,Y,W,H);
    const grad=c.createLinearGradient(X,0,X+W,0); grad.addColorStop(0,'#a796ff'); grad.addColorStop(1,'#ff8fb3');
    c.fillStyle=grad; c.fillRect(X,Y,Math.round(W*v/100),H);
    c.fillStyle='#4a4150'; c.font='600 20px system-ui'; c.fillText(String(v), X+W+16, y);
    y+=54;
  }

  function drawList(title, arr, startY){
    c.fillStyle='#2f2630'; c.font='700 24px system-ui'; c.fillText(title, 56, startY);
    c.font='400 20px system-ui'; c.fillStyle='#4b3f4b';
    let ty=startY+34;
    arr.forEach(t=>{ wrapText(c,'ãƒ»'+t, 56, ty, 970, 28); ty+=30; });
    return ty+8;
  }
  y = drawList('å¼·ã¿', R.job.strengths, y+12);
  y = drawList('æ°—ã‚’ã¤ã‘ãŸã„ã“ã¨', R.job.cautions, y+12);
  y = drawList('æ—¥å¸¸ã‚¯ã‚¨ã‚¹ãƒˆ', R.job.quests, y+12);
  y = drawList('è‚²æˆãƒ’ãƒ³ãƒˆ', R.job.growth, y+12);

  c.font='400 16px system-ui'; c.fillStyle='#7c6b77';
  c.fillText(new Date().toLocaleString(), 56, h-36);

  const a=document.createElement('a');
  a.href=canvas.toDataURL('image/png');
  a.download='adventure_result.png';
  a.click();
}

/* åˆæœŸ */
updateProgress();
</script>
<script>
/* ã“ã“ã‚Lv/æ¸ˆã‚«ã‚¦ãƒ³ãƒˆï¼ˆçµæœæç”»ã®åˆå›³ã§ä¸€åº¦ã ã‘ï¼‰ */
(function(){
  'use strict';
  var DONE_KEY    = 'specimens:open:byid';
  var TOTAL_KEY   = 'specimens:open:total';
  var GLOBAL_LAST = 'specimens:open:global:last';
  var MY_ID = (document.body && document.body.getAttribute('data-id')) || 'unknown';
  var COUNTAPI_NS  = 'haisuikounozarigani_shindan';
  var COUNTAPI_KEY = 'specimens_open_total';
  function hitEveryone(){
    var url = 'https://api.countapi.xyz/hit/'+COUNTAPI_NS+'/'+COUNTAPI_KEY;
    if(navigator.sendBeacon){ try{ navigator.sendBeacon(url); }catch(_){ }
    }else{ fetch(url, {mode:'cors', cache:'no-store', keepalive:true}).catch(function(){}); }
  }
  var marked=false;
  function markOnce(){
    if(marked) return; marked=true;
    try{
      localStorage.setItem(TOTAL_KEY, String((+localStorage.getItem(TOTAL_KEY)||0)+1));
      var map={}; try{ map=JSON.parse(localStorage.getItem(DONE_KEY)||'{}'); }catch(_){}
      map[MY_ID]=(map[MY_ID]||0)+1;
      localStorage.setItem(DONE_KEY, JSON.stringify(Object.assign({},map,{_ts:Date.now()})));
      hitEveryone();
      try{ localStorage.setItem(GLOBAL_LAST, String((+localStorage.getItem(GLOBAL_LAST)||0)+1)); }catch(_){}
    }catch(_){}
  }
  document.addEventListener('result:ready', markOnce);
  setTimeout(markOnce, 2000); // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
})();
</script>
</body>
</html>