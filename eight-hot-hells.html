<!doctype html>

<html lang="ja">

<head>

<meta charset="utf-8">

<meta name="viewport" content="width=device-width,initial-scale=1">

<title>現代ストレス八熱地獄（怒りベース）｜24項目で“怒り温度”を可視化</title>

<meta name="description" content="八熱地獄モチーフで現代の“怒り温度”を8因子×各3項目・5件法で可視化するセルフチェック。エンタメ用。医療目的ではありません。">

<meta name="theme-color" content="#fff7fd">



<!-- OG -->

<meta property="og:type" content="website">

<meta property="og:title" content="現代ストレス八熱地獄（怒りベース）">

<meta property="og:description" content="等活・黒縄・衆合・叫喚・大叫喚・焦熱・大焦熱・阿鼻の8因子で“怒り温度”を可視化。">

<meta property="og:image" content="/shindan/assets/results/eight-hot-hells/t01.webp">

<meta property="og:url" content="/shindan/eight-hot-hells.html">



<style>

  :root{

    --bg1:#fff7fd; --bg2:#f5f7ff; --paper:#ffffff; --ink:#14131a; --muted:#6b6a77;

    --line:#ebe7f3; --accent:#8c6bff; --accent2:#ff8fc7;

  }

  *{box-sizing:border-box} html,body{height:100%}

  body{margin:0;color:var(--ink);font-family:"Noto Sans JP",system-ui,-apple-system,Segoe UI,Roboto,"Hiragino Kaku Gothic ProN","Yu Gothic UI","YuGothic",Meiryo,sans-serif;background:linear-gradient(160deg,var(--bg1),var(--bg2));line-height:1.85;letter-spacing:.02em}

  header{position:sticky;top:0;z-index:5;background:rgba(255,255,255,.92);backdrop-filter:saturate(1.1) blur(8px);border-bottom:1px solid var(--line)}

  - header .in{max-width:980px;margin:auto;padding:12px 16px;display:flex;gap:12px;align-items:center}
+ header .in{max-width:980px;margin:auto;padding:12px 16px;display:flex;gap:12px;align-items:center;flex-wrap:wrap}
/* 進捗バーをヘッダー2段目・全幅に */
header .progress{flex:1 1 100%; order:3; margin-top:6px}
header .crumb{order:2; margin-left:auto}
  h1{font-size:18px;margin:0;font-weight:800}

  .crumb{margin-left:auto;color:var(--muted);font-size:12px}



  main{max-width:980px;margin:0 auto;padding:22px 16px 120px}

  .panel{background:var(--paper);border:1px solid var(--line);border-radius:16px;padding:16px;box-shadow:0 10px 28px rgba(0,0,0,.06)}

  .lead{color:var(--muted);margin-top:6px}

  .warn{margin:12px 0;border:1px dashed #e9b6c8;background:#fff7fb;color:#432;padding:10px;border-radius:12px}

  .warn strong{color:#b12a6b}

  .section-title{margin:12px 0 8px;font-size:15px;font-weight:800}



  .q{border-top:1px solid var(--line);padding:12px 0}

  .q:first-child{border-top:0}

  .q .ttl{font-weight:700}

  .scale{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}

  .opt{flex:1 1 180px;min-width:160px;border:1px solid var(--line);border-radius:12px;padding:8px 10px;display:flex;gap:8px;align-items:center;background:#fff;cursor:pointer}

  .opt input{accent-color:var(--accent);transform:translateY(1px)}

  .muted{color:var(--muted)}



/* header progress (nohスタイル) */
header .in{max-width:980px;margin:auto;padding:12px 16px;display:flex;gap:12px;align-items:center;flex-wrap:wrap}
.header-progress{flex:1 1 100%; display:flex; align-items:center; gap:8px; margin-top:6px}
.header-progress .progress{flex:1; height:6px; background:#edf2fb; border-radius:999px; overflow:hidden}
.header-progress .progress>span{display:block; height:100%; width:0; background:linear-gradient(90deg,var(--accent),var(--accent2)); transition:width .25s ease}
.header-progress .ptext{font-size:12px; color:var(--muted)}

  .actions{display:flex;gap:10px;margin-top:14px;flex-wrap:wrap}

  .btn{appearance:none;border:1px solid var(--line);background:linear-gradient(180deg,#fff,#f7f7fb);padding:10px 14px;border-radius:12px;cursor:pointer;font-weight:700;color:var(--ink)}

  .btn.primary{background:linear-gradient(90deg,var(--accent),var(--accent2));color:#fff;border-color:transparent}

  .btn[disabled]{opacity:.55;cursor:not-allowed}

  .btn.linklike{background:#fff}



  /* Results */

  #result{margin-top:18px;display:none}

  figure.hero{margin:10px 0;border:1px solid var(--line);border-radius:14px;overflow:hidden;background:#fff;aspect-ratio:1/1}

  .badge{padding:2px 8px;border-radius:999px;border:1px solid var(--line);font-size:12px;background:#fff}

  .stage{display:flex;align-items:center;gap:8px;flex-wrap:wrap;font-weight:800}

  .copy{color:#4a3d57;margin:6px 0 0}

  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:10px;margin-top:10px}

  .card{border:1px solid var(--line);border-radius:14px;padding:12px;background:#fff}

  .card .name{font-weight:800}

  .meter{height:6px;background:#f0ecfb;border-radius:999px;overflow:hidden;margin-top:8px}

  .meter > i{display:block;height:100%;background:linear-gradient(90deg,var(--accent),var(--accent2))}

  .small{font-size:.95em}

  details{margin-top:8px}

  summary{cursor:pointer;color:#5c4d7a;font-weight:700}


</style>

</head>

<body data-id="eight-hot-hells">

<header><div class="in">

  <h1>現代ストレス八熱地獄（怒りベース）</h1>

  <span class="crumb">24項目・1〜5 → 8因子％＋総合“怒り温度”</span>
<div class="header-progress" aria-live="polite">
  <div class="progress" role="progressbar" aria-valuemin="0" aria-valuemax="24" aria-valuenow="0">
    <span id="prog"></span>
  </div>
  <div id="ptext" class="ptext">0 / 24</div>
</div>
</div></header>



<main>

  <section class="panel" id="quiz">

    <div>

      <div class="ttl"><strong>八熱地獄モチーフを現代のストレス文脈に再構成</strong>。8因子×各3項目・5件法で“怒り温度”を可視化します。</div>

      <p class="lead">答え方（1〜5）：1 まったく当てはまらない／2 あまり当てはまらない／3 どちらとも言えない／4 やや当てはまる／5 とても当てはまる</p>

 
    </div>



    <!-- 質問（因子名は非表示・毎回ランダム） -->

    <div id="qbox"></div>




    <!-- 操作 -->

    <div class="actions">

      <button id="btnCalc" class="btn primary" disabled>結果を見る</button>

      <button id="btnReset" class="btn">リセット</button>

      <a href="/shindan/" class="btn linklike" role="button">診断一覧に戻る</a>

    </div>



    <!-- 結果 -->

    <div id="result" class="panel">

      <h2 class="section-title" style="font-size:18px">結果</h2>



      <div id="head" class="stage" style="margin-bottom:8px"></div>



      <!-- ヒーロー：トップ因子の画像＆コピー -->

      <figure class="hero"><img id="heroImg" src="" alt="" style="width:100%;height:100%;object-fit:cover;display:block" loading="lazy"></figure>

      <p class="copy" id="heroCopy"></p>



      <h3 class="section-title">全体プロファイル（8因子）</h3>

      <div class="grid" id="all"></div>



      <details>

        <summary>帯域（%）のめやす</summary>

        <div class="small muted">

          <p><b>低め</b> 0–39 ／ <b>中間</b> 40–69 ／ <b>高め</b> 70–100</p>

        </div>

      </details>



      <div style="margin-top:14px">

        <a href="/shindan/" class="btn linklike">診断一覧に戻る</a>

      </div>

    </div>

  </section>
<section class="panel warn">
  <h3 style="margin:4px 0 8px">ご利用にあたって（免責）</h3>
  <ul class="small" style="margin:6px 0 0 1.2em; line-height:1.8">
    <li><strong>エンタメ＋自己理解：</strong>本ページは娯楽目的のセルフチェックです。医療的な診断・治療・助言を目的としません。</li>
    <li><strong>非公式コンテンツ：</strong>心理学領域に着想を得た<strong>独自制作</strong>であり、既存の質問票の権利者による承認・推奨・提携を意味しません。</li>
    <li><strong>プライバシー：</strong>回答は端末内で処理され、サーバー送信は行いません（みんなのLvは匿名の総数のみ集計）。</li>
    <li><strong>体調優先：</strong>強い苦痛や体調不良が続く場合は、医療機関や専門家にご相談ください。</li>
  </ul>
</section>
</main>



<script>

(()=> {

  // ===== 画像パス（等活=01.webp … 阿鼻=08.webp）=====

  const IMG_BASE = '/shindan/assets/results/eight-hot-hells/';

  const IMAGE_BY_KEY = {

    TK:'t01.webp', // 等活（衝動）

    KR:'t02.webp', // 黒縄（拘束）

    SG:'t03.webp', // 衆合（人混み）

    KK:'t04.webp', // 叫喚（割込）

    DK:'t05.webp', // 大叫喚（蒸し返）

    SN:'t06.webp', // 焦熱（時間）

    DS:'t07.webp', // 大焦熱（過負荷）

    AB:'t08.webp', // 阿鼻（崩壊）

  };



  // ===== 因子キーと表示名 =====

  const FACTOR_LABEL = {

    TK:'等活（衝動）',

    KR:'黒縄（拘束）',

    SG:'衆合（人混み）',

    KK:'叫喚（割込）',

    DK:'大叫喚（蒸し返）',

    SN:'焦熱（時間）',

    DS:'大焦熱（過負荷）',

    AB:'阿鼻（崩壊）',

  };



  // ===== 項目（各3・rev=true は逆転）=====

  const FACTORS = [

    {key:'TK', items:[

      {t:'予定が数分ずれるだけで、そわそわして落ち着かなくなる', rev:false},

      {t:'カチカチ音や生活音などの小さな音に、じわじわイラつきが増える', rev:false},

      {t:'待ち時間ができても、特に気にせず過ごせる', rev:true},

    ]},

    {key:'KR', items:[

      {t:'割り込みや横入りを見ると、自分のことではなくても腹が立つ', rev:false},

      {t:'会議で時間や手順を守らない人がいると、その後の話が頭に入らない', rev:false},

      {t:'軽いマナー違反なら、流して気持ちを切り替えられる', rev:true},

    ]},

    {key:'SG', items:[

      {t:'人混みで歩調が合わない人を見ると、ついイラッとしてしまう', rev:false},

      {t:'大人数の集まりは、雑音に消耗して不機嫌になりやすい', rev:false},

      {t:'混雑していても、気分を保って用事をこなせる', rev:true},

    ]},

    {key:'KK', items:[

      {t:'作業中の通知や声かけが続くと、イラつきが一段上がる', rev:false},

      {t:'短時間に依頼が重なると、返答がつい簡潔になり過ぎる', rev:false},

      {t:'割り込みが続いても、ひと呼吸して平常に戻せる', rev:true},

    ]},

    {key:'DK', items:[

      {t:'一度もめた相手の発言は、その後もしばらく気に障る', rev:false},

      {t:'過去の言い方を思い出して、後からまた腹が立ってくる', rev:false},

      {t:'言い合いがあっても、用が済めば気持ちを切り替えられる', rev:true},

    ]},

    {key:'SN', items:[

      {t:'締切前は、人のペースに合わせるのがつらくなる', rev:false},

      {t:'行列や渋滞で予定が崩れると、焦りと苛立ちが同時に強まる', rev:false},

      {t:'急ぎの時でも、周囲への当たりはきつくならない', rev:true},

    ]},

    {key:'DS', items:[

      {t:'同時に多くのことを頼まれると、細かなミスに強く当たりたくなる', rev:false},

      {t:'機材トラブルやシステム遅延に、想像以上に苛立ってしまう', rev:false},

      {t:'状況が混乱しても、感情の温度を下げ直せる', rev:true},

    ]},

    {key:'AB', items:[

      {t:'うまく進まないと、自分に腹を立てて余計に手が止まる', rev:false},

      {t:'「何をやっても変わらない」と感じると、周囲の小さなことにも当たりが強くなる', rev:false},

      {t:'思い通りにいかない日でも、自分にきつく当たりすぎずに済む', rev:true},

    ]},

  ];



  // 5件法（1..5）

  const SCALE = [

    {v:1, label:'1 まったく当てはまらない'},

    {v:2, label:'2 あまり当てはまらない'},

    {v:3, label:'3 どちらとも言えない'},

    {v:4, label:'4 やや当てはまる'},

    {v:5, label:'5 とても当てはまる'},

  ];



  // 帯域コメント（低/中/高）

  const BAND_COMMENTS = {

    TK:{low:'細かなズレや雑音に飲まれにくい安定タイプ。待つ力が強み。',

        mid:'些細な刺激は気になるが、切り替えも効く実務型。',

        high:'小さな苛立ちが積み上がりやすい。疲労や環境要因の影響大。',

        tip:'刺激遮断（通知まとめ・静音）＋“10秒呼吸”。'},

    KR:{low:'ルールの揺らぎに柔軟。大局を見やすい。',

        mid:'秩序を大切にしつつ現実対応も可。職場で信頼されやすい。',

        high:'手順逸脱や横入りに強烈反応。正義感は武器だが疲れやすい。',

        tip:'「注意のコスト」と目的を天秤に。伝えるなら短く具体的に。'},

    SG:{low:'雑踏でも機嫌を保ちやすい。マイペース維持が得意。',

        mid:'混雑は疲れるが対処可能。予定にバッファを持たせると安定。',

        high:'人混み・大人数で苛立ち増幅。消耗が早い。',

        tip:'耳栓・回避ルート・短時間参加など“接触時間を設計”。'},

    KK:{low:'割り込み刺激に流されにくい。集中の再建が早い。',

        mid:'割り込みが続くと短気になりがちだが、切り替えで戻せる。',

        high:'多重呼びかけで一気に沸点へ。丁寧さが崩れやすい。',

        tip:'ディープワーク枠・サイレントモード・返答を決める。'},

    DK:{low:'嫌な出来事の反芻が短く、回復が速い。',

        mid:'しばらくは引きずるが、別視点で収束可能。',

        high:'“後追い怒り”が長引きがち。睡眠にも影響。',

        tip:'反芻禁止ルール（時間箱5分）＋体を動かす切替で断つ。'},

    SN:{low:'時間の揺らぎに寛容。チームを落ち着かせられる。',

        mid:'切迫場面ではピリつくが、役割整理で踏ん張れる。',

        high:'時間圧で対人摩擦が増えやすい。視野が狭くなる。',

        tip:'バッファ（余裕）30％設計、“最初の1手”テンプレ常備。'},

    DS:{low:'負荷が増えても温度上昇は緩やか。粘り強い。',

        mid:'負荷ピークでは短気に傾くが、調整で戻せる。',

        high:'多重タスク＋障害で爆発しやすい。二次被害に注意。',

        tip:'WIP制限・優先度明文化・5分復旧プロトコル。'},

    AB:{low:'結果が出ない時も自己攻撃に傾きにくい。立て直しが効く。',

        mid:'空回り時に自己苛立ちが顔を出すが、ケアで戻せる。',

        high:'無力感と怒りが絡まり、投げ出し衝動へ。',

        tip:'可動域を最小化（5分だけ）。小勝ちログで回復。'}

  };



  // 総合コメント

  function overallBand(p){

    if(p<=24) return {name:'ぬるめ', text:'刺激に流されにくい低反応タイプ。緊急時は“動き出しの合図”を。'};

    if(p<=49) return {name:'中火',   text:'状況次第で上がるが、切り替え可能。通知設計と時間に余裕を。'};

    if(p<=74) return {name:'強火',   text:'外乱が重なると一気に温度上昇。割り込み制御とWIP制限を。'};

    return           {name:'業火',   text:'慢性的に高温。環境調整＋休息の固定化を最優先に。'};

  }



  // DOM

  const $  = (q,root=document)=>root.querySelector(q);

  const $$ = (q,root=document)=>[...root.querySelectorAll(q)];

  const qbox = $('#qbox'), prog = $('#prog'), ptext = $('#ptext');

  const btnCalc = $('#btnCalc'), btnReset = $('#btnReset');

  const res = $('#result'), head = $('#head'), allBox = $('#all');

  const heroImg = $('#heroImg'), heroCopy = $('#heroCopy');



  // シャッフル

  function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; } return a; }



  // 設問をフラット化 → ランダム

  const QUESTIONS = shuffle(FACTORS.flatMap(f => f.items.map(it => ({ key:f.key, text:it.t, rev:it.rev }))));



  // 質問描画

  QUESTIONS.forEach((q, i)=>{

    const s = document.createElement('section');

    s.className = 'q';

    s.innerHTML = `

      <div class="ttl">Q${i+1}. ${q.text}</div>

      <div class="scale" role="group" aria-label="質問 ${i+1}">

        ${SCALE.map(sc=>{

          const id = `q${i+1}-${sc.v}`;

          return `<label class="opt" for="${id}">

            <input type="radio" name="q${i+1}" id="${id}" value="${sc.v}">

            <span>${sc.label}</span>

          </label>`;

        }).join('')}

      </div>`;

    qbox.appendChild(s);

  });



  // 進捗

  const TOTAL = QUESTIONS.length;

  function answeredCount(){ let n=0; for(let i=1;i<=TOTAL;i++){ if($('input[name="q'+i+'"]:checked')) n++; } return n; }

  function updateProgress(){

    const n=answeredCount();

    ptext.textContent = `${n} / ${TOTAL}`;

    prog.style.width = Math.round(n/TOTAL*100)+'%';
const shell = document.querySelector('.progress[role="progressbar"]');
if (shell) shell.setAttribute('aria-valuenow', String(n));
btnCalc.disabled = (n < TOTAL);
  }

  document.addEventListener('change', e=>{ if(e.target.name?.startsWith('q')) updateProgress(); });

  updateProgress();



  // 集計

  function collect(){

    const vals={};

    for(let i=1;i<=TOTAL;i++){

      const el = $('input[name="q'+i+'"]:checked'); if(!el) return null;

      vals[i] = +el.value; // 1..5

    }

    return vals;

  }



  // スコア計算（因子％、総合％）

  function compute(vals){

    const sums = {TK:0,KR:0,SG:0,KK:0,DK:0,SN:0,DS:0,AB:0};

    const cnts = {TK:0,KR:0,SG:0,KK:0,DK:0,SN:0,DS:0,AB:0};



    QUESTIONS.forEach((q, idx)=>{

      const v = vals[idx+1];                 // 1..5

      const vv = q.rev ? (6 - v) : v;        // 逆転適用

      sums[q.key] += vv;

      cnts[q.key] += 1;

    });



    const factors = Object.keys(sums).map(key=>{

      const avg = sums[key]/cnts[key];       // 1..5

      const pct = Math.round(((avg-1)/4)*100); // 0..100

      return {key, name:FACTOR_LABEL[key], pct, avg:Math.round(avg*10)/10};

    });



    const overallPct = Math.round(factors.reduce((a,x)=>a+x.pct,0)/factors.length);

    return {factors, overallPct};

  }



  // 帯域判定

  function band(p){ if(p>=70) return 'high'; if(p>=40) return 'mid'; return 'low'; }

  function bandLabel(p){ if(p>=70) return '高め'; if(p>=40) return '中間'; return '低め'; }



  // 結果描画

  function render(vals){

    const {factors, overallPct} = compute(vals);



    // トップ因子（％で最大）を決定

    const top = [...factors].sort((a,b)=>b.pct-a.pct)[0];

    const ob = overallBand(overallPct);



    // ヘッダ（総合）

    head.innerHTML = `

      <span class="badge">総合 怒り温度 ${overallPct}%（${ob.name}）</span>

      <span class="badge">${ob.text}</span>

    `;



    // ヒーロー画像＆コピー（トップ因子に対応した01〜08.webp）

    const imgFile = IMAGE_BY_KEY[top.key] || 't01.webp';

    heroImg.src = IMG_BASE + imgFile;

    heroImg.alt = top.name + 'のイメージ';

    const bc = BAND_COMMENTS[top.key];

    const btxt = (band(top.pct)==='high') ? bc.high : (band(top.pct)==='mid' ? bc.mid : bc.low);

    heroCopy.innerHTML = `最も温度が高い因子は<strong>「${top.name}」</strong>（<b>${top.pct}%・${bandLabel(top.pct)}</b>）。<br>${btxt}<br><span class="muted"><b>ひとことヒント：</b>${bc.tip}</span>`;



    // 因子カード（01→08の順で表示）

    allBox.innerHTML='';

    const order = ['TK','KR','SG','KK','DK','SN','DS','AB'];

    order.map(k => factors.find(f=>f.key===k)).forEach(f=>{

      const bkey = band(f.pct);

      const bc = BAND_COMMENTS[f.key];

      const line = (bkey==='high') ? bc.high : (bkey==='mid' ? bc.mid : bc.low);



      const card = document.createElement('article');

      card.className = 'card small';

      card.innerHTML = `

        <div class="name" style="display:flex;align-items:center;gap:8px;flex-wrap:wrap">

          <span>${f.name}</span>

          <span class="badge">${f.pct}%</span>

          <span class="badge">${bandLabel(f.pct)}</span>

        </div>

        <div class="meter"><i style="width:${f.pct}%"></i></div>

        <p style="margin:.7em 0 0">${line}</p>

        <p class="muted" style="margin:.3em 0 0"><b>ヒント：</b>${BAND_COMMENTS[f.key].tip}</p>

      `;

      allBox.appendChild(card);

    });



    res.style.display='block';
res.scrollIntoView({behavior:'smooth',block:'start'});
try{ document.dispatchEvent(new Event('result:ready')); }catch(_){}

  }



// イベント（重複を解消）

btnCalc.addEventListener('click', ()=>{

  const vals = collect(); if(!vals) return;

  render(vals);

});



btnReset.addEventListener('click', ()=>{

  $$('input[type="radio"]').forEach(i=>i.checked=false);

  prog.style.width='0%';

  ptext.textContent='0 / 24';

  res.style.display='none';

  head.innerHTML='';

  allBox.innerHTML='';

  heroImg.removeAttribute('src');

  heroImg.alt='';

  heroCopy.textContent='';

  btnCalc.disabled = true;
  
  

});


})();



</script>
<script>
/* ============================================================
   診断ページ共通スニペット（コピペ用）
   1) 回答の自動保存・自動復元（入力中も逐次保存）
   2) 結果表示タイミングで「済」＋ あなたのLv +1
   3) みんなのこころLv（CountAPI）に +1（失敗は無視）
   ------------------------------------------------------------
   ★置き場所：各診断HTMLの </body> の直前
   ★ページID：<body data-id="xxxxx"> を推奨（未設定でも動作）
============================================================ */
(function(){
  'use strict';

  // ===== 固定キー：index.html と合わせてあります =====
  var DONE_KEY   = 'specimens:open:byid';   // 診断ごとの「済」マップ
  var TOTAL_KEY  = 'specimens:open:total';  // あなたのこころLv（合計）
  var GLOBAL_LAST= 'specimens:open:global:last'; // みんなのLvの前回表示キャッシュ

  // ===== このページのID =====
  var MY_ID = (document.body && document.body.getAttribute('data-id')) || 'unknown';

  // ===== 回答保存ストレージ（この診断だけの箱） =====
  var ANSWER_KEY = 'specimens:answers:' + MY_ID;

  // ===== みんなのLv（CountAPI設定） =====
  var COUNTAPI_NS  = 'haisuikounozarigani_shindan';
  var COUNTAPI_KEY = 'specimens_open_total';
  function countapiHit(){
    var url = 'https://api.countapi.xyz/hit/'+COUNTAPI_NS+'/'+COUNTAPI_KEY;
    if(navigator.sendBeacon){
      try{ navigator.sendBeacon(url); }catch(_){}
    }else{
      fetch(url, {mode:'cors', cache:'no-store', keepalive:true}).catch(function(){});
    }
  }

  // ---------- 回答の保存/復元 ----------
  function loadState(){
    try{ return JSON.parse(localStorage.getItem(ANSWER_KEY) || '{}'); }catch(_){ return {}; }
  }
  function saveState(obj){
    try{ localStorage.setItem(ANSWER_KEY, JSON.stringify(obj)); }catch(_){}
  }
  function saveField(el){
    if(!el || !el.name) return;
    var st = loadState();
    var nm = el.name;

    if(el.type === 'radio'){
      // ラジオは選ばれた value を保存
      var chosen = (el.form || document).querySelector('input[type="radio"][name="'+nm+'"]:checked');
      st[nm] = chosen ? {t:'r', v: chosen.value} : {t:'r', v:null};
    }else if(el.type === 'checkbox'){
      // チェックボックスは同名グループのチェック済み value 配列
      var all = (el.form || document).querySelectorAll('input[type="checkbox"][name="'+nm+'"]');
      var vals = [];
      all.forEach(function(c){ if(c.checked) vals.push(c.value || 'on'); });
      st[nm] = {t:'c', v: vals};
    }else if(el.tagName==='SELECT'){
      if(el.multiple){
        var arr=[]; [].slice.call(el.options).forEach(function(o){ if(o.selected) arr.push(o.value); });
        st[nm] = {t:'m', v: arr};
      }else{
        st[nm] = {t:'s', v: el.value};
      }
    }else{
      // text / number / textarea など
      st[nm] = {t:'t', v: el.value};
    }
    saveState(st);
  }
  function restoreOnce(){
    var st = loadState();
    var names = Object.keys(st);
    if(!names.length) return false;

    names.forEach(function(nm){
      var info = st[nm]; if(!info) return;

      if(info.t==='r'){
        var r = document.querySelector('input[type="radio"][name="'+nm+'"][value="'+CSS.escape(String(info.v))+'"]');
        if(r){ r.checked = true; r.dispatchEvent(new Event('change',{bubbles:true})); }
      }else if(info.t==='c'){
        var all = document.querySelectorAll('input[type="checkbox"][name="'+nm+'"]');
        var set = new Set(info.v||[]);
        all.forEach(function(c){ c.checked = set.has(c.value || 'on'); });
      }else if(info.t==='m'){
        var sel = document.querySelector('select[name="'+nm+'"]');
        if(sel){
          var setm = new Set(info.v||[]);
          [].slice.call(sel.options).forEach(function(o){ o.selected = setm.has(o.value); });
        }
      }else if(info.t==='s'){
        var s = document.querySelector('select[name="'+nm+'"]');
        if(s){ s.value = info.v; }
      }else{
        var t = document.querySelector('[name="'+nm+'"]');
        if(t){ t.value = info.v==null? '' : String(info.v); }
      }
    });
    // プログレス等を更新したいUIのため、軽く change を投げる
    try{
      document.dispatchEvent(new Event('change', {bubbles:true}));
    }catch(_){}
    return true;
  }
  // 入力監視（保存）
  document.addEventListener('change', function(e){
    var el = e.target;
    if(!(el instanceof HTMLElement)) return;
    if(el.matches('input[name], select[name], textarea[name]')) saveField(el);
  }, true);
  document.addEventListener('input', function(e){
    var el = e.target;
    if(!(el instanceof HTMLElement)) return;
    if(el.matches('input[type="text"][name], input:not([type])[name], textarea[name]')) saveField(el);
  }, true);

  // 復元は「入力が描画されてから」一度だけ試みる（動的生成にも対応）
  (function restoreWhenReady(){
    var TRY_MAX=12, tries=0;
    function tick(){
      tries++;
      // 入力が一つでも見つかってから復元
      var hasAny = document.querySelector('input[name], select[name], textarea[name]');
      if(hasAny){
        restoreOnce(); return;
      }
      if(tries<TRY_MAX){ setTimeout(tick, 300); }
    }
    if(document.readyState==='complete' || document.readyState==='interactive'){ tick(); }
    else document.addEventListener('DOMContentLoaded', tick);
  })();

  // リセット系ボタンがあれば保存も削除（#btnReset / data-role="reset" を想定）
  function clearAnswers(){
    try{ localStorage.removeItem(ANSWER_KEY); }catch(_){}
  }
  document.addEventListener('click', function(e){
    var t = e.target;
    if(!(t instanceof HTMLElement)) return;
    if(t.id==='btnReset' || t.matches('[data-role="reset"]')) clearAnswers();
  }, true);

  // ---------- 結果確定で「済」＋Lv加算 ----------
  var marked = false;
  function markOnce(){
    if(marked) return; marked = true;
    try{
      // 1) あなたのこころLv 合計 +1
      var total = (+localStorage.getItem(TOTAL_KEY) || 0) + 1;
      localStorage.setItem(TOTAL_KEY, String(total));

      // 2) この診断の「済」を +1（他タブ即時反映用にタイムスタンプ混ぜる）
      var map={}; try{ map = JSON.parse(localStorage.getItem(DONE_KEY) || '{}'); }catch(_){}
      map[MY_ID] = (map[MY_ID] || 0) + 1;
      localStorage.setItem(DONE_KEY, JSON.stringify(Object.assign({}, map, {_ts: Date.now()})));

      // 3) みんなのこころLv +1（表示は index 側で取得／ここでは送るだけ）
      countapiHit();
      // ついでに前回キャッシュも+1（index初期表示の見栄え改善）
      try{
        var last = (+localStorage.getItem(GLOBAL_LAST) || 0) + 1;
        localStorage.setItem(GLOBAL_LAST, String(last));
      }catch(_){}
    }catch(_){}
  }

  // A) 結果が描画された合図（推奨：各ページの集計完了時に dispatch してください）
  //   例）document.dispatchEvent(new Event('result:ready'));
  document.addEventListener('result:ready', markOnce);

  // B) フォールバック：結果UIが見えてから2秒後に一度だけ実行（戻る無しでも確実に「済」）
  setTimeout(markOnce, 2000);
})();
</script>
</body>

</html>