<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>æ€è€ƒã‚¯ã‚»ãƒ¢ãƒ³è¨ºæ–­</title>
<meta name="description" content="25å•ã§â€œè¦‹ãˆæ–¹ã®ã‚¯ã‚»â€ã‚’10ä½“ã®ã‚¯ã‚»ãƒ¢ãƒ³ã¨ã—ã¦å›³é‘‘åŒ–ã€‚ä¸»å½¹ã‚¯ã‚»ãƒ¢ãƒ³ï¼‹ç›¸æ£’ã¨Lvã‚’è¡¨ç¤ºã€‚ã‚¨ãƒ³ã‚¿ãƒ¡è‡ªå·±ç†è§£ã§ã™ã€‚">
<meta name="theme-color" content="#f7f9ff">
<meta property="og:type" content="website">
<meta property="og:title" content="æ€è€ƒã‚¯ã‚»ãƒ¢ãƒ³è¨ºæ–­">
<meta property="og:description" content="25å•ãƒ»10å› å­ï¼…ã§ä¸»å½¹ã‚¯ã‚»ãƒ¢ãƒ³ã‚’åˆ¤å®šã€‚ç”»åƒwebpå¯¾å¿œï¼†çµæœç”»åƒä¿å­˜OKã€‚">
<meta property="og:image" content="/shindan/assets/results/kusemon/t01.webp">
<style>
:root{
  --accent:#6b9bff; --accent2:#8bd3ff;
  --ink:#1f2732; --muted:#667087; --paper:#fff;
  --bg1:#f7f9ff; --bg2:#f2fbff; --line:#e6ecf7;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;color:var(--ink);
  background:linear-gradient(180deg,var(--bg1),var(--bg2));
  font-family:"Noto Sans JP",system-ui,-apple-system,"Segoe UI",Roboto,"Hiragino Kaku Gothic ProN",sans-serif;
}
a{color:inherit}
.wrap{max-width:980px;margin:18px auto;padding:0 14px}
header.hd{display:grid;grid-template-columns:56px 1fr;gap:12px;align-items:center;margin:8px 0}
.logo{width:56px;height:56px;border-radius:14px;background:linear-gradient(135deg,#e6f0ff,#e9fffe);display:grid;place-items:center;font-size:28px}
h1{margin:0;font-size:clamp(22px,4.6vw,34px);letter-spacing:.02em}
.sub{margin:4px 0 0;color:var(--muted);font-size:.96em}
.card{background:var(--paper);border:1px solid var(--line);border-radius:16px;padding:14px}
.section{margin:14px 0}
.pill{display:inline-block;padding:4px 8px;border:1px solid var(--line);border-radius:999px;background:#fff;color:#6b6a77;font-size:.88em}
.meta{display:flex;gap:8px;flex-wrap:wrap}
.sticky{position:sticky;top:0;z-index:10;margin:-6px -14px 12px;padding:8px 14px;background:rgba(255,255,255,.8);backdrop-filter:blur(6px) saturate(1.05);border-bottom:1px solid #e9edf7;display:flex;align-items:center;gap:10px}
.progress{height:8px;background:#edf2fb;border-radius:999px;flex:1;overflow:hidden}
.progress>span{display:block;height:100%;width:0;background:linear-gradient(90deg,var(--accent),var(--accent2));transition:width .25s ease}
.btn{padding:10px 14px;border:1px solid var(--line);border-radius:12px;background:#fff;cursor:pointer}
.btn.primary{background:linear-gradient(90deg,var(--accent),var(--accent2));border-color:transparent;color:#fff;font-weight:700}
fieldset.q{border:1px solid var(--line);border-radius:12px;padding:10px;margin:10px 0;background:#fff}
legend{font-weight:700}
.scale{display:grid;grid-template-columns:repeat(5,minmax(66px,1fr));gap:8px;margin-top:8px}
.scale input{position:absolute;opacity:0;pointer-events:none}
.scale label{display:grid;place-items:center;border:1px solid #e5e9f3;border-radius:10px;padding:8px;cursor:pointer;user-select:none;background:#fff}
.scale input:checked+label{outline:2px solid var(--accent);border-color:transparent}
mark.need{animation:need 1.6s ease}
@keyframes need{0%{box-shadow:0 0 0 0 rgba(107,155,255,.45)}100%{box-shadow:0 0 0 0 rgba(107,155,255,0)}}
.result-head{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
.badge{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;background:linear-gradient(90deg,var(--accent),var(--accent2));color:#fff;font-weight:700}
.total{font-size:22px;font-weight:800}
.small{color:var(--muted);font-size:.92em}

/* ãƒ’ãƒ¼ãƒ­ãƒ¼ï¼ˆç”»åƒâ†’ãƒ†ã‚­ã‚¹ãƒˆï¼‰ */
.hero-vert{display:grid;place-items:center;border:1px solid var(--line);border-radius:16px;background:#fff;overflow:hidden}
.hero-vert figure{margin:0;width:min(720px,100%);max-width:100%;aspect-ratio:1/1;border-bottom:1px solid var(--line);background:#f7f9ff}
.hero-vert img{width:100%;height:100%;object-fit:cover;display:block}
.hero-vert figcaption{padding:10px;width:100%}
.hero-vert .capline{font-weight:800;line-height:1.55;overflow-wrap:anywhere;word-break:break-word;white-space:normal}
.hero-vert .capmini{font-size:1em;line-height:1.85;color:var(--muted);overflow-wrap:anywhere;word-break:break-word;white-space:normal}

.grid2{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:12px}
.stat{border:1px solid var(--line);border-radius:12px;padding:10px;background:#fff}
.stat .big{font-size:22px;font-weight:800}
.hr{height:1px;background:var(--line);margin:10px 0}
.factor-mini{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:10px}
.bar{border:1px solid var(--line);border-radius:12px;padding:10px;background:#fff}
.bar .row{height:10px;background:#edf2fb;border-radius:999px;overflow:hidden;margin-top:6px}
.bar .row>span{display:block;height:100%;width:0;background:linear-gradient(90deg,var(--accent),var(--accent2))}
.note{border:1px solid var(--line);border-radius:12px;background:#fff;padding:10px}
.note h4{margin:0 0 6px;font-size:16px}

/* å…±æœ‰ãƒœã‚¿ãƒ³ */
.share-row{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
.btn.tw::before{content:"ğ•";margin-right:.25em}
.btn.line::before{content:"ğŸ’¬";margin-right:.25em}
.btn.ig::before{content:"ğŸ“¸";margin-right:.25em}
.btn.save::before{content:"â¬‡ï¸";margin-right:.25em}

@media (max-width: 560px){
  .wrap{padding:0 10px}
  .sticky{top:calc(env(safe-area-inset-top) + 0px); padding:8px 10px}
  .scale{grid-template-columns:repeat(2,1fr)}
  .scale label{padding:12px 8px;font-size:14px}
  .hero-vert figure{width:100%}
  .grid2{grid-template-columns:1fr}
  .card{padding:12px}
  .hero-vert .capline{font-size:clamp(16px,5.2vw,20px);line-height:1.65}
  .hero-vert .capmini{font-size:clamp(14px,4.6vw,16px);line-height:1.95}
  .note h4{font-size:15px}
}
</style>
</head>
<body data-id="kusemon">
<main class="wrap" id="app">
  <header class="hd">
    <div class="logo">ğŸ“˜</div>
    <div>
      <h1>æ€è€ƒã‚¯ã‚»ãƒ¢ãƒ³è¨ºæ–­</h1>
      <p class="sub">25å•ï¼ˆ0ã€œ4ã®5ä»¶æ³•ï¼‰ã€‚10å› å­ã®ï¼…ã¨ã€Œä¸»å½¹ã‚¯ã‚»ãƒ¢ãƒ³ã€ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚â€»ã‚¨ãƒ³ã‚¿ãƒ¡è‡ªå·±ç†è§£ï¼å› æœã¯æ–­å®šã—ã¾ã›ã‚“ã€‚</p>
    </div>
  </header>

  <div class="sticky" aria-live="polite">
    <div class="progress" aria-label="å›ç­”é€²æ—" role="progressbar" aria-valuemin="0" aria-valuemax="25">
      <span id="prog"></span>
    </div>
    <button class="btn primary" id="doScore">è¨ºæ–­ã™ã‚‹</button>
  </div>

  <section class="card section" id="desc">
    <h2 style="margin:4px 0 8px">èª¬æ˜</h2>
    <div class="meta" style="margin-bottom:8px">
      <span class="pill">è³ªå•æ•°ï¼š25</span>
      <span class="pill">å½¢å¼ï¼š0â€“4ï¼ˆ0=ãœã‚“ãœã‚“ / 4=ã¨ã¦ã‚‚ï¼‰</span>
      <span class="pill">å‡ºåŠ›ï¼š10å› å­ï¼…â†’ä¸»å½¹ï¼‹ç›¸æ£’ï¼ˆæ¡ä»¶ï¼‰</span>
    </div>
    <p class="small">â€œè¦‹ãˆæ–¹ã®ã‚¯ã‚»â€ã‚’10ä½“ã®ã‚­ãƒ£ãƒ©ã§å›³é‘‘åŒ–ã€‚æ—¥å¸¸ã§ä½¿ãˆã‚‹**ä¸€è¨€ãƒ’ãƒ³ãƒˆ**ã‚‚è¡¨ç¤ºã—ã¾ã™ã€‚</p>
  </section>

  <!-- è¨­å• -->
  <section class="card section" id="questions">
    <h2 style="margin:4px 0 8px">è¨­å•ï¼ˆãœã‚“ãœã‚“ï¼ã‚ã¾ã‚Šï¼ã¨ãã©ãï¼ã‚ˆãï¼ã¨ã¦ã‚‚ï¼‰</h2>
    <div id="qWrap"></div>
    <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:10px">
      <button class="btn" id="clearAns">å›ç­”ã‚’ã‚¯ãƒªã‚¢</button>
      <button class="btn primary" id="doScore2">è¨ºæ–­ã™ã‚‹</button>
    </div>
  </section>

  <!-- çµæœ -->
  <section class="card section" id="result" aria-live="polite">
    <div id="resEmpty">
      <span class="badge">ã¾ã çµæœã¯ã‚ã‚Šã¾ã›ã‚“</span>
      <p class="small">å…¨25å•ã«å›ç­”ã—ã¦ã€Œè¨ºæ–­ã™ã‚‹ã€ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚</p>
    </div>

    <div id="resArea" style="display:none">
      <div class="result-head">
        <span class="badge">çµæœ</span>
        <div class="total" id="typeLine">â€”</div>
      </div>

      <!-- ã‚¿ã‚¤ãƒ—ç”»åƒï¼‹ãƒŸãƒ‹æƒ…å ±ï¼ˆæ­£æ–¹å½¢ï¼‰ -->
      <div class="hero-vert section" role="region" aria-label="ã‚¿ã‚¤ãƒ—ã‚¤ãƒ¡ãƒ¼ã‚¸">
        <figure>
          <img id="heroImg" src="/shindan/assets/results/kusemon/t01.webp" alt="çµæœã‚¤ãƒ¡ãƒ¼ã‚¸" loading="lazy" width="1080" height="1080">
        </figure>
        <figcaption>
          <div class="capline" id="heroTitle">â€”</div>
          <div class="capmini" id="heroCopy">â€”</div>
          <div class="capmini" id="heroHint" style="margin-top:4px">â€”</div>

          <div class="share-row" id="shareRow" hidden>
            <button id="btnShot"  class="btn save" type="button">çµæœç”»åƒã‚’ä¿å­˜</button>
            <button id="shareTw"  class="btn tw"   type="button">Xã§å…±æœ‰</button>
            <button id="shareLn"  class="btn line" type="button">LINEã§é€ã‚‹</button>
            <button id="shareIg"  class="btn ig"   type="button" aria-label="Instagramï¼ˆWebï¼‰">Instagram</button>
            <button id="shareCp"  class="btn"      type="button">ãƒªãƒ³ã‚¯ã‚’ã‚³ãƒ”ãƒ¼</button>
          </div>
          <canvas id="shotCanvas" width="1080" height="1350" style="display:none"></canvas>
        </figcaption>
      </div>

      <div class="grid2">
        <article class="stat" aria-label="ç·åˆã‚¹ã‚³ã‚¢">
          <div><strong>å› å­å¹³å‡ï¼ˆ0â€“4ï¼‰</strong></div>
          <div class="big"><span id="sumAvg">0.00</span> / 4.00 <span class="small" id="sumPct">= 0%</span></div>
          <div class="small" id="sumNote">â€”</div>
        </article>
        <article class="stat" aria-label="ç›¸æ£’">
          <div><strong>ç›¸æ£’ã‚¯ã‚»ãƒ¢ãƒ³</strong></div>
          <div class="big" id="allyName">â€”</div>
          <div class="small" id="allyNote">æ¡ä»¶ä¸€è‡´ã®ã¨ãè¡¨ç¤º</div>
        </article>
      </div>

      <div class="hr"></div>
      <!-- å› å­ãƒãƒ¼ï¼ˆ10ï¼‰ -->
      <div class="section">
        <h3 style="margin:8px 0">10å› å­ï¼ˆï¼…ï¼‰</h3>
        <div id="bars" class="factor-mini"></div>
      </div>

      <div class="hr"></div>
      <!-- é•·æ–‡ -->
      <div id="longCopy" class="small"></div>

      <div class="hr"></div>
      <!-- ä»Šæ—¥ã®ã‚±ã‚¢ -->
      <details class="section" open id="careSec">
        <summary><strong>ä»Šæ—¥ã®ã‚±ã‚¢</strong></summary>
        <ul class="small" id="careList" style="margin:6px 0 0 18px;line-height:1.8"></ul>
      </details>

      <div class="hr"></div>
      <!-- ç ”ç©¶ãƒ¡ãƒ¢ -->
      <details class="section" open>
        <summary><strong>ç ”ç©¶ãƒ¡ãƒ¢</strong></summary>
        <ul class="small" id="resMemo" style="margin:6px 0 0 18px;line-height:1.8"></ul>
        <p class="small" style="margin-top:6px">â€»ç›¸é–¢ä¸­å¿ƒã§å› æœã¯æ–­å®šã§ãã¾ã›ã‚“ã€‚å€‹äººå·®ãŒã‚ã‚Šã¾ã™ã€‚åŒ»ç™‚ãƒ»æ¡ç”¨ãªã©ã®ç”¨é€”ã«ã¯ä½¿ãˆã¾ã›ã‚“ã€‚</p>
      </details>

      <div class="back-area" style="display:flex;justify-content:center;margin-top:12px">
        <a class="back" href="/shindan/" id="backLink" aria-label="è¨ºæ–­ä¸€è¦§ã«æˆ»ã‚‹">è¨ºæ–­ä¸€è¦§ã«æˆ»ã‚‹</a>
      </div>
    </div>
  </section>

  <section class="footer card">
    <h2 style="margin:4px 0 8px">ã”åˆ©ç”¨ã«ã‚ãŸã£ã¦</h2>
    <p class="small">ã“ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¯<b>ã‚¨ãƒ³ã‚¿ãƒ¡ç”¨ã®è‡ªå·±ç†è§£</b>ã§ã™ã€‚ç¾å®Ÿã®åˆ¤æ–­ã‚„åŒ»ç™‚ãƒ»æ¡ç”¨ã«ã¯ä½¿ãˆã¾ã›ã‚“ã€‚å¿…è¦ãªå ´åˆã¯é–¢ä¿‚æ©Ÿé–¢ãƒ»å°‚é–€å®¶ã«ã”ç›¸è«‡ãã ã•ã„ã€‚<br>
    ãƒ‡ãƒ¼ã‚¿ã¯ç«¯æœ«å†…ã§å‡¦ç†ã•ã‚Œã€å€‹äººã‚’ç‰¹å®šã™ã‚‹æƒ…å ±ã®é€ä¿¡ãƒ»åé›†ã¯è¡Œã„ã¾ã›ã‚“ï¼ˆã”åˆ©ç”¨ç’°å¢ƒã«ã‚ˆã‚Šã‚¢ã‚¯ã‚»ã‚¹è§£æç­‰ãŒå‹•ä½œã™ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ï¼‰ã€‚</p>
  </section>
</main>

<script>
(function(){
  // ====== ãƒšãƒ¼ã‚¸æƒ…å ± ======
  var SLUG = "kusemon";
  var TITLE = "æ€è€ƒã‚¯ã‚»ãƒ¢ãƒ³è¨ºæ–­";
  var ANS_KEY = "specimens:"+SLUG+":answers";
  var IMG_BASE = "/shindan/assets/results/kusemon/"; // t01.webp..t10.webp

  // ====== å› å­ãƒ»è¨­å• ======
  var FACTORS = {
    ZO:{ name:"ã‚¼ãƒ­ã‚¤ãƒãã‚“ï¼ˆç™½é»’åŒ–ï¼‰",     items:["Q01","Q02","Q03"] },
    YS:{ name:"ã‚ˆã¿ã‚¹ã‚®ã•ã‚“ï¼ˆå…ˆèª­ã¿/èª­å¿ƒï¼‰", items:["Q04","Q05","Q06"] },
    BK:{ name:"ãƒã‚¯ãƒãƒ„ã•ã‚“ï¼ˆæ‹¡å¤§ç¸®å°ï¼‰",   items:["Q07","Q08","Q09"] },
    BB:{ name:"ã¹ãã¹ãå›£ï¼ˆã¹ãæ€è€ƒï¼‰",     items:["Q10","Q11","Q12"] },
    WS:{ name:"ã‚ãŸã—ã®ã›ã„å¦–ç²¾ï¼ˆå€‹äººåŒ–ï¼‰", items:["Q13","Q14","Q15"] },
    LB:{ name:"ãƒ©ãƒ™ãƒ«è·äººï¼ˆãƒ¬ãƒƒãƒ†ãƒ«è²¼ã‚Šï¼‰", items:["Q16","Q17"] },
    EJ:{ name:"æ°—åˆ†ã‚¸ãƒ£ãƒƒã‚¸ï¼ˆæ„Ÿæƒ…æ±ºã‚ã¤ã‘ï¼‰", items:["Q18","Q19"] },
    SL:{ name:"ç©´ãƒ¡ã‚¬ãƒï¼ˆé¸æŠçš„æŠ½å‡ºï¼‰",     items:["Q20","Q21"] },
    OG:{ name:"ä¸€èˆ¬åŒ–ã‚ªã‚¦ãƒ ï¼ˆéåº¦ã®ä¸€èˆ¬åŒ–ï¼‰", items:["Q22","Q23"] },
    PD:{ name:"ãƒã‚¸å´ä¸‹ãƒãƒ³ï¼ˆãƒã‚¸å¦èªï¼‰",     items:["Q24","Q25"] }
  };
  window.FACTORS = FACTORS;

  // 25å•ï¼ˆrev: é€†è»¢ï¼‰
  var ITEMS = {
    Q01:{ text:"ã¡ã‚‡ã£ã¨ã—ãŸãƒŸã‚¹ã§ã‚‚ã€å…¨ä½“ãŒâ€œå°ãªã—â€ã«æ„Ÿã˜ã‚‹ã€‚" },
    Q02:{ text:"ç‰©äº‹ã¯ã€Œå®Œç’§ã‹ä¸åˆæ ¼ã‹ã€ã§è¦‹ã‚„ã™ã„ã€‚" },
    Q03:{ text:"é€”ä¸­ã®è‰¯ã„ç‚¹ã‚‚ã¡ã‚ƒã‚“ã¨æ®‹ã‚‹ã¨æ€ãˆã‚‹ã€‚", rev:true },

    Q04:{ text:"æ‚ªã„å±•é–‹ã‚’å…ˆã«æƒ³åƒã—ã¦æ°—æŒã¡ãŒæ²ˆã¿ãŒã¡ã€‚" },
    Q05:{ text:"ç›¸æ‰‹ã®æœ¬å¿ƒã¯â€œãŸã¶ã‚“ã“ã†ã â€ã¨æ±ºã‚ã¦ã—ã¾ã†ã€‚" },
    Q06:{ text:"å®Ÿéš›ã«ç¢ºã‹ã‚ã¦ã‹ã‚‰åˆ¤æ–­ã™ã‚‹ã»ã†ã ã€‚", rev:true },

    Q07:{ text:"å°ã•ãªå¤±æ•—ã‚’å¤§ã”ã¨ã«æ„Ÿã˜ã¦ã—ã¾ã†ã€‚" },
    Q08:{ text:"ã†ã¾ãã„ã£ã¦ã‚‚ã€Œé‹ãŒè‰¯ã‹ã£ãŸã ã‘ã€ã¨æ€ã„ãŒã¡ã€‚" },
    Q09:{ text:"è‰¯ã‹ã£ãŸç‚¹ã¯ç´ ç›´ã«ã‚«ã‚¦ãƒ³ãƒˆã§ãã‚‹ã€‚", rev:true },

    Q10:{ text:"ã€Œã€œã™ã¹ãã€ãŒå¤šãã€è‡ªåˆ†ã«ãã³ã—ã„ã€‚" },
    Q11:{ text:"çŠ¶æ³ã«åˆã‚ã›ã¦åŸºæº–ã‚’ã‚†ã‚‹ã‚ã‚‰ã‚Œã‚‹ã€‚", rev:true },
    Q12:{ text:"ä¼‘ã‚€ã‚ˆã‚Šã€ã¾ãšç¾©å‹™ã‚’å„ªå…ˆã—ãŒã¡ã ã€‚" },

    Q13:{ text:"ãƒˆãƒ©ãƒ–ãƒ«ãŒã‚ã‚‹ã¨ã€è‡ªåˆ†ã®ã›ã„ã ã¨æ„Ÿã˜ã‚„ã™ã„ã€‚" },
    Q14:{ text:"ç‰©äº‹ã«ã¯ã„ã‚ã„ã‚ãªè¦å› ãŒã‚ã‚‹ã¨è€ƒãˆã‚‰ã‚Œã‚‹ã€‚", rev:true },
    Q15:{ text:"äººã«é ¼ã‚‹ã¨è¿·æƒ‘ã‚’ã‹ã‘ã‚‹æ°—ãŒã—ã¦æŠ±ãˆè¾¼ã¿ã‚„ã™ã„ã€‚" },

    Q16:{ text:"ä¸€åº¦ã®å‡ºæ¥äº‹ã§ã€Œè‡ªåˆ†ã¯â—¯â—¯ãªäººã€ã¨åä¹—ã‚ŠãŸããªã‚‹ã€‚" },
    Q17:{ text:"äººã«ã‚‚è‡ªåˆ†ã«ã‚‚çŸ­ã„è¨€è‘‰ã§å›ºå®šãƒ©ãƒ™ãƒ«ã‚’ä»˜ã‘ãŒã¡ã ã€‚" },

    Q18:{ text:"ä¸å®‰ã ã‹ã‚‰ã€ãã£ã¨ã†ã¾ãã„ã‹ãªã„ã¨æ€ã†ã€‚" },
    Q19:{ text:"æ°—åˆ†ãŒè½ã¡ã‚‹ã¨ã€ãã®ã¾ã¾äº‹å®Ÿã‚‚æ‚ªã„ã¨æ„Ÿã˜ã‚‹ã€‚" },

    Q20:{ text:"æ¬ ç‚¹ã®ã»ã†ãŒç›®ã«é£›ã³è¾¼ã‚“ã§ãã‚‹ã€‚" },
    Q21:{ text:"è‰¯ã„ç‚¹ã‚‚åŒã˜ãã‚‰ã„ç›®ã«å…¥ã‚‹ã€‚", rev:true },

    Q22:{ text:"ä¸€åº¦ã®å¤±æ•—ã§ã€Œã„ã¤ã‚‚/çµ¶å¯¾ãƒ€ãƒ¡ã€ã«åºƒã’ã¦ã—ã¾ã†ã€‚" },
    Q23:{ text:"æ¬¡ã¯é•ã†ã‹ã‚‚ã€ã¨æ€ã„ç›´ã›ã‚‹ã€‚" },

    Q24:{ text:"è¤’ã‚ã‚‰ã‚Œã¦ã‚‚ã€Œå¤§ã—ãŸã“ã¨ãªã„ã€ã¨å¦å®šã—ãŒã¡ã ã€‚" },
    Q25:{ text:"è¤’ã‚ã‚„æˆåŠŸã‚’ã€ãã®ã¾ã¾å—ã‘å–ã‚Œã‚‹ã€‚", rev:true }
  };
  var LABELS = ["ãœã‚“ãœã‚“","ã‚ã¾ã‚Š","ã¨ãã©ã","ã‚ˆã","ã¨ã¦ã‚‚"];

  // 10ã‚¿ã‚¤ãƒ—ï¼ˆt01..t10ï¼‰
  var TYPES = [
    { id:1,  key:"t01", code:"ZO", name:"ZOï½œã‚¼ãƒ­ã‚¤ãƒãã‚“ï¼ˆç™½é»’åŒ–ï¼‰",
      one:"ç™½ã‹é»’ã§æ±ºã‚ãŸã„ä¿Šè¶³ã‚¿ã‚¤ãƒ—ã€‚è¿·ã„ãŒå°‘ãªãå‹•ã‘ã‚‹ã®ãŒå¼·ã¿ã€‚",
      hint:"è©•ä¾¡ã¯OK/æ”¹å–„ã®äºŒæ®µã‚ã‘ã€‚ä¸­é–“ã®ã€Œã¾ã‚è‰¯ã—ã€ã‚’1ã¤æ¢ã™ã€‚"
    },
    { id:2,  key:"t02", code:"YS", name:"YSï½œã‚ˆã¿ã‚¹ã‚®ã•ã‚“ï¼ˆå…ˆèª­ã¿/èª­å¿ƒï¼‰",
      one:"ç©ºæ°—èª­ã¿ã¨å…ˆå›ã‚ŠãŒä¸Šæ‰‹ã€‚ãŸã ã—æ ¹æ‹ è–„ã®â€œæ‚ªã„äºˆå ±â€ã«å‚¾ããŒã¡ã€‚",
      hint:"åˆè¨€è‘‰ã¯ã€Œç¢ºã‹ã‚ãŸï¼Ÿã€ã€‚çŸ­ã„ç¢ºèªã‚’ã²ã¨ã¤è¶³ã™ã€‚"
    },
    { id:3,  key:"t03", code:"BK", name:"BKï½œãƒã‚¯ãƒãƒ„ã•ã‚“ï¼ˆæ‹¡å¤§ç¸®å°ï¼‰",
      one:"å¤±æ•—ã¯å·¨å¤§åŒ–ã€æˆåŠŸã¯æ§ãˆã‚ã€‚ç´°éƒ¨ã¸ã®æ„Ÿåº¦ãŒé«˜ã„è¨¼ã€‚",
      hint:"äº‹å®Ÿã‚’3ã¤æ›¸ãå‡ºã—ã€å½¢å®¹è©ã‚’å¤–ã—ã¦ç­‰å€ã«æˆ»ã™ã€‚"
    },
    { id:4,  key:"t04", code:"BB", name:"BBï½œã¹ãã¹ãå›£ï¼ˆã¹ãæ€è€ƒï¼‰",
      one:"ã€Œã“ã†ã‚ã‚‹ã¹ãã€ã§å“è³ªã‚’å®ˆã‚‹ç•ªäººã€‚çŠ¶æ³å¤‰åŒ–ã«ç¡¬ããªã‚Šã‚„ã™ã„ã€‚",
      hint:"ç›®çš„â†’æ‰‹æ®µã§è¦‹ç›´ã—ã€‚ä»Šæ—¥ã¯â€œ7å‰²OKâ€ã®æ—¥ã‚’ä½œã‚‹ã€‚"
    },
    { id:5,  key:"t05", code:"WS", name:"WSï½œã‚ãŸã—ã®ã›ã„å¦–ç²¾ï¼ˆå€‹äººåŒ–ï¼‰",
      one:"è²¬ä»»æ„ŸãŒå¼·ãã€äººã®ãŸã‚ã«å‹•ã‘ã‚‹ã€‚èƒŒè² ã„éãã«æ³¨æ„ã€‚",
      hint:"å‡ºæ¥äº‹ã‚’è‡ªåˆ†/ç›¸æ‰‹/çŠ¶æ³ã®3ç®±ã¸ã€‚ã¾ãšã¯1/3ãšã¤ã€‚"
    },
    { id:6,  key:"t06", code:"LB", name:"LBï½œãƒ©ãƒ™ãƒ«è·äººï¼ˆãƒ¬ãƒƒãƒ†ãƒ«è²¼ã‚Šï¼‰",
      one:"çŸ­ã„è¨€è‘‰ã§â€œè‡ªåˆ†/äººâ€ã‚’å®šç¾©ã—ãŸããªã‚‹å™¨ç”¨ã•ã€‚æ‰±ã„ã«æ³¨æ„ã€‚",
      hint:"åè©ãƒ©ãƒ™ãƒ«â†’è¡Œå‹•ãƒ©ãƒ™ãƒ«ã¸ï¼ˆä¾‹ï¼šä»Šã¯ç–²ã‚Œã¦åå¿œãŒé…ã„ï¼‰ã€‚"
    },
    { id:7,  key:"t07", code:"EJ", name:"EJï½œæ°—åˆ†ã‚¸ãƒ£ãƒƒã‚¸ï¼ˆæ„Ÿæƒ…çš„æ±ºã‚ã¤ã‘ï¼‰",
      one:"æ°—åˆ†ï¼äº‹å®Ÿã«ãªã‚Šã‚„ã™ã„ã€‚æ„Ÿå—æ€§ã®é«˜ã•ã¯æ­¦å™¨ã€‚",
      hint:"æ°—åˆ†ã¨äº‹å®Ÿã‚’åˆ¥ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«åˆ†ã‘ã¦1è¡Œãšã¤æ›¸ãã€‚"
    },
    { id:8,  key:"t08", code:"SL", name:"SLï½œç©´ãƒ¡ã‚¬ãƒï¼ˆé¸æŠçš„æŠ½å‡ºï¼‰",
      one:"æ¬ ç‚¹ã‚’è¦‹ã¤ã‘ã‚‹åäººã€‚è‰¯ã„ç‚¹ã®ãƒ”ãƒ³ãƒˆã‚‚åˆã‚ã›ã‚ˆã†ã€‚",
      hint:"æ¬ ç‚¹1ã¤ã«å¯¾ã—ã€è‰¯ã„ç‚¹2ã¤ã‚’æ›¸ãæ·»ãˆã‚‹ã€‚"
    },
    { id:9,  key:"t09", code:"OG", name:"OGï½œä¸€èˆ¬åŒ–ã‚ªã‚¦ãƒ ï¼ˆéåº¦ã®ä¸€èˆ¬åŒ–ï¼‰",
      one:"ã€Œä¸€åº¦ã®å¤±æ•—ï¼ã„ã¤ã‚‚ãƒ€ãƒ¡ã€ã«åºƒã’ã‚„ã™ã„å£ãã›ã€‚",
      hint:"æ¡ä»¶ã‚’é™å®šã—ã¦è¨€ã„æ›ãˆï¼ˆä¾‹ï¼šä»Šæ—¥ã¯æ™‚é–“ãŒè¶³ã‚Šãªã‹ã£ãŸï¼‰ã€‚"
    },
    { id:10, key:"t10", code:"PD", name:"PDï½œãƒã‚¸å´ä¸‹ãƒãƒ³ï¼ˆãƒã‚¸å¦èªï¼‰",
      one:"è¬™è™šã•ã®è£ã«ã€ãƒã‚¸ã‚’å—ã‘å–ã‚Šã«ãã„ã‚¯ã‚»ã€‚",
      hint:"è¤’ã‚ã‚’å¼•ç”¨ã—ã¦ãƒ¡ãƒ¢â†’åè«–ã¯æ˜æ—¥ã€‚"
    }
  ];

  // è¦ç´ å‚ç…§
  var qWrap   = document.getElementById("qWrap");
  var prog    = document.getElementById("prog");
  var resEmpty= document.getElementById("resEmpty");
  var resArea = document.getElementById("resArea");
  var typeLine= document.getElementById("typeLine");
  var heroImg = document.getElementById("heroImg");
  var heroTitle= document.getElementById("heroTitle");
  var heroCopy = document.getElementById("heroCopy");
  var heroHint = document.getElementById("heroHint");
  var sumAvg  = document.getElementById("sumAvg");
  var sumPct  = document.getElementById("sumPct");
  var sumNote = document.getElementById("sumNote");
  var bars    = document.getElementById("bars");
  var longCopy= document.getElementById("longCopy");
  var resMemo = document.getElementById("resMemo");
  var shareRow= document.getElementById("shareRow");
  var shareTw = document.getElementById("shareTw");
  var shareLn = document.getElementById("shareLn");
  var shareIg = document.getElementById("shareIg");
var btnShot = document.getElementById("btnShot");
var careList = document.getElementById("careList");
  var shotCanvas = document.getElementById("shotCanvas");
  var allyName = document.getElementById("allyName");
  var allyNote = document.getElementById("allyNote");
  window.shotCanvas = shotCanvas;

  // è¨­å•ç”Ÿæˆ
  function buildQuestions(){
    var html = "";
    Object.keys(ITEMS).forEach(function(qid, i){
      var q = ITEMS[qid];
      html += '<fieldset class="q" id="fs-'+qid+'">'+
        '<legend>'+String(i+1).padStart(2,"0")+'. '+q.text+'</legend>'+
        '<div class="scale" role="radiogroup" aria-label="'+q.text+'">';
      for(var v=0;v<=4;v++){
        html += '<div style="position:relative">'+
          '<input id="q'+qid+'-'+v+'" type="radio" name="q'+qid+'" value="'+v+'">'+
          '<label for="q'+qid+'-'+v+'" title="'+LABELS[v]+'">'+LABELS[v]+'</label>'+
        '</div>';
      }
      html += '</div></fieldset>';
    });
    qWrap.innerHTML = html;

    qWrap.querySelectorAll('input[type="radio"]').forEach(function(r){
      r.addEventListener('change', function(){ saveAnswers(); updateProgress(); }, false);
    });
    restoreAnswers();
    updateProgress();
  }

  // ä¿å­˜/å¾©å…ƒ
  function saveAnswers(){
    try{
      var out = {};
      Object.keys(ITEMS).forEach(function(id){
        var chk = qWrap.querySelector('#fs-'+id+' input[type="radio"]:checked');
        if(chk){ out[id] = parseInt(chk.value,10); }
      });
      localStorage.setItem(ANS_KEY, JSON.stringify({ts:Date.now(), ans:out}));
    }catch(e){}
  }
  function restoreAnswers(){
    try{
      var raw = localStorage.getItem(ANS_KEY);
      if(!raw) return;
      var data = JSON.parse(raw);
      var ans = (data && data.ans) || {};
      Object.keys(ans).forEach(function(id){
        var v = ans[id];
        var input = qWrap.querySelector('#q'+id+'-'+v);
        if(input){ input.checked = true; }
      });
    }catch(e){}
  }
  function wipeAnswers(){ try{ localStorage.removeItem(ANS_KEY); }catch(e){} }

  function updateProgress(){
    var total = Object.keys(ITEMS).length; // 25
    var answered = 0;
    Object.keys(ITEMS).forEach(function(id){
      if(qWrap.querySelector('#fs-'+id+' input[type="radio"]:checked')) answered++;
    });
    var pct = Math.round(100*answered/total);
    prog.style.width = pct + "%";
    var bar = prog.parentElement;
    if(bar){
      bar.setAttribute("aria-valuenow", answered);
      bar.setAttribute("aria-label", "å›ç­”é€²æ—ï¼š"+answered+" / "+total);
    }
  }

  // ã‚¹ã‚³ã‚¢è¨ˆç®—
  function valOf(id, raw){ var v=Number(raw); return (ITEMS[id].rev? (4-v):v); }
  function calc(){
    var missing = [];
    var ans = {};
    Object.keys(ITEMS).forEach(function(id){
      var chk = qWrap.querySelector('#fs-'+id+' input[type="radio"]:checked');
      if(!chk){ missing.push(id); return; }
      ans[id] = parseInt(chk.value,10);
    });
    if(missing.length){
      alert("æœªå›ç­”ãŒã‚ã‚Šã¾ã™ã€‚å…¨25å•ã«ãŠç­”ãˆãã ã•ã„ã€‚");
      var fs = document.getElementById('fs-'+missing[0]);
      if(fs){ fs.scrollIntoView({behavior:"smooth", block:"center"}); fs.classList.add("need"); setTimeout(function(){ fs.classList.remove("need"); },1600); }
      return;
    }

    var fScore = {}, fPct = {};
    Object.keys(FACTORS).forEach(function(key){
      var ids = FACTORS[key].items;
      var sum = ids.reduce(function(s,id){ return s + valOf(id, ans[id]); },0);
      var avg = sum / ids.length; // 0-4
      fScore[key] = avg;
      fPct[key] = Math.round((avg/4)*100);
    });

    var keys = Object.keys(FACTORS);
    var totalAvg = keys.reduce(function(s,k){ return s + fScore[k]; },0) / keys.length;
    var totalPct = Math.round((totalAvg/4)*100);

    render({ fScore, fPct, totalAvg, totalPct });
  }

  // ã‚¿ã‚¤ãƒ—åˆ¤å®šï¼ˆä¸»å½¹ï¼æœ€å¤§ã€ç›¸æ£’ï¼ä¸»å½¹ã¨ã®å·®ãŒ8ptæœªæº€ï¼‰
  function pickType(p){
    var order = Object.keys(p).sort(function(a,b){ return p[b]-p[a]; });
    var top = order[0];
    var second = order[1];
    var map = {ZO:1,YS:2,BK:3,BB:4,WS:5,LB:6,EJ:7,SL:8,OG:9,PD:10};
    return {
      main: TYPES.find(function(t){ return t.id===map[top]; }),
      ally: (p[top] - p[second] < 8) ? TYPES.find(function(t){ return t.id===map[second]; }) : null
    };
  }

  function heroPath(typeNo){ var id = String(typeNo).padStart(2,"0"); return IMG_BASE + "t" + id + ".webp"; }

  function drawBars(pct){
    var order = ["ZO","YS","BK","BB","WS","LB","EJ","SL","OG","PD"];
    var html = "";
    order.forEach(function(key){
      var def = FACTORS[key], val = pct[key]||0;
      html += '<article class="bar" aria-label="'+def.name+'">'+
        '<div><strong>'+def.name+'</strong><span class="pill" style="margin-left:6px">'+String(val).padStart(2,"0")+'%</span></div>'+
        '<div class="row" aria-hidden="true"><span style="width:'+val+'%"></span></div>'+
      '</article>';
    });
    bars.innerHTML = html;
  }

  // é•·æ–‡ï¼ˆå„ä½“ï¼‰
  var LONG = {
    ZO:"ã¯ã£ãã‚Šçµè«–ã‚’å‡ºã›ã‚‹ã®ã¯ç«‹æ´¾ãªè³‡è³ªã€‚ç· åˆ‡ã‚„å±æ©Ÿå¯¾å¿œã§é ¼ã‚‰ã‚Œã¾ã™ã€‚ãŸã ã€ãƒŸã‚¹ã‚„é…ã‚ŒãŒã€Œå…¨éƒ¨ãƒ€ãƒ¡ã€ã«è¦‹ãˆã‚„ã™ãã€æ°—æŒã¡ã®è½å·®ã‚‚å¤§ãããªã‚ŠãŒã¡ã€‚ã¾ãšã¯çµæœã‚’ã€ŒOKã€ã¨ã€Œæ”¹å–„ã€ã«äºŒæ®µã§åˆ†ã‘ã€æ”¹å–„ç‚¹ã¯æ¬¡ã®ä¸€æ‰‹ã«è½ã¨ã—è¾¼ã‚“ã§ãƒ¡ãƒ¢ã€‚è‰¯ã‹ã£ãŸç‚¹ã‚’1ã¤æ®‹ã›ã°ã€ã‚¼ãƒ­ã‚¤ãƒãã‚“ã¯æš´ã‚Œã«ãããªã‚Šã¾ã™ã€‚ç™½ã¨é»’ã®é–“ã«åºƒãŒã‚‹â€œã¡ã‚‡ã†ã©è‰¯ã„ã‚°ãƒ¬ãƒ¼â€ã‚’ã€å°ã•ãå¢—ã‚„ã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚",
    YS:"é…æ…®ã®åšã•ã¯å¤§ããªé•·æ‰€ã€‚å ´ã‚’æ•´ãˆã‚‹åŠ›ãŒã‚ã‚Šã¾ã™ã€‚æƒ…å ±ãŒå°‘ãªã„æ™‚ã»ã©æ‚ªã„çµè«–ã«é£›ã³ã‚„ã™ã„ã®ã§ã€ã¾ãšã¯é ­ã®ä¸­ã®çµè«–ã«â€œä»®èª¬â€ã¨ãƒ©ãƒ™ãƒ«ã‚’ä»˜ã‘ã¦ä¿ç•™ã—ã€çŸ­ã„ç¢ºèªè¡Œå‹•ã‚’1ã¤æŒŸã¿ã¾ã—ã‚‡ã†ã€‚è¿”ä¿¡ãŒé…ã„ï¼å«Œã‚ã‚ŒãŸã€ã§ã¯ãªãã€Œå¿™ã—ã„ã ã‘ã‹ã‚‚ï¼Ÿã€ã¨ã„ã†åˆ¥æ¡ˆã‚’ä¸¦ã¹ã‚‹ã¨è¦–é‡ãŒåºƒãŒã‚Šã¾ã™ã€‚ç¢ºã‹ã‚ã‚‹ä¸€æ­©ã¯äººé–“é–¢ä¿‚ã‚’ä¸å¯§ã«ã™ã‚‹æŠ€ã§ã‚‚ã‚ã‚Šã¾ã™ã€‚",
    BK:"æ°—ã¥ãåŠ›ãŒé«˜ã„ã‹ã‚‰ã“ãã€ãƒã‚¬è¦ç´ ãŒæ‹¡å¤§ã—ã¦è¦‹ãˆã¾ã™ã€‚ç´™ã«äº‹å®Ÿ3ã¤ï¼ˆæ™‚åˆ»ãƒ»æ•°ãƒ»èª°ãŒä½•ã‚’ï¼‰ã‚’æ›¸ãå‡ºã—ã€è©•ä¾¡èªã‚’ä¸€åº¦å¤–ã—ã¾ã—ã‚‡ã†ã€‚è‰¯ã‹ã£ãŸç‚¹ã‚’1ã¤åŠªåŠ›ã«å¸°å±ã•ã›ã‚Œã°ã€æ¬¡ã¸ã®åœ°å›³ã«ãªã‚Šã¾ã™ã€‚æˆåŠŸã‚’ç¸®å°ã—ãªã„ã“ã¨ã¯è‡ªæ…¢ã§ã¯ãªãã€å†ç¾æ‰‹é †ã®è¨˜éŒ²ã§ã™ã€‚ãƒã‚¯ãƒãƒ„ã•ã‚“ã¯é©åº¦ã«ç©ºæ°—ã‚’æŠœã‘ã°ã€ã¡ã‚‡ã†ã©è‰¯ã„ã‚µã‚¤ã‚ºã§åƒã„ã¦ãã‚Œã¾ã™ã€‚",
    BB:"é«˜ã„åŸºæº–ã¯å®‰å¿ƒã®åœŸå°ã€‚ã§ã‚‚å…¨å ´é¢ã«åŒã˜åŸºæº–ã‚’å½“ã¦ã‚‹ã¨çª®å±ˆã•ã‚„æ‘©æ“¦ãŒå¢—ãˆã¾ã™ã€‚ã¾ãšç›®çš„ï¼ˆä½•ã®ãŸã‚ï¼Ÿï¼‰ã‚’æ›¸ãã€æ‰‹æ®µã‚’2æ¡ˆä¸¦ã¹ã¦é¸ã¶ç¿’æ…£ã‚’ã€‚æ—¥ã«ã‚ˆã£ã¦7å‰²OKã‚’è¨±ã™ã“ã¨ã¯ã€æ¬¡ã®100%ã®åŠ©èµ°ã«ãªã‚Šã¾ã™ã€‚è‡ªåˆ†ã«ã‚‚ä»–è€…ã«ã‚‚ã€çŠ¶æ³ã«å¿œã˜ãŸâ€œæŸ”ã‚‰ã‹ã„æ——â€ã‚’ã€‚æŸ”è»Ÿæ€§ãŒåŠ ã‚ã‚‹ã¨ã€ã¹ãã¹ãå›£ã¯é ¼ã‚Œã‚‹è­·è¡›éšŠã«å¤‰ã‚ã‚Šã¾ã™ã€‚",
    WS:"æ€ã„ã‚„ã‚Šã®æ·±ã•ã¯é­…åŠ›ã€‚ã‘ã‚Œã©ä»–äººã®æ©Ÿå«Œã‚„çµæœã¾ã§èƒŒè² ã†ã¨ç–²å¼Šã—ã¾ã™ã€‚èµ·ããŸå‡ºæ¥äº‹ã‚’3ç®±ã«é…åˆ†ã—ã€ãŠé¡˜ã„ãƒ»ç›¸è«‡ã§ãƒãƒ©ãƒ³ã‚¹ã‚’æ•´ãˆã¾ã—ã‚‡ã†ã€‚é ¼ã‚‹ã“ã¨ã¯å¼±ã•ã§ã¯ãªãã€é–¢ä¿‚ã®æŠ€èƒ½ã§ã™ã€‚è‡ªåˆ†ã®åˆ†ã ã‘ã«é›†ä¸­ã™ã‚‹ã¨ã€å¦–ç²¾ã¯è‚©ã‹ã‚‰è»½ãé™ã‚Šã¾ã™ã€‚æ‰‹æ”¾ã—æ–¹ã‚’è¦šãˆã‚‹ã»ã©ã€æŒç¶šå¯èƒ½ãªå„ªã—ã•ã«ãªã‚Šã¾ã™ã€‚",
    LB:"è¨€èªåŒ–ãŒé€Ÿã„ã®ã¯å¼·ã¿ã€‚ãŸã ä¸€å›ã®å‡ºæ¥äº‹ã§ã€Œè‡ªåˆ†ã¯â—¯â—¯ã€ã€Œã‚ã®äººã¯Ã—Ã—ã€ã¨å›ºå®šã™ã‚‹ã¨é¸æŠè‚¢ã‚’å¤±ã„ãŒã¡ã€‚åè©ã§ã¯ãªãå‹•è©ã§è¡¨ã™ç·´ç¿’ã‚’ã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼ˆä¾‹ï¼šä»Šã¯ç–²ã‚Œã¦åå¿œãŒé…ã„ã€ä¼‘ã‚ã°æˆ»ã‚‹ï¼‰ã€‚æœŸé–“ã‚„çŠ¶æ³ã‚’æ™‚é™ã§ã¤ã‘ã‚‹ã ã‘ã§ã‚‚ä½™ç™½ãŒç”Ÿã¾ã‚Œã¾ã™ã€‚ãƒ©ãƒ™ãƒ«ãŒæ‰±ã„ã‚„ã™ã„ä»˜ç®‹ã«å¤‰ã‚ã‚Œã°ã€è·äººã¯é ¼ã‚Œã‚‹ç·¨é›†è€…ã«ã€‚",
    EJ:"æ•æ„Ÿã•ã¯å¤§åˆ‡ãªã‚»ãƒ³ã‚µãƒ¼ã€‚ã‘ã‚Œã©ä¸å®‰ï¼å¤±æ•—ã®ç¢ºå®šã«ã¯ãªã‚Šã¾ã›ã‚“ã€‚ã¾ãšã€Œä»Šã®æ°—åˆ†ã€ã¨ã€Œè¦³æ¸¬ã•ã‚ŒãŸäº‹å®Ÿã€ã‚’åˆ¥è¡Œã«åˆ†é›¢ã—ã¦è¨˜éŒ²ã€‚æ°—åˆ†ãŒè½ã¡ã‚‹æ—¥ã¯è² è·ã‚’ä¸‹ã’ã‚‹ã»ã†ãŒæˆæœçš„ãªã“ã¨ã‚‚ã‚ã‚Šã¾ã™ã€‚åˆ¤æ–­ã¯ç¿Œæ—¥ã«å›ã™ã€ã‚’ãƒ«ãƒ¼ãƒ«åŒ–ã™ã‚‹ã¨ã‚¸ãƒ£ãƒƒã‚¸ã¯ç©ã‚„ã‹ã«ã€‚æ„Ÿæƒ…ã¯ãƒŠãƒ“ã€æœ€çµ‚æ±ºå®šã¯å°‘ã—å¾ŒãŒã¡ã‚‡ã†ã©ã‚ˆã„ã€‚",
    SL:"è¦³å¯Ÿçœ¼ãŒé‹­ã„ã®ã§ã€ãƒªã‚¹ã‚¯ç®¡ç†ã«å¼·ã„ã‚¿ã‚¤ãƒ—ã€‚ãŸã ã—â€œç©´â€ã ã‘ã‚’æ‹¡å¤§ã™ã‚‹ã¨ãƒãƒ©ãƒ³ã‚¹ãŒå´©ã‚Œã¾ã™ã€‚ãƒ¬ãƒ“ãƒ¥ãƒ¼æ™‚ã¯è‰¯ã„ç‚¹2ã¤ï¼‹æ”¹å–„1ã¤ã®é †ã§ãƒ¡ãƒ¢ã€‚é †ç•ªã‚’å®ˆã‚‹ã ã‘ã§ã€è„³ã®ãƒ”ãƒ³ãƒˆãŒæ•´ã„ã¾ã™ã€‚é€±1å›ã¯æˆåŠŸãƒ•ã‚©ãƒ«ãƒ€ã‚’è¦‹è¿”ã—ã€å†ç¾å¯èƒ½ãªæ‰‹ãŒã‹ã‚Šã‚’æŠ½å‡ºã€‚ç©´ãƒ¡ã‚¬ãƒã¯ã€ä¸¡çœ¼ã«ã™ã‚‹ã¨ä¸€æ°—ã«é ¼ã‚‚ã—ããªã‚Šã¾ã™ã€‚",
    OG:"å†ç™ºé˜²æ­¢ã«çœŸå‰£ã ã‹ã‚‰ã“ãã€åºƒãå³ã—ãè¨€ã„åˆ‡ã‚ŠãŒã¡ã€‚ã€Œã„ã¤ã‚‚ã€ã€Œçµ¶å¯¾ã€ã‚’å¤–ã—ã¦ã€å ´é¢ãƒ»æ™‚é–“ãƒ»ç›¸æ‰‹ã‚’é™å®šã—ãŸæ–‡ç« ã«å¤‰ãˆã¾ã—ã‚‡ã†ã€‚æ¬¡ã«è©¦ã™ä¸€æ‰‹ã‚’1ã¤æ›¸ãã¨ã€å­¦ã³ã«å¤‰ã‚ã‚Šã¾ã™ã€‚æˆåŠŸã®ä¾‹å¤–ã‚‚é›†ã‚ã‚Œã°ã€ã‚ªã‚¦ãƒ ã®ãƒ•ãƒ¬ãƒ¼ã‚ºã¯è±Šã‹ã«ã€‚ä¸€èˆ¬åŒ–ã¯è¨­è¨ˆå›³ã«ãƒªãƒ©ã‚¤ãƒˆã§ãã¾ã™ã€‚",
    PD:"ä¼¸ã³ã‚‹äººã»ã©è¬™è™šã€‚ã§ã‚‚è¤’ã‚ã‚’æ‹’å¦ã™ã‚‹ã¨ã€æˆé•·ã®ç‡ƒæ–™ãŒæ¸›ã‚Šã¾ã™ã€‚ã¾ãšã¯åè«–ã—ãªã„ã§ãã®ã¾ã¾å¼•ç”¨ã€‚ç¿Œæ—¥ã«èª­ã¿è¿”ã—ã¦ã€å…·ä½“çš„è¡Œå‹•ã«å¤‰æ›ã—ã¾ã—ã‚‡ã†ï¼ˆä¾‹ï¼šã¾ãŸåŒã˜æº–å‚™ã‚’ã™ã‚‹ï¼‰ã€‚è©•ä¾¡ã¯ç›¸æ‰‹ã®æ‰€æœ‰ç‰©ã§ã‚‚ã‚ã‚Šã¾ã™ã€‚å—ã‘å–ã‚‹ã“ã¨ã¯ã€ç›¸æ‰‹ã®å¥½æ„ã‚’å°Šé‡ã™ã‚‹è¡Œç‚ºã€‚å¦èªã‚’ä¸€æ­©ã‚„ã‚ã‚‹ã ã‘ã§ã€è‡ªå·±åŠ¹åŠ›æ„ŸãŒé™ã‹ã«ç©ã¿ä¸ŠãŒã‚Šã¾ã™ã€‚"
  };
  // ã‚¿ã‚¤ãƒ—åˆ¥ï¼šå…·ä½“çš„ã‚±ã‚¢ï¼ˆ3è¡Œï¼‰
var CARE = {
  ZO: [
    "è©•ä¾¡ã¯OK/æ”¹å–„ã®äºŒæ®µã§ãƒ¡ãƒ¢ã€‚ã¾ãšâ€œè‰¯ã‹ã£ãŸç‚¹â€ã‚’1ã¤æ›¸ãã€‚",
    "ç™½é»’ã®é–“ã«â€œã¾ã‚è‰¯ã—â€ã‚’1ã¤ç½®ãã€‚",
    "ä»Šæ—¥ã®åˆ¤æ–­ã«â€œã‚°ãƒ¬ãƒ¼æ¡ˆâ€ã‚’1å€‹æ··ãœã‚‹ã€‚"
  ],
  YS: [
    "çµè«–ã«â€œä»®èª¬ï¼Ÿâ€ãƒ©ãƒ™ãƒ«ã‚’ä»˜ã‘ã¦ä¿ç•™â†’çŸ­ã„ç¢ºèªã‚’1å¾€å¾©ã€‚",
    "è¿”ä¿¡ãŒé…ã„ï¼â€œå¿™ã—ã„ã ã‘ã‹ã‚‚â€ã¨ã„ã†åˆ¥æ¡ˆã‚’ä¸¦ã¹ã‚‹ã€‚",
    "ç¢ºã‹ã‚ã‚‹ä¸€æ­©ï¼ˆè³ªå•1ã¤ãƒ»DM1é€šï¼‰ã‚’å…ˆã«å…¥ã‚Œã‚‹ã€‚"
  ],
  BK: [
    "äº‹å®Ÿã‚’3ã¤ï¼ˆæ™‚åˆ»/æ•°/èª°ãŒä½•ã‚’ï¼‰æ›¸ãå‡ºã—ã€å½¢å®¹è©ã‚’å¤–ã™ã€‚",
    "æˆåŠŸã®â€œæ‰‹é †1è¡Œâ€ã‚’è¿½è¨˜ã—ã¦ç¸®å°ã—ãªã„ã€‚",
    "æ„Ÿæƒ…ã®å¼·ã•ã‚’0ã€œ10ã§æ›¸ãã€ç­‰å€ã«æˆ»ã™ã€‚"
  ],
  BB: [
    "â€œç›®çš„â†’æ‰‹æ®µâ€ã§è¦‹ç›´ã—ã€æ‰‹æ®µã‚’2æ¡ˆä¸¦ã¹ã¦é¸ã¶ã€‚",
    "é€±ã«1å›â€œ7å‰²OKãƒ‡ãƒ¼â€ã‚’ä½œã‚‹ã€‚",
    "ToDo3ã¤â†’â€œä»Šã¯1ã¤ã ã‘â€ã«çµã‚‹ã€‚"
  ],
  WS: [
    "å‡ºæ¥äº‹ã‚’è‡ªåˆ†/ç›¸æ‰‹/çŠ¶æ³ã®3ç®±ã«é…åˆ†ï¼ˆã¾ãš1/3ãšã¤ï¼‰ã€‚",
    "ãŠé¡˜ã„ãƒ†ãƒ³ãƒ—ãƒ¬ã‚’ç”¨æ„ã—ã¦â€œé ¼ã‚‹â€ã‚’ç·´ç¿’ã€‚",
    "è‡ªåˆ†ã®é ˜åŸŸã«ãƒ©ãƒ™ãƒ«ã‚’ä»˜ã‘ã¦å¢ƒç•Œã‚’å¯è¦–åŒ–ã€‚"
  ],
  LB: [
    "åè©ãƒ©ãƒ™ãƒ«â†’â€œè¡Œå‹•ãƒ©ãƒ™ãƒ«â€ã«è¨€ã„æ›ãˆã‚‹ï¼ˆä»Šã¯ç–²ã‚Œã¦é…ã„ç­‰ï¼‰ã€‚",
    "ãƒ©ãƒ™ãƒ«ã«æœŸé™ã‚’ä»˜ã‘ã‚‹ï¼ˆä»Šæ—¥ã¯/ä»Šé€±ã¯ï¼‰ã€‚",
    "ä¾‹å¤–ã‚’2ä»¶é›†ã‚ã¦å›ºå®šè¦³å¿µã‚’ã‚†ã‚‹ã‚ã‚‹ã€‚"
  ],
  EJ: [
    "â€œæ°—åˆ†â€ã¨â€œäº‹å®Ÿâ€ã‚’åˆ¥è¡Œã«åˆ†ã‘ã¦è¨˜éŒ²ã€‚",
    "é‡è¦åˆ¤æ–­ã¯ç¿Œæ—¥ã«å›ã™ãƒ«ãƒ¼ãƒ«ã€‚",
    "ç¡çœ ã¨è¡€ç³–ã‚±ã‚¢ï¼ˆè»½é£Ÿ/æ°´åˆ†ï¼‰ã§åœŸå°ã‚’æ•´ãˆã‚‹ã€‚"
  ],
  SL: [
    "ãƒ¬ãƒ“ãƒ¥ãƒ¼ã¯â€œè‰¯ã„ç‚¹2ï¼‹æ”¹å–„1â€ã®é †ã§æ›¸ãã€‚",
    "æˆåŠŸãƒ•ã‚©ãƒ«ãƒ€ã‚’é€±1ã§è¦‹è¿”ã—ã€å†ç¾ã®æ‰‹ãŒã‹ã‚Šã‚’æŠ½å‡ºã€‚",
    "æ¬ ç‚¹ãƒ¡ãƒ¢ã®å‰ã«â€œè‰¯ã„ç‚¹â€ã‚’å¿…ãš2ã¤ç½®ãã€‚"
  ],
  OG: [
    "â€œã„ã¤ã‚‚/çµ¶å¯¾â€ã‚’å¤–ã—ã€æ¡ä»¶ã‚’é™å®šã—ã¦è¨€ã„æ›ãˆã‚‹ã€‚",
    "æ¬¡ã«è©¦ã™ä¸€æ‰‹ã‚’1ã¤ã ã‘æ›¸ãã€‚",
    "æˆåŠŸã®ä¾‹å¤–ã‚’é›†ã‚ã¦â€œæ‹¡ã’éãâ€ã‚’æˆ»ã™ã€‚"
  ],
  PD: [
    "è¤’ã‚ã‚’â€œå¼•ç”¨â€ã§ä¿å­˜ã€‚åè«–ã¯24æ™‚é–“ä¿ç•™ã€‚",
    "ç¿Œæ—¥ã«èª­ã¿è¿”ã—ã€å†ç¾ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’1ã¤æ±ºã‚ã‚‹ã€‚",
    "è©•ä¾¡ã¯ç›¸æ‰‹ã®æ‰€æœ‰ç‰©ã€‚å—ã‘å–ã‚‹ï¼ç›¸æ‰‹ã‚’å°Šé‡ã™ã‚‹ã€‚"
  ]
};

  function render(o){
    // åˆ¤å®š
    var pair = pickType(o.fPct);
    var t = pair.main, ally = pair.ally;
    var code = t.code;

    // ã‚¿ã‚¤ãƒˆãƒ«è¡Œ
    typeLine.textContent = 'ä»Šæ—¥ã®ä¸»å½¹ã‚¯ã‚»ãƒ¢ãƒ³ï¼š' + t.name;

    // ãƒ’ãƒ¼ãƒ­ãƒ¼
    heroImg.src = heroPath(t.id);
    heroImg.alt = t.name + " ã®ã‚¤ãƒ¡ãƒ¼ã‚¸";
    heroTitle.textContent = t.name;
    heroCopy.innerHTML = LONG[code];
    heroHint.textContent  = "ãƒ’ãƒ³ãƒˆï¼š" + t.hint;

    // ç·åˆ
    var avg = Object.keys(o.fScore).reduce(function(s,k){return s+o.fScore[k];},0)/Object.keys(o.fScore).length;
    sumAvg.textContent = avg.toFixed(2);
    sumPct.textContent = "= " + o.totalPct + "%";
    var topKey = Object.keys(o.fPct).sort(function(a,b){ return o.fPct[b]-o.fPct[a]; })[0];
    sumNote.textContent = "ä¸Šä½å› å­ï¼š"+FACTORS[topKey].name;

    // ç›¸æ£’
    if(ally){
      allyName.textContent = ally.name;
      allyNote.textContent = "ä¸»å½¹ã¨ã®å·®ãŒå°ã•ã„ãŸã‚ç›¸æ£’ã¨ã—ã¦è¡¨ç¤ºã—ã¦ã„ã¾ã™ã€‚";
    }else{
      allyName.textContent = "â€”";
      allyNote.textContent = "æ¡ä»¶ä¸€è‡´ã®ã¨ãè¡¨ç¤º";
    }

    // å› å­ãƒãƒ¼
    drawBars(o.fPct);

longCopy.innerHTML = '';

  // ã‚±ã‚¢ï¼ˆã‚¿ã‚¤ãƒ—åˆ¥3è¡Œï¼‰
if (careList && CARE[code]) {
  careList.innerHTML = CARE[code].map(function(s){ return "<li>"+s+"</li>"; }).join("");
}

// ç ”ç©¶ãƒ¡ãƒ¢ï¼ˆè»½æ¸›ãƒ¡ãƒªãƒƒãƒˆã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ï¼š10ä»¶ï¼‰
var memo = [
  "ç™½é»’ã§æ±ºã‚åˆ‡ã‚‹ã‚¯ã‚»ã‚’ã‚†ã‚‹ã‚ã‚‹ã¨ã€æ°—åˆ†ã®è½å·®ãŒå°ã•ããªã‚Šæ—¥å¸¸ã®å›å¾©ãŒé€Ÿããªã‚Šã‚„ã™ã„ï¼ˆæ€è€ƒã®æŸ”è»Ÿæ€§â†‘ï¼‰ã€‚",
  "èª­å¿ƒãƒ»å…ˆèª­ã¿ã‚’â€œç¢ºèªâ€ã«ç½®ãæ›ãˆã‚‹ç¿’æ…£ã¯ã€ä¸å®‰ã®ãƒ”ãƒ¼ã‚¯ã‚’ä¸‹ã’äººé–“é–¢ä¿‚ã®èª¤è§£ã‚’æ¸›ã‚‰ã™ï¼ˆèª¤æ¨æ¸¬â†“ï¼‰ã€‚",
  "ç ´å±€åŒ–ï¼ˆæ‹¡å¤§ï¼‰ã‚’ä¸‹ã’ã‚‹ç·´ç¿’ã¯ã€ã‚¹ãƒˆãƒ¬ã‚¹å ´é¢ã§â€œä»Šã§ãã‚‹ã“ã¨â€ã‚’è¦‹ã¤ã‘ã‚„ã™ãã—è¡Œå‹•é‡ã‚’ä¿ã¡ã‚„ã™ã„ï¼ˆæ©Ÿèƒ½ç¶­æŒâ†‘ï¼‰ã€‚",
  "ã€Œã€œã™ã¹ãã€ã‚’ç·©ã‚ã‚‹ã¨ã€å®Œç’§æ€è€ƒã®è² è·ãŒä¸‹ãŒã‚Šç„¦ã‚Šãƒ»è‡ªå·±æ‰¹åˆ¤ãŒå’Œã‚‰ãï¼ˆè‡ªå·±è¨±å®¹â†‘ï¼‰ã€‚",
  "ã€å…¨éƒ¨è‡ªåˆ†ã®ã›ã„ã€ã‚’æ‰‹æ”¾ã™ã¨ã€ç›¸è«‡ã‚„åˆ†æ‹…ãŒã—ã‚„ã™ããªã‚Šç‡ƒãˆå°½ãã®äºˆé˜²ã«ãªã‚‹ï¼ˆè² æ‹…æ„Ÿâ†“ï¼‰ã€‚",
  "ãƒ¬ãƒƒãƒ†ãƒ«è²¼ã‚Šã‚’â€œè¡Œå‹•ãƒ©ãƒ™ãƒ«â€ã«è¨€ã„æ›ãˆã‚‹ã¨ã€è‡ªå·±å¦å®šã®å›ºå®šåŒ–ãŒå¼±ã¾ã‚Šè©¦è¡Œå›æ•°ãŒå¢—ãˆã‚‹ï¼ˆãƒãƒ£ãƒ¬ãƒ³ã‚¸å›æ•°â†‘ï¼‰ã€‚",
  "â€œæ°—åˆ†ï¼äº‹å®Ÿâ€ã‚’åˆ†ã‘ã¦è¨˜éŒ²ã™ã‚‹ã¨ã€è¡å‹•çš„åˆ¤æ–­ãŒæ¸›ã‚Šç¿Œæ—¥ã®è»Œé“ä¿®æ­£ãŒã—ã‚„ã™ã„ï¼ˆæ„æ€æ±ºå®šã®è³ªâ†‘ï¼‰ã€‚",
  "æ¬ ç‚¹ã ã‘ã‚’è¦‹ã‚‹ã‚¯ã‚»ã‚’æ•´ãˆã‚‹ã¨ã€å­¦ç¿’åŠ¹ç‡ãŒä¸ŠãŒã‚Šæ”¹å–„ç‚¹ã®å®šç€ãŒæ—©ã¾ã‚‹ï¼ˆãƒ¬ãƒ“ãƒ¥ãƒ¼åŠ¹æœâ†‘ï¼‰ã€‚",
  "ã€ã„ã¤ã‚‚/çµ¶å¯¾ã€ã®è¨€ã„åˆ‡ã‚Šã‚’æ¸›ã‚‰ã™ã¨ã€å†æŒ‘æˆ¦ã®ãƒãƒ¼ãƒ‰ãƒ«ãŒä¸‹ãŒã‚Šç¶™ç¶šç‡ãŒä¸ŠãŒã‚‹ï¼ˆå†æŒ‘æˆ¦ç‡â†‘ï¼‰ã€‚",
  "è¤’ã‚ã‚’â€œå¼•ç”¨ã§å—ã‘å–ã‚‹â€ç·´ç¿’ã¯ã€è‡ªå·±åŠ¹åŠ›æ„Ÿã®ç‡ƒæ–™ã‚’è²¯ã‚ã‚„ã™ããƒ¢ãƒãƒ™ãŒå®‰å®šã™ã‚‹ï¼ˆãƒã‚¸è³‡æºã®å–ã‚Šè¾¼ã¿â†‘ï¼‰"
];
resMemo.innerHTML = memo.map(function(s){ return "<li>"+s+"</li>"; }).join("");

    // å…±æœ‰ï¼ˆãƒœã‚¿ãƒ³ã§ç¢ºå®Ÿã«é–‹ãï¼‰
    var shareText = 'ã€æ€è€ƒã‚¯ã‚»ãƒ¢ãƒ³è¨ºæ–­ã€ä¸»å½¹ï¼š'+t.name+'ï½œå› å­å¹³å‡ '+avg.toFixed(2)+' / 4';
    var url = location.href.split('#')[0];
    function openBlank(u){ window.open(u, '_blank', 'noopener'); }

    shareTw.onclick = function(){ openBlank('https://twitter.com/intent/tweet?text='+encodeURIComponent(shareText)+'&url='+encodeURIComponent(url)); };
    shareLn.onclick = function(){ openBlank('https://line.me/R/msg/text/?'+encodeURIComponent(shareText+' '+url)); };
    shareIg.onclick = function(){
      var cap = shareText+' '+url;
      copyToClipboard(cap).then(function(){
        openBlank('https://www.instagram.com/');
        toast('ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸã€‚Instagramã§è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ã€‚');
      });
    };
    var shareCp = document.getElementById('shareCp');
    if(shareCp){
      shareCp.onclick = function(){
        copyToClipboard(shareText+' '+url).then(function(){ toast('ãƒªãƒ³ã‚¯ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ'); });
      };
    }
    shareRow.hidden = false;
    shareRow.style.display = 'flex';

    // è¡¨ç¤ºåˆ‡æ›¿
    resEmpty.style.display = "none";
    resArea.style.display  = "block";
    document.getElementById("result").scrollIntoView({behavior:"smooth", block:"start"});

    // ä¿å­˜
    try{
      localStorage.setItem("specimens:last", JSON.stringify({ id: SLUG, title: TITLE, href: location.pathname }));
    }catch(e){}
  }

  // å…±æœ‰ãƒ˜ãƒ«ãƒ‘ãƒ¼
  function copyToClipboard(text){
    if(navigator.clipboard && navigator.clipboard.writeText){ return navigator.clipboard.writeText(text); }
    return new Promise(function(res){
      var ta=document.createElement('textarea'); ta.value=text;
      document.body.appendChild(ta); ta.select();
      try{ document.execCommand('copy'); }catch(_){}
      document.body.removeChild(ta); res();
    });
  }
  function toast(msg){
    var t=document.createElement('div');
    t.textContent=msg;
    t.style.position='fixed'; t.style.left='50%'; t.style.bottom='20px';
    t.style.transform='translateX(-50%)'; t.style.background='rgba(31,39,50,.92)';
    t.style.color='#fff'; t.style.padding='8px 12px'; t.style.borderRadius='10px';
    t.style.zIndex=9999; t.style.fontSize='13px';
    document.body.appendChild(t);
    setTimeout(function(){ t.remove(); },1500);
  }

  // ã‚¯ãƒªã‚¢
  function clearAnswers(){
    qWrap.querySelectorAll('input[type="radio"]').forEach(function(r){ r.checked=false; });
    wipeAnswers(); prog.style.width="0%";
    resEmpty.style.display=""; resArea.style.display="none";
    var app=document.getElementById("app"); if(app){ app.scrollIntoView({behavior:"smooth", block:"start"}); }
  }

  // åˆæœŸåŒ–
  function init(){
    buildQuestions();
    resMemo.innerHTML = ["ã‚ã‚‹ç ”ç©¶ã§ã¯ã€è¤‡æ•°è¦ç´ ãŒé‡ãªã£ã¦å°è±¡ãŒå½¢ã¥ãã‚‰ã‚Œã‚‹ç¤ºå”†ã€‚"].map(function(s){return "<li>"+s+"</li>";}).join("");
  }
  if(document.readyState === "loading"){ document.addEventListener("DOMContentLoaded", init); } else { init(); }
  document.getElementById("doScore").addEventListener("click", calc, false);
  document.getElementById("doScore2").addEventListener("click", calc, false);
  document.getElementById("clearAns").addEventListener("click", clearAnswers, false);

  var back = document.getElementById("backLink");
  if(back){
    back.addEventListener("click", function(){
      try{ localStorage.setItem("specimens:last", JSON.stringify({ id: SLUG, title: TITLE, href: location.pathname })); }catch(e){}
    }, false);
  }

  // çŠ¶æ…‹ï¼ˆæœªä½¿ç”¨ä¿æŒç”¨ï¼‰
  var state = { };
})(); // IIFE

// ====== çµæœç”»åƒï¼ˆ1080x1350ï¼‰ ======
async function buildShareImage(data){
  var cvs = (window.shotCanvas || document.getElementById("shotCanvas"));
  if(!cvs) throw new Error("shotCanvas not found");
  var ctx = cvs.getContext("2d");
  var W = cvs.width, H = cvs.height;
  var FACT = (window.FACTORS || {});

  // èƒŒæ™¯
  ctx.fillStyle = "#ffffff"; ctx.fillRect(0,0,W,H);

  // ãƒ’ãƒ¼ãƒ­ãƒ¼ç”»åƒï¼ˆæ­£æ–¹å½¢ï¼‰
  var heroW = W - 120, heroH = heroW;
  var hx = Math.round((W - heroW)/2), hy = 60;
  roundRect(ctx, hx-4, hy-4, heroW+8, heroH+8, 18, "#f7f9ff", "#e6ecf7");
  try{
    var img = await loadImage(data.heroSrc);
    ctx.drawImage(img, hx, hy, heroW, heroH);
  }catch(_){
    ctx.fillStyle = "#e6ecf7"; ctx.fillRect(hx, hy, heroW, heroH);
    ctx.fillStyle = "#9aa3b2"; ctx.font = "600 24px 'Noto Sans JP',system-ui";
    ctx.fillText("ç”»åƒã‚’è¡¨ç¤ºã§ãã¾ã›ã‚“ã§ã—ãŸ", hx + 24, hy + heroH/2);
  }

  // ã‚¿ã‚¤ãƒˆãƒ«
  var y = hy + heroH + 40;
  ctx.fillStyle = "#1f2732";
  ctx.font = "800 40px 'Noto Sans JP',system-ui";
  ctx.fillText("æ€è€ƒã‚¯ã‚»ãƒ¢ãƒ³è¨ºæ–­", 60, y);
  ctx.font = "800 44px 'Noto Sans JP',system-ui";
  drawWrapText(ctx, "ä¸»å½¹ï¼š"+data.title, 60, y+54, W-120, 48);

  // ä¸€è¨€ãƒ»ãƒ’ãƒ³ãƒˆ
  ctx.font = "700 28px 'Noto Sans JP',system-ui";
  drawWrapText(ctx, data.one, 60, y+120, W-120, 36, "#667087");
  ctx.font = "600 26px 'Noto Sans JP',system-ui";
  drawWrapText(ctx, "ãƒ’ãƒ³ãƒˆï¼š"+data.hint, 60, y+176, W-120, 34, "#667087");

  // å› å­ãƒãƒ¼ï¼ˆ10ï¼‰
  var baseY = y + 230;
  var order = ["ZO","YS","BK","BB","WS","LB","EJ","SL","OG","PD"];
  for(var i=0;i<order.length;i++){
    var key = order[i], val = data.pct[key]||0;
    drawBar(ctx, 60, baseY + i*60, W-120, 16, val,
      (FACT[key] ? FACT[key].name : key), "#6b9bff", "#8bd3ff");
  }

  // å¹³å‡
  var ftY = baseY + order.length*60 + 36;
  ctx.font = "700 28px 'Noto Sans JP',system-ui";
  ctx.fillStyle = "#1f2732";
  ctx.fillText("å› å­å¹³å‡ï¼š"+data.avg+" / 4ï¼ˆ= "+Math.round((parseFloat(data.avg)/4)*100)+"%ï¼‰", 60, ftY);

  return await canvasToBlob(cvs, "image/png");
}

// ç”»åƒèª­è¾¼
async function loadImage(src){
  try{
    const r = await fetch(src, {cache:'no-store'});
    if(!r.ok) throw new Error('fetch failed');
    const b = await r.blob();
    const blobUrl = URL.createObjectURL(b);
    const img = await new Promise((res, rej)=>{
      const im = new Image();
      im.onload = ()=>res(im);
      im.onerror = rej;
      im.src = blobUrl;
    });
    setTimeout(()=>URL.revokeObjectURL(blobUrl), 1000);
    return img;
  }catch(e){
    return await new Promise((res, rej)=>{
      const im = new Image();
      im.crossOrigin = "anonymous";
      im.onload = ()=>res(im);
      im.onerror = rej;
      im.src = src + (src.indexOf("?")>-1 ? "&" : "?") + "t=" + Date.now();
    });
  }
}

// è§’ä¸¸
function roundRect(ctx, x, y, w, h, r, fill, stroke){
  ctx.save(); ctx.beginPath();
  ctx.moveTo(x+r, y);
  ctx.arcTo(x+w, y, x+w, y+h, r);
  ctx.arcTo(x+w, y+h, x, y+h, r);
  ctx.arcTo(x, y+h, x, y, r);
  ctx.arcTo(x, y, x+w, y, r);
  ctx.closePath();
  if(fill){ ctx.fillStyle = fill; ctx.fill(); }
  if(stroke){ ctx.strokeStyle = stroke; ctx.stroke(); }
  ctx.restore();
}
// æŠ˜è¿”ã—
function drawWrapText(ctx, text, x, y, maxW, lh, color){
  ctx.fillStyle = color || "#1f2732";
  var words = (text||"").split(/(\s+)/);
  var line = "", cursor = y;
  for(var i=0;i<words.length;i++){
    var test = line + words[i];
    if(ctx.measureText(test).width > maxW && i>0){
      ctx.fillText(line, x, cursor);
      line = words[i].trimStart();
      cursor += lh;
    }else{ line = test; }
  }
  if(line){ ctx.fillText(line, x, cursor); }
}
// ãƒãƒ¼
function drawBar(ctx, x, y, w, h, pct, label, c1, c2){
  ctx.save();
  ctx.fillStyle = "#1f2732";
  ctx.font = "700 20px 'Noto Sans JP',system-ui";
  ctx.fillText(label, x, y-8);
  var by = y+8;
  roundRect(ctx, x, by, w, h, 10, "#edf2fb", "#e8eef9");
  var ww = Math.max(0, Math.min(w, Math.round(w*pct/100)));
  var grad = ctx.createLinearGradient(x,0,x+w,0);
  grad.addColorStop(0, c1); grad.addColorStop(1, c2);
  roundRect(ctx, x, by, ww, h, 10, grad);
  ctx.fillStyle = "#667087";
  ctx.font = "600 16px 'Noto Sans JP',system-ui";
  var txt = String(pct).padStart(2,"0")+"%";
  ctx.fillText(txt, x + w - ctx.measureText(txt).width, by + h + 18);
  ctx.restore();
}
// ä¿å­˜
function saveBlob(blob, filename){
  var a = document.createElement("a");
  var url = URL.createObjectURL(blob);
  a.href = url; a.download = filename || "result.png";
  document.body.appendChild(a); a.click();
  setTimeout(function(){ URL.revokeObjectURL(url); a.remove(); }, 400);
}
// toBlob
function canvasToBlob(cvs, type){
  return new Promise(function(res){
    if(cvs.toBlob){ cvs.toBlob(function(b){ res(b); }, type||"image/png"); }
    else{ res(dataURLtoBlob(cvs.toDataURL(type||"image/png"))); }
  });
}
function dataURLtoBlob(dataUrl){
  var arr = dataUrl.split(','), mime = arr[0].match(/:(.*?);/)[1],
      bstr = atob(arr[1]), n = bstr.length, u8arr = new Uint8Array(n);
  while(n--){ u8arr[n] = bstr.charCodeAt(n); }
  return new Blob([u8arr], {type:mime});
}
</script>
<script>
/* ============================================================
   è¨ºæ–­ãƒšãƒ¼ã‚¸å…±é€šã‚¹ãƒ‹ãƒšãƒƒãƒˆï¼ˆã‚³ãƒ”ãƒšç”¨ï¼‰
   1) å›ç­”ã®è‡ªå‹•ä¿å­˜ãƒ»è‡ªå‹•å¾©å…ƒï¼ˆå…¥åŠ›ä¸­ã‚‚é€æ¬¡ä¿å­˜ï¼‰
   2) çµæœè¡¨ç¤ºã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ã€Œæ¸ˆã€ï¼‹ ã‚ãªãŸã®Lv +1
   3) ã¿ã‚“ãªã®ã“ã“ã‚Lvï¼ˆCountAPIï¼‰ã« +1ï¼ˆå¤±æ•—ã¯ç„¡è¦–ï¼‰
   ------------------------------------------------------------
   â˜…ç½®ãå ´æ‰€ï¼šå„è¨ºæ–­HTMLã® </body> ã®ç›´å‰
   â˜…ãƒšãƒ¼ã‚¸IDï¼š<body data-id="xxxxx"> ã‚’æ¨å¥¨ï¼ˆæœªè¨­å®šã§ã‚‚å‹•ä½œï¼‰
============================================================ */
(function(){
  'use strict';

  // ===== å›ºå®šã‚­ãƒ¼ï¼šindex.html ã¨åˆã‚ã›ã¦ã‚ã‚Šã¾ã™ =====
  var DONE_KEY   = 'specimens:open:byid';   // è¨ºæ–­ã”ã¨ã®ã€Œæ¸ˆã€ãƒãƒƒãƒ—
  var TOTAL_KEY  = 'specimens:open:total';  // ã‚ãªãŸã®ã“ã“ã‚Lvï¼ˆåˆè¨ˆï¼‰
  var GLOBAL_LAST= 'specimens:open:global:last'; // ã¿ã‚“ãªã®Lvã®å‰å›è¡¨ç¤ºã‚­ãƒ£ãƒƒã‚·ãƒ¥

  // ===== ã“ã®ãƒšãƒ¼ã‚¸ã®ID =====
  var MY_ID = (document.body && document.body.getAttribute('data-id')) || 'unknown';

  // ===== å›ç­”ä¿å­˜ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ï¼ˆã“ã®è¨ºæ–­ã ã‘ã®ç®±ï¼‰ =====
  var ANSWER_KEY = 'specimens:answers:' + MY_ID;

  // ===== ã¿ã‚“ãªã®Lvï¼ˆCountAPIè¨­å®šï¼‰ =====
  var COUNTAPI_NS  = 'haisuikounozarigani_shindan';
  var COUNTAPI_KEY = 'specimens_open_total';
  function countapiHit(){
    var url = 'https://api.countapi.xyz/hit/'+COUNTAPI_NS+'/'+COUNTAPI_KEY;
    if(navigator.sendBeacon){
      try{ navigator.sendBeacon(url); }catch(_){}
    }else{
      fetch(url, {mode:'cors', cache:'no-store', keepalive:true}).catch(function(){});
    }
  }

  // ---------- å›ç­”ã®ä¿å­˜/å¾©å…ƒ ----------
  function loadState(){
    try{ return JSON.parse(localStorage.getItem(ANSWER_KEY) || '{}'); }catch(_){ return {}; }
  }
  function saveState(obj){
    try{ localStorage.setItem(ANSWER_KEY, JSON.stringify(obj)); }catch(_){}
  }
  function saveField(el){
    if(!el || !el.name) return;
    var st = loadState();
    var nm = el.name;

    if(el.type === 'radio'){
      // ãƒ©ã‚¸ã‚ªã¯é¸ã°ã‚ŒãŸ value ã‚’ä¿å­˜
      var chosen = (el.form || document).querySelector('input[type="radio"][name="'+nm+'"]:checked');
      st[nm] = chosen ? {t:'r', v: chosen.value} : {t:'r', v:null};
    }else if(el.type === 'checkbox'){
      // ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã¯åŒåã‚°ãƒ«ãƒ¼ãƒ—ã®ãƒã‚§ãƒƒã‚¯æ¸ˆã¿ value é…åˆ—
      var all = (el.form || document).querySelectorAll('input[type="checkbox"][name="'+nm+'"]');
      var vals = [];
      all.forEach(function(c){ if(c.checked) vals.push(c.value || 'on'); });
      st[nm] = {t:'c', v: vals};
    }else if(el.tagName==='SELECT'){
      if(el.multiple){
        var arr=[]; [].slice.call(el.options).forEach(function(o){ if(o.selected) arr.push(o.value); });
        st[nm] = {t:'m', v: arr};
      }else{
        st[nm] = {t:'s', v: el.value};
      }
    }else{
      // text / number / textarea ãªã©
      st[nm] = {t:'t', v: el.value};
    }
    saveState(st);
  }
  function restoreOnce(){
    var st = loadState();
    var names = Object.keys(st);
    if(!names.length) return false;

    names.forEach(function(nm){
      var info = st[nm]; if(!info) return;

      if(info.t==='r'){
        var r = document.querySelector('input[type="radio"][name="'+nm+'"][value="'+CSS.escape(String(info.v))+'"]');
        if(r){ r.checked = true; r.dispatchEvent(new Event('change',{bubbles:true})); }
      }else if(info.t==='c'){
        var all = document.querySelectorAll('input[type="checkbox"][name="'+nm+'"]');
        var set = new Set(info.v||[]);
        all.forEach(function(c){ c.checked = set.has(c.value || 'on'); });
      }else if(info.t==='m'){
        var sel = document.querySelector('select[name="'+nm+'"]');
        if(sel){
          var setm = new Set(info.v||[]);
          [].slice.call(sel.options).forEach(function(o){ o.selected = setm.has(o.value); });
        }
      }else if(info.t==='s'){
        var s = document.querySelector('select[name="'+nm+'"]');
        if(s){ s.value = info.v; }
      }else{
        var t = document.querySelector('[name="'+nm+'"]');
        if(t){ t.value = info.v==null? '' : String(info.v); }
      }
    });
    // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ç­‰ã‚’æ›´æ–°ã—ãŸã„UIã®ãŸã‚ã€è»½ã change ã‚’æŠ•ã’ã‚‹
    try{
      document.dispatchEvent(new Event('change', {bubbles:true}));
    }catch(_){}
    return true;
  }
  // å…¥åŠ›ç›£è¦–ï¼ˆä¿å­˜ï¼‰
  document.addEventListener('change', function(e){
    var el = e.target;
    if(!(el instanceof HTMLElement)) return;
    if(el.matches('input[name], select[name], textarea[name]')) saveField(el);
  }, true);
  document.addEventListener('input', function(e){
    var el = e.target;
    if(!(el instanceof HTMLElement)) return;
    if(el.matches('input[type="text"][name], input:not([type])[name], textarea[name]')) saveField(el);
  }, true);

  // å¾©å…ƒã¯ã€Œå…¥åŠ›ãŒæç”»ã•ã‚Œã¦ã‹ã‚‰ã€ä¸€åº¦ã ã‘è©¦ã¿ã‚‹ï¼ˆå‹•çš„ç”Ÿæˆã«ã‚‚å¯¾å¿œï¼‰
  (function restoreWhenReady(){
    var TRY_MAX=12, tries=0;
    function tick(){
      tries++;
      // å…¥åŠ›ãŒä¸€ã¤ã§ã‚‚è¦‹ã¤ã‹ã£ã¦ã‹ã‚‰å¾©å…ƒ
      var hasAny = document.querySelector('input[name], select[name], textarea[name]');
      if(hasAny){
        restoreOnce(); return;
      }
      if(tries<TRY_MAX){ setTimeout(tick, 300); }
    }
    if(document.readyState==='complete' || document.readyState==='interactive'){ tick(); }
    else document.addEventListener('DOMContentLoaded', tick);
  })();

  // ãƒªã‚»ãƒƒãƒˆç³»ãƒœã‚¿ãƒ³ãŒã‚ã‚Œã°ä¿å­˜ã‚‚å‰Šé™¤ï¼ˆ#btnReset / data-role="reset" ã‚’æƒ³å®šï¼‰
  function clearAnswers(){
    try{ localStorage.removeItem(ANSWER_KEY); }catch(_){}
  }
  document.addEventListener('click', function(e){
    var t = e.target;
    if(!(t instanceof HTMLElement)) return;
    if(t.id==='btnReset' || t.matches('[data-role="reset"]')) clearAnswers();
  }, true);

  // ---------- çµæœç¢ºå®šã§ã€Œæ¸ˆã€ï¼‹LvåŠ ç®— ----------
  var marked = false;
  function markOnce(){
    if(marked) return; marked = true;
    try{
      // 1) ã‚ãªãŸã®ã“ã“ã‚Lv åˆè¨ˆ +1
      var total = (+localStorage.getItem(TOTAL_KEY) || 0) + 1;
      localStorage.setItem(TOTAL_KEY, String(total));

      // 2) ã“ã®è¨ºæ–­ã®ã€Œæ¸ˆã€ã‚’ +1ï¼ˆä»–ã‚¿ãƒ–å³æ™‚åæ˜ ç”¨ã«ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—æ··ãœã‚‹ï¼‰
      var map={}; try{ map = JSON.parse(localStorage.getItem(DONE_KEY) || '{}'); }catch(_){}
      map[MY_ID] = (map[MY_ID] || 0) + 1;
      localStorage.setItem(DONE_KEY, JSON.stringify(Object.assign({}, map, {_ts: Date.now()})));

      // 3) ã¿ã‚“ãªã®ã“ã“ã‚Lv +1ï¼ˆè¡¨ç¤ºã¯ index å´ã§å–å¾—ï¼ã“ã“ã§ã¯é€ã‚‹ã ã‘ï¼‰
      countapiHit();
      // ã¤ã„ã§ã«å‰å›ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚‚+1ï¼ˆindexåˆæœŸè¡¨ç¤ºã®è¦‹æ „ãˆæ”¹å–„ï¼‰
      try{
        var last = (+localStorage.getItem(GLOBAL_LAST) || 0) + 1;
        localStorage.setItem(GLOBAL_LAST, String(last));
      }catch(_){}
    }catch(_){}
  }

  // A) çµæœãŒæç”»ã•ã‚ŒãŸåˆå›³ï¼ˆæ¨å¥¨ï¼šå„ãƒšãƒ¼ã‚¸ã®é›†è¨ˆå®Œäº†æ™‚ã« dispatch ã—ã¦ãã ã•ã„ï¼‰
  //   ä¾‹ï¼‰document.dispatchEvent(new Event('result:ready'));
  document.addEventListener('result:ready', markOnce);

  // B) ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼šçµæœUIãŒè¦‹ãˆã¦ã‹ã‚‰2ç§’å¾Œã«ä¸€åº¦ã ã‘å®Ÿè¡Œï¼ˆæˆ»ã‚‹ç„¡ã—ã§ã‚‚ç¢ºå®Ÿã«ã€Œæ¸ˆã€ï¼‰
  setTimeout(markOnce, 2000);
})();
</script>
</body>
</html>