<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">

<title>ç´”æ„›è¨ºæ–­ï½œ24å•ã§ã€Œã¾ã£ã™ãæ„›ã™ã‚‹åŠ›ã€ã‚’æ¸¬ã‚‹</title>
<meta name="description" content="å®‰å¿ƒãƒ™ãƒ¼ã‚¹ãƒ»ã¾ã£ã™ãã•ãƒ»æ€ã„ã‚„ã‚Šè¡Œå‹•ãƒ»è¨€è‘‰ã®ä¿®å¾©åŠ›ãƒ»ä¿¡é ¼ã®ç¶™ç¶šãƒ»ä¸€ç·’ã«è‚²ã¦ã‚‹æ„Ÿãƒ»ç…§ã‚Œã¨éŠã³å¿ƒãƒ»è¦šæ‚Ÿã¨è²¬ä»»ã‚’24å•ã§å¯è¦–åŒ–ã€‚å¨¯æ¥½ç”¨ã€‚">
<meta name="theme-color" content="#fff7fd">

<!-- OG -->
<meta property="og:type" content="website">
<meta property="og:title" content="ç´”æ„›è¨ºæ–­">
<meta property="og:description" content="ã¾ã£ã™ãæ„›ã™ã‚‹åŠ›ã‚’24å•ã§æ¸¬ã‚‹ï¼ˆå¨¯æ¥½ç”¨ï¼‰ã€‚">
<meta property="og:url" content="https://haisuikounozarigani.github.io/shindan/pure-love.html">
<meta property="og:image" content="https://haisuikounozarigani.github.io/shindan/assets/results/pure-love/t00.webp">

<style>
:root{
  --bg:#fff7fb;
  --paper:#fff;
  --ink:#201322;
  --muted:#6a5b70;
  --line:#f0e3ee;
  --accent:#ff8fc7;
  --accent2:#8c6bff;
}
html,body{
  margin:0;padding:0;background:var(--bg);color:var(--ink);
  font:16px/1.65 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Noto Sans JP","Hiragino Sans","Yu Gothic",Meiryo,sans-serif;
}
a{color:#5b2ea8;text-decoration:none}
.wrap{max-width:980px;margin:0 auto;padding:16px}
header.hd{
  background:linear-gradient(160deg,#fff7fd,#f3ecff);
  border-bottom:1px solid var(--line);
}
header.hd .wrap{padding:20px 16px 10px}
.ttl{
  font-weight:900;font-size:1.35rem;letter-spacing:.02em;
  display:flex;gap:10px;align-items:center;flex-wrap:wrap;
}
.sub{color:var(--muted);font-size:.95rem}

/* ãƒ©ãƒ³ã‚¯ãƒãƒƒã‚¸ï¼ˆãƒ˜ãƒƒãƒ€ï¼‰ */
.rank{
  display:inline-flex;align-items:center;gap:6px;
  padding:.2em .75em;border-radius:999px;
  background:#ffeaf6;color:#5a2445;font-weight:850;font-size:.85rem;
}

/* å›ºå®šé€²æ—ãƒãƒ¼ */
.progress-fixed{position:sticky;top:0;z-index:20;height:8px;background:var(--line)}
.progress-bar{
  height:100%;border-radius:6px;
  background:linear-gradient(90deg,var(--accent),var(--accent2));
  transition:width .2s ease
}
[role="progressbar"]{width:100%}

/* ãƒ’ãƒ¼ãƒ­ãƒ¼ï¼ˆæ­£æ–¹å½¢å›ºå®šï¼‰ */
figure.hero{
  margin:12px 0;border:1px solid var(--line);
  border-radius:16px;overflow:hidden;background:#fff;
}
figure.hero img{
  display:block;width:100%;
  aspect-ratio:1/1;object-fit:cover;
}

/* å…±é€šã‚«ãƒ¼ãƒ‰ */
.paper{
  background:var(--paper);
  border:1px solid var(--line);
  border-radius:16px;
  padding:16px;
  margin:14px 0;
}

/* ãƒ—ãƒ­ãƒ­ãƒ¼ã‚° */
#prologue h2{margin-top:0;font-size:1.1rem}
#prologue p{margin:.45rem 0;color:var(--muted)}
#prologue .note{color:var(--muted);font-size:.9rem}
.start-btn{
  margin-top:12px;width:100%;
  padding:12px 16px;border-radius:999px;border:0;
  background:linear-gradient(135deg,var(--accent),var(--accent2));
  color:#1b0f1c;font-weight:900;letter-spacing:.03em;
  cursor:pointer;box-shadow:0 10px 20px rgba(255,143,199,.18);
  display:inline-flex;align-items:center;justify-content:center;gap:8px;
}
.start-btn span.emo{font-size:1.2rem}

/* è³ªå• */
.qhead{display:flex;justify-content:space-between;align-items:center;gap:8px}
.qnum{font-weight:900;color:#4c2b5f}
.qtag{
  font-size:.8rem;color:#7a6c86;
  padding:2px 8px;border-radius:999px;
  border:1px solid var(--line);
  background:#fff4fb;
  display:inline-flex;align-items:center;gap:4px;
}
.qtext{margin:.65rem 0 1rem;font-weight:850}
.opts{display:grid;grid-template-columns:1fr;gap:8px}
.btn{
  display:flex;align-items:center;justify-content:space-between;gap:12px;
  padding:12px 14px;border:1px solid var(--line);
  border-radius:12px;background:#fff;cursor:pointer;transition:.12s;
}
.btn[aria-pressed="true"]{outline:2px solid var(--accent2);background:#fff4fa}
.btn:hover{transform:translateY(-1px)}
.btn-label{font-weight:850}
.opt-note{color:#8b7b93;font-size:.9rem;white-space:nowrap}
.ctrls{display:flex;gap:8px;margin-top:12px;flex-wrap:wrap}
.ctrls button{
  padding:10px 14px;border-radius:10px;border:1px solid var(--line);
  background:#fff0f8;cursor:pointer;font-weight:800;
}
.ctrls button:disabled{opacity:.55;cursor:not-allowed}

/* çµæœ */
.result{display:none}
.flex{display:flex;gap:16px;flex-wrap:wrap}
.result .imgbox{flex:1 1 280px;min-width:260px}
.result .imgbox img{
  width:100%;aspect-ratio:1/1;object-fit:cover;
  border-radius:14px;border:1px solid var(--line);display:block;
}
.result .text{flex:2 1 360px;min-width:300px}
.badge-line{display:flex;flex-wrap:wrap;gap:6px;align-items:center;margin:.2rem 0 .55rem}
.badge-pill{
  display:inline-flex;align-items:center;gap:6px;
  padding:3px 10px;border-radius:999px;background:#fff1fb;font-size:.85rem;
  border:1px solid rgba(240,227,238,.95);
}
.result-title-main{margin:.1rem 0 0}
.result-title-sub{margin:.15rem 0 .8rem;font-size:.9rem;color:var(--muted)}
.result-comment{
  margin:.35rem 0 .9rem;
  padding:10px 12px;
  border-radius:14px;
  border:1px solid var(--line);
  background:linear-gradient(180deg,#fff,#fff6fb);
}
.result-comment p{margin:.25rem 0;color:#5a3a4f}
.result-comment .rc-ttl{font-weight:950;color:#3a2433}
.result-small{margin:.2rem 0 0;color:var(--muted);font-size:.88rem}

/* ä»Šæ—¥ã®ã²ã¨ã“ã¨ */
.today-box{
  margin:.9rem 0 .2rem;
  padding:12px 12px 10px;
  border-radius:16px;
  border:1px solid rgba(255,143,199,.35);
  background:linear-gradient(135deg, rgba(255,143,199,.14), rgba(140,107,255,.12));
  box-shadow:0 10px 22px rgba(255,143,199,.12);
}
.today-head{
  display:inline-flex;align-items:center;gap:8px;
  font-weight:950;color:#2b1830;
  padding:2px 10px;border-radius:999px;
  background:rgba(255,255,255,.75);
  border:1px solid rgba(240,227,238,.95);
}
.today-text{margin:.55rem 0 0;font-weight:850;color:#2b1830}

/* å› å­ãƒãƒ¼ */
.bars{display:grid;grid-template-columns:1fr;gap:10px;margin-top:10px}
.bar{background:transparent;border-radius:10px;padding:4px 0 6px}
.bar .h{
  display:flex;justify-content:space-between;align-items:center;
  padding:2px 10px 4px;font-size:.9rem
}
.bar .h span:first-child{font-weight:850}
.bar .track{
  margin:0 10px 4px;height:10px;border-radius:999px;background:#ffeaf6;overflow:hidden;
  border:1px solid var(--line);
}
.bar .fill{
  height:100%;width:0%;
  background:linear-gradient(90deg,var(--accent),var(--accent2));
  border-radius:inherit;transition:width .25s ease-out;
}
.bar-desc{padding:0 10px 2px;font-size:.8rem;color:var(--muted)}

/* å‰å›å›ç­”ï¼ˆä¸€è¦§ï¼‰ */
.prev-list{list-style:none;padding-left:0;margin:.4rem 0 .2rem .9rem}
.prev-item{
  display:flex;gap:8px;align-items:flex-start;
  padding:6px 0;border-bottom:1px solid var(--line);
}
.prev-q{
  flex:1;min-width:0;
  display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;
  overflow:hidden;overflow-wrap:anywhere;
}
.prev-a{
  flex:0 0 auto;white-space:nowrap;
  border:1px solid var(--line);border-radius:999px;padding:2px 8px;
  font-size:.9rem;background:#fff0f8;
}

/* ã‚®ãƒ£ãƒ©ãƒªãƒ¼ï¼ˆt01ã€œt05ï¼‰ */
.gallery{
  margin-top:2px;
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(120px,1fr));
  gap:10px;
}
.gallery figure{
  margin:0;border:1px solid var(--line);border-radius:12px;background:#fff;
  padding:6px;text-align:center;font-size:.85rem;color:var(--muted);
  display:flex;flex-direction:column;gap:4px;
}
.gallery img{
  width:100%;aspect-ratio:1/1;object-fit:cover;border-radius:8px;display:block
}
.bar{background:transparent;border-radius:10px;padding:4px 0 6px}
.bar .h{
  display:flex;justify-content:space-between;align-items:center;
  padding:2px 10px 4px;font-size:.9rem
}
.bar .h span:first-child{font-weight:850}
.bar .track{
  margin:0 10px 4px;height:10px;border-radius:999px;background:#ffeaf6;overflow:hidden;
  border:1px solid var(--line);
}
.bar .fill{
  height:100%;width:0%;
  background:linear-gradient(90deg,var(--accent),var(--accent2));
  border-radius:inherit;transition:width .25s ease-out;
}
.bar-desc{padding:0 10px 2px;font-size:.8rem;color:var(--muted)}

/* æŠ˜ã‚ŠãŸãŸã¿ */
.fold-card{
  margin:10px 0 8px;padding:8px 10px;border-radius:12px;
  border:1px solid var(--line);background:#fff;color:var(--muted);font-size:.9rem;
}
.fold-card summary{
  cursor:pointer;list-style:none;font-weight:850;
  display:flex;align-items:center;justify-content:space-between;
}
.fold-card[open]{background:#fff7fb;box-shadow:0 3px 8px rgba(0,0,0,.03)}
.fold-card[open] summary{margin-bottom:6px}

/* ç ”ç©¶ãƒ¡ãƒ¢ï¼ˆã‚†ã‚‹ã‚ï¼‰ */
.meta-note{
  margin-top:8px;padding:8px 10px;border-radius:12px;
  border:1px solid var(--line);background:#fff7fb;color:var(--muted);font-size:.9rem;
}
.meta-note summary{
  cursor:pointer;list-style:none;font-weight:850;
  display:flex;align-items:center;justify-content:space-between;
}
.meta-note[open]{background:#fff}
.meta-note ul{margin:.5rem 0 0 1.1rem;padding-left:0}
.meta-note ul li + li{margin-top:10px;padding-top:6px;border-top:1px dashed var(--line)}

/* æœ€åˆã‹ã‚‰ï¼†ä¸€è¦§ã¸ */
.back-row{display:flex;gap:10px;flex-wrap:wrap;margin:12px 0 6px;}
.back{
  flex:1 1 220px;
  display:inline-flex;align-items:center;justify-content:center;gap:8px;
  padding:12px 16px;border-radius:999px;
  border:1px solid var(--line);background:#fff;color:var(--ink);
  font-weight:900;letter-spacing:.02em;cursor:pointer;
  box-shadow:0 12px 24px rgba(255,143,199,.12);
  transition:transform .12s ease, box-shadow .12s ease, border-color .12s ease;
}
.back:hover{transform:translateY(-1px);box-shadow:0 16px 30px rgba(255,143,199,.16);border-color:#f1d6e7}
.back:active{transform:translateY(0);box-shadow:0 10px 20px rgba(255,143,199,.12)}
.back:focus-visible{outline:3px solid rgba(182,156,255,.35);outline-offset:3px}
.back-primary{
  border:0;background:linear-gradient(135deg,var(--accent),var(--accent2));
  color:#1b0f1c;box-shadow:0 14px 28px rgba(255,143,199,.18);
}
.back-ghost{background:linear-gradient(180deg,#fff,#fff6fb)}
.back .chev{
  display:inline-grid;place-items:center;width:22px;height:22px;border-radius:999px;
  background:rgba(255,143,199,.12);color:rgba(32,19,34,.75);
  font-size:1.15rem;line-height:1;
}

/* ãƒˆãƒ¼ã‚¹ãƒˆ */
.mini-toast{
  position:fixed;left:50%;bottom:24px;
  transform:translateX(-50%) translateY(20px);
  opacity:0;background:#5a2445;color:#fff;
  padding:8px 12px;border-radius:999px;
  font-size:1.1rem;transition:.25s;z-index:40;
}
.mini-toast.show{opacity:1;transform:translateX(-50%) translateY(0)}

/* å°ç”»é¢ */
@media (max-width:600px){
  header.hd .wrap{padding:16px 12px 8px}
  .paper{padding:14px 12px}
}
</style>
</head>

<body data-id="pure-love">
<header class="hd" role="banner">
  <div class="wrap">
    <div class="ttl">
      <span aria-hidden="true">ğŸ’</span>
      <span id="pageTitle">ç´”æ„›è¨ºæ–­</span>
      <span class="rank" aria-label="ç¾åœ¨ã®ãƒ©ãƒ³ã‚¯">
        <span aria-hidden="true">ğŸ§©</span><span>æœªåˆ¤å®š</span>
      </span>
    </div>
    <div class="sub" id="pageSub">
      ã€Œå¥½ãã€ãŒã¡ã‚ƒã‚“ã¨ç¶šãã‚¿ã‚¤ãƒ—ã‹ã€‚ã¾ã£ã™ãè¨€ãˆã‚‹ã‚¿ã‚¤ãƒ—ã‹ã€‚ã‚„ã•ã—ã•ãŒâ€œè¡Œå‹•â€ã«ãªã‚‹ã‚¿ã‚¤ãƒ—ã‹ã€‚ç´”æ„›ã£ã½ã•ã‚’24å•ã§ç‚¹æ¤œã—ã¾ã™ï¼ˆå¨¯æ¥½ç”¨ï¼‰ã€‚
    </div>
  </div>
</header>

<div class="progress-fixed" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
  <div class="progress-bar" style="width:0%"></div>
</div>

<main class="wrap" id="app" role="main" aria-live="polite">

  <figure class="hero">
    <img id="heroImg" src="/shindan/assets/results/pure-love/t00.webp" alt="èŠ±ç«å¤§ä¼šã®äºŒäºº" loading="lazy">
  </figure>

  <!-- ãƒ—ãƒ­ãƒ­ãƒ¼ã‚° -->
  <section id="prologue" class="paper" aria-label="ãƒ—ãƒ­ãƒ­ãƒ¼ã‚°">
    <h2>ãƒ—ãƒ­ãƒ­ãƒ¼ã‚°ï¼šç´”æ„›ã‚‚ãƒ­ãƒãƒ³</h2>
    <p>å¤§äº‹ä»¶ã¯èµ·ããªã„ã€‚ãªã®ã«ã€å¿ƒãŒã¡ã‚ƒã‚“ã¨æ¸©ã‹ã„ã€‚</p>
    <p>è¿”äº‹ãŒå°‘ã—é…ãã¦ã‚‚ç–‘ã‚ãªã„ã€‚ä¼šãˆãªã„æ—¥ã‚‚ã€å£Šã‚Œãªã„ã€‚</p>
    <p>è¨€è‘‰ãŒç…§ã‚Œã¦ã‚‚ã€è¡Œå‹•ã§ä¼ãˆã‚‰ã‚Œã‚‹ã€‚ãã†ã„ã†â€œç¶šãå¥½ãâ€ã«ã¯ã€ã¡ã‚ƒã‚“ã¨æŠ€è¡“ãŒã‚ã‚‹ã€‚</p>
    <p>ã“ã®è¨ºæ–­ã¯ã€ã‚ãªãŸã®<strong>ç´”æ„›åŠ›</strong>ã‚’24å•ã§ã‚†ã‚‹ãå¯è¦–åŒ–ã™ã‚‹éŠã³ã§ã™ã€‚</p>
    <p class="note">â€»æœ¬ãƒšãƒ¼ã‚¸ã¯å¨¯æ¥½ï¼‹è‡ªå·±ç†è§£ã®è£œåŠ©ã‚’ç›®çš„ã¨ã—ãŸç°¡æ˜“ãƒ†ã‚¹ãƒˆã§ã™ã€‚ã—ã‚“ã©ã•ãŒç¶šãå ´åˆã¯å°‚é–€æ©Ÿé–¢ã¸ã”ç›¸è«‡ãã ã•ã„ã€‚</p>
    <button type="button" id="startBtn" class="start-btn" aria-label="è¨ºæ–­ã‚’å§‹ã‚ã‚‹">
      <span class="emo">ğŸ†</span><span>æŒ‡è¼ªã‚’ã¯ã‚ã‚‹</span>
    </button>
  </section>

  <!-- è³ªå• -->
  <section id="quiz" class="paper" aria-label="è³ªå•ã‚»ã‚¯ã‚·ãƒ§ãƒ³" style="display:none">
    <div class="qhead">
      <div class="qnum" id="qnum">Q1/24</div>
      <div class="qtag" id="qtag"><span aria-hidden="true">ğŸ’¬</span><span>å›ç­”ä¸­</span></div>
    </div>
    <div class="qtext" id="qtext">â€¦</div>
    <div class="opts" id="opts" role="group" aria-label="å›ç­”ã‚’é¸æŠ"></div>
    <div class="ctrls">
      <button type="button" id="prevBtn" aria-label="å‰ã®è¨­å•ã¸æˆ»ã‚‹">ã‚‚ã©ã‚‹</button>
    </div>
  </section>

  <!-- çµæœ -->
  <section id="result" class="paper result" aria-label="çµæœã‚»ã‚¯ã‚·ãƒ§ãƒ³">
    <h2 style="margin-top:0">çµæœ</h2>

    <div class="flex">
      <div class="imgbox">
        <img id="resultImg" src="" alt="" loading="lazy">
      </div>
      <div class="text">
        <div class="badge-line">
          <span class="badge-pill" id="gradeBadge"><span aria-hidden="true">ğŸ§©</span><span>æœªåˆ¤å®š</span></span>
          <span class="badge-pill" id="scoreBadge">ç´”æ„›åº¦ â€”ç‚¹</span>
        </div>

        <h3 class="result-title-main" id="resultTitle">â€”</h3>
        <p class="result-title-sub" id="resultSubtitle">â€”</p>

        <div class="result-comment" id="resultComment" aria-label="çµæœã‚³ãƒ¡ãƒ³ãƒˆ">
          <p class="rc-ttl">â€”</p>
          <p>â€”</p>
        </div>

        <div class="today-box" aria-label="ä»Šæ—¥ã®ã²ã¨ã“ã¨">
          <div class="today-head"><span aria-hidden="true">ğŸ’Œ</span><span>ä»Šæ—¥ã®ã²ã¨ã“ã¨</span></div>
          <div class="today-text" id="todayText">â€”</div>
        </div>

        <p class="result-small" id="resultSmall"></p>

        <div class="bars" id="bars" aria-label="å› å­ãƒãƒ¼"></div>
      </div>
    </div>

    <!-- å‰å›ã®å›ç­”ï¼ˆä¸€è¦§ï¼‰ -->
    <details id="prevBlock" class="fold-card">
      <summary>ğŸ“ å‰å›ã®å›ç­”ï¼ˆä¸€è¦§ï¼‰<span aria-hidden="true">â–¾</span></summary>
      <ul id="prevList" class="prev-list"></ul>
    </details>

    <!-- ã‚®ãƒ£ãƒ©ãƒªãƒ¼ï¼ˆt01ã€œt05ï¼‰ -->
    <details id="galleryBlock" class="fold-card">
      <summary>ğŸ–¼ ãƒ©ãƒ³ã‚¯ã®ã‚®ãƒ£ãƒ©ãƒªãƒ¼<span aria-hidden="true">â–¾</span></summary>
      <div class="gallery" id="gallery"></div>
    </details>

    <details class="meta-note" id="researchNotes">
      <summary>ğŸ“š ç ”ç©¶ãƒ¡ãƒ¢ï¼ˆã‚†ã‚‹ã‚ï¼‰<span aria-hidden="true">â–¾</span></summary>
      <ul id="researchList">
        <li><strong>æ–¹å‘æ€§</strong>ï¼šé–¢ä¿‚æº€è¶³ã«ã¯ã€Œå®‰å¿ƒæ„Ÿã€ã€Œæ€ã„ã‚„ã‚Šè¡Œå‹•ã€ã€Œä¿®å¾©ï¼ˆä»²ç›´ã‚Šï¼‰ã€ãŒåŠ¹ãã‚„ã™ã„ã¨è¨€ã‚ã‚ŒãŒã¡ã€‚</li>
        <li><strong>æ³¨æ„</strong>ï¼šã“ã‚Œã¯å¨¯æ¥½ã€‚ç¾å®Ÿã®åˆ¤æ–­ã¯ã€å®‰å…¨ãƒ»å°Šé‡ãƒ»åŒæ„ãŒæœ€å„ªå…ˆã€‚</li>
      </ul>
    </details>

    <p class="note">â€»æœ¬ãƒšãƒ¼ã‚¸ã¯å¨¯æ¥½ï¼‹è‡ªå·±ç†è§£ã®è£œåŠ©ã‚’ç›®çš„ã¨ã—ãŸç°¡æ˜“ãƒ†ã‚¹ãƒˆã§ã™ã€‚ã—ã‚“ã©ã•ãŒç¶šãå ´åˆã¯å°‚é–€æ©Ÿé–¢ã¸ã”ç›¸è«‡ãã ã•ã„ã€‚</p>

    <div class="back-row" aria-label="æ“ä½œãƒ¡ãƒ‹ãƒ¥ãƒ¼">
      <button type="button" class="back back-primary" id="restartBtn" aria-label="æœ€åˆã‹ã‚‰ã‚„ã‚Šç›´ã™">
        <span aria-hidden="true">ğŸ”</span><span>æœ€åˆã‹ã‚‰</span>
      </button>
      <a class="back back-ghost" href="/shindan/" aria-label="è¨ºæ–­ä¸€è¦§ã«æˆ»ã‚‹">
        <span aria-hidden="true">ğŸ§ª</span><span>è¨ºæ–­ä¸€è¦§ã¸</span><span class="chev" aria-hidden="true">â€º</span>
      </a>
    </div>
  </section>
</main>

<div class="mini-toast" id="toast" role="status" aria-live="polite">âœ…</div>

<script>
/* ===== å›ºå®šé€²æ—ãƒãƒ¼ ===== */
function updateProgress(p){
  var bar = document.querySelector('.progress-bar');
  var wrap = document.querySelector('.progress-fixed');
  var val = Math.max(0,Math.min(100,p));
  if(bar) bar.style.width = val + '%';
  if(wrap) wrap.setAttribute('aria-valuenow', String(val));
}

/* ===== åŸºæœ¬è¨­å®š ===== */
const SLUG = 'pure-love';
const IMG_BASE = `/shindan/assets/results/${SLUG}/`;

/* ä¿å­˜ã‚­ãƒ¼ */
const LS_ANS     = `shindan:${SLUG}:answers`;
const LS_IDX     = `shindan:${SLUG}:index`;
const LS_LASTANS = `shindan:${SLUG}:lastAnswers`;

/* å›ç­”ãƒ©ãƒ™ãƒ« */
const LABELS = ['ãœã‚“ãœã‚“','ã‚ã¾ã‚Š','ã©ã¡ã‚‰ã¨ã‚‚','ã‚ã‚Šã¨','ã¨ã¦ã‚‚'];
function descFor(i){
  return ['ã»ã¼ãªã„','ã™ã“ã—','åŠã€…','ã‚ˆãã‚ã‚‹','ã‚ã£ã¡ã‚ƒã‚ã‚‹'][i] || '';
}

/* ãƒ†ãƒ³ãƒ */
const NEXT_Q_DELAY_MS = 220;
const RESULT_SCROLL_DELAY_MS = 900;

/* =========================================================
   8å› å­ï¼ˆç´”æ„›ã£ã½ã•ã®ææ–™ï¼‰
========================================================= */
const FACTS = ['BASE','STRAIGHT','CARE','REPAIR','TRUST','GROW','PLAY','COMMIT'];
const FACT_LABEL = {
  BASE:'å®‰å¿ƒãƒ™ãƒ¼ã‚¹',
  STRAIGHT:'ã¾ã£ã™ãã•',
  CARE:'æ€ã„ã‚„ã‚Šè¡Œå‹•',
  REPAIR:'è¨€è‘‰ã®ä¿®å¾©åŠ›',
  TRUST:'ä¿¡é ¼ã®ç¶™ç¶š',
  GROW:'ä¸€ç·’ã«è‚²ã¦ã‚‹æ„Ÿ',
  PLAY:'ç…§ã‚Œã¨éŠã³å¿ƒ',
  COMMIT:'è¦šæ‚Ÿã¨è²¬ä»»'
};
const FACT_DESC = {
  BASE:'ä¸€ç·’ã«ã„ã‚‹ã¨è½ã¡ç€ããƒ»ç–‘ã„ã§å£Šã‚Œã«ãã„',
  STRAIGHT:'å¥½æ„ã‚’éš ã—ã™ããšèª å®Ÿã«ç¤ºã›ã‚‹',
  CARE:'æ°—é£ã„ãŒâ€œè¨€ã†ã ã‘â€ã§çµ‚ã‚ã‚‰ãšå‹•ã‘ã‚‹',
  REPAIR:'æ°—ã¾ãšã•ã‚„èª¤è§£ã‚’ä¼šè©±ã§ã»ã©ã‘ã‚‹',
  TRUST:'é›¢ã‚Œã¦ã‚‚æºã‚Œã«ãã„ãƒ»ç´„æŸã¨ä¸€è²«æ€§',
  GROW:'æœªæ¥ã‚„æ—¥å¸¸ã‚’å…±åŒä½œæ¥­ã«ã§ãã‚‹',
  PLAY:'ç”˜ã•ã‚’è»½ãç¬‘ã„ã«ã§ãã‚‹',
  COMMIT:'å¤§äº‹ã«ã™ã‚‹è²¬ä»»ã‚’èƒŒè² ãˆã‚‹'
};

/* è¨­å•ï¼ˆ24å•ï½œ8å› å­Ã—3ï¼‰
   answers ã¯ 0..4
   reverse:true ã¯ v=4-vï¼ˆåŒæ„ã™ã‚‹ã¨ç´”æ„›åº¦ãŒä¸‹ãŒã‚‹ï¼‰
*/
const QUESTIONS = [
  /* BASE å®‰å¿ƒãƒ™ãƒ¼ã‚¹ */
  {t:'ç›¸æ‰‹ã®è¿”ä¿¡ãŒé…ãã¦ã‚‚ã€æœ€æ‚ªã®æƒ³åƒã«é£›ã³ã«ãã„ã€‚', key:'BASE'},
  {t:'ä¸€ç·’ã«ã„ã‚‹ã¨ã€ç„¡è¨€ã®æ™‚é–“ã‚‚è½ã¡ç€ãã€‚', key:'BASE'},
  {t:'ä¸å®‰ã«ãªã‚‹ã¨ã€è©¦ã™ã‚ˆã†ãªè¨€ã„æ–¹ã‚’ã—ã¦ã—ã¾ã†ã€‚', key:'BASE', reverse:true},

  /* STRAIGHT ã¾ã£ã™ãã• */
  {t:'å¥½ããªã‚‰ã€é å›ã—ã˜ã‚ƒãªãâ€œå¥½ãâ€å¯„ã‚Šã®è¨€è‘‰ã§ä¼ãˆã‚‰ã‚Œã‚‹ã€‚', key:'STRAIGHT'},
  {t:'æ°—æŒã¡ã‚’éš ã—ã¦é§†ã‘å¼•ãã™ã‚‹ã‚ˆã‚Šã€ç´ ç›´ã«å‡ºã—ãŸã„ã€‚', key:'STRAIGHT'},
  {t:'å¥½æ„ãŒã‚ã‚‹ã»ã©ã€ã‚ã–ã¨å†·ãŸãã—ã¦ã—ã¾ã†ã€‚', key:'STRAIGHT', reverse:true},

  /* CARE æ€ã„ã‚„ã‚Šè¡Œå‹• */
  {t:'ç›¸æ‰‹ãŒç–²ã‚Œã¦ã‚‹æ—¥ã«ã€è¨€è‘‰ã‚ˆã‚Šå…ˆã«å…·ä½“çš„ã«åŠ©ã‘ã‚‰ã‚Œã‚‹ã€‚', key:'CARE'},
  {t:'ã€Œå¤§ä¸ˆå¤«ï¼Ÿã€ã§çµ‚ã‚ã‚‰ãšã€ä½•ãŒåŠ©ã‹ã‚‹ã‹ã¾ã§è€ƒãˆã‚‹ã€‚', key:'CARE'},
  {t:'æ°—é£ã„ã¯ã™ã‚‹ã‘ã©ã€çµå±€ãªã«ã‚‚è¡Œå‹•ã«ç§»ã›ãªã„ã“ã¨ãŒå¤šã„ã€‚', key:'CARE', reverse:true},

  /* REPAIR è¨€è‘‰ã®ä¿®å¾©åŠ› */
  {t:'æ°—ã¾ãšã„ç©ºæ°—ã«ãªã£ã¦ã‚‚ã€é€ƒã’ãšã«è©±ã—ã¦æˆ»ã›ã‚‹ã€‚', key:'REPAIR'},
  {t:'è¬ã‚‹ãƒ»è¨‚æ­£ã™ã‚‹ãƒ»ç¢ºèªã™ã‚‹ã‚’ã€æ—©ã‚ã«å‡ºã›ã‚‹ã€‚', key:'REPAIR'},
  {t:'è¨€ã„åˆã„ã«ãªã‚‹ã¨ã€å‹ã¡è² ã‘ãŒæ°—ã«ãªã£ã¦ã—ã¾ã†ã€‚', key:'REPAIR', reverse:true},

  /* TRUST ä¿¡é ¼ã®ç¶™ç¶š */
  {t:'ç´„æŸã—ãŸã“ã¨ã¯ã€å°ã•ã„ã“ã¨ã§ã‚‚å®ˆã‚ã†ã¨ã™ã‚‹ã€‚', key:'TRUST'},
  {t:'é›¢ã‚Œã¦ã¦ã‚‚ã€ç›¸æ‰‹ã®èª å®Ÿã•ã‚’åŸºæœ¬ã¯ä¿¡ã˜ã‚‰ã‚Œã‚‹ã€‚', key:'TRUST'},
  {t:'å°‘ã—ã®é•å’Œæ„Ÿã§ã€ç›¸æ‰‹ã‚’ç–‘ã†ãƒ¢ãƒ¼ãƒ‰ã«å…¥ã‚Šã‚„ã™ã„ã€‚', key:'TRUST', reverse:true},

  /* GROW ä¸€ç·’ã«è‚²ã¦ã‚‹æ„Ÿ */
  {t:'ã€ŒäºŒäººã®äºˆå®šã€ã‚’è‡ªç„¶ã«ä½œã‚‹ã®ãŒå¥½ãã ã€‚', key:'GROW'},
  {t:'ç›¸æ‰‹ã®å¤¢ã‚„ç›®æ¨™ã‚’ã€ç¾å®Ÿã®æ®µå–ã‚Šã¾ã§ä¸€ç·’ã«è€ƒãˆã‚‰ã‚Œã‚‹ã€‚', key:'GROW'},
  {t:'å°†æ¥ã®è©±ã¯é‡ãæ„Ÿã˜ã¦ã€é¿ã‘ãŸããªã‚‹ã€‚', key:'GROW', reverse:true},

  /* PLAY ç…§ã‚Œã¨éŠã³å¿ƒ */
  {t:'ç…§ã‚Œãã•ã„ç”˜ã•ã‚’ã€è»½ãå†—è«‡ã«ã—ã¦å‡ºã›ã‚‹ã€‚', key:'PLAY'},
  {t:'äºŒäººã ã‘ã®å°ã•ãªãƒãƒªï¼ˆåˆè¨€è‘‰ãƒ»å†…è¼ªãƒã‚¿ï¼‰ãŒå¢—ãˆãŒã¡ã€‚', key:'PLAY'},
  {t:'ç”˜ã„é›°å›²æ°—ã«ãªã‚‹ã¨ã€æ¥ãšã‹ã—ãã¦è©±é¡Œã‚’é€¸ã‚‰ã—ãŒã¡ã€‚', key:'PLAY', reverse:true},

  /* COMMIT è¦šæ‚Ÿã¨è²¬ä»» */
  {t:'ç›¸æ‰‹ã‚’å¤§åˆ‡ã«ã™ã‚‹ãŸã‚ã«ã€è‡ªåˆ†ã®éƒ½åˆã‚’èª¿æ•´ã§ãã‚‹ã€‚', key:'COMMIT'},
  {t:'é–¢ä¿‚ã‚’ç¶šã‘ã‚‹ãŸã‚ã®â€œã‚„ã‚‹ã“ã¨â€ï¼ˆå ±é€£ç›¸ãƒ»ç´„æŸãƒ»é…æ…®ï¼‰ã‚’ã‚„ã‚Œã‚‹ã€‚', key:'COMMIT'},
  {t:'ã€Œé¢å€’ã€ãŒå‹ã£ã¦ã€ç¶šã‘ã‚‹åŠªåŠ›ã‚’æ”¾æ£„ã—ã‚„ã™ã„ã€‚', key:'COMMIT', reverse:true}
];

/* ãƒ©ãƒ³ã‚¯ï¼ˆç´”æ„›åº¦ 0..100ï¼‰ */
const GRADE_DEF = [
  {
    min:0, max:24, emo:'â˜”', label:'ã¾ã ç…§ã‚Œé›¨',
    img:'t01.webp', alt:'ç›¸åˆå‚˜ã®äºŒäºº',
    headline:'å¥½ãã¯ã‚ã‚‹ã€‚ã ã‹ã‚‰ã“ãã€ç…§ã‚Œã‚‹ã€‚',
    blurb:'æ°—æŒã¡ã¯ã¡ã‚ƒã‚“ã¨å¼·ã„ã®ã«ã€è¨€è‘‰ã«ã™ã‚‹ã¨æ€¥ã«ç…§ã‚ŒãŒé‚ªé­”ã‚’ã™ã‚‹ã‚¿ã‚¤ãƒ—ã€‚è¿‘ã¥ãã»ã©ç´ ç›´ã«ãªã‚Œãšã€ã¤ã„è»½å£ã‚„æ²ˆé»™ã§åŒ…ã‚€ã€‚ã§ã‚‚ãã‚Œã£ã¦ã€ã€Œã©ã†ã§ã‚‚ã„ã„ç›¸æ‰‹ã€ã«ã¯èµ·ããªã„åå¿œã€‚ã‚ãªãŸã®å„ªã—ã•ã¯ã€ã¾ã è¡¨ã«å‡ºã‚‹æº–å‚™ä¸­ã€‚',
    action:'ä»Šæ—¥ã ã‘ã€çŸ­ãã§ã„ã„ã€‚ã€Œä¼šãˆã¦ã†ã‚Œã—ã‹ã£ãŸã€ã‚’ä¸€å›ã ã‘è¨€ã†ã€‚'
  },
  {
    min:25, max:44, emo:'ğŸ“', label:'é’æ˜¥ã¾ã£ã™ã',
    img:'t02.webp', alt:'å’æ¥­å¼ã®äºŒäºº',
    headline:'ã¾ã£ã™ãã§ã€ã¡ã‚ƒã‚“ã¨ã‚„ã•ã—ã„ã€‚',
    blurb:'é§†ã‘å¼•ãã‚ˆã‚Šèª å®Ÿã•ãŒå…ˆã«å‡ºã‚‹ã‚¿ã‚¤ãƒ—ã€‚ç…§ã‚Œã¯ã‚ã£ã¦ã‚‚ã€ç›¸æ‰‹ã‚’ä¸å®‰ã«ã•ã›ã‚‹å˜˜ã¯ã¤ã‹ãªã„ã€‚æ´¾æ‰‹ã˜ã‚ƒãªã„ã®ã«ä¿¡é ¼ãŒç©ã¿ä¸ŠãŒã‚‹ã®ã¯ã€ã‚ãªãŸãŒâ€œç¶šã‘ã‚‹äººâ€ã ã‹ã‚‰ã€‚ç”˜ã•ãŒå¹¼ããªã‚‰ãªã„ã®ã€ã‹ãªã‚Šå¼·ã„ã€‚',
    action:'ã€Œã‚ã‚ŠãŒã¨ã†ã€ï¼‹ç†ç”±ã‚’ä¸€è¨€ã ã‘æ·»ãˆã‚‹ï¼ˆä¾‹ï¼šä»Šæ—¥ã®è¿”ä¿¡ã€åŠ©ã‹ã£ãŸï¼‰ã€‚'
  },
  {
    min:45, max:64, emo:'ğŸŒ…', label:'å¤•ç„¼ã‘å®‰å®š',
    img:'t03.webp', alt:'æµ·è¾ºã®å¤•ç„¼ã‘ã®äºŒäºº',
    headline:'æºã‚Œã¦ã‚‚ã€æ‰‹ã‚’é›¢ã•ãªã„ã€‚',
    blurb:'å®‰å¿ƒæ„Ÿã¨ä»²ç›´ã‚Šã®åŠ›ãŒã¡ã‚‡ã†ã©ã„ã„ã€‚æ°—ã¾ãšããªã£ã¦ã‚‚é€ƒã’ãšã«æˆ»ã‚Œã‚‹ã—ã€ç›¸æ‰‹ã®å¼±ã„æ—¥ã‚‚â€œå«Œã„ã«ãªã‚‰ãªã„â€ã€‚æ‹ãŒã‚¤ãƒ™ãƒ³ãƒˆã˜ã‚ƒãªãç”Ÿæ´»ã«ãªã‚‹å¸¯ã€‚ã“ã“ã«ã„ã‚‹äººã®å¥½ãã¯ã€é™ã‹ã ã‘ã©æŠ˜ã‚Œãªã„ã€‚',
    action:'ã€Œã¾ãŸä»Šåº¦ã€ã‚’ä¸€ã¤ã ã‘å…·ä½“åŒ–ã™ã‚‹ï¼ˆä¾‹ï¼šæ¥é€±ã€20åˆ†ã ã‘é›»è©±ï¼‰ã€‚'
  },
  {
    min:65, max:84, emo:'ğŸŸ', label:'å„ªã—ã•ã®æ°´æ—é¤¨',
    img:'t04.webp', alt:'æ°´æ—é¤¨ã®äºŒäºº',
    headline:'ç”˜ã‚„ã‹ã™ã‚“ã˜ã‚ƒãªã„ã€‚å®ˆã‚Šæ–¹ãŒä¸Šæ‰‹ã„ã€‚',
    blurb:'ç›¸æ‰‹ã®å¤‰åŒ–ã«ã™ãæ°—ã¥ãã—ã€åŠ©ã‘æ–¹ãŒâ€œè¨€è‘‰â€ã§çµ‚ã‚ã‚‰ãªã„ã€‚ã‚ãªãŸã®ç´”æ„›ã¯ã€ç›¸æ‰‹ã®ç”Ÿæ´»ã‚’ã¡ã‚ƒã‚“ã¨è»½ãã™ã‚‹ã‚¿ã‚¤ãƒ—ã€‚ãŸã¾ã«è‡ªåˆ†ãŒå¾Œå›ã—ã«ãªã‚ŠãŒã¡ã ã‘ã©ã€ãã‚Œã§ã‚‚å„ªã—ã•ãŒæ¿ã‚‰ãªã„ã®ãŒã™ã”ã„ã€‚æ„›ãŒã¡ã‚ƒã‚“ã¨å®Ÿå‹™ã«ãªã‚‹ã€‚',
    action:'ç›¸æ‰‹ã®ãŸã‚ã«å‹•ãå‰ã«ã€è‡ªåˆ†ã®å›å¾©ã‚’1ã¤ç¢ºä¿ï¼ˆç¡çœ /é£Ÿäº‹/ä¼‘æ†©ã©ã‚Œã‹ï¼‰ã€‚'
  },
  {
    min:85, max:100, emo:'ğŸ’', label:'çµå©šå¼ãƒ«ãƒ¼ãƒˆ',
    img:'t05.webp', alt:'çµå©šå¼ã®äºŒäºº',
    headline:'ã€Œå¥½ãã€ã‚’ã€æœªæ¥ã«ç½®ã‘ã‚‹ã€‚',
    blurb:'ç”˜ã•ã¨è²¬ä»»ãŒåŒå±…ã—ã¦ã‚‹å¸¯ã€‚æ°—æŒã¡ã ã‘ã§èµ°ã‚‰ãšã€ç›¸æ‰‹ã®ä¸å®‰ã‚’å¢—ã‚„ã•ãªã„é¸ã³æ–¹ãŒã§ãã‚‹ã€‚ç´„æŸã‚’å®ˆã‚‹ã€è©±ã—åˆã†ã€å¾…ã¤ã€è¬ã‚‹â€¦ãã†ã„ã†åœ°å‘³ãªè¡Œå‹•ã‚’â€œæ„›â€ã¨ã—ã¦ç¶šã‘ã‚‰ã‚Œã‚‹äººã€‚ã‚ãªãŸã®ç´”æ„›ã¯ã€æ´¾æ‰‹ã˜ã‚ƒãªãã¦æœ¬ç‰©ã€‚',
    action:'ç›¸æ‰‹ã«ã€Œå®‰å¿ƒã™ã‚‹ãƒã‚¤ãƒ³ãƒˆã€ã‚’ä¸€ã¤ã ã‘ä¼ãˆã‚‹ï¼ˆä¾‹ï¼šã‚ãªãŸã¯èª å®Ÿã ã‹ã‚‰è½ã¡ç€ãï¼‰ã€‚'
  }
];

function gradeFromScore(pct){
  for(const g of GRADE_DEF){
    if(pct >= g.min && pct <= g.max) return g;
  }
  return GRADE_DEF[2];
}

/* ã‚¹ã‚³ã‚¢è¨ˆç®—ï¼šå› å­å¹³å‡(1..5)â†’pct(0..100)ã€ç´”æ„›åº¦ï¼8å› å­pctå¹³å‡ */
function computeScores(answers){
  const sums = {}, counts = {};
  FACTS.forEach(k=>{ sums[k]=0; counts[k]=0; });

  QUESTIONS.forEach((q,i)=>{
    let v = answers[i];
    if(v==null) return;
    if(q.reverse) v = 4 - v;
    sums[q.key] += v;
    counts[q.key] += 1;
  });

  const pct = {};
  FACTS.forEach(k=>{
    const avg04 = counts[k] ? (sums[k]/counts[k]) : 0; // 0..4
    const a15 = avg04 + 1;                             // 1..5
    pct[k] = Math.round((a15-1)/4*100);                // 0..100
  });

  const pure = Math.max(0, Math.min(100, Math.round(
    FACTS.map(k=>pct[k]||0).reduce((a,v)=>a+v,0)/FACTS.length
  )));

  return { pct, pure };
}

/* ===== çŠ¶æ…‹ ===== */
let idx = 0;
let answers = new Array(QUESTIONS.length).fill(null);

/* ===== è¦ç´  ===== */
const $qnum = document.getElementById('qnum');
const $qtag = document.getElementById('qtag');
const $qtext = document.getElementById('qtext');
const $opts = document.getElementById('opts');
const $prev = document.getElementById('prevBtn');

const $quiz = document.getElementById('quiz');
const $result = document.getElementById('result');
const $prologue = document.getElementById('prologue');
const $startBtn = document.getElementById('startBtn');

const $rankBadge = document.querySelector('.rank');
const $gradeBadge = document.getElementById('gradeBadge');
const $scoreBadge = document.getElementById('scoreBadge');

const $resultImg = document.getElementById('resultImg');
const $resultTitle = document.getElementById('resultTitle');
const $resultSubtitle = document.getElementById('resultSubtitle');

const $resultComment = document.getElementById('resultComment');
const $todayText = document.getElementById('todayText');
const $resultSmall = document.getElementById('resultSmall');

const $bars = document.getElementById('bars');
const $prevList = document.getElementById('prevList');
const $gallery = document.getElementById('gallery');

const $restart = document.getElementById('restartBtn');
const $toast = document.getElementById('toast');

/* ===== ãƒˆãƒ¼ã‚¹ãƒˆ ===== */
let toastTimer = null;
function showToast(){
  if(!$toast) return;
  $toast.textContent = 'âœ…';
  $toast.classList.add('show');
  clearTimeout(toastTimer);
  toastTimer = setTimeout(()=> $toast.classList.remove('show'), 750);
}

/* ===== è¡¨ç¤ºåˆ‡æ›¿ ===== */
function enterPrologueMode(){
  $prologue.style.display = 'block';
  $quiz.style.display = 'none';
  $result.style.display = 'none';
  if($rankBadge) $rankBadge.innerHTML = '<span aria-hidden="true">ğŸ§©</span><span>æœªåˆ¤å®š</span>';
  updateProgress(0);
}
function enterQuizMode(){
  $prologue.style.display = 'none';
  $quiz.style.display = 'block';
  $result.style.display = 'none';
}
function enterResultMode(){
  $prologue.style.display = 'none';
  $quiz.style.display = 'none';
  $result.style.display = 'block';
}

/* ===== ä¿å­˜/å¾©å…ƒ ===== */
function persist(){
  try{
    localStorage.setItem(LS_ANS, JSON.stringify(answers));
    localStorage.setItem(LS_IDX, JSON.stringify(idx));
  }catch(_){}
}

/* ===== è³ªå•æç”» ===== */
function renderQuestion(){
  const q = QUESTIONS[idx];
  $qnum.textContent = `Q${idx+1}/${QUESTIONS.length}`;
  $qtext.textContent = q.t;
  if($qtag) $qtag.innerHTML = `<span aria-hidden="true">ğŸ’¬</span><span>å›ç­”ä¸­</span>`;

  $opts.innerHTML = '';
  LABELS.forEach((lab,i)=>{
    const btn = document.createElement('button');
    btn.type = 'button';
    btn.className = 'btn';
    btn.setAttribute('aria-pressed', answers[idx]===i ? 'true':'false');
    btn.innerHTML = `<span class="btn-label">${lab}</span><span class="opt-note">${descFor(i)}</span>`;
    btn.addEventListener('click', ()=> selectAnswer(i));
    $opts.appendChild(btn);
  });

  $prev.disabled = (idx===0);

  const done = answers.filter(v=>v!==null).length;
  updateProgress(Math.round(done/QUESTIONS.length*100));

  if($rankBadge) $rankBadge.innerHTML = '<span aria-hidden="true">ğŸ§©</span><span>æœªåˆ¤å®š</span>';
}
function markPressed(v){
  [...$opts.children].forEach((el,i)=> el.setAttribute('aria-pressed', i===v ? 'true' : 'false'));
}
function selectAnswer(v){
  answers[idx] = v;
  persist();
  markPressed(v);
  showToast();

  setTimeout(()=>{
    if(idx < QUESTIONS.length-1){
      idx++;
      renderQuestion();
    }else{
      enterResultMode();
      showResult();
      setTimeout(()=>{
        const top = $result.getBoundingClientRect().top + window.pageYOffset - 6;
        window.scrollTo({top, behavior:'smooth'});
      }, RESULT_SCROLL_DELAY_MS);
    }
  }, NEXT_Q_DELAY_MS);
}

/* ã‚®ãƒ£ãƒ©ãƒªãƒ¼ï¼ˆt01ã€œt05ï¼‰ */
function buildGallery(){
  return [
    {img:'t01.webp', cap:'â˜” ã¾ã ç…§ã‚Œé›¨', alt:'ç›¸åˆå‚˜ã®äºŒäºº'},
    {img:'t02.webp', cap:'ğŸ“ é’æ˜¥ã¾ã£ã™ã', alt:'å’æ¥­å¼ã®äºŒäºº'},
    {img:'t03.webp', cap:'ğŸŒ… å¤•ç„¼ã‘å®‰å®š', alt:'æµ·è¾ºã®å¤•ç„¼ã‘ã®äºŒäºº'},
    {img:'t04.webp', cap:'ğŸŸ å„ªã—ã•ã®æ°´æ—é¤¨', alt:'æ°´æ—é¤¨ã®äºŒäºº'},
    {img:'t05.webp', cap:'ğŸ’ çµå©šå¼ãƒ«ãƒ¼ãƒˆ', alt:'çµå©šå¼ã®äºŒäºº'}
  ];
}
function buildGalleryUI(){
  if(!$gallery) return;
  const g = buildGallery();
  $gallery.innerHTML = '';
  g.forEach(x=>{
    const fig = document.createElement('figure');
    fig.innerHTML = `
      <img src="${IMG_BASE + x.img}" alt="${x.alt||''}" loading="lazy">
      <figcaption>${x.cap||x.img}</figcaption>
    `;
    $gallery.appendChild(fig);
  });
}

/* å‰å›ã®å›ç­”ï¼ˆä¸€è¦§ï¼‰ */
function buildPrevAnswers(){
  if(!$prevList) return;
  let prev=null;
  try{ prev = JSON.parse(localStorage.getItem(LS_LASTANS) || 'null'); }catch(_){}
  if(!prev || !Array.isArray(prev.answers)) return;

  $prevList.innerHTML = '';
  prev.answers.forEach((v,i)=>{
    const li = document.createElement('li');
    li.className = 'prev-item';
    const lab = (typeof v === 'number' && v>=0 && v<LABELS.length) ? LABELS[v] : 'â€”';
    li.innerHTML = `<span class="prev-q">Q${i+1}ï¼š${QUESTIONS[i].t}</span><span class="prev-a">ã€Œ${lab}ã€</span>`;
    $prevList.appendChild(li);
  });
}

/* ===== çµæœè¡¨ç¤º ===== */
function showResult(){
  const firstNull = answers.findIndex(x=>x==null);
  if(firstNull !== -1){
    idx = firstNull;
    enterQuizMode();
    renderQuestion();
    return;
  }

  const {pct, pure} = computeScores(answers);
  const grade = gradeFromScore(pure);

  if($rankBadge) $rankBadge.innerHTML = `<span aria-hidden="true">${grade.emo}</span><span>${grade.label}</span>`;

  $resultImg.src = IMG_BASE + grade.img;
  $resultImg.alt = grade.alt || 'çµæœç”»åƒ';

  $resultTitle.textContent = `ã‚ãªãŸã®ç´”æ„›ãƒ«ãƒ¼ãƒˆï¼š${grade.label}`;
  $resultSubtitle.textContent = `ç´”æ„›åº¦ï¼š${pure}ç‚¹`;
  if($scoreBadge) $scoreBadge.textContent = `ç´”æ„›åº¦ ${pure}ç‚¹`;
  if($gradeBadge) $gradeBadge.innerHTML = `<span aria-hidden="true">${grade.emo}</span><span>${grade.label}</span>`;

  if($resultComment){
    $resultComment.innerHTML = `
      <p class="rc-ttl">${grade.headline}</p>
      <p>${grade.blurb}</p>
    `;
  }
  if($todayText) $todayText.textContent = grade.action;

  if($resultSmall){
    $resultSmall.textContent = 'â€»å› å­ã¯ã€Œå¾—æ„/è‹¦æ‰‹ã€ã‚’æ±ºã‚ã¤ã‘ã‚‹ãŸã‚ã§ã¯ãªãã€ä¼¸ã°ã—æ–¹ã®ãƒ’ãƒ³ãƒˆç”¨ã€‚';
  }

  $bars.innerHTML = '';
  FACTS.forEach(k=>{
    const v = Math.max(0, Math.min(100, +pct[k]||0));
    const wrap = document.createElement('div');
    wrap.className = 'bar';
    wrap.innerHTML = `
      <div class="h"><span>${FACT_LABEL[k] || k}</span><span>${v}%</span></div>
      <div class="track"><div class="fill" style="width:${v}%"></div></div>
      <div class="bar-desc">${FACT_DESC[k] || ''}</div>
    `;
    $bars.appendChild(wrap);
  });

  // å‰å›å›ç­”ï¼ˆä¸€è¦§ï¼‰ã¨ã—ã¦ä¿å­˜â†’è¡¨ç¤º
  try{
    localStorage.setItem(LS_LASTANS, JSON.stringify({answers: answers.slice(), ts: Date.now()}));
  }catch(_){}
  buildPrevAnswers();

  // ãƒ©ãƒ³ã‚¯ç”»åƒã‚®ãƒ£ãƒ©ãƒªãƒ¼
  buildGalleryUI();

  document.dispatchEvent(new Event('result:ready'));
}

/* ===== æ“ä½œ ===== */
$prev.addEventListener('click', ()=>{
  if(idx>0){ idx--; persist(); renderQuestion(); }
});
$startBtn.addEventListener('click', ()=>{
  enterQuizMode();
  renderQuestion();
  window.scrollTo({top:0,behavior:'smooth'});
});
$restart.addEventListener('click', ()=>{
  answers = new Array(QUESTIONS.length).fill(null);
  idx = 0;
  try{ localStorage.removeItem(LS_ANS); localStorage.removeItem(LS_IDX); }catch(_){}
  enterPrologueMode();
  window.scrollTo({top:0,behavior:'smooth'});
  showToast();
});

/* ===== èµ·å‹• ===== */
(function init(){
  const hero = document.getElementById('heroImg');
  if(hero) hero.src = IMG_BASE + 't00.webp';
  updateProgress(0);

  let savedAns=null, savedIdx=0;
  try{
    savedAns = JSON.parse(localStorage.getItem(LS_ANS) || 'null');
    savedIdx = JSON.parse(localStorage.getItem(LS_IDX) || '0');
  }catch(_){}
  const valid = Array.isArray(savedAns) && savedAns.length === QUESTIONS.length;
  const hasAny = valid && savedAns.some(v=>v!==null);
  const allDone = valid && savedAns.every(v=>v!==null);

  if(allDone){
    answers = savedAns;
    idx = QUESTIONS.length - 1;
    renderQuestion();
    enterResultMode();
    showResult();
    return;
  }
  if(hasAny){
    answers = savedAns;
    idx = Math.min(Math.max(0, +savedIdx || 0), QUESTIONS.length-1);
    enterQuizMode();
    renderQuestion();
    return;
  }
  enterPrologueMode();
}());
</script>

</body>
</html>