<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ãƒ™ã‚¹ãƒˆãƒ•ãƒ¬ãƒ³ãƒ‰åŠ›è¨ºæ–­ï¼ˆã‚ãŸã—ï¼ã‚ã®äººï¼‰</title>
<meta name="description" content="è¦ªã—ã„äººã¨ã„ã‚‹æ™‚ã®è‡ªåˆ†ã‚’è¦‹ã‚‹ã€ã‚ãŸã—ãƒ¢ãƒ¼ãƒ‰ã€ã¨ã€ç›¸æ‰‹ã‚’è¦‹ã‚‹ã€ã‚ã®äººãƒ¢ãƒ¼ãƒ‰ã€ã‚’åˆ‡æ›¿ã€‚21å•ã§å‹æƒ…ã‚¹ã‚­ãƒ«ï¼ˆ7å› å­ï¼‰ã‚’ï¼…ã§å¯è¦–åŒ–ã—ã¾ã™ã€‚">
<meta name="theme-color" content="#f7f9ff">
<!-- OGP -->
<meta property="og:type" content="website">
<meta property="og:title" content="ãƒ™ã‚¹ãƒˆãƒ•ãƒ¬ãƒ³ãƒ‰åŠ›è¨ºæ–­ï¼ˆã‚ãŸã—ï¼ã‚ã®äººï¼‰">
<meta property="og:description" content="21å•ã§ã€Œå–œã³ã®åˆ†ã‹ã¡åˆã„ãƒ»å®‰å¿ƒãƒ»è‡ªå¾‹å°Šé‡ãƒ»æŒ‘æˆ¦æ”¯æ´ãƒ»ä¸€è²«æ€§ãƒ»ä¿®å¾©ãƒ»ãƒ¦ãƒ¼ãƒ¢ã‚¢ã€ã‚’ï¼…åŒ–ã€‚ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ã§ã€ã‚ãŸã—ï¼ã‚ã®äººã€ã‚’è©•ä¾¡ã€‚">
<meta property="og:url" content="https://haisuikounozarigani.github.io/shindan/best-friend.html">
<meta property="og:image" content="/shindan/assets/results/best-friend/t01.webp">
<style>
:root{
  --accent:#4aa8ff; --accent2:#a48bff;
  --ink:#1f2732; --muted:#667087; --paper:#fff;
  --bg1:#f7f9ff; --bg2:#f6f3ff; --line:#e6ecf7;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; color:var(--ink);
  background:linear-gradient(180deg,var(--bg1),var(--bg2));
  font-family:"Noto Sans JP",system-ui,-apple-system,"Segoe UI",Roboto,"Hiragino Kaku Gothic ProN",sans-serif;
}
a{color:inherit}
.wrap{max-width:980px;margin:18px auto;padding:0 14px}
header.hd{display:grid;grid-template-columns:56px 1fr;gap:12px;align-items:center;margin:8px 0}
.logo{width:56px;height:56px;border-radius:14px;background:linear-gradient(135deg,#e1f2ff,#ece6ff);display:grid;place-items:center;font-size:28px}
h1{margin:0;font-size:clamp(22px,4.6vw,34px);letter-spacing:.02em}
.sub{margin:4px 0 0;color:var(--muted);font-size:.96em}
.card{background:var(--paper);border:1px solid var(--line);border-radius:16px;padding:14px}
.section{margin:14px 0}
.pill{display:inline-block;padding:4px 8px;border:1px solid var(--line);border-radius:999px;background:#fff;color:#6b6a77;font-size:.88em}
.meta{display:flex;gap:8px;flex-wrap:wrap}
.sticky{position:sticky;top:0;z-index:10;margin:-6px -14px 12px;padding:8px 14px;background:rgba(255,255,255,.8);backdrop-filter:blur(6px) saturate(1.05);border-bottom:1px solid #e9edf7;display:flex;align-items:center;gap:10px}
.progress{height:8px;background:#edf2fb;border-radius:999px;flex:1;overflow:hidden}
.progress>span{
  display:block;height:100%;width:0;
  background:linear-gradient(90deg,var(--accent),var(--accent2));
  transition:width .25s ease;
}
.btn{padding:10px 14px;border:1px solid var(--line);border-radius:12px;background:#fff;cursor:pointer}
.btn.primary{background:linear-gradient(90deg,var(--accent),var(--accent2));border-color:transparent;color:#fff;font-weight:700}
fieldset.q{border:1px solid var(--line);border-radius:12px;padding:10px;margin:10px 0;background:#fff}
legend{font-weight:700}
.scale{display:grid;grid-template-columns:repeat(5,minmax(66px,1fr));gap:8px;margin-top:8px}
.scale input{position:absolute;opacity:0;pointer-events:none}
.scale label{display:grid;place-items:center;border:1px solid #e5e9f3;border-radius:10px;padding:8px;cursor:pointer;user-select:none;background:#fff}
.scale input:checked+label{outline:2px solid var(--accent);border-color:transparent}
mark.need{animation:need 1.6s ease}
@keyframes need{0%{box-shadow:0 0 0 0 rgba(74,168,255,.45)}100%{box-shadow:0 0 0 0 rgba(74,168,255,0)}}
.result-head{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
.badge{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;background:linear-gradient(90deg,var(--accent),var(--accent2));color:#fff;font-weight:700}
.total{font-size:26px;font-weight:800}
.small{color:var(--muted);font-size:.92em}

/* ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ */
.mode-tabs{display:inline-flex;border:1px solid var(--line);border-radius:12px;overflow:hidden;background:#fff}
.mode-tabs button{padding:8px 12px;border:0;background:#fff;cursor:pointer}
.mode-tabs button.on{background:linear-gradient(90deg,var(--accent),var(--accent2));color:#fff;font-weight:700}

/* ãƒ’ãƒ¼ãƒ­ãƒ¼ï¼ˆã‚¿ã‚¤ãƒˆãƒ«â†’ç”»åƒâ†’ã‚³ãƒ¡ãƒ³ãƒˆï¼‰ */
.hero-vert{display:grid;place-items:center;border:1px solid var(--line);border-radius:16px;background:#fff;overflow:hidden}
.hero-vert figure{margin:0;width:min(720px,100%);max-width:100%;aspect-ratio:1/1;border-bottom:1px solid var(--line);background:#f7f9ff}
.hero-vert img{width:100%;height:100%;object-fit:cover;display:block}
.hero-vert figcaption{padding:10px;width:100%}
.hero-vert .capline{font-weight:800;line-height:1.55;overflow-wrap:anywhere;word-break:break-word;white-space:normal}
.hero-vert .poem{font-style:italic;letter-spacing:.02em;margin-top:4px;color:#445;opacity:.9}
.hero-vert .capmini{font-size:1em;line-height:1.85;color:var(--muted);overflow-wrap:anywhere;word-break:break-word;white-space:normal}

.grid2{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:12px}
.stat{border:1px solid var(--line);border-radius:12px;padding:10px;background:#fff}
.stat .big{font-size:22px;font-weight:800}
.hr{height:1px;background:var(--line);margin:10px 0}
.factor-mini{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:10px}
.bar{border:1px solid var(--line);border-radius:12px;padding:10px;background:#fff}
.bar .row{height:10px;background:#edf2fb;border-radius:999px;overflow:hidden;margin-top:6px}
.bar .row>span{display:block;height:100%;width:0;background:linear-gradient(90deg,var(--accent),var(--accent2))}
.note{border:1px solid var(--line);border-radius:12px;background:#fff;padding:10px}
.note h4{margin:0 0 6px;font-size:16px}
.note p{margin:6px 0;line-height:1.75}
.footer{color:var(--muted);font-size:.92em}
.warn{background:#f8fbff;border:1px solid #e1ebf7;border-radius:12px;padding:10px;margin:12px 0}
.back-area{display:flex;justify-content:center;margin-top:10px}
a.back{display:inline-flex;align-items:center;gap:6px;padding:10px 14px;border:1px solid var(--line);border-radius:12px;background:#fff;text-decoration:none}
.badge-size{display:inline-flex;align-items:center;gap:6px;padding:4px 8px;border-radius:999px;background:#fff;border:1px solid var(--line);font-size:.85em;margin-left:6px}
.title-row{display:flex;align-items:center;gap:6px;flex-wrap:wrap}

/* å…±æœ‰ãƒœã‚¿ãƒ³ */
.share-row{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
.btn.tw::before{content:"ğ•";margin-right:.25em}
.btn.line::before{content:"ğŸ’¬";margin-right:.25em}
.btn.ig::before{content:"ğŸ“¸";margin-right:.25em}

@media (max-width: 560px){
  .wrap{padding:0 10px}
  .sticky{top:calc(env(safe-area-inset-top) + 0px); padding:8px 10px}
  .scale{grid-template-columns:repeat(2,1fr)}
  .scale label{padding:12px 8px;font-size:14px}
  .hero-vert figure{width:100%}
  .grid2{grid-template-columns:1fr}
  .badge-size{font-size:.8em}
  .card{padding:12px}
  .hero-vert .capline{font-size:clamp(16px,5.2vw,20px);line-height:1.65}
  .hero-vert .capmini{font-size:clamp(14px,4.6vw,16px);line-height:1.95}
  .note h4{font-size:15px}
}
</style>
</head>
<body data-id="best-friend">
<main class="wrap" id="app">
  <header class="hd">
    <div class="logo">ğŸ¤</div>
    <div>
      <h1>ãƒ™ã‚¹ãƒˆãƒ•ãƒ¬ãƒ³ãƒ‰åŠ›è¨ºæ–­ï¼ˆã‚ãŸã—ï¼ã‚ã®äººï¼‰</h1>
      <p class="sub">21å•ï¼ˆ0ã€œ4ã®5ä»¶æ³•ï¼‰ã€‚7å› å­ã®ï¼…ã¨ç·åˆãƒ©ãƒ³ã‚¯ã€ä¸Šä½å› å­ãƒ’ãƒ¼ãƒ­ãƒ¼ã€ç ”ç©¶ãƒ¡ãƒ¢ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚â€»ã‚¨ãƒ³ã‚¿ãƒ¡è‡ªå·±ç†è§£ï¼å› æœã¯æ–­å®šã—ã¾ã›ã‚“ã€‚</p>
    </div>
  </header>

  <div class="sticky" aria-live="polite">
    <div class="mode-tabs" role="tablist" aria-label="å›ç­”ãƒ¢ãƒ¼ãƒ‰">
      <button id="modeSelf" class="on" role="tab" aria-selected="true">ã‚ãŸã—</button>
      <button id="modeFriend" role="tab" aria-selected="false">ã‚ã®äºº</button>
    </div>
    <div class="progress" aria-label="å›ç­”é€²æ—" role="progressbar" aria-valuemin="0" aria-valuemax="21">
      <span id="prog"></span>
    </div>
    <button class="btn primary" id="doScore">è¨ºæ–­ã™ã‚‹</button>
  </div>

  <section class="card section" id="desc">
    <h2 style="margin:4px 0 8px">èª¬æ˜</h2>
    <div class="meta" style="margin-bottom:8px">
      <span class="pill">è³ªå•æ•°ï¼š21</span>
      <span class="pill">å½¢å¼ï¼š0â€“4ï¼ˆ0=ãœã‚“ãœã‚“ / 4=ã¨ã¦ã‚‚ï¼‰</span>
      <span class="pill">ç·åˆï¼š0â€“4ï¼ˆ7å› å­å¹³å‡ï¼‰â†’ï¼…åŒ–</span>
    </div>
    <p class="small">ãƒ¢ãƒ¼ãƒ‰ã¯<b>æ–‡é¢ã ã‘åˆ‡æ›¿</b>ï¼ˆé›†è¨ˆã¯å…±é€šï¼‰ã€‚ã€Œã‚ãŸã—ï¼è‡ªåˆ†ã®ãµã‚‹ã¾ã„ã€ã€Œã‚ã®äººï¼ç›¸æ‰‹ã®ãµã‚‹ã¾ã„ã€ã‚’æ€ã„æµ®ã‹ã¹ã¦å›ç­”ã—ã¦ãã ã•ã„ã€‚</p>
  </section>

  <!-- è¨­å• -->
  <section class="card section" id="questions">
    <h2 style="margin:4px 0 8px">è¨­å•ï¼ˆãœã‚“ãœã‚“ï¼ã‚ã¾ã‚Šï¼ã¨ãã©ãï¼ã‚ˆãï¼ã¨ã¦ã‚‚ï¼‰</h2>
    <div id="qWrap"></div>
    <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:10px">
      <button class="btn" id="clearAns">å›ç­”ã‚’ã‚¯ãƒªã‚¢</button>
      <button class="btn primary" id="doScore2">è¨ºæ–­ã™ã‚‹</button>
    </div>
  </section>

  <!-- çµæœ -->
  <section class="card section" id="result" aria-live="polite">
    <div id="resEmpty">
      <span class="badge">ã¾ã çµæœã¯ã‚ã‚Šã¾ã›ã‚“</span>
      <p class="small">å…¨21å•ã«å›ç­”ã—ã¦ã€Œè¨ºæ–­ã™ã‚‹ã€ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚</p>
    </div>

    <div id="resArea" style="display:none">
      <div class="result-head">
        <span class="badge">çµæœ</span>
        <div class="total" id="typeLine">â€”</div>
      </div>

      <!-- ãƒ’ãƒ¼ãƒ­ãƒ¼ï¼ˆä¸Šä½å› å­ç”»åƒï¼‹ç·åˆãƒãƒƒã‚¸ï¼‰ -->
      <div class="hero-vert section" role="region" aria-label="ã‚¿ã‚¤ãƒ—ã‚¤ãƒ¡ãƒ¼ã‚¸">
        <figure>
          <img id="heroImg" src="/shindan/assets/results/best-friend/t01.webp" alt="çµæœã‚¤ãƒ¡ãƒ¼ã‚¸" loading="lazy" width="1200" height="1200">
        </figure>
        <figcaption>
          <div class="title-row">
            <div class="capline" id="heroTitle">â€”</div>
            <span class="badge-size" id="sizeBadge" aria-label="ç·åˆå¹³å‡">â€”</span>
            <span class="badge-size" id="rankBadge" aria-label="ç·åˆãƒ©ãƒ³ã‚¯">â€”</span>
          </div>
          <div class="poem" id="heroPoem">â€”</div>
          <div class="capmini" id="heroCopy">â€”</div>
          <div class="share-row" id="shareRow" hidden>
            <a id="shareTw" class="btn tw" href="#" target="_blank" rel="noopener">ã§å…±æœ‰</a>
            <a id="shareLn" class="btn line" href="#" target="_blank" rel="noopener">LINEã§é€ã‚‹</a>
            <a id="shareIg" class="btn ig" href="#" aria-label="Instagramã§ã‚·ã‚§ã‚¢">Instagramã§ã‚·ã‚§ã‚¢</a>
          </div>
        </figcaption>
      </div>

      <!-- æ•°å€¤ãªã© -->
      <div class="grid2">
        <article class="stat" aria-label="ç·åˆã‚¹ã‚³ã‚¢">
          <div><strong>ç·åˆï¼ˆ0â€“4ï¼‰</strong></div>
          <div class="big"><span id="sumAvg">0.00</span> / 4.00 <span class="small" id="sumPct">= 0%</span></div>
          <div class="small" id="sumNote">â€”</div>
        </article>
      </div>

      <div class="hr"></div>
      <!-- å› å­ãƒãƒ¼ -->
      <div class="section">
        <h3 style="margin:8px 0">å› å­åˆ¥ã‚¹ã‚³ã‚¢</h3>
        <div id="bars" class="factor-mini"></div>
      </div>

      <div class="hr"></div>
      <!-- ãƒ©ãƒ³ã‚¯é•·æ–‡ï¼‹ãƒ’ãƒ³ãƒˆ -->
      <div id="longCopy" class="small"></div>

      <div class="hr"></div>
      <!-- ç ”ç©¶ãƒ¡ãƒ¢ -->
      <details class="section" open>
        <summary><strong>ç ”ç©¶ãƒ¡ãƒ¢</strong></summary>
        <ul class="small" id="resMemo" style="margin:6px 0 0 18px;line-height:1.8"></ul>
        <p class="small" style="margin-top:6px">â€»ç›¸é–¢ä¸­å¿ƒã§å› æœã¯æ–­å®šã§ãã¾ã›ã‚“ã€‚å€‹äººå·®ãŒå¤§ãã„æ€§è³ªãŒã‚ã‚Šã¾ã™ã€‚åŒ»ç™‚ãƒ»æ¡ç”¨ãªã©ã®ç”¨é€”ã«ã¯ä½¿ãˆã¾ã›ã‚“ã€‚</p>
      </details>

      <div class="back-area" style="margin-top:12px">
        <a class="back" href="/shindan/" id="backLink" aria-label="è¨ºæ–­ä¸€è¦§ã«æˆ»ã‚‹">è¨ºæ–­ä¸€è¦§ã«æˆ»ã‚‹</a>
      </div>
    </div>
  </section>

  <section class="footer card">
    <h2 style="margin:4px 0 8px">ã”åˆ©ç”¨ã«ã‚ãŸã£ã¦</h2>
    <p class="warn"><strong>æ³¨æ„ï¼š</strong>ã“ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¯<b>ã‚¨ãƒ³ã‚¿ãƒ¡ç”¨ã®è‡ªå·±ç†è§£</b>ã§ã™ã€‚ç¾å®Ÿã®åˆ¤æ–­ã‚„åŒ»ç™‚ãƒ»æ¡ç”¨ã«ã¯ä½¿ãˆã¾ã›ã‚“ã€‚å¿…è¦ãªå ´åˆã¯é–¢ä¿‚æ©Ÿé–¢ãƒ»å°‚é–€å®¶ã«ã”ç›¸è«‡ãã ã•ã„ã€‚<br>
å›ç­”ã¯ç«¯æœ«å†…ã§å‡¦ç†ãƒ»ä¿å­˜ã•ã‚Œã€å›ç­”å†…å®¹ã‚„å€‹äººã‚’ç‰¹å®šã§ãã‚‹æƒ…å ±ã¯ã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡ã•ã‚Œã¾ã›ã‚“ã€‚çµæœè¡¨ç¤ºæ™‚ã«åŒ¿åã®ä»¶æ•°ã‚«ã‚¦ãƒ³ãƒˆã®ã¿é€ä¿¡ã™ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚</p>
  </section>
</main>

<script>
(function(){
  // ====== ãƒšãƒ¼ã‚¸æƒ…å ± ======
  var SLUG = "best-friend";
  var TITLE = "ãƒ™ã‚¹ãƒˆãƒ•ãƒ¬ãƒ³ãƒ‰åŠ›è¨ºæ–­ï¼ˆã‚ãŸã—ï¼ã‚ã®äººï¼‰";
  var ANS_KEY = "specimens:"+SLUG+":answers";
  var MODE_KEY= "specimens:"+SLUG+":mode";
  var IMG_BASE_FACTOR = "/shindan/assets/results/best-friend/"; // 01..07
  var IMG_BY_FACTOR = { ACR:"t01.webp", SEC:"t02.webp", AUT:"t03.webp", CHL:"t04.webp", REL:"t05.webp", REP:"t06.webp", FUN:"t07.webp" };
  var ALT_BY_FACTOR = {
    ACR:"å–œã³ã‚’åˆ†ã‹ã¡åˆã†2äºº", SEC:"å®‰å¿ƒã—ã¦è©±ã›ã‚‹ç©ºæ°—",
    AUT:"è‡ªå¾‹ã‚’å°Šé‡ã™ã‚‹2äºº", CHL:"èƒŒä¸­ã‚’æŠ¼ã™å‹", REL:"ä¸€è²«æ€§ã¨äºˆæ¸¬å¯èƒ½æ€§",
    REP:"ã™ã‚Œé•ã„ã®ä¿®å¾©", FUN:"éŠã³ã¨ãƒ¦ãƒ¼ãƒ¢ã‚¢"
  };

  // ====== å› å­ãƒ»è¨­å• ======
  var FACTORS = {
    ACR:{ name:"å–œã³ã®åˆ†ã‹ã¡åˆã„å¿œç­”", items:["Q01","Q02","Q03"] },
    SEC:{ name:"å®‰å¿ƒã®åœŸå°",         items:["Q04","Q05","Q06"] },
    AUT:{ name:"è‡ªå¾‹ã®å°Šé‡",         items:["Q07","Q08","Q09"] },
    CHL:{ name:"æˆé•·ã®å¾ŒæŠ¼ã—",       items:["Q10","Q11","Q12"] },
    REL:{ name:"ä¸€è²«æ€§ã¨äºˆæ¸¬å¯èƒ½æ€§", items:["Q13","Q14","Q15"] },
    REP:{ name:"ä¿®å¾©åŠ›",             items:["Q16","Q17","Q18"] },
    FUN:{ name:"éŠã³ã¨ãƒ¦ãƒ¼ãƒ¢ã‚¢",     items:["Q19","Q20","Q21"] }
  };
  var ITEMS = {
    Q01:{ text_self:"ã‚ãŸã—ã¯ã€ç›¸æ‰‹ã®è‰¯ã„ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚’ç›®ã‚’è¼ã‹ã›ã¦è©³ã—ãèãã€‚", text_friend:"ãã®äººã¯ã€ã‚ãŸã—ã®è‰¯ã„ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚’ç›®ã‚’è¼ã‹ã›ã¦è©³ã—ãèãã€‚" },
    Q02:{ text_self:"ã‚ãŸã—ã¯ã€è‰¯ã„å ±å‘Šã‚’ã•ã‚Œã¦ã‚‚ã™ãè©±é¡Œã‚’å¤‰ãˆãŒã¡ã ã€‚", text_friend:"ãã®äººã¯ã€ã‚ãŸã—ãŒè‰¯ã„å ±å‘Šã‚’ã—ã¦ã‚‚ã™ãè©±é¡Œã‚’å¤‰ãˆãŒã¡ã ã€‚", rev:true },
    Q03:{ text_self:"ã‚ãŸã—ã¯ã€ç›¸æ‰‹ã®åŠªåŠ›ã‚„å·¥å¤«ã‚’è¨€è‘‰ã«ã—ã¦è¤’ã‚ã‚‹ã€‚", text_friend:"ãã®äººã¯ã€ã‚ãŸã—ã®åŠªåŠ›ã‚„å·¥å¤«ã‚’è¨€è‘‰ã«ã—ã¦è¤’ã‚ã‚‹ã€‚" },
    Q04:{ text_self:"ã‚ãŸã—ã¯ã€å¼±éŸ³ã‚‚è©±ã›ã‚‹å®‰å¿ƒãªç©ºæ°—ã‚’ä¸€ç·’ã«ä½œã‚Œã‚‹ã€‚", text_friend:"ãã®äººã¯ã€ã‚ãŸã—ãŒå¼±éŸ³ã‚‚è©±ã›ã‚‹å®‰å¿ƒãªç©ºæ°—ã‚’ä½œã£ã¦ãã‚Œã‚‹ã€‚" },
    Q05:{ text_self:"ã¤ã‚‰ã„æ—¥ã«ã€ç›¸æ‰‹ãŒè½ã¡ç€ãã¾ã§å¯„ã‚Šããˆã‚‹ã€‚", text_friend:"ã¤ã‚‰ã„æ—¥ã«ã€ã‚ãŸã—ãŒè½ã¡ç€ãã¾ã§å¯„ã‚Šãã£ã¦ãã‚Œã‚‹ã€‚" },
    Q06:{ text_self:"ç›¸æ‰‹ãŒæ‰“ã¡æ˜ã‘ã¦ã‚‚ã€è©•ä¾¡ã‚„èª¬æ•™ã‚’ã—ãŒã¡ã ã€‚", text_friend:"ã‚ãŸã—ãŒæ‰“ã¡æ˜ã‘ã‚‹ã¨ã€è©•ä¾¡ã‚„èª¬æ•™ã‚’ã•ã‚ŒãŒã¡ã ã€‚", rev:true },
    Q07:{ text_self:"ç›¸æ‰‹ã®é¸æŠã‚„å¢ƒç•Œç·šã‚’å°Šé‡ã§ãã‚‹ã€‚", text_friend:"ã‚ãŸã—ã®é¸æŠã‚„å¢ƒç•Œç·šã‚’å°Šé‡ã—ã¦ãã‚Œã‚‹ã€‚" },
    Q08:{ text_self:"ç›¸è«‡ã•ã‚Œã‚‹ã¨ã€ç´°ã‹ã„æŒ‡å›³ãŒå¢—ãˆãŒã¡ã ã€‚", text_friend:"ç›¸è«‡ã™ã‚‹ã¨ã€ç´°ã‹ã„æŒ‡å›³ã‚’ã•ã‚ŒãŒã¡ã ã€‚", rev:true },
    Q09:{ text_self:"ç›¸æ‰‹ã®ãƒšãƒ¼ã‚¹ã‚’å¤§åˆ‡ã«ã—ã€æ€¥ã‹ã•ãªã„ã€‚", text_friend:"ã‚ãŸã—ã®ãƒšãƒ¼ã‚¹ã‚’å¤§åˆ‡ã«ã—ã€æ€¥ã‹ã•ãªã„ã€‚" },
    Q10:{ text_self:"å¿…è¦ãªæ™‚ã«â€œã§ãã‚‹ç†ç”±â€ã§èƒŒä¸­ã‚’æŠ¼ã›ã‚‹ã€‚", text_friend:"å¿…è¦ãªæ™‚ã«â€œã§ãã‚‹ç†ç”±â€ã§èƒŒä¸­ã‚’æŠ¼ã—ã¦ãã‚Œã‚‹ã€‚" },
    Q11:{ text_self:"ç›¸æ‰‹ã®æŒ‘æˆ¦ã®è©±é¡Œã‚’ã€ã¤ã„ãã‚‰ã—ã¦ã—ã¾ã†ã€‚", text_friend:"ã‚ãŸã—ã®æŒ‘æˆ¦ã®è©±é¡Œã‚’ã€ã¤ã„ãã‚‰ã—ãŒã¡ã ã€‚", rev:true },
    Q12:{ text_self:"ç”˜ã‚„ã‹ã™ã ã‘ã§ãªãã€å»ºè¨­çš„ãªå•ã„ã§è¦–é‡ã‚’åºƒã’ã‚‰ã‚Œã‚‹ã€‚", text_friend:"ç”˜ã‚„ã‹ã™ã ã‘ã§ãªãã€å»ºè¨­çš„ãªå•ã„ã§è¦–é‡ã‚’åºƒã’ã¦ãã‚Œã‚‹ã€‚" },
    Q13:{ text_self:"ç´„æŸãƒ»é€£çµ¡ã®ä¸€è²«æ€§ãŒã‚ã‚Šã€é ¼ã‚Œã‚‹ã€‚", text_friend:"ãã®äººã®ç´„æŸãƒ»é€£çµ¡ã¯ä¸€è²«ã—ã¦ã„ã¦ã€é ¼ã‚Œã‚‹ã€‚" },
    Q14:{ text_self:"ãƒ‰ã‚¿ã‚­ãƒ£ãƒ³ã‚„æ—¢èª­ã‚¹ãƒ«ãƒ¼ãŒç¶šããŒã¡ã ã€‚", text_friend:"ãƒ‰ã‚¿ã‚­ãƒ£ãƒ³ã‚„æ—¢èª­ã‚¹ãƒ«ãƒ¼ãŒç¶šããŒã¡ã ã€‚", rev:true },
    Q15:{ text_self:"ã€Œé ¼ã£ã¦ã„ã„ã€ã¨è¨€ãˆã‚‹ç©ºæ°—æ„Ÿã‚’ä¿ã¦ã¦ã„ã‚‹ã€‚", text_friend:"ã‚ãŸã—ãŒã€Œé ¼ã£ã¦ã„ã„ã€ã¨è¨€ãˆã‚‹ç©ºæ°—æ„ŸãŒã‚ã‚‹ã€‚" },
    Q16:{ text_self:"æ„è¦‹ãŒé£Ÿã„é•ã£ã¦ã‚‚ã€æ—©ã‚ã«è©±ã—åˆã„å†æ¥ç¶šã§ãã‚‹ã€‚", text_friend:"é£Ÿã„é•ã£ã¦ã‚‚ã€æ—©ã‚ã«è©±ã—åˆã„å†æ¥ç¶šã—ã¦ãã‚Œã‚‹ã€‚" },
    Q17:{ text_self:"ã‚±ãƒ³ã‚«å¾Œã€è¬ã‚‰ãšè‡ªç„¶æ¶ˆæ»…ã‚’å¾…ã¡ãŒã¡ã ã€‚", text_friend:"ã‚±ãƒ³ã‚«å¾Œã€è¬ã‚‰ãšè‡ªç„¶æ¶ˆæ»…ã‚’å¾…ã¡ãŒã¡ã ã€‚", rev:true },
    Q18:{ text_self:"è‡ªåˆ†ã®éã«æ°—ã¥ã„ãŸã‚‰ã€ç´ ç›´ã«è¬ã‚Œã‚‹ã€‚", text_friend:"è‡ªåˆ†ã®éã«æ°—ã¥ã„ãŸã‚‰ã€ç´ ç›´ã«è¬ã£ã¦ãã‚Œã‚‹ã€‚" },
    Q19:{ text_self:"ä¸€ç·’ã«ç¬‘ã„ã€æ°—åˆ†ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹å·¥å¤«ãŒã§ãã‚‹ã€‚", text_friend:"ä¸€ç·’ã«ç¬‘ã„ã€æ°—åˆ†ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹å·¥å¤«ã‚’ã—ã¦ãã‚Œã‚‹ã€‚" },
    Q20:{ text_self:"å†…è¼ªãƒã‚¿ã‚„å°ã•ãªéŠã³ã®ç¿’æ…£ãŒè‡ªç„¶ã¨ç”Ÿã¾ã‚Œã‚‹ã€‚", text_friend:"å†…è¼ªãƒã‚¿ã‚„å°ã•ãªéŠã³ã®ç¿’æ…£ãŒè‡ªç„¶ã¨ç”Ÿã¾ã‚Œã‚‹ã€‚" },
    Q21:{ text_self:"æ„šç—´ã ã‘ã§çµ‚ã‚ã‚‰ãšã€æ°—åˆ†ã‚’è»½ãç· ã‚ã‚‰ã‚Œã‚‹ã€‚", text_friend:"æ„šç—´ã ã‘ã§çµ‚ã‚ã‚‰ãšã€æ°—åˆ†ã‚’è»½ãç· ã‚ã¦ãã‚Œã‚‹ã€‚" }
  };
  var LABELS = ["ãœã‚“ãœã‚“","ã‚ã¾ã‚Š","ã¨ãã©ã","ã‚ˆã","ã¨ã¦ã‚‚"];
  var REVERSED = new Set(["Q02","Q06","Q08","Q11","Q14","Q17"]);
  var CURRENT_MODE = "self"; // "self" | "friend"

  // ====== ä¸Šä½å› å­ãƒ’ãƒ¼ãƒ­ãƒ¼æ–‡é¢ï¼ˆçŸ­è©•ï¼‰ ======
  var FACTOR_COPY = {
    ACR:{ title:"ç¥ç¦ãƒã‚¹ã‚¿ãƒ¼ï¼ˆACRï¼‰", poem:"è‰¯ã„ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚’ä¸€ç·’ã«è‚²ã¦ã‚‹äººã€‚", copy:"ã†ã‚Œã—ã„è©±ã‚’æ·±æ˜ã‚Šã§å—ã‘å–ã‚Œã‚‹ã‚¿ã‚¤ãƒ—ã€‚ç§°è³›ã¨è¨€èªåŒ–ãŒç›¸æ‰‹ã®è‡ªä¿¡ã‚’è‚²ã¦ã¾ã™ã€‚"},
    SEC:{ title:"å®‰å¿ƒãƒ™ãƒ¼ã‚¹ä¿‚ï¼ˆSECï¼‰", poem:"å¼±éŸ³ã‚‚ç½®ã‘ã‚‹ã€ã‚„ã‚ã‚‰ã‹ãªåœŸå°ã€‚", copy:"ç›¸æ‰‹ãŒå®‰å¿ƒã—ã¦è©±ã›ã‚‹ç©ºæ°—ã‚’ã¤ãã‚Œã‚‹äººã€‚æ€¥ãŒãšè´ãå§¿å‹¢ãŒé–¢ä¿‚ã®æ¸©åº¦ã‚’ä¸Šã’ã¾ã™ã€‚"},
    AUT:{ title:"å°Šé‡ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ï¼ˆAUTï¼‰", poem:"äº’ã„ã®ãƒšãƒ¼ã‚¹ã«æ•¬æ„ã‚’ã€‚", copy:"é¸æŠã‚„å¢ƒç•Œç·šã‚’å¤§åˆ‡ã«ã§ãã‚‹ã‚¿ã‚¤ãƒ—ã€‚ç„¡ç†å¼·ã„ã—ãªã„æ”¯ãˆæ–¹ãŒé•·ç¶šãã®éµã«ã€‚"},
    CHL:{ title:"æŒ‘æˆ¦ãƒ–ãƒ¼ã‚¹ã‚¿ãƒ¼ï¼ˆCHLï¼‰", poem:"â€œã§ãã‚‹ç†ç”±â€ã§èƒŒä¸­ã‚’æŠ¼ã™ã€‚", copy:"å»ºè¨­çš„ãªå•ã„ã‹ã‘ã§è¦–é‡ã‚’åºƒã’ã‚‹äººã€‚å°ã•ãªæˆåŠŸã‚’ä¸€ç·’ã«è¨­è¨ˆã§ãã¾ã™ã€‚"},
    REL:{ title:"å®‰å®šã‚ªãƒšãƒ¬ãƒ¼ã‚¿ãƒ¼ï¼ˆRELï¼‰", poem:"ç´„æŸã¯é™ã‹ãªå®‰å¿ƒã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã€‚", copy:"é€£çµ¡ã‚„ç´„æŸãŒå®‰å®šã—ä¿¡é ¼ã‚’è²¯é‡‘ã§ãã‚‹ã‚¿ã‚¤ãƒ—ã€‚äºˆæ¸¬å¯èƒ½æ€§ãŒâ€œé ¼ã£ã¦ã„ã„â€ã‚’ç”Ÿã¿ã¾ã™ã€‚"},
    REP:{ title:"å†æ¥ç¶šãƒŠãƒ“ï¼ˆREPï¼‰", poem:"ã¶ã¤ã‹ã£ãŸã‚‰ã€çŸ­ãæ—©ã‚ã«å†æ¥ç¶šã€‚", copy:"å¯¾ç«‹å¾Œã®è©±ã—åˆã„ãŒå¾—æ„ã€‚ç´ ç›´ãªè¬ç½ªã¨æ¬¡ã®è¡Œå‹•ã§é–¢ä¿‚ã‚’å›å¾©ã§ãã¾ã™ã€‚"},
    FUN:{ title:"ãƒ ãƒ¼ãƒ‰ã‚·ãƒ•ã‚¿ãƒ¼ï¼ˆFUNï¼‰", poem:"ç¬‘ã„ã§è»½ã‚„ã‹ã€åˆ‡æ›¿ä¸Šæ‰‹ã€‚", copy:"å†…è¼ªãƒã‚¿ã‚„å°ã•ãªéŠã³ã§æ°—åˆ†è»¢æ›ã‚’ä¿ƒã›ã‚‹ã‚¿ã‚¤ãƒ—ã€‚è‰¯ã„æ™‚é–“ã‚’å¢—ã‚„ã›ã¾ã™ã€‚"}
  };

  // ====== ç·åˆãƒ©ãƒ³ã‚¯ ======
  var RANKS = [
    { id:"R1", min:80, label:"ç›¸æ£’ãƒ¬ã‚¸ã‚§ãƒ³ãƒ‰", img:"rank-01.png",
      one:"å®‰å¿ƒãƒ»ç§°è³›ãƒ»ä¿®å¾©ãƒ»æŒ‘æˆ¦æ”¯æ´ãƒ»ç¬‘ã„ãŒå¾ªç’°ã€‚ãƒ™ã‚¹ãƒˆãƒ•ãƒ¬ãƒ³ãƒ‰åŠ›ã¯ãƒˆãƒƒãƒ—å±¤ã€‚",
      long:"ã‚ãªãŸã¯è‰¯ã„ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚’æ·±æ˜ã‚Šã§ç¥ã—ã€å¼±ã„æ°—æŒã¡ã‚‚å—ã‘æ­¢ã‚ã€å¿…è¦ãªæ™‚ã«èƒŒä¸­ã‚’æŠ¼ã›ã‚‹äººã€‚ç´„æŸã¯å®‰å®šã—ã€è¡çªã®å¾Œã‚‚çŸ­æ™‚é–“ã§å†æ¥ç¶šã§ãã¾ã™ã€‚ã•ã‚‰ã«ç¬‘ã„ã¨å°ã•ãªéŠã³ãŒã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚’è£œçµ¦ã€‚ã“ã†ã—ãŸä¸¦ã³ã¯ã€ä¸»è¦³çš„å¹¸ç¦ã‚„ãƒ¬ã‚¸ãƒªã‚¨ãƒ³ã‚¹ã€ç›®æ¨™é”æˆã®ç¶™ç¶šã«é–¢é€£ã—ã‚„ã™ã„æ§‹æˆã§ã™ã€‚ä»Šã®è‰¯ã•ã‚’ä¿ã¤éµã¯â€œéåº¦ã«å®Œç’§åŒ–ã—ãªã„ã“ã¨â€ã€‚å°ã•ãªç§°è³›ã¨ã€Œã‚ã‚ŠãŒã¨ã†ã€ã‚’æ—¥å¸¸ã«ã€‚",
      hint:"ACRï¼ˆç¥ã†æ·±æ˜ã‚Šï¼‰ã¨REPï¼ˆæ—©ã„ä¿®å¾©ï¼‰ã‚’ç¿’æ…£ã§å›ºå®šåŒ–ã€‚"
    },
    { id:"R2", min:65, label:"å®‰å¿ƒã¨æŒ‘æˆ¦ã®äºŒåˆ€æµ", img:"rank-02.png",
      one:"æ”¯ãˆã¨å‰é€²ã®ãƒãƒ©ãƒ³ã‚¹ãŒè‰¯å¥½ã€‚ã‚ã¨å°‘ã—ACRãŒä¼¸ã³ã—ã‚ã€‚",
      long:"å®‰å¿ƒã¨è¡Œå‹•æ”¯æ´ã¯å¼·ã„è»¸ã€‚è‰¯ã„çŸ¥ã‚‰ã›ã‚’ã€Œè³ªå•â†’ç§°è³›â†’ä¸€ç·’ã«è¨ˆç”»ã€ã§å—ã‘å–ã‚‹ACRã‚’å¢—ã‚„ã™ã¨ã€æº€è¶³åº¦ã¨çµ†ãŒã‚‚ã†ä¸€æ®µéšä¸ŠãŒã‚Šã¾ã™ã€‚ä¿®å¾©ã¯â€œæ—©ã‚ãƒ»çŸ­ããƒ»å…·ä½“â€ã€‚",
      hint:"ã€Œã†ã‚Œã—ã„ç†ç”±ã€ã‚‚ã†å°‘ã—æ•™ãˆã¦ï¼Ÿã€ã®ä¸€è¨€ã‹ã‚‰ã€‚"
    },
    { id:"R3", min:50, label:"ã»ã©ã‚ˆã„å‹ã®é”äºº", img:"rank-03.png",
      one:"è‰¯å¥½ãªåŸºç›¤ã€‚é€£çµ¡ã®ã°ã‚‰ã¤ãã‚„ä¿®å¾©å¾…ã¡ãŒå¼±ç‚¹ã«ãªã‚Šã‚„ã™ã„ã€‚",
      long:"ä¸€ç·’ã®æ™‚é–“ã¯å¿ƒåœ°ã‚ˆã„ã‘ã‚Œã©ã€ç´„æŸã®æºã‚Œã‚„ä¿®å¾©ã®é…ã‚Œã§æ‘©è€—ã—ã‚„ã™ã„æ®µéšã€‚æœˆ1ã®â€œã†ã‚Œã—ã‹ã£ãŸå…±æœ‰ä¼šâ€ï¼ˆACRï¼‹FUNï¼‰ã¨ã€ãƒŸãƒ‹å®šæœŸï¼ˆRELï¼‰ã§åº•ä¸Šã’ã€‚",
      hint:"ã€Œ3åˆ†ã§è‰¯ã„è©±å…±æœ‰ã€ã‚’åˆè¨€è‘‰ã«ã€‚"
    },
    { id:"R4", min:35, label:"èŠ½ã°ãˆæœŸã®æ”¯ãˆæ‰‹", img:"rank-04.png",
      one:"è‰¯ã•ã¯ã‚ã‚‹ã€‚ã¾ãšã¯äºˆæ¸¬å¯èƒ½æ€§ã¨æ—©ã„ä¿®å¾©ã‹ã‚‰æ•´ãˆã‚ˆã†ã€‚",
      long:"é€£çµ¡ã‚„ç´„æŸãŒæºã‚Œã‚‹ã¨ã€å®‰å¿ƒã¨ACRãŒåŠ¹ãã«ãããªã‚Šã¾ã™ã€‚RELã®â€œå‹â€ã‚’æ±ºã‚ã€ã¶ã¤ã‹ã£ãŸã‚‰ã€Œã”ã‚ã‚“ï¼‹æ¬¡ã¯ã“ã†ã™ã‚‹ã€ã§çŸ­ãå†æ¥ç¶šã€‚",
      hint:"äºˆå®šãŒè©°ã¾ã‚‹æ—¥ã¯ã€Œä»Šæ—¥ã¯è´ãå½¹å®£è¨€ã€ã§ç„¡ç†ãªãã€‚"
    },
    { id:"R5", min:0,  label:"ã“ã‚Œã‹ã‚‰è‚²ã¤ç›¸æ£’åŠ›", img:"rank-05.png",
      one:"ç„¦ã‚‰ãšåœŸã¥ãã‚Šã€‚å®‰å¿ƒã¨ä¸€è²«æ€§ã®ãƒŸãƒ‹æˆåŠŸã‹ã‚‰ã€‚",
      long:"æ·±ã„è©±ã‚ˆã‚Šã€è»½ã„å…±æœ‰ã¨ç¬‘ã„ã‚’å¢—ã‚„ã™ã¨ã“ã‚ã‹ã‚‰ã€‚SECã¨RELã®åœŸå°ã‚’æ•´ãˆã€ACRã‚’å°‘ã—ã ã‘è¶³ã™ã¨é–¢ä¿‚ã®æ¸©åº¦ãŒä¸ŠãŒã‚Šã¾ã™ã€‚",
      hint:"ã€ŒçŸ­ãå®šæœŸã€â†’ã€Œå°ã•ãªç§°è³›ã€ã®é †ã§ã€‚"
    }
  ];

  // ====== ç ”ç©¶ãƒ¡ãƒ¢ï¼ˆã‚„ã•ã—ã„èªå½™ãƒ»ç¾…åˆ—ï¼‰ ======
  var RESEARCH_MEMO = [
    "ã‚ã‚‹ç ”ç©¶ã§ã¯ã€è‰¯ã„ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚’æ·±æ˜ã‚Šã§ç¥ã†å¿œç­”ï¼ˆACRï¼‰ãŒã€é–¢ä¿‚ã®æº€è¶³ã‚„å¹¸ã›æ„Ÿã¨é–¢é€£ã™ã‚‹ç¤ºå”†ã€‚",
    "ã‚ã‚‹ç ”ç©¶ã§ã¯ã€å®‰å¿ƒã§ãã‚‹å ´ï¼ˆå®‰å…¨åŸºåœ°ï¼‰ãŒã€ã‚¹ãƒˆãƒ¬ã‚¹å›å¾©ã‚„æŒ‘æˆ¦è¡Œå‹•ã®å®‰å®šã«é–¢ã‚ã‚‹é–¢é€£ã€‚",
    "ã‚ã‚‹ç ”ç©¶ã§ã¯ã€è‡ªå¾‹ã®å°Šé‡ã¯ã€å†…ç™ºçš„ãªã‚„ã‚‹æ°—ã‚„é–¢ä¿‚æº€è¶³ã¨çµã³ã¤ãã‚„ã™ã„å‚¾å‘ã€‚",
    "ã‚ã‚‹ç ”ç©¶ã§ã¯ã€æ—©ã„ä¿®å¾©ï¼ˆè¬ç½ªã‚„å†æ¥ç¶šï¼‰ãŒã€é•·ãè‰¯ã„é–¢ä¿‚ã‚’ä¿ã¤ã“ã¨ã«é–¢ä¿‚ã™ã‚‹å¯èƒ½æ€§ã€‚",
    "ã‚ã‚‹ç ”ç©¶ã§ã¯ã€ãƒ¦ãƒ¼ãƒ¢ã‚¢ã‚„å°ã•ãªéŠã³ã¯ã€æ°—åˆ†ã®åˆ‡æ›¿ã‚„å‰å‘ãã•ã®åŠ©ã‘ã«ãªã‚‹ç¤ºå”†ã€‚"
  ];

  // ====== è¦ç´  ======
  var qWrap   = document.getElementById("qWrap");
  var prog    = document.getElementById("prog");
  var resEmpty= document.getElementById("resEmpty");
  var resArea = document.getElementById("resArea");
  var typeLine= document.getElementById("typeLine");
  var heroImg = document.getElementById("heroImg");
  var heroTitle= document.getElementById("heroTitle");
  var heroPoem = document.getElementById("heroPoem");
  var heroCopy = document.getElementById("heroCopy");
  var sizeBadgeEl= document.getElementById("sizeBadge");
  var rankBadgeEl= document.getElementById("rankBadge");
  var sumAvg  = document.getElementById("sumAvg");
  var sumPct  = document.getElementById("sumPct");
  var sumNote = document.getElementById("sumNote");
  var bars    = document.getElementById("bars");
  var longCopy= document.getElementById("longCopy");
  var resMemo = document.getElementById("resMemo");
  var shareRow= document.getElementById("shareRow");
  var shareTw = document.getElementById("shareTw");
  var shareLn = document.getElementById("shareLn");
  var shareIg = document.getElementById("shareIg");
  var modeSelfBtn   = document.getElementById("modeSelf");
  var modeFriendBtn = document.getElementById("modeFriend");

  // ====== è¨­å•ç”Ÿæˆ ======
  function buildQuestions(){
    var html = "";
    Object.keys(FACTORS).forEach(function(key){
      FACTORS[key].items.forEach(function(qid){
        var q = ITEMS[qid];
        var text = (CURRENT_MODE === "friend") ? q.text_friend : q.text_self;
        html += '<fieldset class="q" id="fs-'+qid+'">'+
          '<legend>'+text+'</legend>'+
          '<div class="scale" role="radiogroup" aria-label="'+text+'">';
        for(var v=0;v<=4;v++){
          html += '<div style="position:relative">'+
            '<input id="q'+qid+'-'+v+'" type="radio" name="q'+qid+'" value="'+v+'">'+
            '<label for="q'+qid+'-'+v+'" title="'+LABELS[v]+'">'+LABELS[v]+'</label>'+
          '</div>';
        }
        html += '</div></fieldset>';
      });
    });
    qWrap.innerHTML = html;

    // ã‚¤ãƒ™ãƒ³ãƒˆ
    qWrap.querySelectorAll('input[type="radio"]').forEach(function(r){
      r.addEventListener('change', function(){ saveAnswers(); updateProgress(); }, false);
    });
    restoreAnswers();
    updateProgress();
  }

  // ====== ä¿å­˜/å¾©å…ƒ ======
  function saveAnswers(){
    try{
      var out = {};
      Object.keys(ITEMS).forEach(function(id){
        var chk = qWrap.querySelector('#fs-'+id+' input[type="radio"]:checked');
        if(chk){ out[id] = parseInt(chk.value,10); }
      });
      localStorage.setItem(ANS_KEY, JSON.stringify({ts:Date.now(), ans:out}));
    }catch(e){}
  }
  function restoreAnswers(){
    try{
      var raw = localStorage.getItem(ANS_KEY);
      if(!raw) return;
      var data = JSON.parse(raw);
      var ans = (data && data.ans) || {};
      Object.keys(ans).forEach(function(id){
        var v = ans[id];
        var input = qWrap.querySelector('#q'+id+'-'+v);
        if(input){ input.checked = true; }
      });
    }catch(e){}
  }
  function wipeAnswers(){
    try{ localStorage.removeItem(ANS_KEY); }catch(e){}
  }

  function updateProgress(){
    var total = Object.keys(ITEMS).length;
    var answered = 0;
    Object.keys(ITEMS).forEach(function(id){
      if(qWrap.querySelector('#fs-'+id+' input[type="radio"]:checked')) answered++;
    });
    var pct = Math.round(100*answered/total);
    prog.style.width = pct + "%";
    var bar = prog.parentElement;
    if(bar){
      bar.setAttribute("aria-valuenow", answered);
      bar.setAttribute("aria-label", "å›ç­”é€²æ—ï¼š"+answered+" / "+total);
    }
  }

  // ====== ã‚¹ã‚³ã‚¢è¨ˆç®— ======
  function valOf(id, raw){ var v=Number(raw); return REVERSED.has(id)?(4-v):v; }
  function score(){
    var missing = [];
    var ans = {};
    Object.keys(ITEMS).forEach(function(id){
      var chk = qWrap.querySelector('#fs-'+id+' input[type="radio"]:checked');
      if(!chk){ missing.push(id); return; }
      ans[id] = parseInt(chk.value,10);
    });
    if(missing.length){
      alert("æœªå›ç­”ãŒã‚ã‚Šã¾ã™ã€‚å…¨21å•ã«ãŠç­”ãˆãã ã•ã„ã€‚");
      var fs = document.getElementById('fs-'+missing[0]);
      if(fs){ fs.scrollIntoView({behavior:"smooth", block:"center"}); fs.classList.add("need"); setTimeout(function(){ fs.classList.remove("need"); },1600); }
      return;
    }

    var fScore = {}, fPct = {};
    Object.keys(FACTORS).forEach(function(key){
      var ids = FACTORS[key].items;
      var sum = ids.reduce(function(s,id){ return s + valOf(id, ans[id]); },0);
      var avg = sum / ids.length; // 0-4
      fScore[key] = avg;
      fPct[key] = Math.round((avg/4)*100);
    });

    var keys = Object.keys(FACTORS);
    var totalAvg = keys.reduce(function(s,k){ return s + fScore[k]; },0) / keys.length;
    var totalPct = Math.round((totalAvg/4)*100);

    var order = keys.slice().sort(function(a,b){ return fPct[b]-fPct[a]; });
    var top = order[0], second = order[1];
    var diff = fPct[top]-fPct[second];

    render({ fScore, fPct, totalAvg, totalPct, top, second, diff });
  }

  // ====== ãƒ©ãƒ³ã‚¯é¸å®š ======
  function pickRank(pct){
    for(var i=0;i<RANKS.length;i++){
      if(pct >= RANKS[i].min) return RANKS[i];
    }
    return RANKS[RANKS.length-1];
  }

  function render(o){
    var topDef = FACTORS[o.top];
    var heroDef= FACTOR_COPY[o.top];
    var rank   = pickRank(o.totalPct);

    // ã‚¿ã‚¤ãƒˆãƒ«è¡Œ
    var typeText = 'ç·åˆãƒ©ãƒ³ã‚¯ï¼š'+rank.label+'ï¼ˆ'+o.totalPct+'%ï¼‰ ï¼ ä¸Šä½å› å­ï¼š'+topDef.name;
    typeLine.textContent = typeText;

    // ãƒ’ãƒ¼ãƒ­ãƒ¼ï¼ˆä¸Šä½å› å­ç”»åƒï¼‰
    heroImg.src = heroPathFromRank(rank.id);
    heroImg.alt = ALT_BY_FACTOR[o.top] || "çµæœã‚¤ãƒ¡ãƒ¼ã‚¸";
    heroTitle.textContent = heroDef.title + "ï¼ˆ" + topDef.name + "ï¼‰";
    heroPoem.textContent  = heroDef.poem;
    heroCopy.textContent  = heroDef.copy;
    sizeBadgeEl.textContent = "ç·åˆ " + o.totalAvg.toFixed(2) + " / 4.00";
    rankBadgeEl.textContent = "ãƒ©ãƒ³ã‚¯ " + rank.id + "ãƒ»" + rank.label;
    

    // ç·åˆ
    sumAvg.textContent = o.totalAvg.toFixed(2);
    sumPct.textContent = "= " + o.totalPct + "%";
    sumNote.textContent = "ä¸Šä½å› å­ï¼š"+topDef.name + "ï¼ˆç¬¬2ä½ã¨ã®å·®ï¼š"+o.diff+"%ï¼‰";

    // å› å­ãƒãƒ¼
    var bHtml = "";
    Object.keys(FACTORS).forEach(function(key){
      var def = FACTORS[key];
      var avg = o.fScore[key], pct = o.fPct[key];
      bHtml += '<article class="bar" aria-label="'+def.name+'">'+
        '<div><strong>'+def.name+'</strong><span class="pill" style="margin-left:6px">'+avg.toFixed(2)+' / 4</span>'+
        '<span class="pill" style="margin-left:6px">'+pct+'%</span></div>'+
        '<div class="row" aria-hidden="true"><span style="width:'+pct+'%"></span></div>'+
      '</article>';
    });
    bars.innerHTML = bHtml;

    // é•·æ–‡ï¼ˆãƒ©ãƒ³ã‚¯ï¼‰
    longCopy.innerHTML =
      '<div class="note"><h4>'+rank.label+'ï¼ˆ'+rank.id+'ï¼‰</h4>'+
      '<p>'+rank.one+'</p><p>'+rank.long+'</p>'+
      '<p><em>ãƒ’ãƒ³ãƒˆï¼š</em>'+rank.hint+'</p></div>';

    // ç ”ç©¶ãƒ¡ãƒ¢
    resMemo.innerHTML = RESEARCH_MEMO.map(function(s){ return "<li>"+s+"</li>"; }).join("");

    // å…±æœ‰ãƒªãƒ³ã‚¯
    var shareText = 'ã€ãƒ™ã‚¹ãƒˆãƒ•ãƒ¬ãƒ³ãƒ‰åŠ›è¨ºæ–­ã€çµæœï¼š'+rank.label+'ï¼ˆ'+o.totalPct+'%ï¼‰ï½œä¸Šä½å› å­ï¼š'+topDef.name;
    var url = location.href.split('#')[0];

    var tw = 'https://twitter.com/intent/tweet?text=' + encodeURIComponent(shareText) + '&url=' + encodeURIComponent(url);
    shareTw.href = tw;

    var ln = 'https://line.me/R/msg/text/?' + encodeURIComponent(shareText + ' ' + url);
    shareLn.href = ln;

    shareIg.onclick = function(e){
      e.preventDefault();
      var caption = shareText + ' ' + url;
      copyToClipboard(caption).then(function(){
        var opened = false;
        try{ var w = window.open('instagram://app','_blank'); opened = !!w; }catch(_){}
        if(!opened){ window.open('https://www.instagram.com/','_blank'); }
        toast('ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸã€‚Instagramã§è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ã€‚');
      });
    };
    shareRow.hidden = false;

    // è¡¨ç¤ºåˆ‡æ›¿
    resEmpty.style.display = "none";
    resArea.style.display  = "block";
    document.getElementById("result").scrollIntoView({behavior:"smooth", block:"start"});

    try{
      document.dispatchEvent(new Event('result:ready'));
      localStorage.setItem("specimens:last", JSON.stringify({ id: SLUG, title: TITLE, href: location.pathname }));
    }catch(e){}
  }

  // å…±æœ‰ãƒ˜ãƒ«ãƒ‘ãƒ¼
  function copyToClipboard(text){
    if(navigator.clipboard && navigator.clipboard.writeText){
      return navigator.clipboard.writeText(text);
    }
    return new Promise(function(res){
      var ta=document.createElement('textarea'); ta.value=text;
      document.body.appendChild(ta); ta.select();
      try{ document.execCommand('copy'); }catch(_){}
      document.body.removeChild(ta); res();
    });
  }
  function toast(msg){
    var t=document.createElement('div');
    t.textContent=msg;
    t.style.position='fixed'; t.style.left='50%'; t.style.bottom='20px';
    t.style.transform='translateX(-50%)'; t.style.background='rgba(31,39,50,.92)';
    t.style.color='#fff'; t.style.padding='8px 12px'; t.style.borderRadius='10px';
    t.style.zIndex=9999; t.style.fontSize='13px';
    document.body.appendChild(t);
    setTimeout(function(){ t.remove(); },1500);
  }

  // ã‚¯ãƒªã‚¢
  function clearAnswers(){
    qWrap.querySelectorAll('input[type="radio"]').forEach(function(r){ r.checked=false; });
    wipeAnswers();
    prog.style.width = "0%";
    resEmpty.style.display = "";
    resArea.style.display = "none";
    var app = document.getElementById("app");
    if(app){ app.scrollIntoView({behavior:"smooth", block:"start"}); }
  }

  // ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿
  function setMode(m){
    CURRENT_MODE = m;
    try{ localStorage.setItem(MODE_KEY, m); }catch(e){}
    modeSelfBtn.classList.toggle("on", m==="self");
    modeFriendBtn.classList.toggle("on", m==="friend");
    modeSelfBtn.setAttribute("aria-selected", m==="self" ? "true":"false");
    modeFriendBtn.setAttribute("aria-selected", m==="friend" ? "true":"false");
    buildQuestions(); // æ–‡é¢ã ã‘å†ç”Ÿæˆã€å›ç­”ã¯å¾©å…ƒ
  }
  modeSelfBtn.addEventListener("click", function(){ setMode("self"); }, false);
  modeFriendBtn.addEventListener("click", function(){ setMode("friend"); }, false);

  // åˆæœŸåŒ–
  function init(){
    try{
      var savedMode = localStorage.getItem(MODE_KEY);
      if(savedMode === "friend") CURRENT_MODE = "friend";
    }catch(e){}
    buildQuestions();
    // ç ”ç©¶ãƒ¡ãƒ¢ï¼ˆåˆæœŸè¡¨ç¤ºç”¨ï¼‰
    resMemo.innerHTML = RESEARCH_MEMO.map(function(s){ return "<li>"+s+"</li>"; }).join("");
  }

  if(document.readyState === "loading"){
    document.addEventListener("DOMContentLoaded", init);
  }else{
    init();
  }
  document.getElementById("doScore").addEventListener("click", score, false);
  document.getElementById("doScore2").addEventListener("click", score, false);
  document.getElementById("clearAns").addEventListener("click", clearAnswers, false);

  var back = document.getElementById("backLink");
  if(back){
    back.addEventListener("click", function(){
      try{
        localStorage.setItem("specimens:last", JSON.stringify({ id: SLUG, title: TITLE, href: location.pathname }));
      }catch(e){}
    }, false);
  }
})();

</script>
<script>
/* ============================================================
   è¨ºæ–­ãƒšãƒ¼ã‚¸å…±é€šã‚¹ãƒ‹ãƒšãƒƒãƒˆï¼ˆã‚³ãƒ”ãƒšç”¨ï¼‰
   1) å›ç­”ã®è‡ªå‹•ä¿å­˜ãƒ»è‡ªå‹•å¾©å…ƒï¼ˆå…¥åŠ›ä¸­ã‚‚é€æ¬¡ä¿å­˜ï¼‰
   2) çµæœè¡¨ç¤ºã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ã€Œæ¸ˆã€ï¼‹ ã‚ãªãŸã®Lv +1
   3) ã¿ã‚“ãªã®ã“ã“ã‚Lvï¼ˆCountAPIï¼‰ã« +1ï¼ˆå¤±æ•—ã¯ç„¡è¦–ï¼‰
============================================================ */
(function(){
  'use strict';
  var DONE_KEY   = 'specimens:open:byid';
  var TOTAL_KEY  = 'specimens:open:total';
  var GLOBAL_LAST= 'specimens:open:global:last';
  var MY_ID = (document.body && document.body.getAttribute('data-id')) || 'unknown';

  // ã¿ã‚“ãªã®Lvï¼ˆCountAPIï¼‰
  var COUNTAPI_NS  = 'haisuikounozarigani_shindan';
  var COUNTAPI_KEY = 'specimens_open_total';
  function countapiHit(){
    var url = 'https://api.countapi.xyz/hit/'+COUNTAPI_NS+'/'+COUNTAPI_KEY;
    if(navigator.sendBeacon){ try{ navigator.sendBeacon(url); }catch(_){ } }
    else{ fetch(url, {mode:'cors', cache:'no-store', keepalive:true}).catch(function(){}); }
  }

  // å›ç­”ã®ä¿å­˜ç®±ï¼ˆã“ã®è¨ºæ–­ã ã‘ï¼‰
  var ANSWER_KEY = 'specimens:answers:' + MY_ID;
  function loadState(){ try{ return JSON.parse(localStorage.getItem(ANSWER_KEY) || '{}'); }catch(_){ return {}; } }
  function saveState(obj){ try{ localStorage.setItem(ANSWER_KEY, JSON.stringify(obj)); }catch(_){} }
  function saveField(el){
    if(!el || !el.name) return;
    var st = loadState(), nm = el.name;
    if(el.type==='radio'){
      var c = (el.form||document).querySelector('input[type="radio"][name="'+nm+'"]:checked');
      st[nm] = c ? {t:'r', v:c.value} : {t:'r', v:null};
    }else if(el.type==='checkbox'){
      var arr=[]; (el.form||document).querySelectorAll('input[type="checkbox"][name="'+nm+'"]').forEach(function(x){ if(x.checked) arr.push(x.value||'on'); });
      st[nm] = {t:'c', v:arr};
    }else if(el.tagName==='SELECT'){
      if(el.multiple){ var mv=[]; [].slice.call(el.options).forEach(function(o){ if(o.selected) mv.push(o.value); }); st[nm]={t:'m',v:mv}; }
      else{ st[nm]={t:'s',v:el.value}; }
    }else{
      st[nm]={t:'t',v:el.value};
    }
    saveState(st);
  }
  function restoreOnce(){
    var st = loadState(), names = Object.keys(st);
    if(!names.length) return false;
    names.forEach(function(nm){
      var info = st[nm]; if(!info) return;
      if(info.t==='r'){
        var r = document.querySelector('input[type="radio"][name="'+nm+'"][value="'+CSS.escape(String(info.v))+'"]');
        if(r){ r.checked = true; r.dispatchEvent(new Event('change',{bubbles:true})); }
      }else if(info.t==='c'){
        var set = new Set(info.v||[]); document.querySelectorAll('input[type="checkbox"][name="'+nm+'"]').forEach(function(c){ c.checked = set.has(c.value||'on'); });
      }else if(info.t==='m'){
        var sel = document.querySelector('select[name="'+nm+'"]'); if(sel){ var setm=new Set(info.v||[]); [].slice.call(sel.options).forEach(function(o){ o.selected=setm.has(o.value); }); }
      }else if(info.t==='s'){
        var s = document.querySelector('select[name="'+nm+'"]'); if(s){ s.value = info.v; }
      }else{
        var t = document.querySelector('[name="'+nm+'"]'); if(t){ t.value = info.v==null? '' : String(info.v); }
      }
    });
    try{ document.dispatchEvent(new Event('change',{bubbles:true})); }catch(_){}
    return true;
  }
  document.addEventListener('change', function(e){ var el=e.target; if(el && el.matches && el.matches('input[name], select[name], textarea[name]')) saveField(el); }, true);
  document.addEventListener('input',  function(e){ var el=e.target; if(el && el.matches && el.matches('input[type="text"][name], input:not([type])[name], textarea[name]')) saveField(el); }, true);
  (function(){ var TRY_MAX=12, n=0; function tick(){ n++; if(document.querySelector('input[name], select[name], textarea[name]')){ restoreOnce(); return; } if(n<TRY_MAX) setTimeout(tick,300); } if(/complete|interactive/.test(document.readyState)) tick(); else document.addEventListener('DOMContentLoaded', tick); })();

  // ã€Œæ¸ˆã€ï¼‹LvåŠ ç®—ï¼ˆçµæœæç”»ã®åˆå›³ã§ä¸€åº¦ã ã‘ï¼‰
  var marked=false;
  function markOnce(){
    if(marked) return; marked=true;
    try{
      var total=(+localStorage.getItem(TOTAL_KEY)||0)+1; localStorage.setItem(TOTAL_KEY,String(total));
      var map={}; try{ map=JSON.parse(localStorage.getItem(DONE_KEY)||'{}'); }catch(_){}
      map[MY_ID]=(map[MY_ID]||0)+1; localStorage.setItem(DONE_KEY, JSON.stringify(Object.assign({},map,{_ts:Date.now()})));
      countapiHit();
      try{ var last=(+localStorage.getItem(GLOBAL_LAST)||0)+1; localStorage.setItem(GLOBAL_LAST,String(last)); }catch(_){}
    }catch(_){}
  }
  document.addEventListener('result:ready', markOnce);
  setTimeout(markOnce, 2000); // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
})();
</script>
<script>
function heroPathFromRank(rankId){
  var n = (rankId==='R1'?1:rankId==='R2'?2:rankId==='R3'?3:rankId==='R4'?4:5);
  return "/shindan/assets/results/best-friend/" + "t" + String(n).padStart(2,"0") + ".webp";
}
</script>
</body>
</html>