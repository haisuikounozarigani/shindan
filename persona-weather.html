<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ãƒšãƒ«ã‚½ãƒŠå¤©æ°—äººæ ¼è¨ºæ–­</title>
<meta name="description" content="ç©ºæ¨¡æ§˜ï¼ˆæ™´ã‚Œ/é›·/é›ª/é¢¨ï¼‰ã¨12å…ƒå‹ã‹ã‚‰ã‚ãªãŸã®åƒãæ–¹ã®ã‚¯ã‚»ã‚’åˆ¤å®šã€‚å…¨20å•ãƒ»å¿…é ˆå›ç­”ãƒ»ã‚°ãƒ©ãƒ•å¯è¦–åŒ–ã€‚ã‚¨ãƒ³ã‚¿ãƒ¡ç”¨ã€‚">
<meta name="theme-color" content="#f6fbff">
<meta property="og:type" content="website">
<meta property="og:title" content="ãƒšãƒ«ã‚½ãƒŠå¤©æ°—äººæ ¼è¨ºæ–­">
<meta property="og:description" content="ç©ºæ¨¡æ§˜ï¼ˆæ™´ã‚Œ/é›·/é›ª/é¢¨ï¼‰ã¨12å…ƒå‹ã‹ã‚‰ã‚ãªãŸã®åƒãæ–¹ã®ã‚¯ã‚»ã‚’åˆ¤å®šã€‚å…¨20å•ãƒ»å¿…é ˆå›ç­”ãƒ»ã‚°ãƒ©ãƒ•å¯è¦–åŒ–ã€‚ã‚¨ãƒ³ã‚¿ãƒ¡ç”¨ã€‚">
<meta property="og:url" content="https://haisuikounozarigani.github.io/shindan/persona-weather.html">
<meta property="og:image" content="/shindan/assets/results/persona-archetype/01.png">
<script defer src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
:root{
  --bg1:#f6fbff;--bg2:#f7f6ff;--card:#fff;--line:#e9edf7;--fg:#1f2430;--muted:#667085;
  --accent:#4aa8ff;--accent2:#a48bff
}
*{box-sizing:border-box}html,body{height:100%}
body{margin:0;color:var(--fg);font-family:"Noto Sans JP",system-ui,-apple-system,"Segoe UI","Hiragino Kaku Gothic ProN",Meiryo,Roboto,sans-serif;background:linear-gradient(160deg,var(--bg1),var(--bg2))}
a{color:inherit}
.hidden{display:none!important}
.wrap{max-width:1040px;margin:18px auto 24px;padding:0 14px}
.header{display:grid;grid-template-columns:64px 1fr;gap:12px;align-items:center;margin:14px 0 6px}
.logo{width:64px;height:64px;border-radius:16px;background:linear-gradient(135deg,#d9efff,#e7dbff);display:grid;place-items:center;font-size:34px}
h1{margin:0;font-size:clamp(22px,4.5vw,34px)}
.sub{margin:2px 0 0;color:var(--muted);font-size:.95em}
.card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:14px;box-shadow:0 6px 18px rgba(74,168,255,.10)}
.section{margin:16px 0}
.qrow{padding:12px;border:1px solid var(--line);border-radius:12px;margin:12px 0;background:#fff}
.qrow .ttl{font-weight:700}
.opts{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:8px}
.opts label{display:block;padding:12px 14px;border:1px solid #e6ebff;border-radius:12px;background:#fff;cursor:pointer;line-height:1.6;font-size:15px}
.opts input{position:absolute;opacity:0}
.opts input:checked+span{outline:2px solid var(--accent);border-radius:10px;outline-offset:2px}
.badge{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:999px;background:linear-gradient(90deg,var(--accent),var(--accent2));color:#fff;font-weight:700}
.stickybar{position:sticky;top:0;z-index:30;margin:-6px -14px 10px;padding:8px 14px;background:#fff;border-bottom:1px solid #e8eefc;display:flex;align-items:center;gap:10px}
.progress{height:8px;background:#e8eefc;border-radius:999px;flex:1;overflow:hidden}
.progress>span{display:block;height:100%;width:0;background:linear-gradient(90deg,#bfe3ff,#a48bff)}
.btn{padding:10px 14px;border:1px solid var(--line);border-radius:12px;background:#fff;cursor:pointer}
.btn.primary{background:linear-gradient(90deg,var(--accent),var(--accent2));border-color:transparent;color:#fff;font-weight:700}
.cols{display:grid;grid-template-columns:1fr;gap:12px}

/* çµæœãƒ˜ãƒƒãƒ€å¼·åŒ–ï¼šç”»åƒå¤§ãã‚ */
.res-header{display:grid;grid-template-columns:minmax(260px,clamp(360px,56vw,640px)) 1fr;gap:16px;align-items:center}
.rank-large{}
.rank-large img{width:100%;height:auto;border-radius:18px;border:1px solid #e6ebff;background:#fff;object-fit:contain}

/* ã‚¿ã‚¤ãƒˆãƒ«ç­‰ */
.rank-large .title{font-size:clamp(22px,3.6vw,30px);font-weight:800;margin-bottom:6px}
.pills{display:flex;gap:8px;flex-wrap:wrap;color:#54607a}
.pill{padding:4px 8px;border:1px solid #e6ebff;border-radius:999px;background:#fff}

/* ã‚°ãƒ©ãƒ•ã¯æ¨ªå‘ãï¼‹å°ã•ã‚ */
.chartbox{padding:10px;border:1px dashed #dfe7ff;border-radius:12px}
.chartbox canvas{max-width:100%;height:120px!important}

.small{color:var(--muted);font-size:.92em}
.footer{color:var(--muted);font-size:.92em;margin-top:14px}
.backline{display:flex;justify-content:center;margin-top:12px}
.warn{background:#fff;border:1px dashed #d7d7e6;border-radius:12px;padding:12px;color:#503a46;font-size:13px}
.hl{box-shadow:0 0 0 3px rgba(255,127,147,.25)}
.more{margin-top:10px}
.more .lead{font-weight:700;margin:6px 0}
@media (max-width:720px){
  .opts{grid-template-columns:1fr}
}
/* ===== nohé¢¨ï¼šæ¨ªãƒ¡ãƒ¼ã‚¿ãƒ¼ ===== */
.factors{display:grid;gap:12px}
.meter{display:grid;gap:8px}
.meter .row{display:flex;align-items:center;justify-content:space-between;gap:8px}
.meter .row .name{font-weight:700}
.mbar{height:10px;border:1px solid #e5e9f3;border-radius:999px;overflow:hidden;background:#f7f8fc}
.mbar>span{display:block;height:100%;width:0;background:linear-gradient(90deg,var(--accent),var(--accent2))}
.pct{font-variant-numeric:tabular-nums;color:#4e4e6a}
</style>
</head>
<body data-id="persona-weather">
<main class="wrap" id="app">
  <header class="header">
    <div class="logo">ğŸŒ¦ï¸</div>
    <div>
      <h1>ãƒšãƒ«ã‚½ãƒŠå¤©æ°—äººæ ¼è¨ºæ–­</h1>
      <p class="sub">20å•ã§ã€Œç©ºæ¨¡æ§˜Ã—å…ƒå‹ã€ã‚’åˆ¤å®šã€‚çµæœã¯ã€ˆç©ºæ¨¡æ§˜ã®å…ƒå‹ã€‰ã¨æ¨ªå‘ãã®ãƒãƒ¼ã‚°ãƒ©ãƒ•ã§è¡¨ç¤ºã—ã¾ã™ã€‚</p>
    </div>
  </header>

  <div class="stickybar card" aria-live="polite">
    <span>ğŸ§­</span>
    <div class="progress" aria-label="å›ç­”é€²æ—"><span id="prog"></span></div>
    <span class="small" id="progText">0/20</span>
    <button class="btn primary" id="btn-score">çµæœã‚’è¦‹ã‚‹</button>
  </div>

  <div class="cols">
    <section class="card section">
      <h2>ç›´æ„Ÿã§é¸ã‚“ã§ãã ã•ã„</h2>
  
    </section>

    <!-- è¨­å•ï¼šã“ã“ã«ç”Ÿæˆ -->
    <section id="formArea" class="card section" aria-label="è¨­å•ã‚¨ãƒªã‚¢">
      <h2>è¨­å•ï¼ˆå…¨20å•ï¼å„4æŠï¼‰</h2>
      <div id="qContainer"></div>
      <div class="section" style="display:flex;gap:8px;flex-wrap:wrap">
        <button class="btn" id="btn-clear">å›ç­”ã‚’ã‚¯ãƒªã‚¢</button>
        <button class="btn primary" id="btn-score2">çµæœã‚’è¦‹ã‚‹</button>
        <a class="btn" href="/shindan/" id="btnBack" role="button">è¨ºæ–­ä¸€è¦§ã«æˆ»ã‚‹</a>
      </div>
    </section>

    <!-- çµæœ -->
    <section id="result" class="card section" aria-live="polite">
      <div id="resEmpty">
        <div class="badge">ã¾ã çµæœã¯ã‚ã‚Šã¾ã›ã‚“</div>
        <p class="small">ä¸Šã®è¨­å•ã«ã™ã¹ã¦å›ç­”ã™ã‚‹ã¨ã€ã“ã¡ã‚‰ã«çµæœãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</p>
      </div>

      <div id="resArea" class="hidden">
        <div class="res-header rank-large">
          <img id="heroImg" src="/shindan/assets/results/persona-archetype/01.png" alt="å…ƒå‹ã‚¤ãƒ©ã‚¹ãƒˆ" loading="lazy" onerror="this.alt='ç”»åƒã‚’è¡¨ç¤ºã§ãã¾ã›ã‚“';this.style.background='#eef2ff'">
          <div>
            <div class="title" id="titleText">â€”</div>
            <div class="small" id="weatherLine">â€”</div>
            <div class="pills" style="margin-top:8px">
              <span class="pill" id="pillWeather">ç©ºæ¨¡æ§˜ï¼šâ€”</span>
              <span class="pill" id="pillType">å…ƒå‹ï¼šâ€”</span>
            </div>
          </div>
        </div>

        <div class="more" id="moreText"></div>

        <div class="section chartbox">
          <h2 style="margin:0 0 8px;font-size:1.05rem">ã‚°ãƒ©ãƒ•</h2>
          <div class="small">ä¸Šï¼šç©ºæ¨¡æ§˜ã®å‚¾ãï¼ˆ4æœ¬ï¼‰ï¼ä¸‹ï¼šå…ƒå‹ã®ä¸Šä½3ï¼ˆ3æœ¬ï¼‰</div>
          <div style="display:grid;grid-template-columns:1fr;gap:12px;margin-top:8px">
            <div id="meterWeather" class="factors" aria-label="ç©ºæ¨¡æ§˜ï¼ˆï¼…ï¼‰"></div>
            <div id="meterTypes" class="factors" aria-label="å…ƒå‹ãƒˆãƒƒãƒ—3ï¼ˆï¼…ï¼‰"></div>
          </div>
        </div>

        <div class="backline">
          <a class="btn" id="back2" href="/shindan/" aria-label="è¨ºæ–­ä¸€è¦§ã«æˆ»ã‚‹">è¨ºæ–­ä¸€è¦§ã«æˆ»ã‚‹</a>
        </div>
      </div>
    </section>
  </div>

  <section class="footer card">
    <h2>ã”åˆ©ç”¨ã«ã‚ãŸã£ã¦</h2>
    <ul>
      <li><strong>ã‚¨ãƒ³ã‚¿ãƒ¡ç”¨é€”ï¼š</strong>è‡ªå·±ç†è§£ã®ãã£ã‹ã‘ä½œã‚Šã®ãŸã‚ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã§ã™ã€‚åŒ»ç™‚ãƒ»è¨ºæ–­ãƒ»æ²»ç™‚ãƒ»ã‚«ã‚¦ãƒ³ã‚»ãƒªãƒ³ã‚°ç­‰ã®ç›®çš„ã§ã¯åˆ©ç”¨ã§ãã¾ã›ã‚“ã€‚</li>
      <li><strong>ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ï¼š</strong>å›ç­”ã¯ç«¯æœ«å†…ã§<strong>å‡¦ç†ãƒ»ä¿å­˜</strong>ã•ã‚Œã€å›ç­”å†…å®¹ã‚„å€‹äººã‚’ç‰¹å®šã§ãã‚‹æƒ…å ±ã¯ã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡ã•ã‚Œã¾ã›ã‚“ã€‚çµæœè¡¨ç¤ºæ™‚ã«<strong>åŒ¿åã®ä»¶æ•°ã‚«ã‚¦ãƒ³ãƒˆã®ã¿</strong>é€ä¿¡ã™ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚</li>
      <li><strong>æœ€çµ‚åˆ¤æ–­ã¯ã”è‡ªèº«ã§ï¼š</strong>çµæœã®è§£é‡ˆãƒ»æ´»ç”¨ã¯ã”è‡ªèº«ã®è²¬ä»»ã§è¡Œã£ã¦ãã ã•ã„ã€‚æ¥­å‹™ä¸Šã®é‡è¦åˆ¤æ–­ã‚„é€²è·¯æ±ºå®šã®å”¯ä¸€ã®æ ¹æ‹ ã«ã¯ã—ãªã„ã§ãã ã•ã„ã€‚</li>
      <li><strong>è¡¨ç¾ã«ã¤ã„ã¦ï¼š</strong>å› å­åãƒ»æ¯”å–©ã¯æ¼”å‡ºè¡¨ç¾ã§ã™ã€‚å®—æ•™çš„ãƒ»å€«ç†çš„ä¾¡å€¤åˆ¤æ–­ã‚’æ„å›³ã—ã¾ã›ã‚“ã€‚</li>
    </ul>
  </section>
</main>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const STORAGE_KEY = "persona-weather:v1:answers";
  const IMG_BASE = "/shindan/assets/results/persona-archetype/";
  const WEATHER_NAME = { hare:"æ™´ã‚Œ", kaminari:"é›·", yuki:"é›ª", kaze:"é¢¨" };
  const WEATHER_FIXED = {
    hare:"æ™´ã‚Œï¼šå ´ã®é›°å›²æ°—ã‚„æ®µå–ã‚Šã‚’æ•´ãˆã¦ã€ã¿ã‚“ãªãŒå‹•ãã‚„ã™ã„çŠ¶æ…‹ã‚’ã¤ãã‚Šã‚„ã™ã„ã€‚",
    kaminari:"é›·ï¼šæ–¹å‘ã‚’ç¤ºã—ã¦æ±ºã‚ã‚‹ã®ãŒé€Ÿãã€è¿·ã„ã‚’å°ã•ãã—ã¦å‰ã«é€²ã‚ã‚„ã™ã„ã€‚",
    yuki:"é›ªï¼šç‰©äº‹ã®ç­‹é“ã‚„æ ¹æ‹ ã‚’æ•´ãˆã€ä»•çµ„ã¿ã§é€²ã‚ã‚‹ã®ãŒå¾—æ„ã€‚",
    kaze:"é¢¨ï¼šç©ºæ°—ã‚„æµã‚Œã‚’å¤‰ãˆã¦ã€å·»ãè¾¼ã¿ãªãŒã‚‰å‰å‘ããªé›°å›²æ°—ã‚’ä½œã‚‹ã€‚"
  };
  const WEATHER_PRIORITY = ["kaminari","yuki","kaze","hare"];

  // 12å…ƒå‹ï¼ˆ01=è‹±é›„, 02=è³¢è€…, 03=å‰µé€ è€…, 04=å®ˆè­·è€…, 05=çµ±ç‡è€…, 06=æ¢æ±‚è€…, 07=æ‹äºº, 08=é“åŒ–, 09=ç´”çœŸ, 10=éš£äºº, 11=åé€†è€…, 12=é­”è¡“å¸«ï¼‰
  const TYPES = {
    eiyu:{name:"è‹±é›„", idx:1,
      one:"å›°ã‚Šã”ã¨ãŒèµ·ããŸã¨ãã«å‰ã¸å‡ºã¦é“ã‚’ä½œã‚ã†ã¨ã—ã¾ã™ã€‚",
      good:"æ¨é€²åŠ›ãŒã‚ã‚Šã€äººã‚’å¼•ã£ã±ã‚‹åŠ›ãŒã‚ã‚‹",
      care:"æŠ±ãˆè¾¼ã¿ã™ãã‚‹ã¨ç–²ã‚Œã‚„ã™ã„",
      tip:"æœ€åˆã«ã€ã“ã“ã¾ã§ã€ã®ç·šå¼•ãã‚’æ±ºã‚ã¦ã‹ã‚‰å‹•ã",
      do:["ã‚´ãƒ¼ãƒ«ã‚’ä¸€è¡Œã§å®£è¨€","é›£æ‰€ã®â€œå…¥å£ä½œã‚Šâ€ã«é›†ä¸­","æœã„ã¡ã«ä»Šæ—¥ã®çªç ´å£ã‚’æ±ºã‚ã‚‹"],
      dont:["å…¨éƒ¨è‡ªåˆ†ã§èƒŒè² ã†","å‹¢ã„ã§å³æ–­ã—ã™ãã‚‹","ç· åˆ‡ç›´å‰ã®ä»•æ§˜è¿½åŠ "],
      comm:["çµè«–â†’ç†ç”±â†’ãŠé¡˜ã„ã®é †ã§çŸ­ãä¼ãˆã‚‹"]
    },
    kenja:{name:"è³¢è€…", idx:2,
      one:"æƒ…å ±ã‚’æ•´ãˆã€ç´å¾—ã§ãã‚‹é“ç­‹ã‚’ã¤ãã‚Šã¾ã™ã€‚",
      good:"æ•´ç†ãƒ»è¨€èªåŒ–ãƒ»åˆæ„å½¢æˆãŒå¾—æ„",
      care:"è€ƒãˆã™ãã§é…ã‚ŒãŒã¡",
      tip:"ã€å‰æã®ç¢ºèªâ†’æ¬¡ã®ä¸€æ­©ã€ã§å°ã•ãé€²ã‚ã‚‹",
      do:["å‰æ/ç›®çš„/åˆ¶ç´„ã‚’å…±æœ‰","ç”¨èªã‚’å®šç¾©ã—ã¦ã‚ºãƒ¬ã‚’æ¸›ã‚‰ã™","é¸æŠè‚¢ã¯æœ€å¤§3ã¤ã«æ•´ç†"],
      dont:["ä¿ç•™ã‚’å¢—ã‚„ã™ã ã‘ã®æ¤œè¨","å°‚é–€ç”¨èªã§æŠ¼ã—åˆ‡ã‚‹","æ ¹æ‹ ã®ãªã„æ–­å®š"],
      comm:["è¦ç‚¹3è¡Œã§å…±æœ‰ã—ã€å¤‰æ›´ã¯å±¥æ­´ã«æ®‹ã™"]
    },
    sozosha:{name:"å‰µé€ è€…", idx:3,
      one:"æ—¢å­˜ã®æ ã‚’çµ„ã¿æ›¿ãˆã€æ–°ã—ã„å½¢ã‚’ä½œã‚Šã¾ã™ã€‚",
      good:"è¨­è¨ˆãƒ»å†æ§‹æˆãƒ»è©¦ä½œãŒé€Ÿã„",
      care:"ä½œã‚Šè¾¼ã¿ã™ãã«æ³¨æ„",
      tip:"ã¾ãšâ€œé›‘ã§ã‚‚å‹•ãåŸå‹â€ã‚’ã²ã¨ã¤ä½œã‚‹",
      do:["æœ€å°å®Ÿè£…â†’ãƒ¬ãƒ“ãƒ¥ãƒ¼â†’æ”¹è‰¯","æ¨ã¦æ¡ˆã‚’å…ˆã«3ã¤å‡ºã™","åˆ¶ç´„ã‚’â€œç´ æâ€ã«ã—ã¦è¨­è¨ˆ"],
      dont:["ç„¡é™ã‚¹ã‚³ãƒ¼ãƒ—æ‹¡å¼µ","è¦ä»¶æœªç¢ºå®šã§ç€å·¥","ãƒ¬ãƒ“ãƒ¥ãƒ¼ãªã—ã®ä¸€æœ¬å‹è² "],
      comm:["å›³ã‚„è©¦ä½œå“ã‚’è¦‹ã›ãªãŒã‚‰è©±ã™"]
    },
    shugosha:{name:"å®ˆè­·è€…", idx:4,
      one:"äººã‚„è³‡æºã‚’å®ˆã‚Šã€å®‰å¿ƒã—ã¦åƒã‘ã‚‹åœŸå°ã‚’ä½œã‚Šã¾ã™ã€‚",
      good:"ã‚±ã‚¢ãƒ»ãƒªã‚¹ã‚¯å›é¿ãƒ»åŸºç›¤ã¥ãã‚Š",
      care:"æŠ±ãˆè¾¼ã¿ã‚„ã™ã„",
      tip:"â€œä»Šå®ˆã‚‹/å¾Œã§è©¦ã™â€ã‚’åˆ†ã‘ã¦å®‰å¿ƒã‚’ä½œã‚‹",
      do:["ãƒªã‚¹ã‚¯ã¨å‚™ãˆã‚’è¦‹ãˆã‚‹åŒ–","ä¼‘æ¯/äº¤ä»£è¦å“¡ã‚’å…ˆã«ç¢ºä¿","è½ã¡ç€ãå°ç·šã‚’ä½œã‚‹"],
      dont:["æˆ‘æ…¢ã§æŠ±ãˆè¾¼ã‚€","æ›–æ˜§ãªãŠé¡˜ã„ã®è‡ªå·±è§£é‡ˆ","ç·Šæ€¥ã¨é‡è¦ã®æ··åŒ"],
      comm:["äº‹å®Ÿâ†’å½±éŸ¿â†’å¯¾å‡¦â†’ãŠé¡˜ã„ã®é †ã§å…±æœ‰"]
    },
    tososha:{name:"çµ±ç‡è€…", idx:5, // â† ã“ã“ã¯ 'tososha' ã§ã¯ãªã 'tososha' ã«ãªã£ã¦ã„ãŸã®ã‚’å¾Œç¶šã¨åˆã‚ã›ã¦ä¿®æ­£
      one:"å…¨ä½“æœ€é©ã‚’è¦‹ã¦ã€å„ªå…ˆé †ä½ã‚’ã¤ã‘ã¦æ±ºã‚åˆ‡ã‚Šã¾ã™ã€‚",
      good:"æ„æ€æ±ºå®šã¨é…åˆ†ãŒé€Ÿã„",
      care:"æ—©æ±ºã—ã™ãã‚‹ã¨ç¾å ´ãŒç½®ã„ã¦ã„ã‹ã‚Œã‚‹",
      tip:"ã€ç›®çš„â†’å„ªå…ˆâ†’æ‹…å½“â†’æœŸé™ã€ã‚’1æšã«ã¾ã¨ã‚ã‚‹",
      do:["WBSã§é“ç­‹ã‚’è¦‹ãˆã‚‹åŒ–","é€²æ—/éšœå®³ã®çŸ­ã„æ£šå¸ã—","æ±ºã‚ã‚‹å ´ã¨è­°è«–ã®å ´ã‚’åˆ†ã‘ã‚‹"],
      dont:["Askãªã—ã®ãƒˆãƒƒãƒ—ãƒ€ã‚¦ãƒ³","æŒ‡ç¤ºã ã‘ã§ä¼´èµ°ãªã—","æŒ‡æ¨™ãªã—ã®æ ¹æ€§è«–"],
      comm:["â€œãªãœä»Šã“ã‚Œã‹â€ã‚’å…ˆã«èª¬æ˜ã™ã‚‹"]
    },
    tankyu:{name:"æ¢æ±‚è€…", idx:6,
      one:"å°ã•ãè©¦ã—ã€å­¦ã³ã‚’ç©ã¿é‡ã­ã‚‹å®Ÿé¨“ã‚¿ã‚¤ãƒ—ã§ã™ã€‚",
      good:"æ¤œè¨¼ãƒ»å­¦ç¿’ãƒ»æ”¹å–„ãƒ«ãƒ¼ãƒ—",
      care:"æ¤œè¨¼ãŒé•·å¼•ãã‚„ã™ã„",
      tip:"â€œä»®èª¬â†’è©¦ã™â†’å­¦ã¶â€ã®å‘¨æœŸã‚’çŸ­ãä¿ã¤",
      do:["å°å®Ÿé¨“â†’å­¦ã³ãƒ¡ãƒ¢â†’æ¬¡ã®ä»®èª¬","å¤±æ•—æ¡ä»¶ã‚‚å…ˆã«å®šç¾©","è©•ä¾¡è»¸ã¯ä¸€ã¤ã«çµã‚‹"],
      dont:["æ¤œè¨¼ã®ãŸã‚ã®æ¤œè¨¼","ç›®çš„ã®é »ç¹ãªå…¥æ›¿ãˆ","å­¦ã³ã®å…±æœ‰ãªã—"],
      comm:["çµæœã¯æ•°å­—ï¼‹ä¸€è¨€æ‰€æ„Ÿã§å…±æœ‰"]
    },
    koibito:{name:"æ‹äºº", idx:7,
      one:"é–¢ä¿‚ã‚’æ¸©ã‚ç›´ã—ã€ã‚„ã‚‹æ°—ãŒæˆ»ã‚‹ã‚ˆã†ä¼´èµ°ã—ã¾ã™ã€‚",
      good:"å…±æ„Ÿãƒ»é–¢ä¿‚èª¿æ•´ãƒ»é›°å›²æ°—ã¥ãã‚Š",
      care:"æƒ…ã«å‚¾ãã™ãã‚‹ã¨ç·šå¼•ããŒæ›–æ˜§ã«",
      tip:"ã€äººâ†’ç›®çš„â†’ã‚„ã‚Šæ–¹ã€ã®é †ã§è©±ã‚’æ•´ãˆã‚‹",
      do:["æ„Ÿæƒ…ã®è¦ç´„ã§å—ã‘æ­¢ã‚ã‚‹","å°ã•ãªæˆåŠŸä½“é¨“ã‚’ä½œã‚‹","æ„Ÿè¬ã®å¯è¦–åŒ–ã‚’ç¿’æ…£ã«"],
      dont:["å¯Ÿã—ã¦å¾…ã¡ç¶šã‘ã‚‹","é™ç•Œã¾ã§å¼•ãå—ã‘ã‚‹","å¢ƒç•Œç·šã®æ›–æ˜§åŒ–"],
      comm:["Iãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§ç‡ç›´ã«ä¼ãˆã‚‹"]
    },
    doka:{name:"é“åŒ–", idx:8,
      one:"ç©ºæ°—ã‚’ã‚„ã‚ã‚‰ã’ã€å†é–‹ã®ã‚¹ã‚¤ãƒƒãƒã‚’æŠ¼ã—ã¾ã™ã€‚",
      good:"å ´é¢è»¢æ›ãƒ»ãƒ ãƒ¼ãƒ‰ãƒ¡ãƒ¼ã‚«ãƒ¼",
      care:"è»½ã•ã ã‘ã§çµ‚ã‚ã‚‰ãªã„å·¥å¤«ãŒå¿…è¦",
      tip:"ç¬‘ã„â†’è¦ç‚¹1è¡Œâ†’æ¬¡ã®å‹•ã ã®ä¸‰æ®µæ§‹ãˆ",
      do:["ç·Šå¼µã‚’ã»ãã™ä»•æ›ã‘","ä¼‘æ†©ã‚„æŠ•ç¥¨ã§åˆ‡ã‚Šæ›¿ãˆ","é›£é¡Œã¯å°åˆ†ã‘ã«ã—ã¦å†é–‹"],
      dont:["æœ¬é¡ŒãŒæ›–æ˜§ãªã¾ã¾é€²è¡Œ","èŒ¶åŒ–ã—ã§çµ‚ã‚ã‚‹","å†—é•·ãªé›‘è«‡"],
      comm:["ãƒ¦ãƒ¼ãƒ¢ã‚¢ï¼‹è¦ç‚¹1è¡Œã§ç· ã‚ã‚‹"]
    },
    junshin:{name:"ç´”çœŸ", idx:9,
      one:"å®ˆã‚‹ã¹ãç·šã‚’è¦‹æ¥µã‚ã€ã¾ã£ã™ãé€²ã¿ã¾ã™ã€‚",
      good:"åŸç‚¹å›å¸°ãƒ»ç´”åº¦ã®ç¶­æŒ",
      care:"0/100ã§æ­¢ã¾ã‚Šã‚„ã™ã„",
      tip:"ã€ä»Šã„ã¡ã°ã‚“å¤§äº‹ãªä¸€æœ¬ç·šã¯ï¼Ÿã€ã‚’è¨€è‘‰ã«ã™ã‚‹",
      do:["åŸå‰‡/ä¾‹å¤–ã‚’å…ˆã«å®šç¾©","æœ€å°å®Œæˆ(MLP)ã‚’æ˜ç¢ºã«","å“è³ªã®å¢ƒç•Œç·šã‚’å¯è¦–åŒ–"],
      dont:["è«–ç‚¹ã‚ºãƒ¬ã®æ”¾ç½®","ç†æƒ³ã ã‘ã§æ±ºã‚ã‚‹"],
      comm:["â€œãªãœå¤§äº‹ã‹â€ã‚’çŸ­ãå…±æœ‰ã™ã‚‹"]
    },
    rinjin:{name:"éš£äºº", idx:10,
      one:"ç­‰èº«å¤§ã®è¨€è‘‰ã§æ©‹æ¸¡ã—ã—ã€åˆæ„ã‚’ç©ã¿ä¸Šã’ã¾ã™ã€‚",
      good:"é€šè¨³å½¹ãƒ»åˆæ„ã¥ãã‚Šãƒ»ä¼´èµ°",
      care:"æ¿æŒŸã¿ã§æ¶ˆè€—ã—ã‚„ã™ã„",
      tip:"å°ã•ãªåˆæ„ã‚’ç©ã¿é‡ã­ã¦å‰ã¸é€²ã‚€",
      do:["åŒæ–¹ã®è¨€è‘‰ã‚’è¦ç´„ã—ã¦è¿”ã™","åˆæ„ã®ç¨®(å°æ¡ä»¶)ã‚’ä½œã‚‹","æ¸©åº¦å·®ã®è¦‹å–ã‚Šå›³ã‚’ä½œã‚‹"],
      dont:["ä¸»èªã®å…¥æ›¿ãˆã§èª¤è§£ã‚’ç”Ÿã‚€","æ›–æ˜§ãªYESã§å…ˆé€ã‚Š"],
      comm:["YES/NO/ä¿ç•™ã‚’æ˜ç¢ºã«ã™ã‚‹"]
    },
    hangyakusha:{name:"åé€†è€…", idx:11,
      one:"ä¸å…¬å¹³ã‚„ä¸ä¾¿ã«å‘ãåˆã„ã€å¤‰åŒ–ã®å£ç«ã‚’åˆ‡ã‚Šã¾ã™ã€‚",
      good:"æ˜¯æ­£ãƒ»çªç ´ãƒ»å¤‰é©",
      care:"å¯¾ç«‹ã‚’ç”Ÿã¾ãªã„è¨€ã„å›ã—ãŒã‚«ã‚®",
      tip:"ä¸æº€â†’äº‹å®Ÿâ†’ä»£æ¡ˆâ†’åˆæ„ ã®é †ã§ä¼ãˆã‚‹",
      do:["å°ã•ãªå®Ÿè¨¼ã‚’å…ˆã«å‡ºã™","ç—›ç‚¹â†’åŠ¹æœâ†’ã‚³ã‚¹ãƒˆã§ææ¡ˆ","å‘³æ–¹ã®è¼ªã‚’å…ˆã«ä½œã‚‹"],
      dont:["äººæ ¼å¦å®š","æˆæœãªãå¯¾ç«‹","å‹¢ã„ä»»ã›ã®ç ´å£Š"],
      comm:["æ•¬æ„ã‚ã‚‹èªå°¾ã¨äº‹å®Ÿãƒ™ãƒ¼ã‚¹ã§è©±ã™"]
    },
    majutsushi:{name:"é­”è¡“å¸«", idx:12,
      one:"ä»•çµ„ã¿ã‚’ã¤ãªãæ›¿ãˆã€æµã‚Œè‡ªä½“ã‚’ä½œã‚Šå¤‰ãˆã¾ã™ã€‚",
      good:"å†è¨­è¨ˆãƒ»è‡ªå‹•åŒ–ãƒ»ãƒ¬ãƒãƒ¬ãƒƒã‚¸",
      care:"è¤‡é›‘åŒ–ã—ã™ãã«æ³¨æ„",
      tip:"â€œã‚„ã‚‰ãªã„/è‡ªå‹•/ã¾ã¨ã‚ã‚‹â€ã‚’å…ˆã«æ±ºã‚ã‚‹",
      do:["æ‰‹ä½œæ¥­â†’è‡ªå‹•åŒ–ã®åœ°å›³ã‚’ä½œã‚‹","æˆæœã‚’æ•°å€¤ã§ä¼ãˆã‚‹","å…¥å£ã¨å‡ºå£ã‚’ä¸€æœ¬åŒ–"],
      dont:["ãƒ–ãƒ©ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹åŒ–","æ©Ÿèƒ½éå¤šã®è¨­è¨ˆ","èª¬æ˜ãªã—ã®å¤§æ”¹ä¿®"],
      comm:["ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ã§è¦‹ã›ã¦çŸ­ãèª¬æ˜"]
    }
  };

  // çµ±ç‡è€…ã‚­ãƒ¼ã‚’ 'tososha' ã«çµ±ä¸€ï¼ˆè¡¨è¨˜ã‚†ã‚Œå¸åï¼‰
  const TYPE_PRIORITY = ["eiyu","kenja","sozosha","shugosha","tososha","tankyu","koibito","doka","junshin","rinjin","hangyakusha","majutsushi"];
  const normalizeTypeKey = (k) => {
    if(!k) return k;
    const s = k.replace(/\s+/g,"");
    return (s==="tososha" || s==="tososha") ? "tososha" : s;
  };

  // è¿½åŠ ã‚¹ãƒŠãƒƒãƒ—
  const SNAP = {
    eiyu:{ shine:"ç· åˆ‡å‰ã‚„ãƒˆãƒ©ãƒ–ãƒ«æ™‚ã»ã©ã‚¹ã‚¤ãƒƒãƒãŒå…¥ã‚Šã€æœ€åˆã®ä¸€æ­©ã‚’è‡ªåˆ†ãŒåˆ‡ã‚Šé–‹ãã¨å‘¨ã‚ŠãŒã¤ã„ã¦ãã¾ã™ã€‚",
           trap:"ä¸€äººã§æŠ±ãˆè¾¼ã‚€ã»ã©ãƒšãƒ¼ã‚¹ãŒä¹±ã‚ŒãŒã¡ã€‚åŠ©ã‘ã‚’é ¼ã‚€ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’æ—©ã‚ã‚‹ã»ã©æˆæœãŒå®‰å®šã—ã¾ã™ã€‚",
           seen:"ã€Œè¡Œããã€ã¨èƒŒä¸­ã‚’æŠ¼ã—ã¦ãã‚Œã‚‹äººã ã¨è¦‹ã‚‰ã‚Œã‚„ã™ã„ã€‚" },
    kenja:{ shine:"æƒ…å ±ãŒæ•£ã‚‰ã°ã£ã¦ã„ã‚‹ã»ã©åŠ›ã‚’ç™ºæ®ã€‚å‰æã¨è«–ç‚¹ã‚’æ•´ãˆã‚‹ã»ã©è­°è«–ãŒãªã‚ã‚‰ã‹ã«ãªã‚Šã¾ã™ã€‚",
            trap:"è€ƒãˆãŒæ·±ã¾ã‚‹ã»ã©ç€æ‰‹ãŒé…ã‚ŒãŒã¡ã€‚å°ã•ãè©¦ã™ã¨é€²ã¿ã‚„ã™ã„ã§ã™ã€‚",
            seen:"â€œè©±ã‚’çŸ­ãè¦ç‚¹ã«ã—ã¦ãã‚Œã‚‹äººâ€ã ã¨èªè­˜ã•ã‚Œã‚„ã™ã„ã€‚" },
    sozosha:{ shine:"ç™½ç´™ã‚„åˆ¶ç´„ãŒå¤šã„ã»ã©ãƒ¯ã‚¯ãƒ¯ã‚¯ã€‚è©¦ä½œå“ã‚’ç´ æ—©ãå‡ºã™ã»ã©å‘¨å›²ã®ç†è§£ãŒé€²ã¿ã¾ã™ã€‚",
              trap:"ä½œã‚Šè¾¼ã¿ã™ãã§æ™‚é–“ãŒæº¶ã‘ãŒã¡ã€‚ç· åˆ‡ã‚’å‘³æ–¹ã«â€œã¾ãšå‹•ãåŸå‹â€ãŒéµã€‚",
              seen:"ã€Œå½¢ã«ã—ã¦è¦‹ã›ã¦ãã‚Œã‚‹äººã€ã¨ã—ã¦é ¼ã‚‰ã‚Œã‚„ã™ã„ã€‚" },
    shugosha:{ shine:"æ··ä¹±ã—ãŸå ´ã§è½ã¡ç€ãã‚’å–ã‚Šæˆ»ã—ã€è¢«å®³ã‚’åºƒã’ãªã„å°ç·šã¥ãã‚ŠãŒå¾—æ„ã§ã™ã€‚",
               trap:"è‡ªåˆ†ã ã‘ã§å—ã‘æ­¢ã‚ã‚‹ã»ã©ç–²å¼Šã€‚å®ˆã‚‹ç·šã¨ä»»ã›ã‚‹ç·šã‚’åˆ†ã‘ã‚‹ã¨æ¥½ã«ãªã‚Šã¾ã™ã€‚",
               seen:"â€œå®‰å¿ƒã®åœŸå°ã‚’ä½œã£ã¦ãã‚Œã‚‹äººâ€ã¨è¦‹ã‚‰ã‚ŒãŒã¡ã€‚" },
    tososha:{ shine:"ã‚„ã‚‹ã“ã¨ãŒå¤šã„æ™‚ã»ã©å„ªå…ˆã‚’æ±ºã‚åˆ‡ã‚Šã€é…åˆ†ã—ã¦å‰ã«é€²ã‚ã¾ã™ã€‚",
              trap:"æ±ºã‚ãŒé€Ÿã™ãã‚‹ã¨ç¾å ´ã®ç´å¾—ãŒç½®ã„ã¦ã‘ã¼ã‚Šã«ã€‚ã²ã¨å£°ã®åˆæ„ã§å¤±é€Ÿã‚’é˜²ã’ã¾ã™ã€‚",
              seen:"â€œæ–¹å‘ã‚’æ±ºã‚ã¦ãã‚Œã‚‹äººâ€ã¨ã„ã†æœŸå¾…ã‚’é›†ã‚ã‚„ã™ã„ã€‚" },
    tankyu:{ shine:"ç­”ãˆãŒè¦‹ãˆãªã„æ¢ç´¢å±€é¢ã«å¼·ãã€å°ã•ãªæ¤œè¨¼ã§ç¢ºã‹ã•ã‚’ç©ã¿ä¸Šã’ã¾ã™ã€‚",
             trap:"æ¤œè¨¼ãŒé•·å¼•ããŒã¡ã€‚å‡ºå£æ¡ä»¶ã‚’å…ˆã«æ±ºã‚ã‚‹ã¨åŒºåˆ‡ã‚Œã¾ã™ã€‚",
             seen:"â€œã¾ãšè©¦ã—ã¦ãã‚Œã‚‹äººâ€ã¨ã—ã¦ä¿¡é ¼ã•ã‚Œã‚„ã™ã„ã€‚" },
    koibito:{ shine:"é–¢ä¿‚ãŒå†·ãˆãŸæ™‚ã«æ¸©åº¦ã‚’æˆ»ã—ã€ã‚„ã‚‹æ°—ã‚’ç¯ã—ç›´ã›ã¾ã™ã€‚",
              trap:"æƒ…ã«å‚¾ãã¨å¢ƒç•ŒãŒæ›–æ˜§ã«ã€‚é »åº¦ã¨æ™‚é–“ã®ç´„æŸãŒè‡ªåˆ†ã‚‚ç›¸æ‰‹ã‚‚å®ˆã‚Šã¾ã™ã€‚",
              seen:"â€œæ°—æŒã¡ã‚’ã‚ã‹ã£ã¦ãã‚Œã‚‹äººâ€ã¨ã„ã†å®‰å¿ƒæ„Ÿã‚’ä¸ãˆã¾ã™ã€‚" },
    doka:{ shine:"é‡ã„ç©ºæ°—ã‚’ã»ã©ã„ã¦å†é–‹ã®ã‚¹ã‚¤ãƒƒãƒã‚’æŠ¼ã™ã®ãŒä¸Šæ‰‹ã§ã™ã€‚",
           trap:"è»½ã•ã ã‘ã§çµ‚ã‚ã‚‹ã¨æœ¬é¡Œã«æˆ»ã‚Šã¥ã‚‰ã„ã€‚è¦ç‚¹1è¡Œã‚’æ·»ãˆã‚‹ã¨ç· ã¾ã‚Šã¾ã™ã€‚",
           seen:"â€œåˆ‡ã‚Šæ›¿ãˆä¸Šæ‰‹â€ã¨ã—ã¦å ´ã«é ¼ã‚‰ã‚Œã‚„ã™ã„ã€‚" },
    junshin:{ shine:"å¤§äº‹ãªç·šã‚’å®ˆã‚Šã€å“è³ªã‚„åŸå‰‡ã‚’ã¶ã‚‰ã•ãšã«é€²ã‚ã¾ã™ã€‚",
              trap:"0/100ã§æ­¢ã¾ã‚Šã‚„ã™ã„ã€‚æœ€å°å®Œæˆã‚’å…ˆã«æ±ºã‚ã‚‹ã¨å‹•ãå‡ºã›ã¾ã™ã€‚",
              seen:"â€œç­‹ã‚’é€šã™äººâ€ã¨ã—ã¦ä¿¡é ¼ã•ã‚ŒãŒã¡ã€‚" },
    rinjin:{ shine:"æ¸©åº¦å·®ã‚„è¨€è‘‰ã®ã‚ºãƒ¬ã‚’æ©‹æ¸¡ã—ã—ã€å°ã•ãªåˆæ„ã‚’ç©ã¿ä¸Šã’ã¾ã™ã€‚",
             trap:"æ¿æŒŸã¿ã§æ¶ˆè€—ã—ã‚„ã™ã„ã€‚ä¼‘ã‚€ä»•çµ„ã¿ã¨æ‹…å½“ã®ç·šå¼•ããŒå®ˆã‚Šã«ãªã‚Šã¾ã™ã€‚",
             seen:"â€œã¿ã‚“ãªã®é€šè¨³â€ã¨å‘¼ã°ã‚Œã‚„ã™ã„ã€‚" },
    hangyakusha:{ shine:"ä¸å…¬å¹³ã«å‘ãåˆã„ã€å¤‰åŒ–ã®å£ç«ã‚’åˆ‡ã‚Œã¾ã™ã€‚",
                  trap:"æ„Ÿæƒ…ã®ç‚ã ã‘ã ã¨å¯¾ç«‹ã«ã€‚äº‹å®Ÿâ†’ä»£æ¡ˆã®é †ã§ä¼ãˆã‚‹ã¨å‘³æ–¹ãŒå¢—ãˆã¾ã™ã€‚",
                  seen:"â€œè¨€ã„ã«ãã„ã“ã¨ã‚’è¨€ã£ã¦ãã‚Œã‚‹äººâ€ã¨ã„ã†æœŸå¾…ã‚’å—ã‘ã‚„ã™ã„ã€‚" },
    majutsushi:{ shine:"è¤‡é›‘ãªæµã‚Œã‚’ç¹‹ãæ›¿ãˆã€ä»•çµ„ã¿ã§ä¸€æ°—ã«æ¥½ã«ã—ã¾ã™ã€‚",
                 trap:"è¤‡é›‘åŒ–ã—ã™ãã«æ³¨æ„ã€‚ã¾ãšâ€œã‚„ã‚‰ãªã„/è‡ªå‹•/ã¾ã¨ã‚ã‚‹â€ã®ä¸€æ­©ã‹ã‚‰ã€‚",
                 seen:"â€œä»•çµ„ã¿ã§è§£æ±ºã—ã¦ãã‚Œã‚‹äººâ€ã¨ã—ã¦è©•ä¾¡ã•ã‚ŒãŒã¡ã€‚" }
  };

  // è¨­å•
  const Q_WEATHER = [ /* ï¼ˆã‚ãªãŸã®ç¾çŠ¶ã®è¨­å•é…åˆ—ã‚’ãã®ã¾ã¾ï¼‰ */ 
    { t:"ä¼šè­°ãŒé•·ããªã‚Šãã†ã€‚ã‚ãªãŸãªã‚‰ï¼Ÿ",
      a:["ã¿ã‚“ãªãŒè©±ã—ã‚„ã™ã„ã‚ˆã†ã«è¦ç‚¹ã‚’ä¸€ã¤ã«ã¾ã¨ã‚ã‚‹","çµ‚ã‚ã‚Šã®æ™‚é–“ã¨æ±ºã‚äº‹ã‚’ã¯ã£ãã‚Šè¨€ã£ã¦é€²ã‚ã‚‹","è©±é¡Œã‚’åˆ†ã‘ã¦ã€æ•´ç†ã—ç›´ã—ã¦ã‹ã‚‰ç¶šã‘ã‚‹","å°ä¼‘æ­¢ã‚„é€²ã‚æ–¹ãƒã‚§ãƒ³ã‚¸ã‚’ææ¡ˆã—ã¦æµã‚Œã‚’å¤‰ãˆã‚‹"],
      k:["hare","kaminari","yuki","kaze"] },
    { t:"åˆã‚ã¾ã—ã¦ã®å ´ãŒã¡ã‚‡ã£ã¨å›ºã„â€¦",
      a:["å…¨å“¡ãŒå®‰å¿ƒã§ãã‚‹è‡ªå·±ç´¹ä»‹ã®é †ç•ªã‚’ä½œã‚‹","ä»Šæ—¥ã®ç›®çš„ã¨ã‚´ãƒ¼ãƒ«ã‚’å…ˆã«ä¼ãˆã‚‹","ãƒ¡ãƒ³ãƒãƒ¼ã‚„èƒŒæ™¯ã‚’ã‚µãƒƒã¨æŠŠæ¡ã—ã¦è³ªå•ã—ã¦ã¿ã‚‹","è»½ã„å°ãƒã‚¿ã§ç©ºæ°—ã‚’ã‚†ã‚‹ã‚ã‚‹"],
      k:["hare","kaminari","yuki","kaze"] },
    { t:"èª°ã‹ã®ä½œæ¥­ãŒé…ã‚Œã¦ã„ã‚‹ã¨ã",
      a:["æ‰‹ãŒç©ºã„ã¦ã‚‹äººã¨çµ„ã¾ã›ã¦è² æ‹…ã‚’æ•´ãˆã‚‹","ç· åˆ‡ã¨å½¹å‰²ã‚’æ˜ç¢ºã«ã—ã¦å„ªå…ˆåº¦ã‚’ä¼ãˆã‚‹","è©°ã¾ã‚Šã®åŸå› ã‚’åˆ†ã‘ã¦ã€å…·ä½“æ‰‹é †ã«ç›´ã™","ã‚„ã‚Šæ–¹ã‚’å…¥ã‚Œæ›¿ãˆã‚‹ææ¡ˆã§æ°—åˆ†ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹"],
      k:["hare","kaminari","yuki","kaze"] },
    { t:"æ–°ã—ã„ä¼ç”»ã®åˆæ—¥ã€‚æ–¹é‡ã¯ã¾ã ãµã‚ã£ã¨â€¦",
      a:["åˆæ„äº‹é …ã¨å…±æœ‰ãƒ«ãƒ¼ãƒ«ã‚’å…ˆã«ã¤ãã‚‹","æ——ã‚’ç«‹ã¦ã¦ä»®ã®é€²è·¯ã§èµ°ã‚ŠãªãŒã‚‰æ•´ãˆã‚‹","æˆåŠŸæ¡ä»¶ã¨è©•ä¾¡ã®ã‚‚ã®ã•ã—ã‚’æ±ºã‚ã¦ã‹ã‚‰å‹•ã","è©¦ä½œå“ã‚„ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã§ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’åˆã‚ã›ã‚‹"],
      k:["hare","kaminari","yuki","kaze"] },
    { t:"ã‚¯ãƒ¬ãƒ¼ãƒ ãŒæ¥ãŸã¨ã",
      a:["ã¾ãšæ°—æŒã¡ã‚’è½ã¡ç€ã‘ã€é–¢ä¿‚ã‚’å¤§äº‹ã«å¯¾å¿œã™ã‚‹","äº‹å®Ÿç¢ºèªã¨å†ç™ºé˜²æ­¢ã®æ‹…å½“ã‚’æ±ºã‚ã‚‹","äº‹å®Ÿã¨æ¨æ¸¬ã‚’åˆ†ã‘ã¦åŸå› ã‚’ãŸã©ã‚‹","ä¼ãˆæ–¹ã¨é †ç•ªã‚’å·¥å¤«ã—ã¦ã‚ã‹ã‚Šã‚„ã™ãè©±ã™"],
      k:["hare","kaminari","yuki","kaze"] },
    { t:"å¤§äº‹ãªè³‡æ–™ãŒç›´å‰ã«å·®ã—æ›¿ãˆã‚‰ã‚ŒãŸï¼",
      a:["å½±éŸ¿ã‚’ç¢ºèªã—ã¦é–¢ä¿‚è€…ã¸ã™ãå…±æœ‰ã™ã‚‹","è¦ç‚¹ã ã‘ã§ä¹—ã‚Šåˆ‡ã‚‹æ–¹é‡ã‚’ãã®å ´ã§æ±ºã‚ã‚‹","å·®åˆ†ã‚’æ´—ã„å‡ºã—ã¦è¦æ—¨ã‚’ä½œã‚Šç›´ã™","è¦‹ã›æ–¹ã‚’åˆ‡ã‚Šæ›¿ãˆã¦ç†è§£ã®å–ã‚Šã“ã¼ã—ã‚’æ¸›ã‚‰ã™"],
      k:["hare","kaminari","yuki","kaze"] },
    { t:"é›‘è«‡ã§é€²è¡ŒãŒæ­¢ã¾ã‚ŠãŒã¡",
      a:["ã„ã£ãŸã‚“æ‹¾ã£ã¦ã‹ã‚‰ã‚„ã‚ã‚‰ã‹ãæœ¬ç­‹ã¸æˆ»ã™","ã€ã“ã“ã‹ã‚‰æœ¬é¡Œï¼ã€ã¨åŒºåˆ‡ã‚Šã‚’å®£è¨€ã™ã‚‹","ä»Šã®è­°é¡Œã«é–¢ä¿‚ã‚ã‚‹ç‚¹ã ã‘æ®‹ã™","è»½ã„ãƒ¯ãƒ¼ã‚¯ã‚„æŠ•ç¥¨ã§å†ã‚¹ã‚¿ãƒ¼ãƒˆã™ã‚‹"],
      k:["hare","kaminari","yuki","kaze"] },
    { t:"æœŸé™ã¨å“è³ªã€ã©ã£ã¡ã‚‚å¤§äº‹â€¦ã©ã†ã™ã‚‹ï¼Ÿ",
      a:["ã¿ã‚“ãªã®è¨±å®¹ãƒ©ã‚¤ãƒ³ã‚’åˆã‚ã›ã¦å¦¥å”ç‚¹ã‚’ä½œã‚‹","æœŸé™å„ªå…ˆã§å‡ºã—ã€è¶³ã‚Šãªã„æ‰€ã¯æ¬¡ã§å›åã™ã‚‹","å¿…é ˆã¨ä»»æ„ã‚’åˆ†ã‘ã¦æœ€å°å®Œæˆå½¢ã‚’æ±ºã‚ã‚‹","è¦‹ã›æ–¹ã§æœŸå¾…å€¤ã‚’èª¿æ•´ã—ã¦ãƒªãƒªãƒ¼ã‚¹ã™ã‚‹"],
      k:["hare","kaminari","yuki","kaze"] },
    { t:"ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ä¼šè­°ã§æ²ˆé»™ãŒç¶šãã¨ã",
      a:["å…¨å“¡ä¸€å·¡ã®ã²ã¨ã“ã¨ã‚¿ã‚¤ãƒ ã‚’ææ¡ˆã™ã‚‹","è‡ªåˆ†ã®çµè«–ã‚’å…ˆã«è¨€ã£ã¦æ„è¦‹ã‚’ã‚‚ã‚‰ã†","åˆ¤æ–­ææ–™ã‚’å…±æœ‰ã—ã¦ã‹ã‚‰è³ªå•ã™ã‚‹","ç”»åƒã‚„ä¾‹ã‚’å‡ºã—ã¦è©±ã—ã‚„ã™ã„ç©ºæ°—ã«å¤‰ãˆã‚‹"],
      k:["hare","kaminari","yuki","kaze"] },
    { t:"æ–°äººã•ã‚“ãŒæ¥ãŸï¼",
      a:["å—ã‘å…¥ã‚Œæº–å‚™ã¨ã‚µãƒãƒ¼ãƒˆå½¹ã‚’æ•´ãˆã‚‹","ç›®æ¨™ã¨å½¹å‰²ã‚’ã¯ã£ãã‚Šã•ã›ã¦æ—©ã‚ã«å®Ÿæˆ¦ã¸","å­¦ã³ã®ã‚¹ãƒ†ãƒƒãƒ—ã¨è©•ä¾¡ã®è¦‹å–ã‚Šå›³ã‚’ä½œã‚‹","ã¾ãšç¾å ´ä½“é¨“ã§å°ã•ãªæˆåŠŸã‚’ä¸€ç·’ã«ä½œã‚‹"],
      k:["hare","kaminari","yuki","kaze"] }
  ];

  const Q_TYPE = [
    { t:"å¾Œè¼©ãŒå¤§ããªãƒŸã‚¹â€¦ã¾ãšã©ã†å‹•ãï¼Ÿ",
      a:["è‡ªåˆ†ãŒå‰ã«å‡ºã¦ãƒ‘ãƒƒã¨ç«æ¶ˆã—ã«å‘ã‹ã†","ã¾ãšå®‰å…¨ã¨å¿ƒã‚’ã‚±ã‚¢ã—ã¦è½ã¡ç€ã‘ã‚‹","ä½•ãŒèµ·ããŸã‹ä¸€ç·’ã«æŒ¯ã‚Šè¿”ã£ã¦å­¦ã³ã«ã™ã‚‹","å¤±æ•—è«‡ã‚’å…±æœ‰ã—ã¦è‚©ã®åŠ›ã‚’ã¬ã„ã¦ã‚‚ã‚‰ã†"],
      k:["eiyu","shugosha","kenja","rinjin"] },
    { t:"æ–°ã—ã„å¸‚å ´ã«å…¥ã£ã¦ã¿ãŸã„",
      a:["å°ã•ãè©¦ã—ã¦ç¢ºã‹ã‚ãªãŒã‚‰é€²ã‚€","æ—¢å­˜ã‚’å£Šã—ã¦åˆ¥ã®é“ã‚’åˆ‡ã‚Šé–‹ã","ä»•çµ„ã¿ã‚’çµ„ã¿æ›¿ãˆã¦æµã‚Œã”ã¨å¤‰ãˆã‚‹","ä½“åˆ¶ã‚„å½¹å‰²ã‚’æ±ºã‚ã¦çµ„ç¹”çš„ã«å‹•ã"],
      k:["tankyu","hangyakusha","majutsushi","tososha"] },
    { t:"ä¼šè­°ãŒå ‚ã€…å·¡ã‚Šâ€¦",
      a:["æƒ…å ±ã‚’æ•´ãˆã¦è¦ç‚¹ã¨å‰æã‚’ã¯ã£ãã‚Šã•ã›ã‚‹","é€²è¡Œå½¹ã‚„æ›¸è¨˜ã‚’ç«‹ã¦ã¦åˆæ„ã®é“ç­‹ã‚’ä½œã‚‹","ã„ã£ãŸã‚“ç¬‘ã„ã§ç©ºæ°—ã‚’ã‚„ã‚ã‚‰ã’ã¦å†é–‹ã™ã‚‹","åˆ¥æ¡ˆã®ãŸãŸãå°ã‚’ãã®å ´ã§è¦‹ã›ã‚‹"],
      k:["kenja","rinjin","doka","sozosha"] },
    { t:"ãƒãƒ¼ãƒ ã®å…ƒæ°—ãŒè½ã¡ã¦ã„ã‚‹ã¨ã",
      a:["è‡ªåˆ†ãŒå…ˆé ­ã«ç«‹ã£ã¦å…ƒæ°—ã‚’ã¤ãã‚‹","ä¸€äººã²ã¨ã‚Šã®æ€ã„ã‚’è´ãé–¢ä¿‚ã‚’æ¸©ã‚ç›´ã™","å°ã•ãªé”æˆã‚’ä½œã£ã¦é›°å›²æ°—ã‚’è»½ãã™ã‚‹","åŸç‚¹ã‚„ç›®çš„ã‚’æ€ã„å‡ºã—ã¦æ•´ãˆã‚‹"],
      k:["eiyu","koibito","doka","junshin"] },
    { t:"ä¸å…¬å¹³ãªè©•ä¾¡ã‚’è¦‹ã‹ã‘ãŸã‚‰",
      a:["ç©ºæ°—ã‚ˆã‚Šæ­£ã—ã•ã€‚ã¯ã£ãã‚Šæ˜¯æ­£ã‚’æ±‚ã‚ã‚‹","æ ¹æ‹ ã¨åŸºæº–ã‚’ç¤ºã—ã¦æ­£ã™","å½“äº‹è€…ã®æ°—æŒã¡ã‚’æ‹¾ã„ç›´ã—ã¦å ´ã‚’æ•´ãˆã‚‹","è©•ä¾¡ã®ä»•çµ„ã¿è‡ªä½“ã‚’è¦‹ç›´ã™å ´ã‚’ã¤ãã‚‹"],
      k:["hangyakusha","kenja","rinjin","tososha"] },
    { t:"æœŸé™ã¨å“è³ªã®ã›ã‚ãåˆã„ï¼ˆå†ã³ï¼‰",
      a:["å…¨ä½“æœ€é©ã‚’è¦‹ã¦ã‚¹ãƒ‘ãƒƒã¨æ±ºã‚ã‚‹","æ—¢æˆæ¦‚å¿µã‚’å¤–ã—ã¦åˆ¥è§£ã‚’ã¤ãã‚‹","ã„ã¾å¿…è¦ãªç·šã ã‘ã‚’å®ˆã‚‹ç´”åº¦ã§é€²ã‚ã‚‹","äººã¨è³‡æºã‚’ç„¡ç†ã•ã›ãªã„é…æ…®ã‚’å„ªå…ˆ"],
      k:["tososha","sozosha","junshin","shugosha"] },
    { t:"å–å¼•å…ˆã‹ã‚‰ã¡ã‚‡ã£ã¨ç„¡èŒ¶ãªè¦æœ›",
      a:["è‡ªåˆ†ãŒçŸ¢é¢ã§ç¾å ´èª¿æ•´ã™ã‚‹","æ¡ä»¶ã‚’ç¹‹ãæ›¿ãˆã¦åŒæ–¹ãŒå¾—ã™ã‚‹å½¢ã«å¤‰ãˆã‚‹","è©¦ä½œã§å½“ãŸã‚Šã‚’å–ã‚Šç„¡ç†ãªç·šã‚’è¦‹æ¥µã‚ã‚‹","é–¢ä¿‚ã‚’å‚·ã‚ãªã„ææ¡ˆã«åˆ‡ã‚Šæ›¿ãˆã‚‹"],
      k:["eiyu","majutsushi","tankyu","koibito"] },
    { t:"æ–°ã‚µãƒ¼ãƒ“ã‚¹ã®ç«‹ã¡ä¸Šã’",
      a:["ã‚³ãƒ³ã‚»ãƒ—ãƒˆã¨åŸå‹ã‚’ã‚µãƒƒã¨å½¢ã«ã™ã‚‹","å°ã•ãæ¤œè¨¼ã‚’å›ã™å‰ç·šã‚’ã¤ãã‚‹","å½¹å‰²ã¨åˆ¤æ–­ç·šã‚’æ±ºã‚ã¦é€²è¡Œç®¡ç†ã™ã‚‹","ä»•çµ„ã¿å…¨ä½“ã‚’å†é…ç½®ã—ã¦å‹•ã‹ã™"],
      k:["sozosha","tankyu","tososha","majutsushi"] },
    { t:"ä»²é–“åŒå£«ãŒãƒ”ãƒªãƒ”ãƒªã—ã¦ã„ã‚‹",
      a:["å¯¾è©±ã®å ´ã‚’ä½œã£ã¦é–¢ä¿‚ã‚’æ¸©ã‚ç›´ã™","åŒæ–¹ã®æœ¬éŸ³ã‚’ç­‰èº«å¤§ã§æ©‹æ¸¡ã—ã™ã‚‹","ä¼‘ã¾ã›è¦‹å®ˆã‚Šã€è·é›¢ã‚’ã¨ã£ã¦å›å¾©ã‚’å¾…ã¤","ã„ã£ãŸã‚“ç¬‘ã„ã§ã»ãã—ã¦ã‹ã‚‰æœ¬é¡Œã¸æˆ»ã™"],
      k:["koibito","rinjin","shugosha","doka"] },
    { t:"ä¼šç¤¾ã®å¤ã„æ…£ç¿’ãŒå£ã«â€¦",
      a:["æ­£é¢ã‹ã‚‰åˆ‡ã‚Šè¾¼ã¿ã€å¤‰åŒ–ã®å£ç«ã‚’åˆ‡ã‚‹","ç½®ãæ›ãˆå¯èƒ½ãªæ§‹é€ ã«ä½œã‚Šç›´ã™","æ ¹æ‹ ã‚’ç¤ºã—ã€ç´å¾—ã®ç­‹é“ã§åˆæ„ã‚’å–ã‚‹","è‡ªåˆ†ãŒå‰ã«å‡ºã¦çªç ´å£ã‚’é–‹ã"],
      k:["hangyakusha","sozosha","kenja","eiyu"] }
  ];

  // DOM
  const qContainer = document.getElementById("qContainer");
  const prog = document.getElementById("prog");
  const progText = document.getElementById("progText");
  const resEmpty = document.getElementById("resEmpty");
  const resArea = document.getElementById("resArea");
  const heroImg = document.getElementById("heroImg");
  const titleText = document.getElementById("titleText");
  const weatherLine = document.getElementById("weatherLine");
  const pillWeather = document.getElementById("pillWeather");
  const pillType = document.getElementById("pillType");
  const moreText = document.getElementById("moreText");

  // è³ªå•ç”Ÿæˆ
  function buildQuestions(){
    let html = "";
    Q_WEATHER.forEach((q,i)=>{
      const qn = i+1;
      html += `
        <div class="qrow" data-group="weather">
          <div class="ttl">Q${qn}. ${q.t}</div>
          <div class="opts" role="radiogroup" aria-label="Q${qn}">
            ${q.a.map((t,idx)=>`
              <label>
                <input type="radio" name="Q${qn}" value="${q.k[idx]}"><span>${"ABCD".charAt(idx)}. ${t}</span>
              </label>`).join("")}
          </div>
        </div>`;
    });
    Q_TYPE.forEach((q,i)=>{
      const qn = 11+i;
      html += `
        <div class="qrow" data-group="type">
          <div class="ttl">Q${qn}. ${q.t}</div>
          <div class="opts" role="radiogroup" aria-label="Q${qn}">
            ${q.a.map((t,idx)=>`
              <label>
                <input type="radio" name="Q${qn}" value="${normalizeTypeKey(q.k[idx])}"><span>${"ABCD".charAt(idx)}. ${t}</span>
              </label>`).join("")}
          </div>
        </div>`;
    });
    qContainer.innerHTML = html;
    document.querySelectorAll('#qContainer input[type="radio"]').forEach(el=>{
      el.addEventListener('change', ()=>{ saveLocal(); updateProgress(); }, {passive:true});
    });
    updateProgress();
  }

  function updateProgress(){
    const total = 20;
    let answered = 0;
    for(let i=1;i<=20;i++){
      if(document.querySelector(`input[name="Q${i}"]:checked`)) answered++;
    }
    const pct = Math.round(100*answered/total);
    prog.style.width = pct + "%";
    progText.textContent = `${answered}/20`;
  }

  // å›ç­”èª­ã¿å–ã‚Š
  function readAnswers(){
    const missing = [];
    const weatherAns = [];
    const typeAns = [];
    for(let i=1;i<=10;i++){
      const el = document.querySelector(`input[name="Q${i}"]:checked`);
      if(!el) missing.push(i); else weatherAns.push(el.value);
    }
    for(let i=11;i<=20;i++){
      const el = document.querySelector(`input[name="Q${i}"]:checked`);
      if(!el) missing.push(i); else typeAns.push(normalizeTypeKey(el.value));
    }
    return { missing, weatherAns, typeAns };
  }
  function saveLocal(){
  try{
    const {weatherAns, typeAns} = readAnswers();
    localStorage.setItem(STORAGE_KEY, JSON.stringify({weatherAns, typeAns}));
  }catch{}
}

  // å‹è€…æ±ºå®š
  function resolveWinner(counts, lastIdxMap, priority){
    const entries = Object.entries(counts);
    const maxVal = Math.max(...entries.map(e=>e[1]));
    const cand = entries.filter(e=>e[1]===maxVal).map(e=>e[0]);
    if(cand.length===1) return cand[0];
    let best = null, bestLast=-1;
    cand.forEach(k=>{
      const li = lastIdxMap[k] ?? -1;
      if(li>bestLast){best=k;bestLast=li;}
    });
    const stillTie = cand.filter(k=> (lastIdxMap[k]??-1)===bestLast);
    if(stillTie.length===1) return stillTie[0];
    for(const p of priority){ if(stillTie.includes(p)) return p; }
    return cand[0];
  }

  // é›†è¨ˆ
  function tally(weatherAns, typeAns){
    const wCount = {hare:0,kaminari:0,yuki:0,kaze:0};
    const wLast  = {hare:-1,kaminari:-1,yuki:-1,kaze:-1};
    weatherAns.forEach((code, i)=>{ if(wCount[code]!=null){ wCount[code]++; wLast[code]=i+1; }});
    const weather = resolveWinner(wCount, wLast, WEATHER_PRIORITY);

    const tKeys = ["eiyu","kenja","sozosha","shugosha","tososha","tankyu","koibito","doka","junshin","rinjin","hangyakusha","majutsushi"];
    const tCount = Object.fromEntries(tKeys.map(k=>[k,0]));
    const tLast  = Object.fromEntries(tKeys.map(k=>[k,-1]));
    typeAns.forEach((code, i)=>{ if(tCount[code]!=null){ tCount[code]++; tLast[code]=10+i+1; }});
    const type = resolveWinner(tCount, tLast, TYPE_PRIORITY);

    const top3 = Object.entries(tCount)
      .sort((a,b)=> b[1]-a[1] || (tLast[b[0]]-tLast[a[0]]) || (TYPE_PRIORITY.indexOf(a[0]) - TYPE_PRIORITY.indexOf(b[0])) )
      .slice(0,3);

    return { weather, wCount, type, tCount, top3 };
  }

  // æ¨ªå‘ãã‚°ãƒ©ãƒ•
  let chartWeather=null, chartTop3=null;
  function renderMeters(r){
  // ç©ºæ¨¡æ§˜ï¼ˆ4æœ¬ / 10å• â†’ %ï¼‰
  const mw = document.getElementById('meterWeather');
  const wList = [
    {name:"æ™´ã‚Œ",   pct: Math.round(100 * r.wCount.hare / 10)},
    {name:"é›·",     pct: Math.round(100 * r.wCount.kaminari / 10)},
    {name:"é›ª",     pct: Math.round(100 * r.wCount.yuki / 10)},
    {name:"é¢¨",     pct: Math.round(100 * r.wCount.kaze / 10)}
  ];
  mw.innerHTML = wList.map((e,i)=>{
    const id = 'mw-'+i;
    return '<div class="meter" role="group" aria-label="'+e.name+'">'+
             '<div class="row"><div class="name">'+e.name+'</div><div class="pct" id="'+id+'-pct">'+e.pct+'%</div></div>'+
             '<div class="mbar" aria-hidden="true"><span id="'+id+'" style="width:'+e.pct+'%"></span></div>'+
           '</div>';
  }).join('');

  // å…ƒå‹ãƒˆãƒƒãƒ—3ï¼ˆ3æœ¬ / 10å• â†’ %ï¼‰
  const mt = document.getElementById('meterTypes');
  const tList = r.top3.map(([k,v])=>({ name:(TYPES[k]?TYPES[k].name:k), pct: Math.round(100*v/10) }));
  mt.innerHTML = tList.map((e,i)=>{
    const id = 'mt-'+i;
    return '<div class="meter" role="group" aria-label="'+e.name+'">'+
             '<div class="row"><div class="name">'+e.name+'</div><div class="pct" id="'+id+'-pct">'+e.pct+'%</div></div>'+
             '<div class="mbar" aria-hidden="true"><span id="'+id+'" style="width:'+e.pct+'%"></span></div>'+
           '</div>';
  }).join('');
}

  // çµæœã‚³ãƒ¡ãƒ³ãƒˆ
  function buildNarrative(r){
    const wName = WEATHER_NAME[r.weather];
    const wLine = WEATHER_FIXED[r.weather].replace(/^.*?ï¼š/,"").replace(/ã€‚$/,"");
    const mainKey = r.type;
    const t = TYPES[mainKey];
    const s = SNAP[mainKey] || {shine:"",trap:"",seen:""};
    const second = (r.top3 && r.top3[1] && r.top3[1][1] > 0) ? r.top3[1][0] : null;
    const t2 = second ? TYPES[second] : null;
    const tip  = t.tip || "";
    const use1 = (t.do && t.do[0]) ? t.do[0] : "";
    const dont1= (t.dont && t.dont[0]) ? t.dont[0] : "";
    const comm1= (t.comm && t.comm[0]) ? t.comm[0] : "";

    return `
      <p class="small"><strong>ã“ã®è¨ºæ–­ã§è¦‹ã¦ã„ã‚‹ã“ã¨ï¼š</strong>10å•ã®<strong>ç©ºæ¨¡æ§˜ï¼ˆå ´ã®æ•´ãˆæ–¹ï¼‰</strong>ã¨10å•ã®<strong>å…ƒå‹ï¼ˆå‹•ãæ–¹ã®å‹ï¼‰</strong>ã‹ã‚‰ã€ã„ã¾ã®ã‚ãªãŸã®<strong>ä»•äº‹ã®é€²ã‚æ–¹ã®ã‚¯ã‚»</strong>ã‚’èª­ã¿å–ã£ã¦ã„ã¾ã™ã€‚</p>
      <p><strong>ãƒšãƒ«ã‚½ãƒŠï¼ˆç©ºæ¨¡æ§˜ï¼‰ï¼š${wName}</strong> â€” ${wLine} ã¤ã¾ã‚Šã€å ´ã®å‹•ããŒé‡ããªã£ãŸæ™‚ã«ã€ã‚ãªãŸã¯${wName==="æ™´ã‚Œ"?"æ®µå–ã‚Šã‚„é›°å›²æ°—ã‚’æ•´ãˆã¦":"æµã‚Œã®å‘ãã‚’å¤‰ãˆãŸã‚Šåˆ¤æ–­ã‚’é€²ã‚ãŸã‚Š"}ã—ã¦ã€ã¿ã‚“ãªãŒå‹•ãã‚„ã™ã„çŠ¶æ…‹ã‚’ä½œã‚Šã‚„ã™ã„ã‚¿ã‚¤ãƒ—ã§ã™ã€‚</p>
      <p><strong>å…ƒå‹ï¼ˆå‹•ãæ–¹ï¼‰ï¼š${t.name}</strong> â€” ${t.one} ${s.shine}</p>
      <p><strong>æ™®æ®µã®å‚¾å‘ï¼ˆå¼·ã¿ã¨å¼±ã¿ï¼‰ï¼š</strong>${t.good}ã®ãŒå¤§ããªå¼·ã¿ã§ã™ã€‚åé¢ã€${t.care}ã¨ã“ã‚ãŒå¼±ã¿ã«å¤‰ã‚ã‚Šã‚„ã™ã„ã§ã™ã€‚${s.trap} ${s.seen}</p>
      ${t2 ? `<p><strong>ã‚µãƒ–å‚¾å‘ï¼š</strong>å›ç­”ã‹ã‚‰ã¯<strong>${t2.name}</strong>ã®è¦ç´ ã‚‚è¦‹ãˆã¾ã™ã€‚ä¸»è»¸ã®ã€Œ${t.name}ã€ã«ã€çŠ¶æ³ã«ã‚ˆã£ã¦ã€Œ${t2.name}ã€ã®å‡ºç•ªãŒæ··ã–ã‚‹ã“ã¨ã§ã€å¯¾å¿œã®å¹…ãŒåºƒãŒã‚Šã‚„ã™ã„ã‚¿ã‚¤ãƒ—ã§ã™ã€‚</p>` : ""}
      <p><strong>ä»Šæ—¥ã®å¯¾ç­–ï¼š</strong>${tip} ${use1 ? `ã¾ãšã¯ã€Œ${use1}ã€ã‹ã‚‰æ‰‹ã‚’ä»˜ã‘ã‚‹ã¨ã€è² æ‹…ã‚’å¢—ã‚„ã•ãšã«é€²ã‚ã‚‰ã‚Œã¾ã™ã€‚` : ""} ${dont1 ? `é€†ã«ã€Œ${dont1}ã€ã¯ä»Šæ—¥ã¯ã‚„ã‚‰ãªã„ã¨æ±ºã‚ã¦ãŠãã¨å®‰å¿ƒã§ã™ã€‚` : ""} ${comm1 ? `ã‚„ã‚Šå–ã‚Šã¯ã€Œ${comm1}ã€ã‚’æ„è­˜ã™ã‚‹ã¨ä¼ã‚ã‚Šã‚„ã™ããªã‚Šã¾ã™ã€‚` : ""}</p>
    `;
  }

  function showResult(r){
    const wName = WEATHER_NAME[r.weather];
    const tMeta = TYPES[r.type];
    const title = `${wName}ã®${tMeta.name}`;
    document.getElementById("titleText").textContent = title;
    document.getElementById("weatherLine").textContent = WEATHER_FIXED[r.weather];
    document.getElementById("pillWeather").textContent = `ç©ºæ¨¡æ§˜ï¼š${wName}`;
    document.getElementById("pillType").textContent = `å…ƒå‹ï¼š${tMeta.name}`;
    const nn = String(tMeta.idx).padStart(2,"0");
    const heroImg = document.getElementById("heroImg");
    heroImg.src = `${IMG_BASE}${nn}.png`;
    heroImg.alt = `${tMeta.name}ã®ã‚¤ãƒ©ã‚¹ãƒˆ`;

    document.getElementById("moreText").innerHTML = buildNarrative(r);
    renderMeters(r);

    document.getElementById("resEmpty").classList.add("hidden");
    document.getElementById("resArea").classList.remove("hidden");

    // ã¿ã‚“ãªã®ã“ã“ã‚Lvé€šçŸ¥ï¼†lastä¿å­˜
    try{
      document.dispatchEvent(new Event('result:ready'));
      localStorage.setItem('specimens:last', JSON.stringify({ id: 'persona-weather', title: 'ãƒšãƒ«ã‚½ãƒŠå¤©æ°—äººæ ¼è¨ºæ–­', href: location.pathname }));
    }catch{}

    try{
      const params = new URLSearchParams(); params.set("w", r.weather); params.set("t", r.type);
      history.replaceState(null,"", location.pathname+"?"+params.toString());
    }catch{}
  }

  // æ“ä½œ
  function compute(){
  const {missing, weatherAns, typeAns} = readAnswers();
    if(missing.length){
      alert(`æœªå›ç­”ãŒã‚ã‚Šã¾ã™ï¼ˆ${missing.slice(0,6).map(n=>"Q"+n).join(", ")}${missing.length>6?" ã»ã‹":""}ï¼‰ã€‚ã™ã¹ã¦ã®20å•ã«å›ç­”ã—ã¦ãã ã•ã„ã€‚`);
      const first = missing[0];
      const node = document.querySelector(`[name="Q${first}"]`)?.closest(".qrow");
      if(node){ node.scrollIntoView({behavior:"smooth", block:"center"}); node.classList.add("hl"); setTimeout(()=>node.classList.remove("hl"),1600); }
      return;
    }
    try{
      localStorage.setItem(STORAGE_KEY, JSON.stringify({weatherAns, typeAns}));
      localStorage.setItem('specimens:last', JSON.stringify({ id: 'persona-weather', title: 'ãƒšãƒ«ã‚½ãƒŠå¤©æ°—äººæ ¼è¨ºæ–­', href: location.pathname }));
    }catch{}
    const r = tally(weatherAns, typeAns);
    showResult(r);
    document.getElementById("result").scrollIntoView({behavior:"smooth", block:"start"});
  }

  function restore(){
    try{
      const raw = localStorage.getItem(STORAGE_KEY);
      if(!raw) return;
      const saved = JSON.parse(raw);
      (saved.weatherAns||[]).forEach((v,i)=>{
        const el = document.querySelector(`input[name="Q${i+1}"][value="${v}"]`); if(el) el.checked = true;
      });
      (saved.typeAns||[]).forEach((v,i)=>{
        const el = document.querySelector(`input[name="Q${11+i}"][value="${v}"]`); if(el) el.checked = true;
      });
      updateProgress();
    }catch{}
  }

  // åˆæœŸåŒ–
  buildQuestions();
  restore();
  document.getElementById("btn-score").addEventListener("click", compute);
  document.getElementById("btn-score2").addEventListener("click", compute);
  document.getElementById("btn-clear").addEventListener("click", ()=>{
    if(!confirm("ã™ã¹ã¦ã®å›ç­”ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã™ã‹ï¼Ÿ")) return;
    document.querySelectorAll('#qContainer input[type="radio"]').forEach(el=>el.checked=false);
    try{ localStorage.removeItem(STORAGE_KEY); }catch{}
    updateProgress();
    document.getElementById("resEmpty").classList.remove("hidden");
    document.getElementById("resArea").classList.add("hidden");
    document.getElementById("app").scrollIntoView({behavior:"smooth", block:"start"});
  });
  document.getElementById('btnBack').addEventListener('click', saveLast);
  document.getElementById('back2').addEventListener('click', saveLast);
  function saveLast(){
    try{
      const payload = { id: 'persona-weather', title: 'ãƒšãƒ«ã‚½ãƒŠå¤©æ°—äººæ ¼è¨ºæ–­', href: location.pathname };
      localStorage.setItem('specimens:last', JSON.stringify(payload));
    }catch(_e){}
  }
});

</script>
<!-- ã¿ã‚“ãªã®ã“ã“ã‚Lvï¼ˆresult:readyã§ã‚«ã‚¦ãƒ³ãƒˆï¼‰ -->
<script>
(function(){
  'use strict';
  var DONE_KEY='specimens:open:byid', TOTAL_KEY='specimens:open:total', GLOBAL_LAST='specimens:open:global:last';
  var MY_ID=(document.body&&document.body.getAttribute('data-id'))||'unknown';
  var COUNTAPI_NS='haisuikounozarigani_shindan', COUNTAPI_KEY='specimens_open_total';
  function hitEveryone(){
    var u='https://api.countapi.xyz/hit/'+COUNTAPI_NS+'/'+COUNTAPI_KEY;
    if(navigator.sendBeacon){ try{ navigator.sendBeacon(u); }catch(_){} }
    else{ fetch(u,{mode:'cors',cache:'no-store',keepalive:true}).catch(function(){}); }
  }
  var marked=false;
  function markOnce(){
    if(marked) return; marked=true;
    try{
      localStorage.setItem(TOTAL_KEY, String((+localStorage.getItem(TOTAL_KEY)||0)+1));
      var map={}; try{ map=JSON.parse(localStorage.getItem(DONE_KEY)||'{}'); }catch(_){}
      map[MY_ID]=(map[MY_ID]||0)+1;
      localStorage.setItem(DONE_KEY, JSON.stringify(Object.assign({},map,{_ts:Date.now()})));
      hitEveryone();
      try{ localStorage.setItem(GLOBAL_LAST, String((+localStorage.getItem(GLOBAL_LAST)||0)+1)); }catch(_){}
    }catch(_){}
  }
  document.addEventListener('result:ready', markOnce);
  setTimeout(markOnce, 2000);
})();
</script>
</body>
</html>