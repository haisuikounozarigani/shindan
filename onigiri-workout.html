<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ãŠã«ãã‚Šä½•å€‹ã¶ã‚“ï¼Ÿé‹å‹•è¨ºæ–­</title>
<meta name="description" content="12å•ã®4æŠã§å‚¾å‘ã‚’åˆ¤å®šã€‚ãŠã™ã™ã‚é‹å‹•ã¨æ¶ˆè²»ã‚«ãƒ­ãƒªãƒ¼ï¼ˆãŠã«ãã‚Šæ›ç®—ï¼‰ã‚’è¡¨ç¤ºã€‚">
<meta name="theme-color" content="#f7f9ff">
<style>
:root{
  --accent:#4f8cff; --accent2:#7ad0ff;
  --ink:#1f2732; --muted:#667087; --paper:#fff;
  --bg1:#f7f9ff; --bg2:#eef7ff; --line:#e6ecf7;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; color:var(--ink);
  background:linear-gradient(180deg,var(--bg1),var(--bg2));
  font-family:"Noto Sans JP",system-ui,-apple-system,"Segoe UI",Roboto,"Hiragino Kaku Gothic ProN",sans-serif;
}
a{color:inherit}
.wrap{max-width:980px;margin:18px auto;padding:0 14px}
header.hd{display:grid;grid-template-columns:56px 1fr;gap:12px;align-items:center;margin:8px 0}
.logo{width:56px;height:56px;border-radius:14px;background:linear-gradient(135deg,#eaf1ff,#fff);display:grid;place-items:center;font-size:28px}
h1{margin:0;font-size:clamp(22px,4.6vw,34px);letter-spacing:.02em}
.sub{margin:4px 0 0;color:var(--muted);font-size:.96em}
.card{background:var(--paper);border:1px solid var(--line);border-radius:16px;padding:14px}
.section{margin:14px 0}
.pill{display:inline-block;padding:4px 8px;border:1px solid var(--line);border-radius:999px;background:#fff;color:#6b6a77;font-size:.88em}
.meta{display:flex;gap:8px;flex-wrap:wrap}
.sticky{position:sticky;top:0;z-index:10;margin:-6px -14px 12px;padding:8px 14px;background:rgba(255,255,255,.86);backdrop-filter:blur(6px) saturate(1.05);border-bottom:1px solid #e9edf7;display:flex;align-items:center;gap:10px}
.progress{height:8px;background:#edf2fb;border-radius:999px;flex:1;overflow:hidden}
.progress>span{
  display:block;height:100%;width:0;
  background:linear-gradient(90deg,var(--accent),var(--accent2));
  transition:width .25s ease;
}
.btn{padding:10px 14px;border:1px solid var(--line);border-radius:12px;background:#fff;cursor:pointer}
.btn.primary{background:linear-gradient(90deg,var(--accent),var(--accent2));border-color:transparent;color:#fff;font-weight:700}

fieldset.q{border:1px solid var(--line);border-radius:12px;padding:10px;margin:10px 0;background:#fff}
legend{font-weight:700}
.choices{display:grid;grid-template-columns:repeat(2,minmax(120px,1fr));gap:8px;margin-top:8px}
.choices input{position:absolute;opacity:0;pointer-events:none}
.choices label{display:grid;gap:2px;padding:10px;border:1px solid #e5e9f3;border-radius:10px;background:#fff;cursor:pointer;user-select:none}
.choices small{color:#667087}
.choices input:checked+label{outline:2px solid var(--accent);border-color:transparent}
mark.need{animation:need 1.4s ease}
@keyframes need{0%{box-shadow:0 0 0 0 rgba(79,140,255,.45)}100%{box-shadow:0 0 0 0 rgba(79,140,255,0)}}

.result-head{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
.badge{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;background:linear-gradient(90deg,var(--accent),var(--accent2));color:#fff;font-weight:700}
.total{font-size:22px;font-weight:800}
.small{color:var(--muted);font-size:.92em}

/* ãƒ’ãƒ¼ãƒ­ãƒ¼ï¼šæ­£æ–¹å½¢webp */
.hero-vert{display:grid;place-items:center;border:1px solid var(--line);border-radius:16px;background:#fff;overflow:hidden}
.hero-vert figure{margin:0;width:min(720px,100%);max-width:100%;aspect-ratio:1/1;border-bottom:1px solid var(--line);background:#f7f9ff}
.hero-vert img{width:100%;height:100%;object-fit:cover;display:block}
.hero-vert figcaption{padding:10px;width:100%}
.hero-vert .capline{font-weight:800;line-height:1.55;overflow-wrap:anywhere;word-break:break-word;white-space:normal}
.hero-vert .capmini{font-size:1em;line-height:1.85;color:var(--muted);overflow-wrap:anywhere;word-break:break-word;white-space:normal}

.grid2{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:12px}
.stat{border:1px solid var(--line);border-radius:12px;padding:10px;background:#fff}
.stat .big{font-size:22px;font-weight:800}
.hr{height:1px;background:var(--line);margin:10px 0}

.bars4{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:10px}
.bar{border:1px solid var(--line);border-radius:12px;padding:10px;background:#fff}
.bar .row{height:10px;background:#edf2fb;border-radius:999px;overflow:hidden;margin-top:6px}
.bar .row>span{display:block;height:100%;width:0;background:linear-gradient(90deg,var(--accent),var(--accent2))}

.note{border:1px solid var(--line);border-radius:12px;background:#fff;padding:10px}
.note h4{margin:0 0 6px;font-size:16px}

.rec-list{display:grid;grid-template-columns:1fr;gap:10px}
.rec{border:1px solid var(--line);border-radius:12px;padding:10px;background:#fff}
.rec .ttl{font-weight:800}
.rec .meta{gap:6px}
.rec ul{margin:6px 0 0 18px}

.share-row{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
.btn.tw::before{content:"ğ•";margin-right:.25em}
.btn.line::before{content:"ğŸ’¬";margin-right:.25em}
.btn.ig::before{content:"ğŸ“¸";margin-right:.25em}
.btn.save::before{content:"â¬‡ï¸";margin-right:.25em}

.back-area{display:flex;justify-content:center;margin-top:12px}
.back{display:inline-block;padding:10px 16px;border:1px solid var(--line);border-radius:12px;background:#fff;text-decoration:none}

@media (max-width:560px){
  .wrap{padding:0 10px}
  .sticky{top:calc(env(safe-area-inset-top) + 0px); padding:8px 10px}
  .card{padding:12px}
  .choices{grid-template-columns:1fr}
}
#shareRow{display:flex !important; flex-wrap:wrap; gap:8px}
</style>
</head>
<body data-id="onigiri-workout">
<main class="wrap" id="app">
  <header class="hd">
    <div class="logo">ğŸ™</div>
    <div>
      <h1>ãŠã«ãã‚Šä½•å€‹ã¶ã‚“ï¼Ÿé‹å‹•è¨ºæ–­</h1>
      <p class="sub">12å•ã®4æŠã§åˆ¤å®šã€‚ãŠã™ã™ã‚é‹å‹•ã¨â€œãŠã«ãã‚Šæ›ç®—â€ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚</p>
    </div>
  </header>

  <div class="sticky" aria-live="polite">
    <div class="progress" aria-label="å›ç­”é€²æ—" role="progressbar" aria-valuemin="0" aria-valuemax="12">
      <span id="prog"></span>
    </div>
    <button class="btn primary" id="doScore">è¨ºæ–­ã™ã‚‹</button>
  </div>

  <section class="card section" id="desc">
    <h2 style="margin:4px 0 8px">èª¬æ˜</h2>
    <div class="meta" style="margin-bottom:8px">
      <span class="pill">è³ªå•æ•°ï¼š12</span>
      <span class="pill">å½¢å¼ï¼š4æŠï¼ˆRL/SO/FC/BOï¼‰</span>
      <span class="pill">å‡ºåŠ›ï¼šä¸Šä½ãƒšã‚¢ or å˜ç‹¬ï¼‹ãŠã™ã™ã‚TOP3</span>
    </div>
    <p class="small">ã‚«ãƒ­ãƒªãƒ¼ã¯ç›®å®‰ã§ã™ï¼ˆä½“é‡60kgãƒ»20/30åˆ†æ›ç®—ã€1å€‹=ç´„180kcalï¼‰ã€‚ã‚¨ãƒ³ã‚¿ãƒ¡è‡ªå·±ç†è§£ï¼å› æœã¯æ–­å®šã—ã¾ã›ã‚“ã€‚</p>
  </section>

  <!-- è¨­å• -->
  <section class="card section" id="questions">
    <h2 style="margin:4px 0 8px">è¨­å•ï¼ˆç›´æ„Ÿã§ä¸€ç•ªè¿‘ã„ã‚‚ã®ã‚’ï¼‰</h2>
    <div id="qWrap"></div>
    <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:10px">
      <button class="btn" id="clearAns">å›ç­”ã‚’ã‚¯ãƒªã‚¢</button>
      <button class="btn primary" id="doScore2">è¨ºæ–­ã™ã‚‹</button>
    </div>
  </section>

  <!-- çµæœ -->
  <section class="card section" id="result" aria-live="polite">
    <div id="resEmpty">
      <span class="badge">ã¾ã çµæœã¯ã‚ã‚Šã¾ã›ã‚“</span>
      <p class="small">å…¨12å•ã«å›ç­”ã—ã¦ã€Œè¨ºæ–­ã™ã‚‹ã€ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚</p>
    </div>

    <div id="resArea" style="display:none">
      <div class="result-head">
        <span class="badge">çµæœ</span>
        <div class="total" id="typeLine">â€”</div>
      </div>

      <!-- ç”»åƒï¼ˆæ­£æ–¹å½¢webpï¼‰ï¼‹â€œé‹å‹•åã‚³ãƒ¡ãƒ³ãƒˆâ€ -->
      <div class="hero-vert section" role="region" aria-label="ã‚¿ã‚¤ãƒ—ã‚¤ãƒ¡ãƒ¼ã‚¸">
        <figure>
          <img id="heroImg" src="/shindan/assets/results/onigiri-workout/t01.webp" alt="çµæœã‚¤ãƒ¡ãƒ¼ã‚¸" loading="lazy" width="1080" height="1080">
        </figure>
        <figcaption>
          <div class="capline" id="heroTitle">â€”</div>
          <!-- â†ã“ã“ã«ã€ŒãŠã™ã™ã‚é‹å‹•ï¼ˆ3ã¤ï¼‰ã€ã‚’ä¸€è¡Œè¡¨ç¤º -->
          <div class="capmini" id="heroCopy">â€”</div>

          <div class="share-row" id="shareRow" hidden>
            <button id="btnShot"  class="btn save" type="button">çµæœç”»åƒã‚’ä¿å­˜</button>
            <button id="shareTw"  class="btn tw"   type="button">Xã§å…±æœ‰</button>
            <button id="shareLn"  class="btn line" type="button">LINEã§é€ã‚‹</button>
            <button id="shareIg"  class="btn ig"   type="button" aria-label="Instagramï¼ˆWebï¼‰">Instagram</button>
            <button id="shareCp"  class="btn"      type="button">ãƒªãƒ³ã‚¯ã‚’ã‚³ãƒ”ãƒ¼</button>
          </div>
          <canvas id="shotCanvas" width="1080" height="1350" style="display:none"></canvas>
        </figcaption>
      </div>

      <div class="grid2">
        <article class="stat" aria-label="ç·åˆã‚µãƒãƒª">
          <div><strong>ä¸Šä½å› å­</strong></div>
          <div class="big" id="topKeys">â€”</div>
          <div class="small" id="sumNote">ãŠã«ãã‚Šæ›ç®—ã¯60kgã§è¨ˆç®—ï¼ˆ20/30åˆ†ï¼‰</div>
        </article>
      </div>

      <div class="hr"></div>
      <div class="section">
        <h3 style="margin:8px 0">4å› å­ï¼ˆï¼…ï¼‰</h3>
        <div id="bars" class="bars4"></div>
      </div>

      <div class="hr"></div>
      <!-- ç”»åƒä¸‹ã‚³ãƒ¡ãƒ³ãƒˆã®â€œæ¬¡ã«â€ã‚„ã‚Šæ–¹ãªã©è©³ç´° -->
      <div class="section">
        <h3 style="margin:8px 0">ãŠã™ã™ã‚TOP3ï¼ˆå™¨å…·ãªã—ï¼‰</h3>
        <div class="rec-list" id="recList"></div>
      </div>

      <div class="hr"></div>
      <details class="section" open>
        <summary><strong>ç ”ç©¶ãƒ¡ãƒ¢</strong></summary>
        <ul class="small" id="resMemo" style="margin:6px 0 0 18px;line-height:1.8"></ul>
        <p class="small" style="margin-top:6px">â€»å€‹äººå·®ãŒå¤§ããã€è¡¨ç¤ºã¯ç›®å®‰ã§ã™ã€‚ç„¡ç†ãªãå®‰å…¨ç¬¬ä¸€ã§ã€‚</p>
      </details>

      <div class="back-area">
        <a class="back" href="/shindan/" id="backLink" aria-label="è¨ºæ–­ä¸€è¦§ã«æˆ»ã‚‹">è¨ºæ–­ä¸€è¦§ã«æˆ»ã‚‹</a>
      </div>
    </div>
  </section>

  <section class="footer card">
    <h2 style="margin:4px 0 8px">ã”åˆ©ç”¨ã«ã‚ãŸã£ã¦</h2>
    <p class="small">ç—›ã¿ãƒ»ã‚ã¾ã„ãƒ»æ¯è‹¦ã—ã•ãŒå‡ºãŸã‚‰<strong>ä¸­æ­¢</strong>ã€‚æ°´åˆ†ãƒ»æº–å‚™é‹å‹•ãƒ»å®‰å…¨ãªç’°å¢ƒã‚’ç¢ºä¿ã—ã¦ãã ã•ã„ã€‚è¡¨ç¤ºkcalã¯ç›®å®‰ã§ã™ã€‚</p>
  </section>
</main>

<script>
(function(){
  // ====== ãƒšãƒ¼ã‚¸æƒ…å ± ======
  var SLUG = "onigiri-workout";
  var TITLE = "ãŠã«ãã‚Šä½•å€‹ã¶ã‚“ï¼Ÿé‹å‹•è¨ºæ–­";
  var ANS_KEY = "specimens:"+SLUG+":answers";

  // ====== å› å­ãƒ»è¨­å• ======
  var FACTORS = {
    RL:{ name:"ç™ºæ•£ã—ãŸã„ï¼ˆReleaseï¼‰",   key:"RL" },
    SO:{ name:"æ•´ãˆãŸã„ï¼ˆSootheï¼‰",      key:"SO" },
    FC:{ name:"é›†ä¸­ã—ãŸã„ï¼ˆFocusï¼‰",     key:"FC" },
    BO:{ name:"ãƒã£ã¦å‹•ããŸã„ï¼ˆBounceï¼‰",key:"BO" }
  };

  // è¨­å•12ï¼ˆå„4æŠï¼šA=RL, B=SO, C=FC, D=BOï¼‰
  var QUESTIONS = [
    "ä»Šã®æ°—åˆ†ã«ã„ã¡ã°ã‚“è¿‘ã„ã®ã¯ï¼Ÿ","ä»•äº‹/å‹‰å¼·ã‚ã¨ã®ä¸€ç™ºç›®ãªã‚‰ï¼Ÿ","é›¨ã®æ—¥ã®å®¤å†…ã§ã‚„ã‚‹ãªã‚‰ï¼Ÿ",
    "ä¼‘æ—¥ã®åˆå‰ã€ä½“ã‚’å‹•ã‹ã™ãªã‚‰ï¼Ÿ","5ã€œ10åˆ†ã ã‘ç©ºã„ãŸã‚‰ï¼Ÿ","ã‚‚ã‚„ã‚‚ã‚„ã‚’æ™´ã‚‰ã—ãŸã„ã¨ãã¯ï¼Ÿ",
    "é ­ãŒãƒ‘ãƒ³ãƒ‘ãƒ³ã®ã¨ãã¯ï¼Ÿ","ä½“ãŒé‡ã„/ã ã‚‹ã„æ—¥ã®ä¸€æ­©ç›®ã¯ï¼Ÿ","éŸ³æ¥½ãŒæµã‚Œã¦ã„ã‚‹ãªã‚‰ï¼Ÿ",
    "å±‹å¤–OKã®æ—¥ã®ãƒãƒ§ã‚¤ã‚¹ã¯ï¼Ÿ","ä»Šæ—¥ã®ä¸»ç›®çš„ã¯ã©ã‚Œï¼Ÿ","ç›´æ„Ÿã§æƒ¹ã‹ã‚Œã‚‹ã®ã¯ï¼Ÿ"
  ];

  var CHOICES = [
    { key:"RL", label:"ç™ºæ•£ã—ãŸã„", sub:"æ±—ã‹ã„ã¦ã‚¹ãƒƒã‚­ãƒª" },
    { key:"SO", label:"æ•´ãˆãŸã„",   sub:"ã‚„ã•ã—ããƒªã‚»ãƒƒãƒˆ" },
    { key:"FC", label:"é›†ä¸­ã—ãŸã„", sub:"é™ã‹ã«æ²¡å…¥ã—ãŸã„" },
    { key:"BO", label:"ãƒã£ã¦å‹•ããŸã„", sub:"éŸ³ã«ä¹—ã£ã¦æ¥½ã—ã" }
  ];

  // ====== ç”»åƒï¼ˆwebp / t01ã€œt06ï¼‰ ======
  var IMG_BASE = "/shindan/assets/results/onigiri-workout/";
  var PAIR_IMG = { "RL+BO":"t01.webp","RL+FC":"t02.webp","RL+SO":"t03.webp","FC+SO":"t04.webp","FC+BO":"t05.webp","BO+SO":"t06.webp" };
  var SOLO_IMG = { "RL":"t01.webp","SO":"t03.webp","FC":"t04.webp","BO":"t06.webp" };
  var PAIR_NAME = {
    "RL+BO":"ç™ºæ•£ Ã— ãƒãƒª","RL+FC":"ç™ºæ•£ Ã— é›†ä¸­","RL+SO":"ç™ºæ•£ Ã— æ•´ãˆ",
    "FC+SO":"é›†ä¸­ Ã— æ•´ãˆ","FC+BO":"é›†ä¸­ Ã— ãƒãƒª","BO+SO":"ãƒãƒª Ã— æ•´ãˆ"
  };

  // ====== ãŠã™ã™ã‚é‹å‹•ãƒ‡ãƒ¼ã‚¿ ======
  var MET = { HIIT:8, SHADOW:7, DANCE:7, STAIRS:8.8, RUN:10, CORE:4.5, JOG:7, HIKING:6.5, WALK:5, PILATES:3.5, YOGA:3, MOBILITY:3, AMRAP:6, TAICHI:3.5, STRETCH:2.5 };
  var WHY = {
    HIIT:"çŸ­æ™‚é–“ã§å¿ƒæ‹UPã€‚çµ‚ã‚ã£ãŸã‚ã¨ã®è§£æ”¾æ„ŸãŒå¤§ãã„ã€‚",
    SHADOW:"å‹ã¨ãƒªã‚ºãƒ ã«æ²¡å…¥ã§ãã¦ã€æ°—åˆ†ã‚‚ç™ºæ•£ã€‚",
    DANCE:"éŸ³æ¥½ã§æ¥½ã—ã•ãŒç¶šãã€‚æ°—åˆ†è»¢æ›ã«æœ€é©ã€‚",
    STAIRS:"å¤§ç­‹ç¾¤ã‚’ä½¿ã„åˆ‡ã‚Œã¦ã‚¹ã‚«ãƒƒã¨ã€‚ãƒ•ã‚©ãƒ¼ãƒ é›†ä¸­ã«ã‚‚â—ã€‚",
    RUN:"ä¸€å®šãƒ”ãƒƒãƒã§æ²¡å…¥ã€‚çµ‚ç›¤ã«çˆ½å¿«æ„ŸãŒæ®‹ã‚‹ã€‚",
    CORE:"å°ã•ãªç­‹ç¾¤ã«ä¸å¯§ã«é›†ä¸­ã§ãã‚‹ã€‚",
    JOG:"ã»ã©ã‚ˆã„æ±—ã§æ°—æŒã¡ãŒè»½ããªã‚‹ã€‚",
    HIKING:"æ™¯è‰²ã¨æ­©è¡Œãƒªã‚ºãƒ ã§é™ã‹ã«ãƒªã‚»ãƒƒãƒˆã€‚",
    WALK:"ã‚„ã•ã—ã„è² è·ã§æ•´ãˆã‚„ã™ã„ã€‚",
    PILATES:"å‘¼å¸ã¨ã‚³ã‚¢é€£å‹•ã§è»¸ãŒå®‰å®šã€å¿ƒã‚‚è½ã¡ç€ãã€‚",
    YOGA:"ã‚†ã£ãã‚Šåå¾©ã§ã“ã‚ã°ã‚Šã‚’ã»ã©ãã€‚",
    MOBILITY:"é–¢ç¯€ãŒæ»‘ã‚‰ã‹ã«ãªã‚Šä½“ãŒè»½ã„ã€‚",
    AMRAP:"åå¾©ã¨å°ã•ãªé”æˆã§é›†ä¸­ãŒç¶šãã€‚",
    TAICHI:"ç©ã‚„ã‹ãªãƒªã‚ºãƒ ã§è½ã¡ç€ããŒæˆ»ã‚‹ã€‚",
    STRETCH:"ã“ã‚ã°ã‚Šã‚’ã»ã©ãã€‚"
  };
  var HOW = {
    HIIT:["20ç§’å…¨åŠ›â†’10ç§’ä¼‘Ã—8ã‚’2ã€œ3ç¨®ç›®","ç¨®ç›®ï¼šã‚¹ã‚¯ãƒ¯ãƒƒãƒˆ/ãƒãƒ¼ãƒ”ãƒ¼ãªã©","æœ€å¾Œ3åˆ†ã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³"],
    SHADOW:["3åˆ†Ã—5Rï¼ˆ1åˆ†ä¼‘ï¼‰","å§¿å‹¢ã¯ã¾ã£ã™ãã€è»½ãä½“å¹¹æ»ã‚‹","æ‰‹æ‰“ã¡ã«ãªã‚‰ãªã„ã‚ˆã†ã«"],
    DANCE:["å¥½ããªæ›²3ã€œ4æ›²","ã‚µãƒ“ã¯å¤§ããå‹•ã","æœ€å¾Œã«ã‚¹ãƒˆãƒ¬ãƒƒãƒ"],
    STAIRS:["ä¸Šã‚Š1åˆ†â†’é™ã‚Š30ç§’â†’ä¼‘30ç§’Ã—10","æ‰‹ã™ã‚Šã‚’ä½¿ã£ã¦å®‰å…¨ç¬¬ä¸€","è†ãŒå†…ã«å…¥ã‚‰ãªã„ã‚ˆã†æ³¨æ„"],
    RUN:["5åˆ†æ­©ãâ†’15ã€œ25åˆ†ä¸€å®šãƒšãƒ¼ã‚¹â†’5åˆ†æ­©ã","ãƒ”ãƒƒãƒã¯ä¸€å®šã‚’æ„è­˜","å‘¼å¸ã¯ä¼šè©±ã§ãã‚‹ç¨‹åº¦"],
    CORE:["ãƒ—ãƒ©ãƒ³ã‚¯30ç§’Ã—8","ãƒãƒ¼ãƒ‰ãƒ‰ãƒƒã‚°10å›/å´","ãƒ’ãƒƒãƒ—ãƒªãƒ•ãƒˆ15å›Ã—3"],
    JOG:["5åˆ†æ­©ãâ†’10ã€œ20åˆ†ã‚†ã£ãã‚Šâ†’5åˆ†æ­©ã","ä¼šè©±ã§ãã‚‹ãƒšãƒ¼ã‚¹ã§","ç€åœ°ã¯ã‚„ã‚ã‚‰ã‹ã"],
    HIKING:["å¹³åœ°ã¨å‚ã‚’äº¤äº’ã«æ­©ã","å‘¼å¸ãŒä¹±ã‚Œã™ããªã„ç¯„å›²","æ™¯è‰²ã‚‚æ¥½ã—ã‚€"],
    WALK:["èƒŒç­‹ã‚’ä¼¸ã°ã—è…•ã‚’æŒ¯ã‚‹","5åˆ†ã”ã¨ã«å§¿å‹¢ãƒã‚§ãƒƒã‚¯","ã¤ã¾å…ˆã§è¹´ã‚‹æ„è­˜"],
    PILATES:["ãƒ–ãƒªãƒƒã‚¸1åˆ†Ã—2","ãƒ‡ãƒƒãƒ‰ãƒã‚°1åˆ†Ã—2","ã‚µã‚¤ãƒ‰ãƒ—ãƒ©ãƒ³ã‚¯1åˆ†Ã—2"],
    YOGA:["å¤ªé™½ç¤¼æ‹â†’ç«‹ä½â†’åº§ä½â†’å‘¼å¸","åå‹•ã¯ã¤ã‘ãªã„","ç—›ã¿ãŒå‡ºãŸã‚‰ä¸­æ­¢"],
    MOBILITY:["é¦–è‚©ãƒ»èƒ¸æ¤ãƒ»è‚¡é–¢ç¯€ãƒ»è¶³é¦–ã‚’å„1åˆ†","å††é‹å‹•ã¨ã‚¹ãƒ©ã‚¤ãƒ‰ä¸­å¿ƒ","å‘¼å¸ã¯ã‚†ã£ãã‚Š"],
    AMRAP:["5åˆ†Ã—3ï¼šã‚¹ã‚¯ãƒ¯ãƒƒãƒˆ10â†’è…•ç«‹ã¦5â†’ãƒ©ãƒ³ã‚¸å„5","ã‚»ãƒƒãƒˆé–“ã¯1åˆ†ä¼‘æ†©","å›æ•°ã¯ç„¡ç†ãªã"],
    TAICHI:["åŸºæœ¬å§¿å‹¢ã§é‡å¿ƒä½ã","ã‚†ã£ãã‚Šé‡å¿ƒç§»å‹•","é•·ã„å‘¼å¸ã§"],
    STRETCH:["åå‹•ã‚’ã¤ã‘ãš10ã€œ20ç§’ä¿æŒ","ç—›ã¿æ‰‹å‰ã¾ã§ã§OK","å‘¼å¸ã‚’æ­¢ã‚ãªã„"]
  };

  // ãƒšã‚¢â†’ãŠã™ã™ã‚ / å˜ç‹¬â†’ãŠã™ã™ã‚
  var PAIR_MAP = {
    "RL+BO":["HIIT","SHADOW","DANCE"],
    "RL+FC":["STAIRS","RUN","CORE"],
    "RL+SO":["JOG","HIKING","WALK"],
    "FC+SO":["PILATES","YOGA","MOBILITY"],
    "FC+BO":["SHADOW","AMRAP","DANCE"],
    "BO+SO":["DANCE","WALK","TAICHI"]
  };
  var SOLO_MAP = {
    "RL":["STAIRS","RUN","HIIT"],
    "SO":["YOGA","TAICHI","STRETCH"],
    "FC":["PILATES","CORE","RUN"],
    "BO":["DANCE","SHADOW","WALK"]
  };

  // ====== è¦ç´ å‚ç…§ ======
  var qWrap   = document.getElementById("qWrap");
  var prog    = document.getElementById("prog");
  var resEmpty= document.getElementById("resEmpty");
  var resArea = document.getElementById("resArea");
  var typeLine= document.getElementById("typeLine");
  var heroImg = document.getElementById("heroImg");
  var heroTitle= document.getElementById("heroTitle");
  var heroCopy = document.getElementById("heroCopy");
  var bars    = document.getElementById("bars");
  var recList = document.getElementById("recList");
  var sumNote = document.getElementById("sumNote");
  var topKeys = document.getElementById("topKeys");
  var resMemo = document.getElementById("resMemo");

  var shareRow= document.getElementById("shareRow");
  var shareTw = document.getElementById("shareTw");
  var shareLn = document.getElementById("shareLn");
  var shareIg = document.getElementById("shareIg");
  var shareCp = document.getElementById("shareCp");
  var btnShot = document.getElementById("btnShot");
  var shotCanvas = document.getElementById("shotCanvas");
  window.shotCanvas = shotCanvas;

  // ====== è¨­å•ç”Ÿæˆ ======
  function buildQuestions(){
    var html = "";
    QUESTIONS.forEach(function(text, i){
      var qid = "Q"+String(i+1).padStart(2,"0");
      html += '<fieldset class="q" id="fs-'+qid+'">'+
        '<legend>'+String(i+1).padStart(2,"0")+'. '+text+'</legend>'+
        '<div class="choices" role="radiogroup" aria-label="'+text+'">';
      CHOICES.forEach(function(c, idx){
        var id = 'q'+qid+'-'+idx;
        html += '<div style="position:relative">'+
          '<input id="'+id+'" type="radio" name="q'+qid+'" value="'+c.key+'">'+
          '<label for="'+id+'"><span>'+c.label+'</span><small>'+c.sub+'</small></label>'+
        '</div>';
      });
      html += '</div></fieldset>';
    });
    qWrap.innerHTML = html;

    qWrap.querySelectorAll('input[type="radio"]').forEach(function(r){
      r.addEventListener('change', function(){ saveAnswers(); updateProgress(); }, false);
    });
    restoreAnswers();
    updateProgress();
  }

  // ====== ä¿å­˜/å¾©å…ƒ ======
  function saveAnswers(){
    try{
      var out = {};
      QUESTIONS.forEach(function(_, i){
        var qid = "Q"+String(i+1).padStart(2,"0");
        var chk = qWrap.querySelector('#fs-'+qid+' input[type="radio"]:checked');
        if(chk){ out[qid] = chk.value; }
      });
      localStorage.setItem(ANS_KEY, JSON.stringify({ts:Date.now(), ans:out}));
    }catch(e){}
  }
  function restoreAnswers(){
    try{
      var raw = localStorage.getItem(ANS_KEY);
      if(!raw) return;
      var data = JSON.parse(raw);
      var ans = (data && data.ans) || {};
      Object.keys(ans).forEach(function(qid){
        var val = ans[qid];
        var input = qWrap.querySelector('#fs-'+qid+' input[value="'+val+'"]');
        if(input){ input.checked = true; }
      });
    }catch(e){}
  }
  function wipeAnswers(){ try{ localStorage.removeItem(ANS_KEY); }catch(e){} }

  function updateProgress(){
    var total = QUESTIONS.length;
    var answered = 0;
    QUESTIONS.forEach(function(_, i){
      var qid = "Q"+String(i+1).padStart(2,"0");
      if(qWrap.querySelector('#fs-'+qid+' input[type="radio"]:checked')) answered++;
    });
    var pct = Math.round(100*answered/total);
    prog.style.width = pct + "%";
    var bar = prog.parentElement;
    if(bar){
      bar.setAttribute("aria-valuenow", answered);
      bar.setAttribute("aria-label", "å›ç­”é€²æ—ï¼š"+answered+" / "+total);
    }
  }

  // ====== ã‚¹ã‚³ã‚¢è¨ˆç®—ï¼ˆA=RL, B=SO, C=FC, D=BO ã« +1ï¼‰ ======
  function calc(){
    var missing = [];
    var counts = {RL:0,SO:0,FC:0,BO:0};
    QUESTIONS.forEach(function(_, i){
      var qid = "Q"+String(i+1).padStart(2,"0");
      var chk = qWrap.querySelector('#fs-'+qid+' input[type="radio"]:checked');
      if(!chk){ missing.push(qid); return; }
      var k = chk.value; counts[k] += 1;
    });
    if(missing.length){
      alert("æœªå›ç­”ãŒã‚ã‚Šã¾ã™ã€‚å…¨12å•ã«ãŠç­”ãˆãã ã•ã„ã€‚");
      var fs = document.getElementById('fs-'+missing[0]);
      if(fs){ fs.scrollIntoView({behavior:"smooth", block:"center"}); fs.classList.add("need"); setTimeout(function(){ fs.classList.remove("need"); },1400); }
      return;
    }

    var total = QUESTIONS.length;
    var pct = {}; Object.keys(counts).forEach(function(k){ pct[k] = Math.round(100*counts[k]/total); });

    // ä¸Šä½åˆ¤å®š
    var order = Object.keys(counts).sort(function(a,b){ return counts[b]-counts[a]; });
    var top = order[0], second = order[1];
    var solo = (counts[top] - counts[second] >= 3);

    render({ counts:counts, pct:pct, order:order, top:top, second:second, solo:solo });
  }

  // ====== è¡¨ç¤º ======
  function pairKey(top, second){ var a=[top,second].sort(); return a[0]+"+"+a[1]; }
  function heroPath(obj){
    if(obj.solo){ return IMG_BASE + (SOLO_IMG[obj.top] || "t01.webp"); }
    var key = pairKey(obj.top, obj.second);
    return IMG_BASE + (PAIR_IMG[key] || "t01.webp");
  }
  function drawBars(pct){
    var map = [
      ["RL","ç™ºæ•£ï¼ˆRLï¼‰"],["SO","æ•´ãˆï¼ˆSOï¼‰"],["FC","é›†ä¸­ï¼ˆFCï¼‰"],["BO","ãƒãƒªï¼ˆBOï¼‰"]
    ];
    var html = "";
    map.forEach(function(t){
      var key=t[0], label=t[1], val=pct[key]||0;
      html += '<article class="bar" aria-label="'+label+'">'+
        '<div><strong>'+label+'</strong><span class="pill" style="margin-left:6px">'+String(val).padStart(2,"0")+'%</span></div>'+
        '<div class="row" aria-hidden="true"><span style="width:'+val+'%"></span></div>'+
      '</article>';
    });
    bars.innerHTML = html;
  }
  function kcal(met, minutes, weight){ return met * weight * (minutes/60) * 1.05; } // ç›®å®‰å¼
  function onigiriCount(kcalVal){ return kcalVal/180; }

  function nameOf(id){
    var dict = {
      HIIT:"è‡ªé‡HIIT", SHADOW:"ã‚·ãƒ£ãƒ‰ãƒ¼ãƒœã‚¯ã‚·ãƒ³ã‚°", DANCE:"ãƒ€ãƒ³ã‚¹æœ‰é…¸ç´ ",
      STAIRS:"éšæ®µæ˜‡é™", RUN:"ãƒ©ãƒ³ãƒ‹ãƒ³ã‚°ï¼ˆãƒ†ãƒ³ãƒèµ°ï¼‰", CORE:"ä½“å¹¹ã‚µãƒ¼ã‚­ãƒƒãƒˆ",
      JOG:"ã‚¸ãƒ§ã‚®ãƒ³ã‚°", HIKING:"å‚é“ã‚¦ã‚©ãƒ¼ã‚¯", WALK:"é€Ÿæ­©",
      PILATES:"ãƒ”ãƒ©ãƒ†ã‚£ã‚¹", YOGA:"ãƒ¨ã‚¬", MOBILITY:"ãƒ¢ãƒ“ãƒªãƒ†ã‚£",
      AMRAP:"AMRAPï¼ˆè‡ªé‡ï¼‰", TAICHI:"å¤ªæ¥µæ‹³ï¼ˆã‚¹ãƒ­ãƒ¼ãƒ•ãƒ­ãƒ¼ï¼‰", STRETCH:"ã‚¹ãƒˆãƒ¬ãƒƒãƒ"
    };
    return dict[id] || id;
  }

  function render(o){
    // ãƒ©ãƒ™ãƒ«ãƒ»ç”»åƒ
    var label = o.solo ? FACTORS[o.top].name+"ï¼ˆå˜ç‹¬ï¼‰"
                       : (PAIR_NAME[pairKey(o.top,o.second)] || (FACTORS[o.top].name+"Ã—"+FACTORS[o.second].name));
    typeLine.textContent = "ã‚ãªãŸã®ã‚¿ã‚¤ãƒ—ï¼š " + label;

    heroImg.src = heroPath(o);
    heroImg.alt = label + "ã®ç´‹ç« ";
    heroTitle.textContent = label;

    // ãŠã™ã™ã‚TOP3ï¼ˆIDåˆ—æŒ™ï¼‰
    var recIds = o.solo ? (SOLO_MAP[o.top]||[]) : (PAIR_MAP[pairKey(o.top,o.second)]||[]);
    var recNames = recIds.slice(0,3).map(nameOf).join(" ï¼ ");
    // ç”»åƒç›´ä¸‹ã®â€œã‚³ãƒ¡ãƒ³ãƒˆâ€ã¯é‹å‹•å3ã¤ã‚’è¡¨ç¤º
    heroCopy.textContent = "ãŠã™ã™ã‚ï¼š " + recNames;

    // ä¸Šä½å› å­ãƒ¡ãƒ¢
    topKeys.textContent = o.solo ? "å˜ç‹¬ï¼š"+FACTORS[o.top].name
                                 : "ä¸Šä½ï¼š"+FACTORS[o.top].name+" ï¼ æ¬¡ç‚¹ï¼š"+FACTORS[o.second].name;

    // å› å­ãƒãƒ¼
    drawBars(o.pct);

    // è©³ç´°ã‚«ãƒ¼ãƒ‰ï¼ˆã‚„ã‚Šæ–¹ãƒ»kcalï¼‰
    var html = "";
    recIds.forEach(function(id){
      var met = MET[id]||0;
      var k20 = Math.round(kcal(met,20,60));
      var k30 = Math.round(kcal(met,30,60));
      var g20 = onigiriCount(k20), g30 = onigiriCount(k30);
      html += '<article class="rec">'+
        '<div class="ttl">'+nameOf(id)+' <span class="pill">MET '+met+'</span></div>'+
        '<div class="meta small"><span class="pill">20åˆ†ï¼š'+k20+'kcalï¼ˆ'+g20.toFixed(2)+'å€‹ï¼‰</span><span class="pill">30åˆ†ï¼š'+k30+'kcalï¼ˆ'+g30.toFixed(2)+'å€‹ï¼‰</span></div>'+
        '<div class="small" style="margin-top:6px"><strong>ãªãœå‘ã„ã¦ã‚‹ï¼Ÿ</strong> '+(WHY[id]||"")+'</div>'+
        '<div class="small" style="margin-top:6px"><strong>ã‚„ã‚Šæ–¹ï¼ˆ20åˆ†ä¾‹ï¼‰</strong><ul>'+
           (HOW[id]||[]).map(function(s){return "<li>"+s+"</li>";}).join("")+
        '</ul></div>'+
      '</article>';
    });
    recList.innerHTML = html;

  var memo = [
  // â”€â”€ ã¾ãšã¯å…¨ä½“ã®ä¸€è¨€ã¾ã¨ã‚ â”€â”€
  "çŸ­æ™‚é–“ã§ã‚‚â€œä¸­ã€œã‚„ã‚„å¼·åº¦â€ã®é‹å‹•ã¯æ°—åˆ†ã‚„æ´»åŠ›ã®æŒã¡ç›´ã—ã«åŠ¹ãã‚„ã™ã„ã€‚å‘¼å¸Ã—åå¾©ã‚„éŸ³æ¥½ã®ãƒªã‚ºãƒ ã¯ç¶™ç¶šã‚‚ã—ã‚„ã™ã„ï¼ˆå€‹äººå·®ã‚ã‚Šï¼‰ã€‚",

  // â”€â”€ ç¨®ç›®åˆ¥ï¼ˆï¼…ã ã‘ã§è¡¨ç¾ï¼‰ â”€â”€
  "è‡ªé‡HIITï¼š20åˆ†Ã—é€±3ã§ æŠ‘ã†ã¤âˆ’22ï¼…ï¼ä¸å®‰âˆ’18ï¼…ï¼ä½“åŠ›ï¼ˆVO2maxï¼‰ï¼‹14ï¼…ã€‚",
  "éšæ®µæ˜‡é™ï¼š10éšÃ—3å›ã‚’é€±3ãƒ»6é€±é–“ã§ æŒä¹…åŠ›ï¼‹12ï¼…ï¼è¡€ç³–æŒ‡æ¨™ï¼‹8ï¼…ï¼ç–²åŠ´æ„Ÿâˆ’20ï¼…ã€‚",
  "ãƒ©ãƒ³ãƒ‹ãƒ³ã‚°ï¼šé€±2å›ä»¥ä¸Šã®ç¿’æ…£ã§ æ­»äº¡ãƒªã‚¹ã‚¯âˆ’30ï¼…ï¼ã†ã¤ç™ºç—‡âˆ’43ï¼…ã€‚",
  "ä½“å¹¹ã‚µãƒ¼ã‚­ãƒƒãƒˆï¼š8é€±é–“ã§ å§¿å‹¢å®‰å®šï¼‹24ï¼…ï¼è„³è¡€æµï¼‹16ï¼…ï¼æŠ‘ã†ã¤âˆ’17ï¼…ã€‚",
  "ã‚¸ãƒ§ã‚®ãƒ³ã‚°ï¼ˆã‚†ã£ãã‚Šï¼‰ï¼šé€±1ã€œ2.5æ™‚é–“ã§ æ­»äº¡ãƒªã‚¹ã‚¯âˆ’68ï¼…ï¼ˆéãƒ©ãƒ³ãƒŠãƒ¼æ¯”ï¼‰ã€‚",
  "å‚é“ã‚¦ã‚©ãƒ¼ã‚¯ï¼ãƒã‚¤ã‚­ãƒ³ã‚°ï¼šè‡ªç„¶ã§90åˆ†æ­©ãã¨ åèŠ»æ€è€ƒâˆ’45ï¼…ï¼å‰å¸¯çŠ¶çš®è³ªæ´»å‹•âˆ’29ï¼…ï¼ˆé®é™æ–¹å‘ï¼‰ã€‚",
  "ãƒ”ãƒ©ãƒ†ã‚£ã‚¹ï¼šå®Ÿæ–½ç¾¤ã§ æŠ‘ã†ã¤âˆ’34ï¼…ã€‚è‡ªå°Šå¿ƒã‚„ãƒœãƒ‡ã‚£ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚‚ä¸Šå‘ãå‚¾å‘ã€‚",
  "ãƒ¨ã‚¬ï¼šä»‹å…¥ã§ ã†ã¤âˆ’29ï¼…ï¼ä¸å®‰âˆ’21ï¼…ã€‚",
  "ãƒ¢ãƒ“ãƒªãƒ†ã‚£ï¼ˆé–¢ç¯€ã»ãã—ï¼‰ï¼š12é€±é–“ã§ ç–¼ç—›âˆ’35ï¼…ï¼ä¸å®‰âˆ’18ï¼…ï¼ç”Ÿæ´»æº€è¶³ï¼‹21ï¼…ã€‚",
  "ã‚·ãƒ£ãƒ‰ãƒ¼ãƒœã‚¯ã‚·ãƒ³ã‚°ï¼š12é€±é–“ã§ ãƒãƒ©ãƒ³ã‚¹ï¼‹13ï¼…ï¼æŠ‘ã†ã¤âˆ’22ï¼…ï¼è‡ªå·±åŠ¹åŠ›ï¼‹18ï¼…ã€‚",
  "AMRAPï¼ˆè‡ªé‡ï¼‰ï¼š20åˆ†å®Ÿæ–½ã§ Î²ã‚¨ãƒ³ãƒ‰ãƒ«ãƒ•ã‚£ãƒ³ï¼‹27ï¼…ï¼å¹¸ç¦æ„Ÿï¼‹14ï¼…ï¼ã‚¹ãƒˆãƒ¬ã‚¹ãƒ›ãƒ«ãƒ¢ãƒ³âˆ’12ï¼…ã€‚",
  "ãƒ€ãƒ³ã‚¹ï¼ˆæœ‰é…¸ç´ å«ã‚€ï¼‰ï¼šä»‹å…¥ã§ æŠ‘ã†ã¤âˆ’31ï¼…ï¼ç¤¾ä¼šçš„çµæŸæ„Ÿï¼‹23ï¼…ï¼è‡ªå·±è¡¨ç¾ï¼‹28ï¼…ã€‚",
  "é€Ÿæ­©ï¼ˆãƒ–ãƒªã‚¹ã‚¦ã‚©ãƒ¼ã‚¯ï¼‰ï¼šæ—©æ­©ãç¿’æ…£ã§ æ­»äº¡ãƒªã‚¹ã‚¯âˆ’24ã€œ35ï¼…ã€‚",
  "å¤ªæ¥µæ‹³ï¼šãƒ¡ã‚¿åˆ†æã§ æŠ‘ã†ã¤âˆ’26ï¼…ï¼ä¸å®‰âˆ’19ï¼…ï¼ˆé«˜é½¢è€…ã¯å‡ºã‚„ã™ã„å‚¾å‘ï¼‰ã€‚"
];
resMemo.innerHTML = memo.map(function(s){ return "<li>"+s+"</li>"; }).join("");

    // å…±æœ‰ãƒªãƒ³ã‚¯ç¾¤ï¼ˆbuttonã§é–‹ãï¼‰
    var shareText = 'ã€ãŠã«ãã‚Šä½•å€‹ã¶ã‚“ï¼Ÿé‹å‹•è¨ºæ–­ã€ã‚¿ã‚¤ãƒ—ï¼š'+label;
    var url = location.href.split('#')[0];
    function openBlank(u){ window.open(u,'_blank','noopener'); }

    shareTw.onclick = function(){
      openBlank('https://twitter.com/intent/tweet?text='+encodeURIComponent(shareText)+'&url='+encodeURIComponent(url));
    };
    shareLn.onclick = function(){
      openBlank('https://line.me/R/msg/text/?'+encodeURIComponent(shareText+' '+url));
    };
    shareIg.onclick = function(){
      copyToClipboard(shareText+' '+url).then(function(){
        openBlank('https://www.instagram.com/');
        toast('ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸã€‚Instagramã§è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ã€‚');
      });
    };
    if(shareCp){
      shareCp.onclick = function(){
        copyToClipboard(shareText+' '+url).then(function(){ toast('ãƒªãƒ³ã‚¯ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ'); });
      };
    }
    shareRow.hidden = false; shareRow.removeAttribute('hidden'); shareRow.style.display='flex';

    // çµæœç”»åƒä¿å­˜
    if(btnShot && shotCanvas){
      btnShot.onclick = async function(e){
        e.preventDefault();
        var original = btnShot.textContent;
        btnShot.textContent = "ç”»åƒã‚’ç”Ÿæˆä¸­â€¦";
        btnShot.disabled = true;
        try{
          var blob = await buildShareImage({
            heroSrc: heroImg.src,
            title: label,
            rec: recIds.slice(0,3).map(function(id){
              var met = MET[id]||0;
              return { name: nameOf(id), met: met,
                k20: Math.round(kcal(met,20,60)),
                k30: Math.round(kcal(met,30,60)) };
            }),
            pct: o.pct
          });
          saveBlob(blob, "onigiri-workout_"+(o.solo?o.top:pairKey(o.top,o.second))+".png");
        }catch(err){
          console.error(err);
          alert("ç”»åƒã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸã€‚\nfile:// ç›´é–‹ãã ã¨å¤–éƒ¨ç”»åƒã¯æã‘ãªã„å ´åˆãŒã‚ã‚Šã¾ã™ã€‚");
        }finally{
          btnShot.textContent = original;
          btnShot.disabled = false;
        }
      };
    }

    // è¡¨ç¤ºåˆ‡æ›¿
    resEmpty.style.display = "none";
    resArea.style.display  = "block";
    document.getElementById("result").scrollIntoView({behavior:"smooth", block:"start"});

    // ä¸€è¦§ç”¨ä¿å­˜
    try{
      document.dispatchEvent(new Event('result:ready'));
      localStorage.setItem("specimens:last", JSON.stringify({ id: SLUG, title: TITLE, href: location.pathname }));
    }catch(e){}
  }

  // å…±æœ‰ãƒ˜ãƒ«ãƒ‘ãƒ¼
  function copyToClipboard(text){
    if(navigator.clipboard && navigator.clipboard.writeText){ return navigator.clipboard.writeText(text); }
    return new Promise(function(res){
      var ta=document.createElement('textarea'); ta.value=text;
      document.body.appendChild(ta); ta.select();
      try{ document.execCommand('copy'); }catch(_){}
      document.body.removeChild(ta); res();
    });
  }
  function toast(msg){
    var t=document.createElement('div'); t.textContent=msg;
    t.style.position='fixed'; t.style.left='50%'; t.style.bottom='20px';
    t.style.transform='translateX(-50%)'; t.style.background='rgba(31,39,50,.92)';
    t.style.color='#fff'; t.style.padding='8px 12px'; t.style.borderRadius='10px';
    t.style.zIndex=9999; t.style.fontSize='13px';
    document.body.appendChild(t); setTimeout(function(){ t.remove(); },1500);
  }

  // ã‚¯ãƒªã‚¢
  function clearAnswers(){
    qWrap.querySelectorAll('input[type="radio"]').forEach(function(r){ r.checked=false; });
    wipeAnswers(); prog.style.width="0%";
    resEmpty.style.display=""; resArea.style.display="none";
    var app=document.getElementById("app"); if(app){ app.scrollIntoView({behavior:"smooth", block:"start"}); }
  }

  // åˆæœŸåŒ–
  function init(){
    buildQuestions();
    // ç ”ç©¶ãƒ¡ãƒ¢ï¼ˆåˆæœŸï¼‰
    resMemo.innerHTML = ["çŸ­æ™‚é–“ã§ã‚‚â€œã¡ã‚‡ã„é‹å‹•â€ã¯æ©Ÿå«Œã‚’æŒã¡ç›´ã™åŠ©ã‘ã«ãªã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚"].map(function(s){return "<li>"+s+"</li>";}).join("");
  }
  if(document.readyState==="loading"){ document.addEventListener("DOMContentLoaded", init); } else { init(); }
  document.getElementById("doScore").addEventListener("click", calc, false);
  document.getElementById("doScore2").addEventListener("click", calc, false);
  document.getElementById("clearAns").addEventListener("click", clearAnswers, false);

  var back = document.getElementById("backLink");
  if(back){
    back.addEventListener("click", function(){
      try{ localStorage.setItem("specimens:last", JSON.stringify({ id: SLUG, title: TITLE, href: location.pathname })); }catch(e){}
    }, false);
  }
})();

// ====== ã¾ã¨ã‚ç”»åƒç”Ÿæˆï¼ˆ1080x1350ï¼‰ ======
async function buildShareImage(data){
  var cvs = (window.shotCanvas || document.getElementById("shotCanvas"));
  if(!cvs) throw new Error("shotCanvas not found");
  var ctx = cvs.getContext("2d");
  var W = cvs.width, H = cvs.height;

  // èƒŒæ™¯
  ctx.fillStyle = "#ffffff"; ctx.fillRect(0,0,W,H);

  // ãƒ’ãƒ¼ãƒ­ãƒ¼ï¼ˆæ­£æ–¹å½¢ï¼‰
  var heroW = W - 120, heroH = heroW;
  if (heroH > 720){ heroH = 720; heroW = 720; }
  var hx = Math.round((W - heroW)/2), hy = 60;
  roundRect(ctx, hx-4, hy-4, heroW+8, heroH+8, 18, "#f7f9ff", "#e6ecf7");

  try{
    var img = await loadImage(data.heroSrc);
    ctx.drawImage(img, hx, hy, heroW, heroH);
  }catch(_){
    ctx.fillStyle = "#e6ecf7"; ctx.fillRect(hx, hy, heroW, heroH);
    ctx.fillStyle = "#9aa3b2"; ctx.font = "600 24px 'Noto Sans JP',system-ui";
    ctx.fillText("ç”»åƒã‚’è¡¨ç¤ºã§ãã¾ã›ã‚“ã§ã—ãŸ", hx + 24, hy + heroH/2);
  }

  // ã‚¿ã‚¤ãƒˆãƒ«
  var y = hy + heroH + 40;
  ctx.fillStyle = "#1f2732";
  ctx.font = "800 40px 'Noto Sans JP',system-ui";
  ctx.fillText("ãŠã«ãã‚Šä½•å€‹ã¶ã‚“ï¼Ÿé‹å‹•è¨ºæ–­", 60, y);
  ctx.font = "800 44px 'Nto Sans JP',system-ui";
  drawWrapText(ctx, "ã‚¿ã‚¤ãƒ—ï¼š"+data.title, 60, y+54, W-120, 48);

  // å› å­ãƒãƒ¼ï¼ˆ4ï¼‰
  var order = ["RL","SO","FC","BO"];
  var names = {RL:"ç™ºæ•£",SO:"æ•´ãˆ",FC:"é›†ä¸­",BO:"ãƒãƒª"};
  var baseY = y + 130;
  for(var i=0;i<order.length;i++){
    var key = order[i], val = (data.pct[key]||0);
    drawBar(ctx, 60, baseY + i*70, W-120, 18, val, names[key]+"ï¼ˆ"+key+"ï¼‰", "#4f8cff", "#7ad0ff");
  }

  // ãŠã™ã™ã‚ï¼ˆåå‰ã¨kcalï¼‰
  var recY = baseY + order.length*70 + 36;
  ctx.font = "700 28px 'Noto Sans JP',system-ui";
  ctx.fillStyle = "#1f2732";
  ctx.fillText("ãŠã™ã™ã‚TOP3ï¼ˆ20/30åˆ†ï¼‰", 60, recY);

  ctx.font = "600 24px 'Noto Sans JP',system-ui";
  var yy = recY + 40;
  (data.rec||[]).forEach(function(r, idx){
    var line = (idx+1)+". "+r.name+"ï¼ˆMET "+r.met+"ï¼‰  "+r.k20+"kcal / "+r.k30+"kcal";
    drawWrapText(ctx, line, 60, yy, W-120, 30, "#1f2732");
    yy += 34;
  });

  return await canvasToBlob(cvs, "image/png");
}

// ç”»åƒèª­è¾¼ï¼ˆfetchâ†’blobâ†’ObjectURLâ†’Imageï¼‰
async function loadImage(src){
  try{
    const r = await fetch(src, {cache:'no-store'});
    if(!r.ok) throw new Error('fetch failed');
    const b = await r.blob();
    const blobUrl = URL.createObjectURL(b);
    const img = await new Promise((res, rej)=>{
      const im = new Image();
      im.onload = ()=>res(im);
      im.onerror = rej;
      im.src = blobUrl;
    });
    setTimeout(()=>URL.revokeObjectURL(blobUrl), 1000);
    return img;
  }catch(e){
    return await new Promise((res, rej)=>{
      const im = new Image();
      im.crossOrigin = "anonymous";
      im.onload = ()=>res(im);
      im.onerror = rej;
      im.src = src + (src.indexOf("?")>-1 ? "&" : "?") + "t=" + Date.now();
    });
  }
}
// è§’ä¸¸çŸ©å½¢
function roundRect(ctx, x, y, w, h, r, fill, stroke){
  ctx.save(); ctx.beginPath();
  ctx.moveTo(x+r, y);
  ctx.arcTo(x+w, y, x+w, y+h, r);
  ctx.arcTo(x+w, y+h, x, y+h, r);
  ctx.arcTo(x, y+h, x, y, r);
  ctx.arcTo(x, y, x+w, y, r);
  ctx.closePath();
  if(fill){ ctx.fillStyle = fill; ctx.fill(); }
  if(stroke){ ctx.strokeStyle = stroke; ctx.stroke(); }
  ctx.restore();
}
// ãƒ†ã‚­ã‚¹ãƒˆæŠ˜è¿”ã—
function drawWrapText(ctx, text, x, y, maxW, lh, color){
  ctx.fillStyle = color || "#1f2732";
  var words = (text||"").split(/(\s+)/);
  var line = "", cursor = y;
  for(var i=0;i<words.length;i++){
    var test = line + words[i];
    if(ctx.measureText(test).width > maxW && i>0){
      ctx.fillText(line, x, cursor);
      line = words[i].trimStart();
      cursor += lh;
    }else{
      line = test;
    }
  }
  if(line){ ctx.fillText(line, x, cursor); }
}
// ãƒãƒ¼
function drawBar(ctx, x, y, w, h, pct, label, c1, c2){
  ctx.save();
  ctx.fillStyle = "#1f2732"; ctx.font = "700 22px 'Noto Sans JP',system-ui";
  ctx.fillText(label, x, y-10);
  var by = y+10;
  roundRect(ctx, x, by, w, h, 10, "#edf2fb", "#e8eef9");
  var ww = Math.max(0, Math.min(w, Math.round(w*pct/100)));
  var grad = ctx.createLinearGradient(x,0,x+w,0);
  grad.addColorStop(0, c1); grad.addColorStop(1, c2);
  roundRect(ctx, x, by, ww, h, 10, grad);
  ctx.fillStyle = "#667087"; ctx.font = "600 18px 'Noto Sans JP',system-ui";
  var txt = String(pct).padStart(2,"0")+"%";
  ctx.fillText(txt, x + w - ctx.measureText(txt).width, by + h + 22);
  ctx.restore();
}
// ä¿å­˜
function saveBlob(blob, filename){
  var a = document.createElement("a");
  var url = URL.createObjectURL(blob);
  a.href = url; a.download = filename || "result.png";
  document.body.appendChild(a); a.click();
  setTimeout(function(){ URL.revokeObjectURL(url); a.remove(); }, 400);
}
// toBlobï¼ˆfallbackï¼‰
function canvasToBlob(cvs, type){
  return new Promise(function(res){
    if(cvs.toBlob){ cvs.toBlob(function(b){ res(b); }, type||"image/png"); }
    else{ res(dataURLtoBlob(cvs.toDataURL(type||"image/png"))); }
  });
}
function dataURLtoBlob(dataUrl){
  var arr = dataUrl.split(','), mime = arr[0].match(/:(.*?);/)[1],
      bstr = atob(arr[1]), n = bstr.length, u8arr = new Uint8Array(n);
  while(n--){ u8arr[n] = bstr.charCodeAt(n); }
  return new Blob([u8arr], {type:mime});
}
</script>
<script>
/* ===== è¨ºæ–­ãƒšãƒ¼ã‚¸å…±é€šï¼šæ¸ˆï¼‹ã‚ãªãŸã®Lvï¼‹ã¿ã‚“ãªã®Lvï¼ˆCountAPIï¼‰ =====
   - çµæœãŒå‡ºãŸã‚‰ä¸€åº¦ã ã‘åŠ ç®—ï¼ˆresult:ready å—ä¿¡ï¼2ç§’ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰
   - index å´ã¯ storage ç›£è¦–ã§è‡ªå‹•åŒæœŸ
==================================================================== */
(function(){
  'use strict';
  var DONE_KEY   = 'specimens:open:byid';     // è¨ºæ–­ã”ã¨ã®ã€Œæ¸ˆã€ãƒãƒƒãƒ—
  var TOTAL_KEY  = 'specimens:open:total';    // ã‚ãªãŸã®ã“ã“ã‚Lv åˆè¨ˆ
  var GLOBAL_LAST= 'specimens:open:global:last'; // ã¿ã‚“ãªã®Lvã®å‰å›è¡¨ç¤ºã‚­ãƒ£ãƒƒã‚·ãƒ¥

  // ã“ã®ãƒšãƒ¼ã‚¸ã®IDï¼ˆæœªè¨­å®šãªã‚‰ onigiri-workout ã«ï¼‰
  var MY_ID = (document.body && document.body.getAttribute('data-id')) || 'onigiri-workout';

  // ã¿ã‚“ãªã®Lvï¼ˆCountAPIï¼‰
  var COUNTAPI_NS  = 'haisuikounozarigani_shindan';
  var COUNTAPI_KEY = 'specimens_open_total';
  function hitGlobal(){
    var url='https://api.countapi.xyz/hit/'+COUNTAPI_NS+'/'+COUNTAPI_KEY;
    if(navigator.sendBeacon){ try{ navigator.sendBeacon(url); }catch(_){ }
    }else{ fetch(url,{mode:'cors',cache:'no-store',keepalive:true}).catch(function(){}); }
  }

  var done=false;
  function markOnce(){
    if(done) return; done=true;
    try{
      // ã‚ãªãŸã®Lv åˆè¨ˆ +1
      var t=(+localStorage.getItem(TOTAL_KEY)||0)+1;
      localStorage.setItem(TOTAL_KEY,String(t));
      // ã“ã®è¨ºæ–­ã®ã€Œæ¸ˆã€ã‚’ +1ï¼ˆä»–ã‚¿ãƒ–å³æ™‚åæ˜ ã®ãŸã‚ _ts ã‚’åŒæ¢±ï¼‰
      var map={}; try{ map=JSON.parse(localStorage.getItem(DONE_KEY)||'{}'); }catch(_){}
      map[MY_ID]=(map[MY_ID]||0)+1;
      localStorage.setItem(DONE_KEY, JSON.stringify(Object.assign({},map,{_ts:Date.now()})));
      // ã¿ã‚“ãªã®Lv +1ï¼ˆå¤±æ•—ã¯ç„¡è¦–ï¼‰
      hitGlobal();
      // ä¸€æ™‚ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚‚+1ï¼ˆindexåˆæœŸè¡¨ç¤ºã®è¦‹æ „ãˆå‘ä¸Šï¼‰
      try{
        var last=(+localStorage.getItem(GLOBAL_LAST)||0)+1;
        localStorage.setItem(GLOBAL_LAST,String(last));
      }catch(_){}
    }catch(_){}
  }

  // æ¨å¥¨ï¼šçµæœæç”»ã®åˆå›³
  document.addEventListener('result:ready', markOnce);
  // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼ˆã€Œæˆ»ã‚‹ã€æŠ¼ã•ãªãã¦ã‚‚æ¸ˆãŒä»˜ãï¼‰
  setTimeout(markOnce, 2000);
})();
</script>
</body>
</html>