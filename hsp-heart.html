<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>HSPãƒãƒ¼ãƒˆè¨ºæ–­ â”€ ã“ã“ã‚ã®ç¹Šç´°ã•ã‚’ã‚„ã•ã—ãå¯è¦–åŒ–</title>
<meta name="description" content="18å•ã§ã€Œæ·±ã„å‡¦ç†ãƒ»åˆºæ¿€ã‚ªãƒ¼ãƒãƒ¼ãƒ»å…±é³´ãƒ»äº”æ„Ÿãƒ»ç¾æ„Ÿãƒ»å›å¾©ã€ã®6å› å­ã‚’æ•°å€¤åŒ–ã€‚çµæœã¯ã‚¬ãƒ©ã‚¹ï¼ãƒ™ãƒ«ãƒ™ãƒƒãƒˆï¼ã‚¯ã‚©ãƒ¼ãƒ„ï¼ã‚¹ãƒ†ãƒ³ãƒ¬ã‚¹ï¼ãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰ã®5ãƒãƒ¼ãƒˆã§è¡¨ç¤ºï¼ˆã‚¨ãƒ³ã‚¿ãƒ¡è‡ªå·±ç†è§£ï¼‰ã€‚">
<meta name="theme-color" content="#fff6fb">

<!-- OGP -->
<meta property="og:type" content="website">
<meta property="og:title" content="HSPãƒãƒ¼ãƒˆè¨ºæ–­ â”€ ã“ã“ã‚ã®ç¹Šç´°ã•ã‚’ã‚„ã•ã—ãå¯è¦–åŒ–">
<meta property="og:description" content="18å•ã§ã€Œæ·±ã„å‡¦ç†ãƒ»åˆºæ¿€ã‚ªãƒ¼ãƒãƒ¼ãƒ»å…±é³´ãƒ»äº”æ„Ÿãƒ»ç¾æ„Ÿãƒ»å›å¾©ã€ã®6å› å­ã‚’æ•°å€¤åŒ–ã€‚çµæœã¯ã‚¬ãƒ©ã‚¹ï¼ãƒ™ãƒ«ãƒ™ãƒƒãƒˆï¼ã‚¯ã‚©ãƒ¼ãƒ„ï¼ã‚¹ãƒ†ãƒ³ãƒ¬ã‚¹ï¼ãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰ã®5ãƒãƒ¼ãƒˆã§è¡¨ç¤ºï¼ˆã‚¨ãƒ³ã‚¿ãƒ¡è‡ªå·±ç†è§£ï¼‰ã€‚">
<meta property="og:url" content="/shindan/hsp-heart.html">
<meta property="og:image" content="/shindan/assets/results/hsp-heart/t01.webp">

<style>
:root{
  /* gentle heart-pink */
  --accent:#ff79ac; --accent2:#a48bff;
  --ink:#2b2330; --muted:#7b6a79; --paper:#fff;
  --bg1:#fff6fb; --bg2:#f3f4ff; --line:#eee3ef;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; color:var(--ink);
  background:linear-gradient(180deg,var(--bg1),var(--bg2));
  font-family:"Noto Sans JP",system-ui,-apple-system,"Segoe UI",Roboto,"Hiragino Kaku Gothic ProN",sans-serif;
}
a{color:inherit}
.wrap{max-width:980px;margin:18px auto;padding:0 14px}
header.hd{display:grid;grid-template-columns:56px 1fr;gap:12px;align-items:center;margin:8px 0}
.logo{width:56px;height:56px;border-radius:14px;background:linear-gradient(135deg,#ffe8f3,#ece8ff);display:grid;place-items:center;font-size:28px}
h1{margin:0;font-size:clamp(22px,4.6vw,34px);letter-spacing:.02em}
.sub{margin:4px 0 0;color:var(--muted);font-size:.96em}
.card{background:var(--paper);border:1px solid var(--line);border-radius:16px;padding:14px}
.section{margin:14px 0}
.pill{display:inline-block;padding:4px 8px;border:1px solid var(--line);border-radius:999px;background:#fff;color:#6b6a77;font-size:.88em}
.meta{display:flex;gap:8px;flex-wrap:wrap}

.sticky{position:sticky;top:0;z-index:10;margin:-6px -14px 12px;padding:8px 14px;background:rgba(255,255,255,.85);backdrop-filter:blur(6px) saturate(1.05);border-bottom:1px solid #efe5f1;display:flex;align-items:center;gap:10px}
.progress{height:8px;background:#f7eaf2;border-radius:999px;flex:1;overflow:hidden}
.progress>span{display:block;height:100%;width:0;background:linear-gradient(90deg,var(--accent),var(--accent2));transition:width .25s ease}

.btn{padding:10px 14px;border:1px solid var(--line);border-radius:12px;background:#fff;cursor:pointer}
.btn.primary{background:linear-gradient(90deg,var(--accent),var(--accent2));border-color:transparent;color:#fff;font-weight:700}

fieldset.q{border:1px solid var(--line);border-radius:12px;padding:10px;margin:10px 0;background:#fff}
legend{font-weight:700}
.scale{display:grid;grid-template-columns:repeat(5,minmax(66px,1fr));gap:8px;margin-top:8px}
.scale input{position:absolute;opacity:0;pointer-events:none}
.scale label{display:grid;place-items:center;border:1px solid #eadfea;border-radius:10px;padding:8px;cursor:pointer;user-select:none;background:#fff}
.scale input:checked+label{outline:2px solid var(--accent);border-color:transparent}
mark.need{animation:need 1.6s ease}
@keyframes need{0%{box-shadow:0 0 0 0 rgba(255,121,172,.45)}100%{box-shadow:0 0 0 0 rgba(255,121,172,0)}}

.result-head{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
.badge{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;background:linear-gradient(90deg,var(--accent),var(--accent2));color:#fff;font-weight:700}
.total{font-size:26px;font-weight:800}
.small{color:var(--muted);font-size:.92em}

/* hero (1:1) */
.hero-vert{display:grid;place-items:center;border:1px solid var(--line);border-radius:16px;background:#fff;overflow:hidden}
.hero-vert figure{margin:0;width:min(720px,100%);max-width:100%;aspect-ratio:1/1;border-bottom:1px solid var(--line);background:#fff6fb}
.hero-vert img{width:100%;height:100%;object-fit:cover;display:block}
.hero-vert figcaption{padding:10px;width:100%}
.hero-vert .capline{font-weight:800;line-height:1.55;overflow-wrap:anywhere;word-break:break-word;white-space:normal}
.hero-vert .poem{font-style:italic;letter-spacing:.02em;margin-top:4px;color:#554a58;opacity:.9}
.hero-vert .capmini{font-size:1em;line-height:1.85;color:var(--muted);overflow-wrap:anywhere;word-break:break-word;white-space:normal}
.rank-chip{display:inline-flex;align-items:center;gap:6px;border:1px solid var(--line);border-radius:999px;background:#fff;padding:4px 8px}
.rank-chip img{width:24px;height:24px;border-radius:6px;display:block}

.grid2{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:12px}
.stat{border:1px solid var(--line);border-radius:12px;padding:10px;background:#fff}
.stat .big{font-size:22px;font-weight:800}
.hr{height:1px;background:var(--line);margin:10px 0}
.factor-mini{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:10px}
.bar{border:1px solid var(--line);border-radius:12px;padding:10px;background:#fff}
.bar .row{height:10px;background:#f7eaf2;border-radius:999px;overflow:hidden;margin-top:6px}
.bar .row>span{display:block;height:100%;width:0;background:linear-gradient(90deg,var(--accent),var(--accent2))}

.note{border:1px solid var(--line);border-radius:12px;background:#fff;padding:10px}
.note h4{margin:0 0 6px;font-size:16px}
.note p{margin:6px 0;line-height:1.75}
.footer{color:var(--muted);font-size:.92em}
.warn{background:#fbf8ff;border:1px solid #efe8ff;border-radius:12px;padding:10px;margin:12px 0}
.back-area{display:flex;justify-content:center;margin-top:10px}
a.back{display:inline-flex;align-items:center;gap:6px;padding:10px 14px;border:1px solid var(--line);border-radius:12px;background:#fff;text-decoration:none}
.badge-size{display:inline-flex;align-items:center;gap:6px;padding:4px 8px;border-radius:999px;background:#fff;border:1px solid var(--line);font-size:.85em;margin-left:6px}
.title-row{display:flex;align-items:center;gap:6px;flex-wrap:wrap}

/* --- share buttons --- */
.share-row{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
.btn.tw::before{content:"ğ•";margin-right:.25em}
.btn.line::before{content:"ğŸ’¬";margin-right:.25em}
.btn.ig::before{content:"ğŸ“¸";margin-right:.25em}

@media (max-width:560px){
  .wrap{padding:0 10px}
  .sticky{top:calc(env(safe-area-inset-top) + 0px);padding:8px 10px}
  .scale{grid-template-columns:repeat(2,1fr)}
  .scale label{padding:12px 8px;font-size:14px}
  .hero-vert figure{width:100%}
  .grid2{grid-template-columns:1fr}
  .badge-size{font-size:.8em}
  .card{padding:12px}
  .hero-vert .capline{font-size:clamp(16px,5.2vw,20px);line-height:1.65}
  .hero-vert .capmini{font-size:clamp(14px,4.6vw,16px);line-height:1.95}
  .note h4{font-size:15px}
}
</style>
</head>
<body data-id="hsp-heart">
<main class="wrap" id="app">
  <header class="hd">
    <div class="logo">ğŸ’—</div>
    <div>
      <h1>HSPãƒãƒ¼ãƒˆè¨ºæ–­ â”€ ã“ã“ã‚ã®ç¹Šç´°ã•ã‚’ã‚„ã•ã—ãå¯è¦–åŒ–</h1>
      <p class="sub">18å•ï¼ˆ0ã€œ4ã®5ä»¶æ³•ï¼‰ã€‚ç·åˆãƒ©ãƒ³ã‚¯ã¨å› å­ãƒãƒ¼ã€ç ”ç©¶ãƒ¡ãƒ¢ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚</p>
    </div>
  </header>

  <div class="sticky" aria-live="polite">
    <span>ğŸ“Š</span>
    <div class="progress" aria-label="å›ç­”é€²æ—" role="progressbar" aria-valuemin="0" aria-valuemax="18"><span id="prog"></span></div>
    <button class="btn primary" id="doScore">è¨ºæ–­ã™ã‚‹</button>
  </div>

  <section class="card section" id="desc">
    <h2 style="margin:4px 0 8px">èª¬æ˜</h2>
    <div class="meta" style="margin-bottom:8px">
      <span class="pill">è³ªå•æ•°ï¼š18</span>
      <span class="pill">å½¢å¼ï¼š0â€“4ï¼ˆ0=ãœã‚“ãœã‚“ / 4=ã¨ã¦ã‚‚ï¼‰</span>
      <span class="pill">ç·åˆï¼š0â€“4ï¼ˆ6å› å­å¹³å‡ï¼‰</span>
    </div>
    <p class="small">6å› å­ï¼ˆ<b>æ·±ã„å‡¦ç†ï¼åˆºæ¿€ã‚ªãƒ¼ãƒãƒ¼ï¼æƒ…å‹•å…±é³´ï¼äº”æ„Ÿã®ç´°ã‚„ã‹ã•ï¼ç¾çš„æ„Ÿå—ï¼å›å¾©ã¨å¢ƒç•Œ</b>ï¼‰ã‚’ã‚„ã•ã—ãå¯è¦–åŒ–ã—ã¾ã™ã€‚â€»ã‚¨ãƒ³ã‚¿ãƒ¡è‡ªå·±ç†è§£ç”¨ã€‚</p>
  </section>

  <!-- è¨­å• -->
  <section class="card section" id="questions">
    <h2 style="margin:4px 0 8px">è¨­å•ï¼ˆ0=ãœã‚“ãœã‚“ï¼1=ã‚ã¾ã‚Šï¼2=ã¨ãã©ãï¼3=ã‚ˆãï¼4=ã¨ã¦ã‚‚ï¼‰</h2>
    <div id="qWrap"></div>
    <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:10px">
      <button class="btn" id="clearAns">å›ç­”ã‚’ã‚¯ãƒªã‚¢</button>
      <button class="btn primary" id="doScore2">è¨ºæ–­ã™ã‚‹</button>
    </div>
  </section>

  <!-- çµæœ -->
  <section class="card section" id="result" aria-live="polite">
    <div id="resEmpty">
      <span class="badge">ã¾ã çµæœã¯ã‚ã‚Šã¾ã›ã‚“</span>
      <p class="small">å…¨18å•ã«å›ç­”ã—ã¦ã€Œè¨ºæ–­ã™ã‚‹ã€ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚</p>
    </div>

    <div id="resArea" style="display:none">
      <div class="result-head">
        <span class="badge">çµæœ</span>
        <div class="total" id="typeLine">â€”</div>
      </div>

      <!-- ãƒ’ãƒ¼ãƒ­ãƒ¼ï¼šãƒˆãƒƒãƒ—å› å­ç”»åƒï¼‹ãƒ©ãƒ³ã‚¯ãƒãƒƒã‚¸ -->
      <div class="hero-vert section" role="region" aria-label="ã‚¿ã‚¤ãƒ—ã‚¤ãƒ¡ãƒ¼ã‚¸">
        <figure>
          <img id="heroImg" src="/shindan/assets/results/hsp-heart/t01.webp" alt="çµæœã‚¤ãƒ¡ãƒ¼ã‚¸" loading="lazy" width="1200" height="1200">
        </figure>
        <figcaption>
          <div class="title-row">
            <div class="capline" id="heroTitle">â€”</div>
            <span class="badge-size" id="sizeBadge" aria-label="ç·åˆå¹³å‡">â€”</span>
            <span class="rank-chip" id="rankChip" title="ç·åˆãƒ©ãƒ³ã‚¯" aria-label="ç·åˆãƒ©ãƒ³ã‚¯" hidden>
              <img id="rankImg" src="/shindan/assets/results/hsp-heart/t01.webp" alt="ãƒ©ãƒ³ã‚¯ç”»åƒ" loading="lazy" width="24" height="24">
              <span id="rankLabel" class="small">â€”</span>
            </span>
          </div>
          <div class="poem" id="heroPoem">â€”</div>
          <div class="capmini" id="heroCopy">â€”</div>

          <!-- å…±æœ‰ -->
          <div class="share-row" id="shareRow" hidden>
            <a id="shareTw" class="btn tw" href="#" target="_blank" rel="noopener">Xã§å…±æœ‰</a>
            <a id="shareLn" class="btn line" href="#" target="_blank" rel="noopener">LINEã§é€ã‚‹</a>
            <a id="shareIg" class="btn ig" href="#" aria-label="Instagramã§ã‚·ã‚§ã‚¢">Instagramã§ã‚·ã‚§ã‚¢</a>
          </div>
        </figcaption>
      </div>

      <!-- æ•°å€¤ -->
      <div class="grid2">
        <article class="stat" aria-label="ç·åˆã‚¹ã‚³ã‚¢">
          <div><strong>ç·åˆï¼ˆ0â€“4ï¼‰</strong></div>
          <div class="big"><span id="sumAvg">0.00</span> / 4.00 <span class="small" id="sumPct">= 0%</span></div>
          <div class="small" id="sumNote">â€”</div>
        </article>
      </div>

      <div class="hr"></div>

      <!-- å› å­ãƒãƒ¼ -->
      <div class="section">
        <h3 style="margin:8px 0">å› å­åˆ¥ã‚¹ã‚³ã‚¢</h3>
        <div id="bars" class="factor-mini"><!-- JS --></div>
      </div>

      <div class="hr"></div>

      <!-- é•·æ–‡ï¼ˆæ‹¡å¼µã‚³ãƒ¡ãƒ³ãƒˆï¼‹ãƒŸãƒ‹Tipsï¼‰ -->
      <div id="longCopy" class="small"><!-- JS --></div>

      <div class="hr"></div>

      <!-- ä¸‹ä½å› å­ã®ãƒã‚¤ãƒ³ãƒˆ -->
      <div class="section" id="lowSec" hidden>
        <h3 style="margin:8px 0">ä¸‹ä½å› å­ã®ãƒã‚¤ãƒ³ãƒˆï¼ˆè»½ã‚ï¼‰</h3>
        <ul class="small" id="lowHints" style="margin:6px 0 0 18px;line-height:1.8"></ul>
      </div>

      <div class="hr"></div>

      <!-- ç ”ç©¶ãƒ¡ãƒ¢ï¼ˆè¡Œé ­ã€Œã‚ã‚‹ç ”ç©¶ã§ã¯ã€ã€ï¼‰ -->
      <details class="section" open>
        <summary><strong>ç ”ç©¶ãƒ¡ãƒ¢</strong></summary>
        <ul class="small" id="resMemo" style="margin:6px 0 0 18px;line-height:1.8"><!-- JS --></ul>
        <p class="small" style="margin-top:6px">â€»ç›¸é–¢ä¸­å¿ƒã§å› æœã¯æ–­å®šã§ãã¾ã›ã‚“ã€‚å€‹äººå·®ãŒå¤§ãã„æ€§è³ªãŒã‚ã‚Šã¾ã™ã€‚åŒ»ç™‚ãƒ»æ¡ç”¨ãªã©ã®ç”¨é€”ã«ã¯ä½¿ãˆã¾ã›ã‚“ã€‚</p>
      </details>

      <div class="back-area" style="margin-top:12px">
        <a class="back" href="/shindan/" id="backLink" aria-label="è¨ºæ–­ä¸€è¦§ã«æˆ»ã‚‹">è¨ºæ–­ä¸€è¦§ã«æˆ»ã‚‹</a>
      </div>
    </div>
  </section>

  <section class="footer card">
    <h2 style="margin:4px 0 8px">ã”åˆ©ç”¨ã«ã‚ãŸã£ã¦</h2>
    <p class="warn"><strong>æ³¨æ„ï¼š</strong>ã“ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¯<b>ã‚¨ãƒ³ã‚¿ãƒ¡ç”¨ã®è‡ªå·±ç†è§£</b>ã§ã™ã€‚ç¾å®Ÿã®åˆ¤æ–­ï¼ˆåŒ»ç™‚ãƒ»æ¡ç”¨ãªã©ï¼‰ã«ã¯ä½¿ãˆã¾ã›ã‚“ã€‚å¿…è¦ãªå ´åˆã¯é–¢ä¿‚æ©Ÿé–¢ãƒ»å°‚é–€å®¶ã«ã”ç›¸è«‡ãã ã•ã„ã€‚<br>
    å›ç­”ã¯ç«¯æœ«å†…ã§å‡¦ç†ãƒ»ä¿å­˜ã•ã‚Œã€å›ç­”å†…å®¹ã‚„å€‹äººã‚’ç‰¹å®šã§ãã‚‹æƒ…å ±ã¯ã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡ã•ã‚Œã¾ã›ã‚“ã€‚çµæœè¡¨ç¤ºæ™‚ã«åŒ¿åã®ä»¶æ•°ã‚«ã‚¦ãƒ³ãƒˆã®ã¿é€ä¿¡ã™ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚</p>
  </section>
</main>

<script>
/* â˜… indexã‚«ãƒ¼ãƒ‰ï¼ˆè²¼ã‚Šä»˜ã‘ç”¨ï¼‰
<!-- â˜… HSPãƒãƒ¼ãƒˆè¨ºæ–­ï¼ˆ5ãƒ©ãƒ³ã‚¯ï¼‰ -->
<a class="link" href="/shindan/hsp-heart.html?src=specimens"
   data-id="hsp-heart" data-tags="ã“ã“ã‚,ãµã¤ã†,ã—ã£ã‹ã‚Š" data-mins="6" data-updated="2025-10-03"
   data-keywords="HSP ç¹Šç´° æ„Ÿå—æ€§ åˆºæ¿€ å…±æ„Ÿ äº”æ„Ÿ ç¾çš„ å›å¾© å¢ƒç•Œ å¯è¦–åŒ– è¨ºæ–­">
  <span class="emo">ğŸ’—</span>
  <div class="body">
    <div class="ttl">HSPãƒãƒ¼ãƒˆè¨ºæ–­<span class="mini new" data-new>NEW</span></div>
    <div class="sub2">18å•ã§6å› å­ã‚’ï¼…åŒ–ã€‚çµæœã¯ã‚¬ãƒ©ã‚¹ï¼ãƒ™ãƒ«ãƒ™ãƒƒãƒˆï¼ã‚¯ã‚©ãƒ¼ãƒ„ï¼ã‚¹ãƒ†ãƒ³ãƒ¬ã‚¹ï¼ãƒ€ã‚¤ãƒ¤ã®5ãƒãƒ¼ãƒˆã€‚</div>
    <div class="meta"><span class="pill">â±6åˆ†</span><span class="pill">#æ€§æ ¼</span><span class="pill">#ãµã¤ã†</span><span class="pill">#ã—ã£ã‹ã‚Š</span></div>
  </div>
  <span class="badge">è¨ºæ–­ã¸</span>
</a>
*/

(function(){
  // ====== ãƒšãƒ¼ã‚¸æƒ…å ± ======
  var SLUG = "hsp-heart";
  var TITLE = "HSPãƒãƒ¼ãƒˆè¨ºæ–­ â”€ ã“ã“ã‚ã®ç¹Šç´°ã•ã‚’ã‚„ã•ã—ãå¯è¦–åŒ–";
  var IMG_BASE = "/shindan/assets/results/hsp-heart/"; // æœ«å°¾/
  var ANS_KEY = "specimens:"+SLUG+":answers"; // å›ç­”ä¿å­˜ã‚­ãƒ¼

  // ====== ãƒ©ãƒ³ã‚¯å®šç¾©ï¼ˆç·åˆ%ã—ãã„å€¤ï¼‰ ======
  var THRESH = { R1:80, R2:65, R3:50, R4:35, R5:0 };
  var RANKS = {
    R1:{name:"ã‚¬ãƒ©ã‚¹ãƒãƒ¼ãƒˆ",  label:"ç¹Šç´°ã•ãŒå…‰ã‚‹",      img:"rank-01.png",
        one:"ç´°ã‚„ã‹ãªæ„Ÿå—æ€§ãŒã‚ãªãŸã®æŒã¡å‘³ã€‚æ·±ã„å‡¦ç†ã‚„ç¾çš„æ„Ÿå—ã§ã€æ—¥å¸¸ã®ãƒ‹ãƒ¥ã‚¢ãƒ³ã‚¹ã‚’ã¦ã„ã­ã„ã«å—ã‘å–ã‚Œã¾ã™ã€‚",
        long:"ã‚ãªãŸã¯å°ã•ãªå¤‰åŒ–ã«ã‚‚ã™ãæ°—ã¥ã‘ã¦ã€è¨€è‘‰ã‚„éŸ³ã€æ™¯è‰²ã«ãµã‹ãå¿ƒãŒå‹•ãã‚¿ã‚¤ãƒ—ã€‚ã ã‹ã‚‰ã“ãäººã«å¯„ã‚Šããˆã€é¸æŠã‚‚ã¦ã„ã­ã„ã€‚ãŸã ã€åˆºæ¿€ãŒå¤šã„æ—¥ã¯é›»æ± ãŒåˆ‡ã‚Œã‚„ã™ã„ã€‚äºˆå®šã®å‰å¾Œã«â€œé™ã‹ãª10åˆ†â€ã‚’å…¥ã‚Œã€æ˜ã‚‹ã•ãƒ»éŸ³ãƒ»é¦™ã‚Šã‚’å°‘ã—æ•´ãˆã€ç”¨äº‹ã®ã‚ã„ã ã«ä½™ç™½ã‚’ä½œã£ã¦ãŠã“ã†ã€‚ç¹Šç´°ã•ã¯å®ˆã‚Œã°å…‰ã‚‹ã€å¤§åˆ‡ãªå¼·ã¿ã ã‚ˆã€‚",
        care:"ä»Šæ—¥ã¯äºˆå®šã®å‰å¾Œã«â€œé™ã‹ãª10åˆ†â€ï¼‹æ°´åˆ†ã‚’ã²ã¨å£ã€‚",
        more:[
          "ãŠã™ã™ã‚ç’°å¢ƒï¼šé™ã‹ã§å…‰é‡ã¨é¦™ã‚Šã‚’è‡ªåˆ†ã§èª¿æ•´ã§ãã‚‹å ´æ‰€ã€‚",
          "ç›¸æ€§ã®è‰¯ã„å·¥å¤«ï¼šé€šçŸ¥ã‚’ä¸€æ™‚ãƒŸãƒ¥ãƒ¼ãƒˆã€éŸ³ãƒ»å…‰ãƒ»åŒ‚ã„ã‚’1ã¤ãšã¤æ•´ãˆã‚‹ã€‚",
          "äººé–“é–¢ä¿‚ï¼šæ·±å‘¼å¸ï¼‹ã€Œä»Šã¯èãæ‰‹ã§ã„ã‚‹ã­ã€ã§å¢ƒç•Œã‚’ä¿ã¤ã€‚"
        ]},
    R2:{name:"ãƒ™ãƒ«ãƒ™ãƒƒãƒˆãƒãƒ¼ãƒˆ",label:"ã‚„ã‚ã‚‰ã‹ãªå…±æ„Ÿ",  img:"rank-02.png",
        one:"æ„Ÿå—æ€§ã¨ã—ãªã‚„ã‹ã•ã®ãƒãƒ©ãƒ³ã‚¹ãŒå¿ƒåœ°ã‚ˆã„ã‚¿ã‚¤ãƒ—ã€‚å ´é¢ã«åˆã‚ã›ã¦æ„Ÿåº¦ã‚’ã‚„ã•ã—ãèª¿æ•´ã§ãã¾ã™ã€‚",
        long:"å…±æ„Ÿã‚„ç¾ã—ã•ã¸ã®æ„Ÿåº¦ã‚’ä¿ã¡ãªãŒã‚‰ã€åˆ‡ã‚Šæ›¿ãˆã‚‚ã§ãã‚‹è½ã¡ç€ã„ãŸçŠ¶æ…‹ã€‚ã•ã‚‰ã«å¿ƒåœ°ã‚ˆãã™ã‚‹ãªã‚‰ã€ä¼‘ã¿æ–¹ã‚„åˆ‡ã‚Šæ›¿ãˆï¼ˆRECï¼‰ã‚’å°‘ã—ã ã‘æ•´ãˆã¦ã¿ã¾ã—ã‚‡ã†ã€‚é›†ä¸­å‰ã«ãƒã‚¤ã‚ºã‚’1ã¤æ¸›ã‚‰ã™ã€èª˜ã„ã¯â€œåˆ¥æ—¥ææ¡ˆâ€ã«ã—ã¦ã¿ã‚‹ãªã©ã€å°ã•ãªé¸æŠã®ç©ã¿é‡ã­ãŒãã£ã¨åŠ©ã‘ã«ãªã‚Šã¾ã™ã€‚",
        care:"ä»Šæ—¥ã¯â€œéŸ³â€ã ã‘æ•´ãˆã¦ã¿ã‚‹ã€ã®ã‚ˆã†ã«ç„¦ç‚¹ã‚’1ã¤ã ã‘ã€‚",
        more:[
          "ãŠã™ã™ã‚ç’°å¢ƒï¼šé©åº¦ãªåˆºæ¿€ãŒã‚ã‚Šã€éŸ³é‡ã‚’è‡ªåˆ†ã§èª¿æ•´ã§ãã‚‹å ´æ‰€ã€‚",
          "ç›¸æ€§ã®è‰¯ã„å·¥å¤«ï¼šé›†ä¸­å‰ã«ãƒã‚¤ã‚ºæºã‚’1ã¤ã ã‘æ¸›ã‚‰ã™ï¼ˆå¸­æ›¿ãˆ/æ‰‡é¢¨æ©ŸOFFãªã©ï¼‰ã€‚",
          "äººé–“é–¢ä¿‚ï¼šå…±æ„Ÿã®æ™‚é–“ã®å¾Œã¯ç™½æ¹¯ã‚„2åˆ†æ•£æ­©ã§ã‚†ã‚‹ãã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³ã€‚"
        ]},
    R3:{name:"ã‚¯ã‚©ãƒ¼ãƒ„ãƒãƒ¼ãƒˆ", label:"ã»ã©ã‚ˆã„æ„Ÿåº¦",      img:"rank-03.png",
        one:"å ´é¢ã«ã‚ˆã£ã¦ç¹Šç´°ã•ãŒé¡”ã‚’å‡ºã™ã‚¿ã‚¤ãƒ—ã€‚å°‘ã—ã®è¨­è¨ˆã§ã‚ˆã‚Šæ‰±ã„ã‚„ã™ããªã‚Šã¾ã™ã€‚",
        long:"åˆºæ¿€ã«ã¯æ¯”è¼ƒçš„å¼·ã„ä¸€æ–¹ã€ç¶šãã¨ç–²ã‚Œã‚„ã™ã„ã¨ãã‚‚ã€‚å¿…è¦ãªå ´é¢ã§ã ã‘ DOP/SNS ã‚’æ„è­˜ã—ã¦ä½¿ã†ã¨ç›¸æ€§ãŒè‰¯ã•ãã†ã€‚å¤§ããªåˆ¤æ–­å‰ã®5åˆ†ãƒ¡ãƒ¢ã‚„ã€å¸­ãƒ»å…‰ã®é¸ã³ç›´ã—ãªã©ã€ã©ã‚Œã‹ä¸€ã¤ã ã‘æ•´ãˆã‚‹ã ã‘ã§ã‚‚æ‰‹å¿œãˆãŒå¤‰ã‚ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚",
        care:"å¤§äº‹ãªäºˆå®šã®å‰å¾Œã ã‘â€œä½åˆºæ¿€ãƒ¢ãƒ¼ãƒ‰â€ã‚’æ„è­˜ã€‚",
        more:[
          "ãŠã™ã™ã‚ç’°å¢ƒï¼šå ´é¢ã«åˆã‚ã›ã¦æ„Ÿåº¦ã‚’åˆ‡ã‚Šæ›¿ãˆã‚„ã™ã„å ´æ‰€ã€‚",
          "ç›¸æ€§ã®è‰¯ã„å·¥å¤«ï¼šå¤§äº‹ãªå‰ã«5åˆ†ãƒ¡ãƒ¢ï¼‹å¸­ãƒ»å…‰ãƒ»é€šçŸ¥ã®ã€ä¸€ã¤ã ã‘ã€ã‚’æ•´ãˆã‚‹ã€‚",
          "äººé–“é–¢ä¿‚ï¼šæ³¢ã‚’å—ã‘ãŸã‚‰ã€Œäº‹å®Ÿâ†’æ„Ÿæƒ³â†’å¸Œæœ›ã€ã§çŸ­ãè¨€è‘‰ã«ã—ã¦ã¿ã‚‹ã€‚"
        ]},
    R4:{name:"ã‚¹ãƒ†ãƒ³ãƒ¬ã‚¹ãƒãƒ¼ãƒˆ",label:"ã—ãªã‚„ã‹ã«ä¸ˆå¤«",  img:"rank-04.png",
        one:"ç’°å¢ƒã®å¤‰åŒ–ã«ã‚‚è½ã¡ç€ã„ã¦ã„ã‚‰ã‚Œã‚‹ã‚¿ã‚¤ãƒ—ã€‚è¦³å¯Ÿã‚’ã²ã¨å‘¼å¸è¶³ã™ã¨ã€é¸æŠãŒã•ã‚‰ã«æ»‘ã‚‰ã‹ã«ãªã‚Šã¾ã™ã€‚",
        long:"é¨’ãŒã—ã•ã‚„äºˆå®šã®å¤‰åŒ–ã«ã‚‚è½ã¡ç€ã„ã¦ã„ã‚‰ã‚Œã‚‹ç©ã‚„ã‹ãªåŸºç›¤ã€‚ä¼šè©±ã®å‰ã«ã²ã¨å‘¼å¸ãŠã„ã¦ã€è¡¨æƒ…ã‚„å£°è‰²ã‚’ãã£ã¨çœºã‚ã‚‹ã¨ã€ä¼ã‚ã‚Šæ–¹ãŒã‚„ã•ã—ãæ•´ã†ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚",
        care:"è¿”ç­”ã®å‰ã«å°ã•ãâ€œ1æ‹ç½®ãâ€ã‚’åˆå›³ã«ã€‚",
        more:[
          "ãŠã™ã™ã‚ç’°å¢ƒï¼šå¤‰åŒ–ã®å¤šã„å ´ã§ã‚‚éã”ã—ã‚„ã™ã„å‚¾å‘ã€‚è¦³å¯Ÿã‚’ã²ã¨å‘¼å¸åŠ ãˆã‚‹ã¨å®‰å¿ƒã€‚",
          "ç›¸æ€§ã®è‰¯ã„å·¥å¤«ï¼šè¿”ç­”å‰ã«1æ‹ãŠãã€è¡¨æƒ…ã¨å£°è‰²ã‚’ãã£ã¨ç¢ºèªã™ã‚‹ã¨è¡Œãé•ã„ãŒæ¸›ã‚Šã‚„ã™ã„ã€‚",
          "äººé–“é–¢ä¿‚ï¼šè¦ä»¶â†’æ„Ÿæƒ…â†’è¦æœ›ã®é †ã§èãã¨åˆæ„ã«ãŸã©ã‚Šç€ãã‚„ã™ã„ã€‚"
        ]},
    R5:{name:"ãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰ãƒãƒ¼ãƒˆ",label:"ã¨ã¦ã‚‚ä¸ˆå¤«",     img:"rank-05.png",
        one:"åˆºæ¿€ã‚„å¤‰åŒ–ã«ã¨ã¦ã‚‚å¼·ã„ã‚¿ã‚¤ãƒ—ã€‚å¿…è¦ãªå ´é¢ã ã‘ç¹Šç´°ã•ã‚’ãã£ã¨å‘¼ã³å‡ºã™ä½¿ã„æ–¹ãŒåˆã„ãã†ã§ã™ã€‚",
        long:"æ±ºæ–­ã®é€Ÿã•ã‚„è¡Œå‹•åŠ›ãŒæŒã¡å‘³ã€‚ãµã ã‚“ã¯ç¹Šç´°ã•ã‚’å¼·ã‚ã«æ„è­˜ã—ãªãã¦ã‚‚å¤§ä¸ˆå¤«ã€‚å¤§åˆ‡ãªå ´é¢ã ã‘ DOP/SNS ã‚’ãã£ã¨æ„è­˜ã—ã¦â€œå‘¼ã³å‡ºã™â€ã¨ã€ç²¾åº¦ã‚„ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒã»ã©ã‚ˆãæ•´ã„ã¾ã™ã€‚ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã‚„ç¢ºèªã®ã²ã¨è¨€ã‚’æ‰‹å…ƒã«ç½®ã„ã¦ãŠãã¨å®‰å¿ƒã§ã™ã€‚",
        care:"å§‹ã‚ã‚‹å‰ã«â€œ5åˆ†ãƒ¡ãƒ¢ï¼‹ç¢ºèªã®ã²ã¨è¨€â€ã‚’ã€‚",
        more:[
          "ãŠã™ã™ã‚ç’°å¢ƒï¼šãƒ†ãƒ³ãƒã®é€Ÿã„å ´ã€‚ç¹Šç´°ã•ã¯å¿…è¦ãªæ™‚ã ã‘æ„è­˜ã—ã¦ONã€‚",
          "ç›¸æ€§ã®è‰¯ã„å·¥å¤«ï¼šãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆåŒ–ï¼‹ç¢ºèªã®ã²ã¨è¨€ã‚’æ‰‹å…ƒã«ç½®ã„ã¦ãŠãã¨å®‰å¿ƒã€‚",
          "äººé–“é–¢ä¿‚ï¼šä¼šè­°ã®æœ€åˆã«ç›®çš„ã‚’ç¢ºèªã—ã€è¦ç‚¹ã‚’çŸ­ãç®‡æ¡æ›¸ãã«ã€‚"
        ]}
  };

  // ====== å› å­ãƒ»è¨­å• ======
  var FACTORS = {
    DOP:{ name:"æ·±ã„å‡¦ç†",           items:["Q01","Q02","Q03"], img:"01.png", alt:"ç‰©äº‹ã‚’æ·±ãå‘³ã‚ã†å¿ƒ" },
    OVS:{ name:"åˆºæ¿€ã‚ªãƒ¼ãƒãƒ¼",       items:["Q04","Q05","Q06"], img:"02.png", alt:"åˆºæ¿€ã«åœ§å€’ã•ã‚Œã‚„ã™ã„å¿ƒ" },
    EMO:{ name:"æƒ…å‹•å…±é³´",           items:["Q07","Q08","Q09"], img:"03.png", alt:"å…±é³´ã™ã‚‹å¿ƒ" },
    SNS:{ name:"äº”æ„Ÿã®ç´°ã‚„ã‹ã•",     items:["Q10","Q11","Q12"], img:"04.png", alt:"ç´°éƒ¨ã«æ°—ã¥ãå¿ƒ" },
    AES:{ name:"ç¾çš„æ„Ÿå—",           items:["Q13","Q14","Q15"], img:"05.png", alt:"ç¾ã«å‹•ãå¿ƒ" },
    REC:{ name:"å›å¾©ã¨å¢ƒç•Œ",         items:["Q16","Q17","Q18"], img:"06.png", alt:"å›å¾©ã¨å¢ƒç•Œã®å¿ƒ" }
  };

  var ITEMS = [
    {id:"Q01",text:"å‡ºæ¥äº‹ã®æ„å‘³ã‚’è€ƒãˆã€å¾Œã‹ã‚‰æ–°ã—ã„æ°—ã¥ããŒå‡ºã¦ãã‚‹ã€‚"},
    {id:"Q02",text:"çµè«–ã‚’æ€¥ãŒãšã€ã„ã£ãŸã‚“ã€Œä¿ç•™ã€ã§ç½®ã‘ã‚‹ã€‚"},
    {id:"Q03",text:"è€ƒãˆãŒæµ…ã„ã¾ã¾å‹¢ã„ã§æ±ºã‚ã¦å¾Œæ‚”ã—ãŒã¡ã ã€‚",rev:true},
    {id:"Q04",text:"äººæ··ã¿ã‚„å¤§éŸ³é‡ã®å ´æ‰€ã§ãƒ˜ãƒˆãƒ˜ãƒˆã«ãªã‚Šã‚„ã™ã„ã€‚"},
    {id:"Q05",text:"é¨’ãŒã—ã„ç’°å¢ƒã§ã‚‚ã»ã¨ã‚“ã©æ°—ã«ãªã‚‰ãªã„ã€‚",rev:true},
    {id:"Q06",text:"äºˆå®šãŒè©°ã¾ã‚‹ã¨ã€åˆºæ¿€ã«åœ§å€’ã•ã‚Œã‚„ã™ã„ã€‚"},
    {id:"Q07",text:"ç›¸æ‰‹ã®è¡¨æƒ…ã®ã‚ãšã‹ãªå¤‰åŒ–ã«æ°—ã¥ã„ã¦æ°—ã«ã‹ã‘ã‚‹ã€‚"},
    {id:"Q08",text:"ã¤ã‚‰ã„è©±ã‚’èã„ãŸå¾Œã€è‡ªåˆ†ã®æ°—åˆ†ãŒå¼•ããšã‚‰ã‚Œã‚‹ã€‚"},
    {id:"Q09",text:"ä»–äººã®æ„Ÿæƒ…ã«ã»ã¨ã‚“ã©å½±éŸ¿ã•ã‚Œãªã„ã€‚",rev:true},
    {id:"Q10",text:"ç…§æ˜ãƒ»é¦™ã‚Šãƒ»è¡£é¡ã®ã‚¿ã‚°ãªã©ç´°éƒ¨ã®ä¸å¿«ã«æ•æ„Ÿã€‚"},
    {id:"Q11",text:"ç©ºæ°—ã®æ¸©åº¦ã‚„è³ªæ„Ÿã®å°ã•ãªå·®ã«ã‚‚æ°—ã¥ãã“ã¨ãŒã‚ã‚‹ã€‚"},
    {id:"Q12",text:"éƒ¨å±‹ã®é›‘ç„¶ã•ã‚„ãƒã‚¤ã‚ºã«æ°—ã¥ãã«ãã„ã€‚",rev:true},
    {id:"Q13",text:"éŸ³æ¥½ã‚„è¨€è‘‰ã€æ™¯è‰²ã«èƒ¸ãŒã˜ã‚“ã¨ã™ã‚‹ã“ã¨ãŒå¤šã„ã€‚"},
    {id:"Q14",text:"å°ã•ãªå·¥èŠ¸ã‚„æ‰€ä½œã®ç¾ã—ã•ã«å¼·ãæƒ¹ã‹ã‚Œã‚‹ã€‚"},
    {id:"Q15",text:"èŠ¸è¡“ã‚„è‡ªç„¶ã«ã‚ã¾ã‚Šå¿ƒãŒå‹•ã‹ãªã„ã€‚",rev:true},
    {id:"Q16",text:"ç–²ã‚ŒãŸã‚‰é™ã‹ãªæ™‚é–“ã‚’ç¢ºä¿ã™ã‚‹å·¥å¤«ãŒã§ãã‚‹ã€‚"},
    {id:"Q17",text:"ç„¡ç†ãªèª˜ã„ã«ã€Œä»Šæ—¥ã¯ã‚„ã‚ã¦ãŠãã­ã€ã¨è¨€ãˆã‚‹ã€‚"},
    {id:"Q18",text:"ç–²ã‚Œã¦ã‚‚ã¤ã„ç„¡ç†ã‚’ç¶šã‘ã¦ã—ã¾ã†ã€‚",rev:true}
  ];

  var LABELS = ["ãœã‚“ãœã‚“","ã‚ã¾ã‚Š","ã¨ãã©ã","ã‚ˆã","ã¨ã¦ã‚‚"];
  var REVERSED = new Set(["Q03","Q05","Q09","Q12","Q15","Q18"]);
  var HYBRID_DELTA = 8; // 1ä½ã¨2ä½ãŒè¿‘ã„æ™‚ã®è¡¨è¨˜ç”¨

  // ====== è¦ç´ å‚ç…§ ======
  var qWrap   = document.getElementById("qWrap");
  var prog    = document.getElementById("prog");
  var resEmpty= document.getElementById("resEmpty");
  var resArea = document.getElementById("resArea");
  var typeLine= document.getElementById("typeLine");
  var heroImg = document.getElementById("heroImg");
  var heroTitle= document.getElementById("heroTitle");
  var heroPoem = document.getElementById("heroPoem");
  var heroCopy = document.getElementById("heroCopy");
  var sizeBadgeEl= document.getElementById("sizeBadge");
  var rankChip = document.getElementById("rankChip");
  var rankImg  = document.getElementById("rankImg");
  var rankLabel= document.getElementById("rankLabel");
  var sumAvg  = document.getElementById("sumAvg");
  var sumPct  = document.getElementById("sumPct");
  var sumNote = document.getElementById("sumNote");
  var bars    = document.getElementById("bars");
  var longCopy= document.getElementById("longCopy");
  var resMemo = document.getElementById("resMemo");
  var shareRow= document.getElementById("shareRow");
  var shareTw = document.getElementById("shareTw");
  var shareLn = document.getElementById("shareLn");
  var shareIg = document.getElementById("shareIg");
  var lowSec  = document.getElementById("lowSec");
  var lowHints= document.getElementById("lowHints");

  // ====== è¨­å•ç”Ÿæˆï¼ˆä¿å­˜ãƒ»å¾©å…ƒå¯¾å¿œï¼‰ ======
  function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; } return a; }

  function buildQuestions(){
    // ãƒ©ãƒ³ãƒ€ãƒ é †ï¼ˆå›ºå®šã«ã—ãŸã„å ´åˆã¯ ITEMS.slice() ã«ï¼‰
    var order = shuffle(ITEMS.slice());
    var html = "";
    for(var i=0;i<order.length;i++){
      var q = order[i];
      html += '<fieldset class="q" id="fs-'+q.id+'">'+
        '<legend>'+q.text+'</legend>'+
        '<div class="scale" role="radiogroup" aria-label="'+q.text+'">';
      for(var v=0;v<=4;v++){
        html += '<div style="position:relative">'+
          '<input id="q'+q.id+'-'+v+'" type="radio" name="q'+q.id+'" value="'+v+'">'+
          '<label for="q'+q.id+'-'+v+'" title="'+LABELS[v]+'">'+LABELS[v]+'</label>'+
        '</div>';
      }
      html += '</div></fieldset>';
    }
    qWrap.innerHTML = html;

    var radios = qWrap.querySelectorAll('input[type="radio"]');
    for(var r=0;r<radios.length;r++){
      radios[r].addEventListener('change', function(){
        saveAnswers(); updateProgress();
      }, false);
    }
    restoreAnswers(); updateProgress();

    // ã™ã¹ã¦åŸ‹ã¾ã£ã¦ã„ã‚Œã°è‡ªå‹•é›†è¨ˆï¼ˆå†è¨ªå³è¡¨ç¤ºï¼‰
    if(countAnswered()===ITEMS.length){ score(true); }
  }

  // ====== ä¿å­˜/å¾©å…ƒ ======
  function saveAnswers(){
    try{
      var out = {};
      for(var i=0;i<ITEMS.length;i++){
        var id = ITEMS[i].id;
        var chk = qWrap.querySelector('#fs-'+id+' input[type="radio"]:checked');
        if(chk){ out[id] = parseInt(chk.value,10); }
      }
      localStorage.setItem(ANS_KEY, JSON.stringify({ts:Date.now(), ans:out}));
    }catch(e){}
  }
  function restoreAnswers(){
    try{
      var raw = localStorage.getItem(ANS_KEY);
      if(!raw) return;
      var data = JSON.parse(raw);
      var ans = (data && data.ans) || {};
      Object.keys(ans).forEach(function(id){
        var v = ans[id];
        var input = qWrap.querySelector('#q'+id+'-'+v);
        if(input){ input.checked = true; }
      });
    }catch(e){}
  }
  function wipeAnswers(){
    try{ localStorage.removeItem(ANS_KEY); }catch(e){}
  }
  function countAnswered(){
    var n=0;
    for(var i=0;i<ITEMS.length;i++){
      if(qWrap.querySelector('input[name="q'+ITEMS[i].id+'"]:checked')) n++;
    }
    return n;
  }

  function updateProgress(){
    var total = ITEMS.length;
    var answered = countAnswered();
    var pct = Math.round(100*answered/total);
    prog.style.width = pct + "%";
    var bar = prog.parentElement;
    if(bar){
      bar.setAttribute("aria-valuenow", answered);
      bar.setAttribute("aria-label", "å›ç­”é€²æ—ï¼š"+answered+" / "+total);
    }
  }

  // ====== ã‚¹ã‚³ã‚¢è¨ˆç®— ======
  function valOf(id, raw){ var v=Number(raw); return REVERSED.has(id)?(4-v):v; }

  function score(silent){
    var missing = [];
    var ans = {};
    for(var i=0;i<ITEMS.length;i++){
      var id = ITEMS[i].id;
      var chk = qWrap.querySelector('#fs-'+id+' input[type="radio"]:checked');
      if(!chk){ missing.push(id); continue; }
      ans[id] = parseInt(chk.value,10);
    }
    if(missing.length){
      if(!silent){
        alert("æœªå›ç­”ãŒã‚ã‚Šã¾ã™ã€‚å…¨18å•ã«ãŠç­”ãˆãã ã•ã„ã€‚");
        var fs = document.getElementById('fs-'+missing[0]);
        if(fs){ fs.scrollIntoView({behavior:"smooth", block:"center"}); fs.classList.add("need"); setTimeout(function(){ fs.classList.remove("need"); },1600); }
      }
      return;
    }

    var fScore = {}, fPct = {};
    Object.keys(FACTORS).forEach(function(key){
      var ids = FACTORS[key].items;
      var sum = ids.reduce(function(s,id){ return s + valOf(id, ans[id]); },0);
      var avg = sum / ids.length; // 0-4
      fScore[key] = avg;
      fPct[key] = Math.round((avg/4)*100);
    });

    var keys = Object.keys(FACTORS);
    var totalAvg = keys.reduce(function(s,k){ return s + fScore[k]; },0) / keys.length;
    var totalPct = Math.round((totalAvg/4)*100);

    var order = keys.slice().sort(function(a,b){ return fPct[b]-fPct[a]; });
    var top = order[0], second = order[1];
    var diff = fPct[top]-fPct[second];
    var hybrid = (diff<=HYBRID_DELTA);

    var rankKey = (totalPct>=THRESH.R1)?"R1":(totalPct>=THRESH.R2)?"R2":(totalPct>=THRESH.R3)?"R3":(totalPct>=THRESH.R4)?"R4":"R5";

    render({ fScore, fPct, totalAvg, totalPct, top, second, diff, hybrid, rankKey, order });
  }

  function render(o){
    var topDef = FACTORS[o.top];
    var rank = RANKS[o.rankKey];

    // ã‚¿ã‚¤ãƒˆãƒ«è¡Œ
    var typeText = 'ãƒˆãƒƒãƒ—å› å­ï¼š'+topDef.name + (o.hybrid ? ' ï¼ ç¬¬2ä½ï¼š'+FACTORS[o.second].name+'ï¼ˆå·® '+o.diff+'%ï¼‰' : '');
    typeLine.textContent = typeText;

    // ãƒ’ãƒ¼ãƒ­ãƒ¼ï¼ˆãƒˆãƒƒãƒ—å› å­ç”»åƒï¼‰ï¼‹ãƒ©ãƒ³ã‚¯
    heroImg.src = heroPathFromRank(o.rankKey);
    heroImg.alt = topDef.alt;
    heroTitle.textContent = topDef.name + (o.hybrid ? ' Ã— '+FACTORS[o.second].name : '');
    heroPoem.textContent  = 'ç¹Šç´°ã•ã®æ‰±ã„æ–¹ã‚’ã€6å› å­ã§ã‚„ã•ã—ãå¯è¦–åŒ–ã€‚';
    heroCopy.textContent  = rank.one;
    sizeBadgeEl.textContent = "ç·åˆ " + o.totalAvg.toFixed(2) + " / 4.00";
    rankImg.src = heroPathFromRank(o.rankKey);
    rankLabel.textContent = rank.name + "ï¼ˆ" + rank.label + "ï¼‰";
    rankChip.hidden = false;

    // ç·åˆ
    sumAvg.textContent = o.totalAvg.toFixed(2);
    sumPct.textContent = "= " + o.totalPct + "%";
    sumNote.textContent = "ãƒ©ãƒ³ã‚¯ï¼š"+rank.name+"ï¼ˆ"+rank.label+"ï¼‰";

    // å› å­ãƒãƒ¼
    var bHtml = "";
    Object.keys(FACTORS).forEach(function(key){
      var def = FACTORS[key];
      var avg = o.fScore[key], pct = o.fPct[key];
      bHtml += '<article class="bar" aria-label="'+def.name+'">'+
        '<div><strong>'+def.name+'</strong><span class="pill" style="margin-left:6px">'+avg.toFixed(2)+' / 4</span>'+
        '<span class="pill" style="margin-left:6px">'+pct+'%</span></div>'+
        '<div class="row" aria-hidden="true"><span style="width:'+pct+'%"></span></div>'+
      '</article>';
    });
    bars.innerHTML = bHtml;

    // é•·æ–‡ï¼ˆæ‹¡å¼µï¼‰
    var list = (rank.more||[]).map(function(s){ return '<li>'+s+'</li>'; }).join('');
    longCopy.innerHTML = '<p>'+rank.long+'</p><ul style="margin:6px 0 0 18px;line-height:1.8">'+list+'</ul><p style="margin-top:6px"><b>1è¡Œã‚±ã‚¢ï¼š</b>'+rank.care+'</p>';

    // ä¸‹ä½å› å­ã®ãƒã‚¤ãƒ³ãƒˆï¼ˆ2ã¤ï¼‰
    var orderAsc = o.order.slice().reverse(); // ä½ã„â†’é«˜ã„
    var lows = orderAsc.slice(0,2);
    var LOW_HINT = {
      DOP:"æ„æ€æ±ºå®šã®é€Ÿã•ã¯å¼·ã¿ã€‚å¤§äº‹ãªå ´é¢ã ã‘â€œ5åˆ†ãƒ¡ãƒ¢â€ã§æ ¹æ‹ ã‚’è¶³ã™ã¨ç²¾åº¦ãŒã‚„ã•ã—ãä¸ŠãŒã‚Šã¾ã™ã€‚",
      OVS:"åˆºæ¿€ã«æ¯”è¼ƒçš„å¼·ã‚ã€‚ã€ç–²ã‚Œã®å‰è§¦ã‚Œã‚µã‚¤ãƒ³ã€ã‚’1ã¤æ±ºã‚ã¦ã€ä¼‘æ†©ã®åˆå›³ã«ã€‚",
      EMO:"å¼•ããšã‚‰ã‚Œã«ãã„ã®ã¯é•·æ‰€ã€‚ã€äº‹å®Ÿâ†’æ„Ÿæƒ³â†’å¸Œæœ›ã€ã®è¨€ã„æ›ãˆã‚’ç”¨æ„ã—ã¦ãŠãã¨å®‰å¿ƒã€‚",
      SNS:"å°ã•ãªä¸å¿«ã«ã¨ã‚‰ã‚ã‚Œã«ããé›†ä¸­ã—ã‚„ã™ã„ã€‚å¤§äº‹ãªå ´ã ã‘å¸­ã‚„å…‰ã‚’é¸ã³ç›´ã™ã¨ã‚ˆã•ãã†ã€‚",
      AES:"ç¾ã«å·¦å³ã•ã‚Œã«ãã„å …å®Ÿã•ã€‚BGMã‚„é¦™ã‚Šã‚’1ã¤è¶³ã™ã¨ã€æ°—åˆ†ã®ã‚„ã•ã—ã„ã‚¹ã‚¤ãƒƒãƒã«ãªã‚Šã¾ã™ã€‚",
      REC:"è¸ã‚“å¼µã‚ŠãŒåˆ©ãã‚¿ã‚¤ãƒ—ã€‚ã€ä»Šæ—¥ã¯ã“ã“ã¾ã§ã€ã®åˆå›³ã§ã€æŒã¡è¶Šã—ã®ç–²ã‚Œã‚’ã‚„ã‚ã‚‰ã’ã¾ã—ã‚‡ã†ã€‚"
    };
    var lowList = lows.map(function(k){
      return '<li><b>'+FACTORS[k].name+'</b>ï¼š'+LOW_HINT[k]+'</li>';
    }).join('');
    if(lowList){
      lowHints.innerHTML = lowList;
      lowSec.hidden = false;
    }

    // ç ”ç©¶ãƒ¡ãƒ¢ï¼ˆã€Œã‚ã‚‹ç ”ç©¶ã§ã¯ã€ã€ã§å§‹ã‚ã‚‹ï¼‰
    var memo = [
      "ã‚ã‚‹ç ”ç©¶ã§ã¯ã€æ„Ÿè¦šå‡¦ç†ã®æ•æ„Ÿã•ã¯æ·±ã„æƒ…å ±å‡¦ç†ã‚„å‰µé€ æ€§ã¨çµã³ã¤ãç¤ºå”†ã€‚",
      "ã‚ã‚‹ç ”ç©¶ã§ã¯ã€éå‰°ãªåˆºæ¿€ï¼ˆéŸ³ãƒ»å…‰ãƒ»äººæ··ã¿ï¼‰ãŒç–²åŠ´ã‚„é›†ä¸­ä½ä¸‹ã¨é–¢é€£ã—ã€ç’°å¢ƒèª¿æ•´ãŒåŠ©ã‘ã«ãªã‚‹å¯èƒ½æ€§ã€‚",
      "ã‚ã‚‹ç ”ç©¶ã§ã¯ã€æƒ…å‹•ã®å…±é³´ã¯æ´åŠ©è¡Œå‹•ã‚„å¯¾äººæº€è¶³ã«é–¢ã‚ã‚‹ä¸€æ–¹ã€å¼•ããšã‚ŠãŒèª²é¡Œã«ãªã‚‹ã“ã¨ãŒã‚ã‚‹ç¤ºå”†ã€‚",
      "ã‚ã‚‹ç ”ç©¶ã§ã¯ã€è¨ˆç”»çš„ãªä¼‘æ¯ãƒ»åˆ‡æ›¿ï¼ˆå›å¾©ã¨å¢ƒç•Œï¼‰ãŒãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç¶­æŒã«å½¹ç«‹ã¤å¯èƒ½æ€§ã€‚",
      "ã‚ã‚‹ç ”ç©¶ã§ã¯ã€æ›–æ˜§ã•è€æ€§ã‚„å†è©•ä¾¡ï¼ˆreappraisalï¼‰ãŒæƒ…å‹•èª¿æ•´ã¨é–¢é€£ã™ã‚‹å ±å‘Šã€‚"
    ];
    resMemo.innerHTML = memo.map(function(s){ return "<li>"+s+"</li>"; }).join("");

    // ==== å…±æœ‰ãƒªãƒ³ã‚¯ç”Ÿæˆ ====
    var shareText = 'ã€HSPãƒãƒ¼ãƒˆè¨ºæ–­ã€ãƒ©ãƒ³ã‚¯ï¼š' + rank.name + 'ï¼ˆ' + rank.label + 'ï¼‰ï½œç·åˆ ' + o.totalAvg.toFixed(2) + ' / 4';
    var url = location.href.split('#')[0];

    // Xï¼ˆTwitter Intentã‚’åˆ©ç”¨ï¼‰
    var tw = 'https://twitter.com/intent/tweet?text=' + encodeURIComponent(shareText) + '&url=' + encodeURIComponent(url);
    if (shareTw) shareTw.href = tw;

    // LINE
    var ln = 'https://line.me/R/msg/text/?' + encodeURIComponent(shareText + ' ' + url);
    if (shareLn) shareLn.href = ln;

    // Instagramï¼ˆã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ã‚³ãƒ”ãƒ¼â†’ã‚¢ãƒ—ãƒª/WEBï¼‰
    if (shareIg) {
      shareIg.onclick = function(e){
        e.preventDefault();
        var caption = shareText + ' ' + url;
        copyToClipboard(caption).then(function(){
          var opened = false;
          try{ var w = window.open('instagram://app','_blank'); opened = !!w; }catch(_){}
          if(!opened){ window.open('https://www.instagram.com/','_blank'); }
          toast('ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸã€‚Instagramã§è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ã€‚');
        });
      };
    }
    if (shareRow) shareRow.hidden = false;

    // è¡¨ç¤º
    resEmpty.style.display = "none";
    resArea.style.display  = "block";
    document.getElementById("result").scrollIntoView({behavior:"smooth", block:"start"});

    try{
      document.dispatchEvent(new Event('result:ready'));
      localStorage.setItem("specimens:last", JSON.stringify({ id: SLUG, title: TITLE, href: location.pathname }));
    }catch(e){}
  }

  // å…±æœ‰ãƒ˜ãƒ«ãƒ‘ãƒ¼
  function copyToClipboard(text){
    if(navigator.clipboard && navigator.clipboard.writeText){
      return navigator.clipboard.writeText(text);
    }
    return new Promise(function(res){
      var ta=document.createElement('textarea'); ta.value=text;
      document.body.appendChild(ta); ta.select();
      try{ document.execCommand('copy'); }catch(_){}
      document.body.removeChild(ta); res();
    });
  }
  function toast(msg){
    var t=document.createElement('div');
    t.textContent=msg;
    t.style.position='fixed'; t.style.left='50%'; t.style.bottom='20px';
    t.style.transform='translateX(-50%)';
    t.style.background='rgba(43,35,48,.92)'; t.style.color='#fff';
    t.style.padding='8px 12px'; t.style.borderRadius='10px';
    t.style.zIndex=9999; t.style.fontSize='13px';
    document.body.appendChild(t);
    setTimeout(function(){ t.remove(); },1500);
  }

  // ã‚¯ãƒªã‚¢
  function clearAnswers(){
    var radios = qWrap.querySelectorAll('input[type="radio"]');
    for(var i=0;i<radios.length;i++){ radios[i].checked=false; }
    wipeAnswers();
    prog.style.width = "0%";
    resEmpty.style.display = "";
    resArea.style.display = "none";
    var app = document.getElementById("app");
    if(app){ app.scrollIntoView({behavior:"smooth", block:"start"}); }
  }

  // åˆæœŸåŒ–
  if(document.readyState === "loading"){
    document.addEventListener("DOMContentLoaded", function(){ buildQuestions(); });
  }else{
    buildQuestions();
  }
  document.getElementById("doScore").addEventListener("click", function(){ score(false); }, false);
  document.getElementById("doScore2").addEventListener("click", function(){ score(false); }, false);
  document.getElementById("clearAns").addEventListener("click", clearAnswers, false);
  var back = document.getElementById("backLink");
  if(back){
    back.addEventListener("click", function(){
      try{
        localStorage.setItem("specimens:last", JSON.stringify({ id: SLUG, title: TITLE, href: location.pathname }));
      }catch(e){}
    }, false);
  }
})();

</script>
<script>
(function(){
  'use strict';
  var DONE_KEY   = 'specimens:open:byid';
  var TOTAL_KEY  = 'specimens:open:total';
  var GLOBAL_LAST= 'specimens:open:global:last';
  var MY_ID = (document.body && document.body.getAttribute('data-id')) || 'unknown';

  // ã¿ã‚“ãªã®Lvï¼ˆCountAPIï¼‰
  var COUNTAPI_NS  = 'haisuikounozarigani_shindan';
  var COUNTAPI_KEY = 'specimens_open_total';
  function countapiHit(){
    var url = 'https://api.countapi.xyz/hit/'+COUNTAPI_NS+'/'+COUNTAPI_KEY;
    if(navigator.sendBeacon){ try{ navigator.sendBeacon(url); }catch(_){} }
    else{ fetch(url, {mode:'cors', cache:'no-store', keepalive:true}).catch(function(){}); }
  }

  var marked = false;
  function markOnce(){
    if(marked) return; marked = true;
    try{
      var total = (+localStorage.getItem(TOTAL_KEY) || 0) + 1;
      localStorage.setItem(TOTAL_KEY, String(total));

      var map={}; try{ map = JSON.parse(localStorage.getItem(DONE_KEY) || '{}'); }catch(_){}
      map[MY_ID] = (map[MY_ID] || 0) + 1;
      localStorage.setItem(DONE_KEY, JSON.stringify(Object.assign({}, map, {_ts: Date.now()})));

      countapiHit();
      try{
        var last = (+localStorage.getItem(GLOBAL_LAST) || 0) + 1;
        localStorage.setItem(GLOBAL_LAST, String(last));
      }catch(_){}
    }catch(_){}
  }
  document.addEventListener('result:ready', markOnce);
  setTimeout(markOnce, 2000);
})();
</script>
<script>
function heroPathFromRank(rankKey){
  var n = (rankKey==='R1'?1:rankKey==='R2'?2:rankKey==='R3'?3:rankKey==='R4'?4:5);
  return "/shindan/assets/results/hsp-heart/" + "t" + String(n).padStart(2,"0") + ".webp";
}
</script>
</body>
</html>