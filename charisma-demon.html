<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>æ‚ªé­”ã‚«ãƒªã‚¹ãƒè¨ºæ–­</title>
<meta name="description" content="ãƒ€ãƒ¼ã‚¯å¯„ã‚Šã®3å› å­Ã—å„6å•ï¼ˆ0ã€œ4ã®5ä»¶æ³•ï¼‰ã€‚ç·åˆãƒ©ãƒ³ã‚¯ï¼ˆLv1ã€œLv5ï¼‰ã¨å› å­ãƒãƒ¼ã€å‚¾å‘ã‚¢ãƒ‰ãƒã‚¤ã‚¹ï¼†ç ”ç©¶ãƒ¡ãƒ¢ã‚’è¡¨ç¤ºï¼ˆç‹¬è‡ªé …ç›®ãƒ»ã‚¨ãƒ³ã‚¿ãƒ¡ç”¨ï¼‰ã€‚">
<meta name="theme-color" content="#0b0f1a">
<meta property="og:type" content="website">
<meta property="og:title" content="æ‚ªé­”ã‚«ãƒªã‚¹ãƒè¨ºæ–­">
<meta property="og:description" content="18å•ã§â€œãƒ€ãƒ¼ã‚¯ãƒ»ã‚«ãƒªã‚¹ãƒâ€å‚¾å‘ã‚’ãƒã‚§ãƒƒã‚¯ã€‚ç·åˆãƒ©ãƒ³ã‚¯ã¨å› å­ãƒãƒ¼ã€ç ”ç©¶ãƒ¡ãƒ¢ã‚’è¡¨ç¤ºã€‚">
<meta property="og:url" content="https://haisuikounozarigani.github.io/shindan/charisma-demon.html">
<meta property="og:image" content="/shindan/assets/results/charisma-demon/03.png">
<style>
:root{
  --ink:#e7ebff; --muted:#a7b0c7; --paper:#0b0f1a;
  --bg1:#0b0f1a; --bg2:#0a0d16; --line:#1a2233;
  --accent:#a951ff; --accent2:#ff6a6a;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; color:var(--ink);
  background:radial-gradient(1200px 600px at 50% -10%, #131a2b 0%, var(--bg1) 50%), linear-gradient(180deg,var(--bg1),var(--bg2));
  font-family:"Noto Sans JP",system-ui,-apple-system,"Segoe UI",Roboto,"Hiragino Kaku Gothic ProN",sans-serif;
  -webkit-font-smoothing:antialiased;
}
a{color:inherit}
.wrap{max-width:980px;margin:18px auto;padding:0 14px}
header.hd{display:grid;grid-template-columns:56px 1fr;gap:12px;align-items:center;margin:8px 0}
.logo{width:56px;height:56px;border-radius:14px;background:linear-gradient(135deg,rgba(169,81,255,.22),rgba(255,106,106,.18));display:grid;place-items:center;font-size:28px}
h1{margin:0;font-size:clamp(22px,4.6vw,34px);letter-spacing:.02em}
.sub{margin:4px 0 0;color:var(--muted);font-size:.96em}
.card{background:rgba(255,255,255,.03);border:1px solid var(--line);border-radius:16px;padding:14px}
.section{margin:14px 0}
.pill{display:inline-block;padding:4px 8px;border:1px solid var(--line);border-radius:999px;background:rgba(255,255,255,.04);color:#c9d2ee;font-size:.88em}
.meta{display:flex;gap:8px;flex-wrap:wrap}
.sticky{position:sticky;top:0;z-index:10;margin:-6px -14px 12px;padding:8px 14px;background:rgba(7,10,18,.78);backdrop-filter:blur(8px) saturate(1.05);border-bottom:1px solid var(--line);display:flex;align-items:center;gap:10px}
.progress{height:8px;background:#141c2b;border-radius:999px;flex:1;overflow:hidden}
.progress>span{display:block;height:100%;width:0;background:linear-gradient(90deg,var(--accent),var(--accent2))}
.btn{padding:10px 14px;border:1px solid var(--line);border-radius:12px;background:rgba(255,255,255,.04);color:#fff;cursor:pointer}
.btn.primary{background:linear-gradient(90deg,var(--accent),var(--accent2));border-color:transparent;color:#fff;font-weight:700}
fieldset.q{border:1px solid var(--line);border-radius:12px;padding:10px;margin:10px 0;background:rgba(255,255,255,.02)}
legend{font-weight:700}
.scale{display:grid;grid-template-columns:repeat(5,minmax(66px,1fr));gap:8px;margin-top:8px}
.scale input{position:absolute;opacity:0;pointer-events:none}
.scale label{display:grid;place-items:center;border:1px solid var(--line);border-radius:10px;padding:8px;cursor:pointer;user-select:none;background:rgba(255,255,255,.04)}
.scale input:checked+label{outline:2px solid var(--accent);border-color:transparent}
mark.need{animation:need 1.6s ease}
@keyframes need{0%{box-shadow:0 0 0 0 rgba(169,81,255,.45)}100%{box-shadow:0 0 0 0 rgba(169,81,255,0)}}

.result-head{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
.badge{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;background:linear-gradient(90deg,var(--accent),var(--accent2));color:#fff;font-weight:700}
.total{font-size:26px;font-weight:800}
.small{color:var(--muted);font-size:.92em}

.hero-square{display:grid;place-items:center;border:1px solid var(--line);border-radius:16px;background:rgba(255,255,255,.03);overflow:hidden}
.hero-square figure{margin:0;width:min(560px,100%);max-width:100%;aspect-ratio:1/1;border-bottom:1px solid var(--line);background:#0f1220}
.hero-square img{width:100%;height:100%;object-fit:contain;display:block}
.hero-square figcaption{padding:10px;width:100%}
.hero-square .capline{font-weight:800;line-height:1.55;overflow-wrap:anywhere;word-break:break-word}
.hero-square .poem{font-style:italic;letter-spacing:.02em;margin-top:4px;color:#d5d9f5;opacity:.9}
.hero-square .capmini{font-size:1em;line-height:1.85;color:#b9c2df;overflow-wrap:anywhere;word-break:break-word}

.grid2{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:12px}
.stat{border:1px solid var(--line);border-radius:12px;padding:10px;background:rgba(255,255,255,.03)}
.stat .big{font-size:22px;font-weight:800}
.hr{height:1px;background:var(--line);margin:10px 0}
.factor-mini{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:10px}
.guard{display:flex;align-items:center;gap:8px;border:1px solid var(--line);border-radius:12px;background:rgba(255,255,255,.03);padding:8px 10px}
.guard .g-emo{font-size:18px}

.bar{border:1px solid var(--line);border-radius:12px;padding:10px;background:rgba(255,255,255,.03)}
.bar .row{height:10px;background:#141c2b;border-radius:999px;overflow:hidden;margin-top:6px}
.bar .row>span{display:block;height:100%;width:0;background:linear-gradient(90deg,var(--accent),var(--accent2))}
.bar .mini{color:#b9c2df;margin-top:6px;line-height:1.6}

.note{border:1px solid var(--line);border-radius:12px;background:rgba(255,255,255,.03);padding:10px}
.note h4{margin:0 0 6px;font-size:16px}
.note .mini{display:inline-block;margin-left:6px;font-size:.82em;color:#9aa6c3}
.note p, .note li{margin:6px 0;line-height:1.75}

.footer{color:#9aa6c3;font-size:.92em}
.warn{background:rgba(255,255,255,.05);border:1px solid var(--line);border-radius:12px;padding:10px;margin:12px 0}
.back-area{display:flex;justify-content:center;margin-top:10px}
a.back{display:inline-flex;align-items:center;gap:6px;padding:10px 14px;border:1px solid var(--line);border-radius:12px;background:rgba(255,255,255,.04);text-decoration:none}
.badge-size{display:inline-flex;align-items:center;gap:6px;padding:4px 8px;border-radius:999px;background:rgba(255,255,255,.04);border:1px solid var(--line);font-size:.85em;margin-left:6px}
.title-row{display:flex;align-items:center;gap:6px;flex-wrap:wrap}
.tags{display:flex;flex-wrap:wrap;gap:8px;margin-top:6px}
.tag{padding:3px 8px;border:1px solid var(--line);border-radius:999px;background:rgba(255,255,255,.04);font-size:.84em}

@media (max-width: 560px){
  .wrap{padding:0 10px}
  .sticky{top:calc(env(safe-area-inset-top) + 0px); padding:8px 10px}
  .scale{grid-template-columns:repeat(2,1fr)}
  .scale label{padding:12px 8px;font-size:14px}
  .hero-square figure{width:100%}
  .grid2{grid-template-columns:1fr}
  .badge-size{font-size:.8em}
  .card{padding:12px}
  .hero-square .capline{font-size:clamp(16px,5.2vw,20px);line-height:1.65}
  .hero-square .capmini{font-size:clamp(14px,4.6vw,16px);line-height:1.95}
  .note h4{font-size:15px}
}
</style>
</head>
<body data-id="charisma-demon">
<main class="wrap" id="app">
  <header class="hd">
    <div class="logo">ğŸœ</div>
    <div>
      <h1>æ‚ªé­”ã‚«ãƒªã‚¹ãƒè¨ºæ–­</h1>
      <p class="sub">èª˜å°ï¼ˆAllureï¼‰Ã— å¨åœ§ï¼ˆDominanceï¼‰Ã— ç„¡æ…ˆæ‚²ï¼ˆCallousï¼‰ã®18å•ã€‚ç·åˆãƒ©ãƒ³ã‚¯ï¼ˆæŠ½è±¡ç´‹ç« ï¼‰ã¨å› å­ãƒãƒ¼ã€å‚¾å‘ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã¨ç ”ç©¶ãƒ¡ãƒ¢ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚â€»ç‹¬è‡ªé …ç›®ã®ã‚¨ãƒ³ã‚¿ãƒ¡è‡ªå·±ç†è§£ç”¨ã€‚</p>
    </div>
  </header>

  <div class="sticky" aria-live="polite">
    <span>ğŸ“Š</span>
    <div class="progress" aria-label="å›ç­”é€²æ—"><span id="prog"></span></div>
    <button class="btn primary" id="doScore">è¨ºæ–­ã™ã‚‹</button>
  </div>

  <section class="card section" id="desc">
    <h2 style="margin:4px 0 8px">èª¬æ˜</h2>
    <div class="meta" style="margin-bottom:8px">
      <span class="pill">è³ªå•æ•°ï¼š18</span>
      <span class="pill">å½¢å¼ï¼š0â€“4ï¼ˆ0=ã¾ã£ãŸããªã„ / 4=ã¨ã¦ã‚‚ï¼‰</span>
      <span class="pill">ç·åˆï¼š0â€“4ï¼ˆé‡ã¿ä»˜ã‘å¹³å‡ï¼‰</span>
    </div>
    <p class="small">è‹±é›„ç‰ˆï¼ˆæ¸©ã‹ã•Ã—ç‰½å¼•åŠ›Ã—æ˜ç­ã•ï¼‰ã¨ã¯åˆ¥è»¸ã§ã€<b>â€œç ´å£Šçš„ãªé­…äº†â€</b>ã«ãªã‚Šã‚„ã™ã„æ€§è³ªã‚’å¯è¦–åŒ–ã—ã¾ã™ã€‚äººç‰©ã‚„æ€æƒ³ã®è³›ç¾ã§ã¯ãªãã€<b>è‡ªè¦šã®ãŸã‚ã®æŒ‡æ¨™</b>ã§ã™ã€‚</p>
  </section>

  <!-- è¨­å• -->
  <section class="card section" id="questions">
    <h2 style="margin:4px 0 8px">è¨­å•ï¼ˆ0=ã¾ã£ãŸããªã„ï¼1=ã‚ã¾ã‚Šãªã„ï¼2=åŠã€…ï¼3=ã ã„ãŸã„ï¼4=ã¨ã¦ã‚‚ï¼‰</h2>
    <div id="qWrap"></div>
    <div class="tags">
      <span class="tag">å› å­ï¼šèª˜å°ï¼ˆD1ï¼‰ï¼å¨åœ§ï¼ˆD2ï¼‰ï¼ç„¡æ…ˆæ‚²ï¼ˆD3ï¼‰</span>
    </div>
    <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:10px">
      <button class="btn" id="clearAns">å›ç­”ã‚’ã‚¯ãƒªã‚¢</button>
      <button class="btn primary" id="doScore2">è¨ºæ–­ã™ã‚‹</button>
    </div>
  </section>

  <!-- çµæœ -->
  <section class="card section" id="result" aria-live="polite">
    <div id="resEmpty">
      <span class="badge">ã¾ã çµæœã¯ã‚ã‚Šã¾ã›ã‚“</span>
      <p class="small">å…¨18å•ã«å›ç­”ã—ã¦ã€Œè¨ºæ–­ã™ã‚‹ã€ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚</p>
    </div>

    <div id="resArea" style="display:none">
      <div class="result-head">
        <span class="badge">çµæœ</span>
        <div class="total" id="typeLine">â€”</div>
      </div>

      <!-- ç´‹ç« ï¼ˆ1:1 æ­£æ–¹å½¢ï¼‰ -->
      <div class="hero-square section" role="region" aria-label="ãƒ©ãƒ³ã‚¯ã®ã‚¤ãƒ¡ãƒ¼ã‚¸">
        <figure>
          <img id="heroImg" src="/shindan/assets/results/charisma-demon/01.png" alt="éˆãç¯ã‚‹ç‡­å°ã®ç´‹ç« " loading="lazy" width="600" height="600">
        </figure>
        <figcaption>
          <div class="title-row">
            <div class="capline" id="heroTitle">â€”</div>
            <span class="badge-size" id="sizeBadge" aria-label="ç·åˆå¹³å‡">â€”</span>
          </div>
          <div class="poem" id="heroPoem">â€”</div>
          <div class="capmini" id="heroCopy">â€”</div>
        </figcaption>
      </div>

      <div class="grid2">
        <article class="stat" aria-label="ç·åˆã‚¹ã‚³ã‚¢">
          <div><strong>ç·åˆãƒ€ãƒ¼ã‚¯ãƒ»ã‚«ãƒªã‚¹ãƒï¼ˆ0â€“4ï¼‰</strong></div>
          <div class="big"><span id="sumAvg">0.00</span> / 4.00</div>
          <div class="small" id="sumNote">â€”</div>
        </article>
        <article class="stat" aria-label="å› å­æ¦‚è¦">
          <div><strong>å› å­ï¼ˆD1/D2/D3ï¼‰</strong></div>
          <div class="factor-mini" id="guardArea"><!-- JS --></div>
        </article>
      </div>

      <div class="hr"></div>
      <!-- å› å­ãƒãƒ¼ï¼‹å‚¾å‘ã‚¢ãƒ‰ãƒã‚¤ã‚¹ -->
      <div class="section">
        <h3 style="margin:8px 0">å› å­åˆ¥ã‚¹ã‚³ã‚¢ã¨å‚¾å‘</h3>
        <div id="bars" class="factor-mini"><!-- JS --></div>
      </div>

      <div class="hr"></div>
      <div id="longCopy" class="small"><!-- JS é•·æ–‡ã‚³ãƒ¡ãƒ³ãƒˆï¼ã‚ã‚‹ã‚ã‚‹å‚¾å‘ --></div>

      <div class="hr"></div>
      <!-- ç ”ç©¶ãƒ¡ãƒ¢ï¼ˆâ€œã‚ã‚‹ç ”ç©¶ã§ã¯â€¦â€ã§æ¿ã™ï¼‰ -->
      <details class="section" open>
        <summary><strong>ç ”ç©¶ãƒ¡ãƒ¢ï¼ˆã‚ã‚‹ç ”ç©¶ã§ã¯â€¦ï¼‰</strong></summary>
        <ul class="small" id="resMemo" style="margin:6px 0 0 18px;line-height:1.8"><!-- JS --></ul>
        <p class="small" style="margin-top:6px">â€»ä¸€èˆ¬çš„ãªå‚¾å‘ã‚„ç›¸é–¢ã®è©±ã§ã™ã€‚å› æœã¯æ–­å®šã§ããšã€å€‹äººå·®ãŒå¤§ãã„ç‚¹ã«ã”ç•™æ„ãã ã•ã„ã€‚</p>
      </details>

      <div class="back-area" style="margin-top:12px">
        <a class="back" href="/shindan/" id="backLink" aria-label="è¨ºæ–­ä¸€è¦§ã«æˆ»ã‚‹">è¨ºæ–­ä¸€è¦§ã«æˆ»ã‚‹</a>
      </div>
    </div>
  </section>

  <section class="footer card">
    <h2 style="margin:4px 0 8px">ã”åˆ©ç”¨ã«ã‚ãŸã£ã¦</h2>
    <p class="warn"><strong>æ³¨æ„ï¼š</strong>ã“ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¯<b>ã‚¨ãƒ³ã‚¿ãƒ¡ç”¨ã®ã‚»ãƒ«ãƒ•ãƒã‚§ãƒƒã‚¯</b>ã§ã™ã€‚å®—æ•™çš„ãƒ»æ”¿æ²»çš„ãƒ»æš´åŠ›çš„è¡Œç‚ºã®è³›ç¾ã‚„æ¨å¥¨ã¯<b>ä¸€åˆ‡ã‚ã‚Šã¾ã›ã‚“</b>ã€‚æ¡ç”¨ãƒ»åŒ»ç™‚ãƒ»è‡¨åºŠãƒ»é‘‘åˆ¥ç”¨é€”ã§ã¯ä½¿ç”¨ã—ãªã„ã§ãã ã•ã„ã€‚<br>
å¼·ã„è¡å‹•ã‚„æ”»æ’ƒæ€§ã«ä¸å®‰ãŒã‚ã‚‹å ´åˆã¯ã€ä¿¡é ¼ã§ãã‚‹äººã‚„å°‚é–€çª“å£ã«ç›¸è«‡ã—ã¦ãã ã•ã„ã€‚ãƒ‡ãƒ¼ã‚¿ã¯ç«¯æœ«å†…ã§å‡¦ç†ã•ã‚Œã€å€‹äººã‚’ç‰¹å®šã™ã‚‹æƒ…å ±ã®é€ä¿¡ãƒ»åé›†ã¯è¡Œã„ã¾ã›ã‚“ï¼ˆã”åˆ©ç”¨ç’°å¢ƒã«ã‚ˆã‚Šã‚¢ã‚¯ã‚»ã‚¹è§£æç­‰ãŒå‹•ä½œã™ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ï¼‰ã€‚</p>
  </section>
</main>

<script>
(function(){
  // ====== ãƒšãƒ¼ã‚¸æƒ…å ± ======
  var SLUG = "charisma-demon";
  var TITLE = "æ‚ªé­”ã‚«ãƒªã‚¹ãƒè¨ºæ–­";
  var IMG_BASE = "/shindan/assets/results/charisma-demon/"; // æœ«å°¾/
  var ANS_KEY = "specimens:"+SLUG+":answers"; // å›ç­”ä¿å­˜ã‚­ãƒ¼

  // ====== ãƒ©ãƒ³ã‚¯å®šç¾©ï¼ˆç·åˆ 0â€“4ï¼‰ ======
  var LV = [
    {id:1, name:"ãƒ™ãƒ«ãƒ•ã‚§ã‚´ãƒ¼ãƒ«", label:"Lv1", min:0.00, max:0.79, img:"01.png", alt:"éˆãç¯ã‚‹ç‡­å°ã®ç´‹ç« ",
     poem:"é€†ä¸‰è§’ã®ç‡­å°ã«å°ã•ãªéˆã„ç‚ã€‚", 
     copy:"å½±ã®ç«ç¨®ã¯ã¾ã å°ã•ã„ã€‚ã¨ãã©ãç”˜ã„èª˜ã„ãŒé¡”ã‚’å‡ºã™ã€‚ç¾¤ã‚Œã‚’é›†ã‚ã‚‹åŠ›ã¯ç©ã‚„ã‹ã€‚è‡ªè¦šãƒ¡ãƒ¢ï¼šäº‹å®Ÿãƒã‚§ãƒƒã‚¯ã‚’å…ˆã«ç½®ãã¨å½±ãŒè–„ã¾ã‚‹ã€‚"},
    {id:2, name:"ãƒ™ãƒ«ã‚¼ãƒ–ãƒ–", label:"Lv2", min:0.80, max:1.59, img:"02.png", alt:"ç¿…ã¨è¼ªã®ç´‹ç« ",
     poem:"è …ã®ç¿…ãŒè¼ªã‚’ã‹ã™ã‚ã€ã–ã‚ã‚ããŒé›†ã¾ã‚‹ã€‚", 
     copy:"è¨€è‘‰ã«ç¾¤ã‚ŒãŒå¼•ãå¯„ã›ã‚‰ã‚Œã‚‹å¸¯ã€‚ç…½ã‚Šã¨ä¸€ä½“æ„Ÿã®æ‰±ã„ãŒä¸Šæ‰‹ã„ã€‚åœ§ã¯ä¸­ãã‚‰ã„ã€æ¼”å‡ºã§ä¼¸ã³ã‚‹ã€‚è‡ªè¦šãƒ¡ãƒ¢ï¼šæ•µå‘³æ–¹ã®ç·šã‚’å¤ªãã—ã™ããªã„ã€‚"},
    {id:3, name:"ã‚¢ã‚¹ãƒ¢ãƒ‡ã‚¦ã‚¹", label:"Lv3", min:1.60, max:2.39, img:"03.png", alt:"ä»®é¢ã¨ç³¸ã®ç´‹ç« ",
     poem:"äºŒã¤ã®ä»®é¢ã‚’ç³¸ãŒçµã³ã€è¦³å®¢ã¯ç‰©èªã«çµ¡ã‚€ã€‚", 
     copy:"æ¬²ã‚„æœŸå¾…ã®æ“ä½œãŒåŠ¹ãå¸¯ã€‚å ´ã‚’æµã™æŠ€è¡“ãŒé«˜ã„ã€‚ä¸­èº«ã¨è£…ã„ã®ãƒãƒ©ãƒ³ã‚¹ã«æ³¨æ„ã€‚è‡ªè¦šãƒ¡ãƒ¢ï¼šç¹°ã‚Šè¿”ã™è¨€è‘‰ã»ã©äº‹å®Ÿã«å¯„ã›ã‚‹ã€‚"},
    {id:4, name:"ãƒ™ãƒªã‚¢ãƒ«", label:"Lv4", min:2.40, max:3.19, img:"04.png", alt:"ç •ã‘ãŸè¼ªã®ç´‹ç« ",
     poem:"ç •ã‘ãŸè¼ªãŒæ•£ã‚Šã€é‹­ã„å† ãŒæ®‹ã‚‹ã€‚", 
     copy:"å¼·ã„åœ§ã§å¾“ã‚ã›ã‚‹å¸¯ã€‚æ±ºæ–­ã®é€Ÿã•ãŒé­…åŠ›ã¨æã‚Œã‚’ç”Ÿã‚€ã€‚ç›®çš„ã®ãŸã‚ã®åˆ‡ã‚Šæ¨ã¦ãŒèµ·ã“ã‚Šã‚„ã™ã„ã€‚è‡ªè¦šãƒ¡ãƒ¢ï¼šå¼±ã„ç«‹å ´ã¸ã®é…æ…®ã‚’å…ˆã«å®£è¨€ã™ã‚‹ã€‚"},
    {id:5, name:"ã‚µã‚¿ãƒ³ï¼ˆãƒ«ã‚·ãƒ•ã‚¡ãƒ¼ï¼‰", label:"Lv5", min:3.20, max:4.00, img:"05.png", alt:"ç‹å† ã¨è½ã¡ã‚‹æ˜Ÿã®ç´‹ç« ",
     poem:"é»’ã„ç‹å† ã®ä¸Šã€ã²ã¨ã¤ã®æ˜ŸãŒè½ã¡ã¦ç·šã‚’æ›³ãã€‚", 
     copy:"åé€†ã®å…‰ã§ç‰©èªã‚’åè»¢ã•ã›ã‚‹å¸¯ã€‚äººã¨æ­´å²ã‚’å‹•ã‹ã›ã‚‹è¦æ¨¡ã€‚å¿«ã„å‹åˆ©æ„ŸãŒå¢ƒç•Œã‚’æº¶ã‹ã—ã‚„ã™ã„ã€‚è‡ªè¦šãƒ¡ãƒ¢ï¼šæ­¢ã¾ã‚‹ä»•çµ„ã¿ï¼ˆå¤–éƒ¨ã®ç·šï¼‰ã‚’å¸¸ã«ç½®ãã€‚"}
  ];

  // ====== å› å­ï¼ˆ6å•Ã—3å› å­ï¼‰ ======
  var FACTORS = {
    D1: {name:"èª˜å°ï¼ˆAllure/Manipulationï¼‰",  icon:"ğŸœš", items:[1,2,3,4,5,6]},
    D2: {name:"å¨åœ§ï¼ˆDominance/Force Auraï¼‰", icon:"ğŸœ", items:[7,8,9,10,11,12]},
    D3: {name:"ç„¡æ…ˆæ‚²ï¼ˆCallous Ambitionï¼‰",   icon:"ğŸœ", items:[13,14,15,16,17,18]}
  };

  // ====== è¨­å•ï¼ˆ18å•ï¼â˜…ã¯ rev:true ã ãŒUIéè¡¨ç¤ºï¼‰ ======
  var ITEMS = [
    // D1 èª˜å°
    {id:1,  text:"ç›¸æ‰‹ã®â€œæ¬²ã‚„ä¸å®‰ã«åˆºã•ã‚‹è¨€ã„æ–¹â€ãŒç›´æ„Ÿã§å‡ºã¦ãã‚‹ã€‚"},
    {id:2,  text:"å¤§å‹¢ã®å‰ã§ã¯ã€â€œæ•µã¨å‘³æ–¹â€ã®æ§‹å›³ã§èªã‚‹æ–¹ãŒé€šã‚‹ã¨æ„Ÿã˜ã‚‹ã€‚"},
    {id:3,  text:"åŠåˆ†ã ã‘æœ¬å½“ã®è©±ã§ã€â€œå°è±¡ã‚’æœ‰åˆ©ã«â€ã§ãã‚‹ã€‚"},
    {id:4,  text:"ç¾¤è¡†ã®â€œæ›ã‘å£°ã‚„ã‚³ãƒ¼ãƒ«â€ã§ç†±ã‚’ä¸Šã’ã‚‰ã‚Œã‚‹ã€‚"},
    {id:5,  text:"è©±ãŒâ€œäº‹å®Ÿã«åˆã£ã¦ã„ã‚‹ã‹â€ã‚’å…ˆã«ç¢ºã‹ã‚ã‚‹ã»ã†ã ã€‚", rev:true}, // é€†è»¢
    {id:6,  text:"ç›®ç«‹ã¤ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’â€œä½•åº¦ã‚‚ç¹°ã‚Šè¿”ã™â€ã¨é€šã‚‹å®Ÿæ„ŸãŒã‚ã‚‹ã€‚"},

    // D2 å¨åœ§
    {id:7,  text:"åå¯¾æ„è¦‹ã«ã¯â€œæŠ¼ã—åˆ‡ã‚‹å¼·ã•â€ã§å‘ãåˆã†æ–¹ãŒæ—©ã„ã¨æ„Ÿã˜ã‚‹ã€‚"},
    {id:8,  text:"è©±ã™ã¨ãã€â€œä½“ã®ä½¿ã„æ–¹ã‚„é–“â€ã§å ´ã‚’åˆ¶ã›ã‚‹ã€‚"},
    {id:9,  text:"ç›¸æ‰‹ãŒã²ã‚‹ã‚€ã¨ã€â€œå„ªä½ã®æ‰‹å¿œãˆâ€ã‚’è¦šãˆã‚‹ã€‚"},
    {id:10, text:"å¼·ã„å´ã«â€œäººãŒä¸¦ã¶ç©ºæ°—â€ã‚’ä½œã‚Œã‚‹ã€‚"},
    {id:11, text:"ç«‹å ´ã®å¼±ã„äººã«â€œé…æ…®ã‚’å…ˆã«ç½®ãâ€ã€‚", rev:true}, // é€†è»¢
    {id:12, text:"ç›¸æ‰‹ã®ãƒŸã‚¹ã‚’â€œå…¬ã®å ´ã§æŒ‡æ‘˜â€ã—ã¦åŠ¹æœã‚’ç‹™ã†ã“ã¨ãŒã‚ã‚‹ã€‚"},

    // D3 ç„¡æ…ˆæ‚²
    {id:13, text:"ç›®çš„é”æˆã®ãŸã‚ã«ã€â€œæ‰‹æ®µã¯å•ã‚ãªã„â€ã¨æ€ã†ç¬é–“ãŒã‚ã‚‹ã€‚"},
    {id:14, text:"åå¯¾æ´¾ã®ç—›ã¿ã¯ã€â€œè‡ªå·±è²¬ä»»â€ã ã¨æ„Ÿã˜ã‚„ã™ã„ã€‚"},
    {id:15, text:"å‹ã¤ãŸã‚ãªã‚‰ã€â€œèª°ã‹ã‚’é§’ã¨ã—ã¦æ‰±ã†â€ã“ã¨ã«ãŸã‚ã‚‰ã„ãŒè–„ã„ã€‚"},
    {id:16, text:"â€œé•ã†ç«‹å ´ã®äººã®ç—›ã¿ã‚’æƒ³åƒâ€ã—ç›´ã›ã‚‹ã€‚", rev:true}, // é€†è»¢
    {id:17, text:"ç«¶äº‰ã«è² ã‘ãŸç›¸æ‰‹ã®â€œæ‚”ã—ã•ã‚’è¦‹ã‚‹ã®ãŒå¿«ã„â€æ™‚ãŒã‚ã‚‹ã€‚"},
    {id:18, text:"ã†ã¾ãã„ã‹ãªã„çµ„ç¹”ã¯â€œå£Šã—ã¦ä½œã‚Šç›´ã™â€ã®ãŒæ—©ã„ã¨æ„Ÿã˜ã‚‹ã€‚"}
  ];

  var LABELS = ["ã¾ã£ãŸããªã„","ã‚ã¾ã‚Šãªã„","åŠã€…","ã ã„ãŸã„","ã¨ã¦ã‚‚"];

  // ====== é‡ã¿ ======
  var WEIGHT = { D1:0.34, D2:0.33, D3:0.33 };

  // ====== è¦ç´ å‚ç…§ ======
  var qWrap   = document.getElementById("qWrap");
  var prog    = document.getElementById("prog");
  var resEmpty= document.getElementById("resEmpty");
  var resArea = document.getElementById("resArea");
  var typeLine= document.getElementById("typeLine");
  var heroImg = document.getElementById("heroImg");
  var heroTitle= document.getElementById("heroTitle");
  var heroPoem = document.getElementById("heroPoem");
  var heroCopy = document.getElementById("heroCopy");
  var sizeBadgeEl= document.getElementById("sizeBadge");
  var sumAvg  = document.getElementById("sumAvg");
  var sumNote = document.getElementById("sumNote");
  var guardArea = document.getElementById("guardArea");
  var bars    = document.getElementById("bars");
  var longCopy= document.getElementById("longCopy");
  var resMemo = document.getElementById("resMemo");

  // ====== ä¿å­˜ ======
  function saveAnswers(){
    try{
      var out = {};
      for(var i=0;i<ITEMS.length;i++){
        var id = ITEMS[i].id;
        var chk = qWrap.querySelector('#fs-'+id+' input[type="radio"]:checked');
        if(chk){ out[id] = parseInt(chk.value,10); }
      }
      localStorage.setItem(ANS_KEY, JSON.stringify({ts:Date.now(), ans:out}));
    }catch(e){}
  }
  function restoreAnswers(){
    try{
      var raw = localStorage.getItem(ANS_KEY);
      if(!raw) return;
      var data = JSON.parse(raw);
      var ans = (data && data.ans) || {};
      Object.keys(ans).forEach(function(id){
        var v = ans[id];
        var input = qWrap.querySelector('#q'+id+'-'+v);
        if(input){ input.checked = true; }
      });
      updateProgress();
    }catch(e){}
  }
  function wipeAnswers(){
    try{ localStorage.removeItem(ANS_KEY); }catch(e){}
  }

  // ====== è¨­å•ç”Ÿæˆï¼ˆç•ªå·ã‚„é€†è»¢ã®è¡¨è¨˜ã¯UIã«å‡ºã•ãªã„ï¼‰ ======
  function buildQuestions(){
    var html = "";
    for(var i=0;i<ITEMS.length;i++){
      var q = ITEMS[i];
      html += '<fieldset class="q" id="fs-'+q.id+'">'+
        '<legend>'+q.text+'</legend>'+
        '<div class="scale" role="radiogroup" aria-label="'+q.text+'">';
      for(var v=0;v<=4;v++){
        html += '<div style="position:relative">'+
          '<input id="q'+q.id+'-'+v+'" type="radio" name="q'+q.id+'" value="'+v+'">'+
          '<label for="q'+q.id+'-'+v+'" title="'+LABELS[v]+'">'+LABELS[v]+'</label>'+
        '</div>';
      }
      html += '</div></fieldset>';
    }
    qWrap.innerHTML = html;

    var radios = qWrap.querySelectorAll('input[type="radio"]');
    for(var r=0;r<radios.length;r++){
      radios[r].addEventListener('change', function(){
        saveAnswers();
        updateProgress();
      }, false);
    }
    restoreAnswers();
  }

  function updateProgress(){
    var total = ITEMS.length;
    var answered = qWrap.querySelectorAll('input[type="radio"]:checked').length;
    prog.style.width = Math.round(100*answered/total) + "%";
  }

  // ====== ã‚¹ã‚³ã‚¢è¨ˆç®— ======
  function score(){
    var missing = [];
    var ans = {};
    for(var i=0;i<ITEMS.length;i++){
      var id = ITEMS[i].id;
      var chk = qWrap.querySelector('#fs-'+id+' input[type="radio"]:checked');
      if(!chk){ missing.push(id); continue; }
      var raw = parseInt(chk.value,10);
      var def = ITEMS[i];
      var val = def.rev ? (4 - raw) : raw; // é€†è»¢ï¼ˆå†…éƒ¨ã®ã¿ï¼‰
      ans[id] = val;
    }
    if(missing.length){
      alert("æœªå›ç­”ãŒã‚ã‚Šã¾ã™ã€‚å…¨18å•ã«ãŠç­”ãˆãã ã•ã„ã€‚");
      var fs = document.getElementById('fs-'+missing[0]);
      if(fs){ fs.scrollIntoView({behavior:"smooth", block:"center"}); fs.classList.add("need"); setTimeout(function(){ fs.classList.remove("need"); },1600); }
      return;
    }

    // å› å­å¹³å‡(0-4)
    function avgOf(ids){
      var sum = ids.reduce(function(s,id){ return s + (ans[id]||0); },0);
      return sum / ids.length;
    }
    var D1 = avgOf(FACTORS.D1.items);
    var D2 = avgOf(FACTORS.D2.items);
    var D3 = avgOf(FACTORS.D3.items);

    // ç·åˆï¼ˆé‡ã¿ï¼‰
    var total = WEIGHT.D1*D1 + WEIGHT.D2*D2 + WEIGHT.D3*D3;
    total = Math.round(total*100)/100;

    render({avg:total, by:{D1:D1,D2:D2,D3:D3}});
  }

  function rankOf(avg){
    for(var i=0;i<LV.length;i++){
      var d = LV[i];
      if(avg>=d.min && avg<=d.max) return d;
    }
    return LV[2];
  }

  // ====== å› å­ã‚¢ãƒ‰ãƒã‚¤ã‚¹ï¼ˆåŒºåˆ†ï¼‰ ======
  function adviceFor(key, v){
    var hi = v>=3.2, mid = v>=1.6, lo = v<1.6;
    if(key==="D1"){ // èª˜å°
      if(hi) return "åˆºã•ã‚‹è¨€ã„å›ã—ã¨â€œç‰©èªã®æ â€ã§ç¾¤è¡†ã‚’å‹•ã‹ã—ã‚„ã™ã„å‚¾å‘ã€‚äº‹å®Ÿç¢ºèªã¨åè¨¼å—ã‘çš¿ã‚’å¸¸ã«ã€‚";
      if(mid) return "ãƒ•ãƒ¬ãƒ¼ã‚ºè¨­è¨ˆãŒå¾—æ„ã€‚çµè«–ã®ç¹°ã‚Šè¿”ã—ã¯â€œå…·ä½“ä¾‹â€ã¨ã‚»ãƒƒãƒˆã§ä¸­èº«ã‚’è£œå¼·ã™ã‚‹ã¨è‰¯ã„ã€‚";
      return "ç…½ã‚Šã‚„èª‡å¼µã«å¯„ã‚Šã¥ã‚‰ã„å‚¾å‘ã€‚å¿…è¦ãªå ´é¢ã§ã¯â€œè¦ç‚¹ã²ã¨è¨€ï¼‹ä¸€ä¾‹â€ã®é †ã§å­˜åœ¨æ„Ÿã‚’ã€‚";
    }
    if(key==="D2"){ // å¨åœ§
      if(hi) return "éè¨€èªã®åœ§ã§å ´ã‚’åˆ¶ã—ã‚„ã™ã„ã€‚å†’é ­ã«â€œé…æ…®ã®å¢ƒç•Œç·šâ€ã‚’å®£è¨€ã—ã¦å®‰å…¨ã‚’æ‹…ä¿ã™ã‚‹ã¨å¥å…¨ã€‚";
      if(mid) return "å§¿å‹¢ãƒ»é–“ã®æ‰±ã„ãŒã¾ãšã¾ãšã€‚è¡çªå‰ã®â€œè¦ç‚¹ç¢ºèªâ€ã§æŠ¼ã—åˆ‡ã‚Šäº‹æ•…ã‚’å›é¿ã€‚";
      return "æŠ¼ã—ä»˜ã‘ã‚’é¿ã‘ã‚„ã™ã„ã€‚è¦æ‰€ã¯â€œå£°é‡ã¨é–“â€ã‚’å°‘ã—è¶³ã™ã¨åˆ¤æ–­ãŒé€šã‚Šã‚„ã™ã„ã€‚";
    }
    if(key==="D3"){ // ç„¡æ…ˆæ‚²
      if(hi) return "ç›®çš„å„ªå…ˆã§åˆ‡ã‚Šæ¨ã¦ãŒèµ·ã“ã‚Šã‚„ã™ã„ã€‚åå¯¾å´ã®â€œè¢«å®³ã®æƒ³åƒâ€ã‚’ãƒ—ãƒ­ã‚»ã‚¹ã«å›ºå®šã€‚";
      if(mid) return "æˆæœå¯„ã‚Šã®åˆ¤æ–­ã€‚è¦ã®å ´é¢ã§â€œé…æ…®ã®ä¸€è¡Œâ€ã‚’æŒŸã‚€ã¨æ‘©è€—ãŒæ¸›ã‚‹ã€‚";
      return "å…±æ„ŸãŒåƒãã‚„ã™ã„ã€‚æ”¹é©æ™‚ã¯â€œæ’¤é€€æ¡ä»¶â€ã‚’å…ˆã«æ±ºã‚ã‚‹ã¨è¿·ã„ã«å¼·ããªã‚‹ã€‚";
    }
    return "";
  }

  // ====== è¡¨ç¤º ======
  function render(o){
    var rank = rankOf(o.avg);

    // ç´‹ç« 
    heroImg.src = IMG_BASE + rank.img;
    heroImg.alt = rank.alt;
    heroTitle.textContent = "ãƒ€ãƒ¼ã‚¯ãƒ»ã‚«ãƒªã‚¹ãƒï¼š"+rank.name+"ï¼ˆ"+rank.label+"ï¼‰";
    heroPoem.textContent  = rank.poem;
    heroCopy.textContent  = rank.copy;
    sizeBadgeEl.textContent = "ç·åˆå¹³å‡ " + o.avg.toFixed(2) + " / 4.00";

    // åˆè¨ˆ â€œã‚ã‚‹ã‚ã‚‹â€ç³»ã²ã¨ã“ã¨
    var note = "";
    if(o.avg<0.8) note="è¨€è‘‰ã¯åŠ¹ããŒã€ã¾ã é™ã‹ãªå±¤ã€‚ãŸã¾ã«åˆºã•ã‚‹è¨€ã„å›ã—ãŒå‡ºã‚‹ã€‚";
    else if(o.avg<1.6) note="ç…½ã‚Šã¨ä¸€ä½“æ„Ÿã®æ‰±ã„ãŒä¸Šæ‰‹ã„æ—¥ãŒã‚ã‚‹ã€‚æ¼”å‡ºæ¬¡ç¬¬ã§å­˜åœ¨æ„ŸãŒè·³ã­ã‚‹ã‚¿ã‚¤ãƒ—ã€‚";
    else if(o.avg<2.4) note="å ´ã®æµã‚Œã‚’ä½œã‚‹ã®ãŒå¾—æ„ã€‚è¨€è‘‰ã®åå¾©ãŒåŠ¹ãåˆ†ã€å†…å®¹ã®é‡ã•èª¿æ•´ãŒã‚«ã‚®ã€‚";
    else if(o.avg<3.2) note="åœ§ã¨æ±ºæ–­ãŒå¼·ãå‡ºã‚„ã™ã„ã€‚é€Ÿã•ã®è£å´ã«â€œé…æ…®ã®å®£è¨€â€ã‚’æ·»ãˆã‚‹ã¨æ‰±ã„ã‚„ã™ã„ã€‚";
    else note="ç‰©èªã‚’åè»¢ã•ã›ã‚‹è¦æ¨¡ã€‚å¿«ã„å‹åˆ©æ„Ÿã®ã¨ãã»ã©â€œæ­¢ã¾ã‚‹ä»•çµ„ã¿â€ã‚’å¤–ã«ç½®ãã¨å¥å…¨ã€‚";
    sumNote.textContent = note;

    // å› å­ã‚¿ã‚°ï¼ˆæ¦‚è¦ï¼‰
    var gHtml = "";
    [["D1","èª˜å°ï¼ˆAllureï¼‰","ğŸœš"],["D2","å¨åœ§ï¼ˆDominanceï¼‰","ğŸœ"],["D3","ç„¡æ…ˆæ‚²ï¼ˆCallousï¼‰","ğŸœ"]]
      .forEach(function(t){
        var key=t[0], name=t[1], emo=t[2], v=o.by[key], pct=Math.round(v/4*100);
        gHtml += '<div class="guard"><div class="g-emo" aria-hidden="true">'+emo+
                 '</div><div><div><strong>'+name+'</strong> <span class="small">å¹³å‡ '+v.toFixed(2)+' / 4</span></div>'+
                 '<div class="small" style="opacity:.9">å¸¯ï¼š'+pct+'%</div></div></div>';
      });
    guardArea.innerHTML = gHtml;

    // å› å­ãƒãƒ¼ï¼‹å‚¾å‘
    var bHtml = "";
    [["D1","èª˜å°"],["D2","å¨åœ§"],["D3","ç„¡æ…ˆæ‚²"]].forEach(function(t){
      var key=t[0], label=t[1], v=o.by[key], pct=Math.round(v/4*100);
      bHtml += '<article class="bar" aria-label="'+label+'">'+
        '<div><strong>'+label+'</strong><span class="pill" style="margin-left:6px">'+v.toFixed(2)+' / 4</span>'+
        '<span class="pill" style="margin-left:6px">'+pct+'%</span></div>'+
        '<div class="row" aria-hidden="true"><span style="width:'+pct+'%"></span></div>'+
        '<div class="mini">'+adviceFor(key, v)+'</div>'+
      '</article>';
    });
    bars.innerHTML = bHtml;

    // ãƒ©ãƒ³ã‚¯åˆ¥ã®â€œã‚ã‚‹ã‚ã‚‹â€é•·æ–‡
    var long = {
      1:"ç”˜ã„èª˜ã„ãŒãŸã¾ã«åŠ¹ãã‘ã‚Œã©ã€åŸºæœ¬ã¯é™ã‹ã€‚äº‹å®Ÿã«å¯„ã›ã‚‹ç¿’æ…£ã‚’å…ˆã«ç½®ãã¨ã€èª¤è§£ã‚‚ç…½ã‚Šã‚‚èµ·ã“ã‚Šã«ãã„å¸¯ã€‚",
      2:"åˆå›³ã‚„ã‚³ãƒ¼ãƒ«ã§ä¸€ä½“æ„Ÿã‚’ä½œã‚Šã‚„ã™ã„ã€‚ç·šå¼•ãã‚’å¤ªãã—ã™ããšã€åå¯¾å´ã®å—ã‘çš¿ã‚’æ®‹ã™ã¨æ‘©è€—ã—ã«ãã„å¸¯ã€‚",
      3:"ä»®é¢ï¼ˆè¦‹ã›æ–¹ï¼‰ã¨ç³¸ï¼ˆæµã‚Œï¼‰ã‚’æ‰±ãˆã‚‹ã€‚åå¾©ãƒ•ãƒ¬ãƒ¼ã‚ºã»ã©å†…å®¹ã‚’é‡ãã™ã‚‹ã»ã©ã€èª¬å¾—ãŒå¥å…¨ã«é€šã‚‹å¸¯ã€‚",
      4:"å¼·ã„åœ§ã¨é€Ÿã„æ±ºæ–­ã€‚å…ˆã«â€œé…æ…®ã®å¢ƒç•Œç·šâ€ã‚’è¨€èªåŒ–ã™ã‚‹ã¨ã€åŠ›ãŒæ­£ã—ãæ‰±ã‚ã‚Œã‚„ã™ã„å¸¯ã€‚",
      5:"ç‰©èªã‚’åè»¢ã•ã›ç¾¤ã‚Œã‚’å‹•ã‹ã™è¦æ¨¡ã€‚å¤–éƒ¨ã®åœæ­¢ç·šã¨äº‹å®Ÿç‚¹æ¤œã‚’å¸¸å‚™ã™ã‚‹ã¨ã€é•·ãæ©Ÿèƒ½ã™ã‚‹å¸¯ã€‚"
    }[rank.id] || "";
    longCopy.textContent = long;

    // ç ”ç©¶ãƒ¡ãƒ¢
    var memo = [
      "ãƒ»ã‚ã‚‹ç ”ç©¶ã§ã¯ã€åå¾©ã™ã‚‹çŸ­ã„ãƒ•ãƒ¬ãƒ¼ã‚ºã¯è¨˜æ†¶ã¨çœŸå®Ÿå‘³ã®çŸ¥è¦šã‚’é«˜ã‚ã‚„ã™ã„ç¤ºå”†ã€‚",
      "ãƒ»ææ€–è¨´æ±‚ã‚„æ•µå‘³æ–¹ã®æ çµ„ã¿ã¯æ³¨æ„ã‚’é›†ã‚ã‚‹ãŒã€éå‰°ã ã¨åç™ºã¨åˆ†æ–­ã‚’æ‹›ãã‚„ã™ã„ã¨ã®å ±å‘Šã€‚",
      "ãƒ»éè¨€èªã®å„ªä½ï¼ˆå§¿å‹¢ãƒ»é–“ãƒ»è¦–ç·šï¼‰ã¯æ”¯é…çš„å­˜åœ¨æ„Ÿã®çŸ¥è¦šã«å¯„ä¸ã™ã‚‹å‚¾å‘ã€‚",
      "ãƒ»â€œ3 éƒ¨æ§‹æˆï¼‹å…·ä½“ä¾‹â€ã¯ç†è§£ã‚³ã‚¹ãƒˆã‚’ä¸‹ã’ã€æ‰‡å‹•çš„è¡¨ç¾ã®æ¿ƒåº¦ã‚’ä¸‹ã’ã¦ã‚‚ä¼é”åŠ¹ç‡ã‚’ä¿ã¡ã‚„ã™ã„ç¤ºå”†ã€‚",
      "ãƒ»é“å¾³çš„è·é›¢ã‚’åºƒã’ã‚‹è¨€ã„å›ã—ã¯ã€åˆ‡ã‚Šæ¨ã¦åˆ¤æ–­ã‚’å®¹æ˜“ã«ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ã€å¯¾æŠ—ç­–ã¨ã—ã¦â€œè¢«å®³ã®å†æƒ³åƒâ€ãŒæœ‰åŠ¹ã¨ã®ç¤ºå”†ã€‚"
    ];
    resMemo.innerHTML = memo.map(function(s){ return "<li>"+s+"</li>"; }).join("");

    // è¡¨ç¤ºåˆ‡æ›¿
    resEmpty.style.display = "none";
    resArea.style.display = "block";
    document.getElementById("result").scrollIntoView({behavior:"smooth", block:"start"});

    // ä¸€è¦§ã€Œã¤ã¥ãã‹ã‚‰å†é–‹ã€
    try{
      document.dispatchEvent(new Event('result:ready'));
      localStorage.setItem("specimens:last", JSON.stringify({ id: SLUG, title: TITLE, href: location.pathname }));
    }catch(e){}
  }

  function clearAnswers(){
    var radios = qWrap.querySelectorAll('input[type="radio"]');
    for(var i=0;i<radios.length;i++){ radios[i].checked=false; }
    wipeAnswers();
    prog.style.width = "0%";
    resEmpty.style.display = "";
    resArea.style.display = "none";
    var app = document.getElementById("app");
    if(app){ app.scrollIntoView({behavior:"smooth", block:"start"}); }
  }

  // ====== åˆæœŸåŒ– ======
  if(document.readyState === "loading"){
    document.addEventListener("DOMContentLoaded", function(){ buildQuestions(); });
  }else{
    buildQuestions();
  }
  document.getElementById("doScore").addEventListener("click", score, false);
  document.getElementById("doScore2").addEventListener("click", score, false);
  document.getElementById("clearAns").addEventListener("click", clearAnswers, false);
  var back = document.getElementById("backLink");
  if(back){
    back.addEventListener("click", function(){
      try{
        document.dispatchEvent(new Event('result:ready'));
      localStorage.setItem("specimens:last", JSON.stringify({ id: SLUG, title: TITLE, href: location.pathname }));
      }catch(e){}
    }, false);
  }
})();
</script>
<script>
/* ã“ã“ã‚Lv/æ¸ˆã‚«ã‚¦ãƒ³ãƒˆï¼ˆçµæœæç”»ã®åˆå›³ã§ä¸€åº¦ã ã‘ï¼‰ */
(function(){
  'use strict';
  var DONE_KEY    = 'specimens:open:byid';         // æ¸ˆãƒãƒƒãƒ—
  var TOTAL_KEY   = 'specimens:open:total';        // ã‚ãªãŸã®ã“ã“ã‚Lvï¼ˆåˆè¨ˆï¼‰
  var GLOBAL_LAST = 'specimens:open:global:last';  // ä¸€è¦§ã®åˆæœŸè¡¨ç¤ºã‚­ãƒ£ãƒƒã‚·ãƒ¥
  var MY_ID = (document.body && document.body.getAttribute('data-id')) || 'unknown';

  // ã¿ã‚“ãªã®Lvï¼ˆCountAPIï¼‰
  var COUNTAPI_NS  = 'haisuikounozarigani_shindan';
  var COUNTAPI_KEY = 'specimens_open_total';
  function hitEveryone(){
    var url = 'https://api.countapi.xyz/hit/'+COUNTAPI_NS+'/'+COUNTAPI_KEY;
    if(navigator.sendBeacon){ try{ navigator.sendBeacon(url); }catch(_){ } }
    else{ fetch(url, {mode:'cors', cache:'no-store', keepalive:true}).catch(function(){}); }
  }

  var marked = false;
  function markOnce(){
    if(marked) return; marked = true;
    try{
      // ã‚ãªãŸã®ã“ã“ã‚Lv +1
      localStorage.setItem(TOTAL_KEY, String((+localStorage.getItem(TOTAL_KEY) || 0) + 1));
      // æ¸ˆãƒãƒƒãƒ— +1ï¼ˆä»–ã‚¿ãƒ–å³æ™‚åæ˜ ç”¨ã«_tsæ··ãœï¼‰
      var map={}; try{ map = JSON.parse(localStorage.getItem(DONE_KEY) || '{}'); }catch(_){}
      map[MY_ID] = (map[MY_ID] || 0) + 1;
      localStorage.setItem(DONE_KEY, JSON.stringify(Object.assign({}, map, {_ts: Date.now()})));
      // ã¿ã‚“ãªã®ã“ã“ã‚Lv +1 ã¨è¦‹æ „ãˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ +1
      hitEveryone();
      try{ localStorage.setItem(GLOBAL_LAST, String((+localStorage.getItem(GLOBAL_LAST) || 0) + 1)); }catch(_){}
    }catch(_){}
  }

  // çµæœæç”»ã®åˆå›³ã§åŠ ç®—ã€ä¿é™ºã§2ç§’å¾Œã«ã‚‚ä¸€åº¦ã ã‘
  document.addEventListener('result:ready', markOnce);
  setTimeout(markOnce, 2000);
})();
</script>
</body>
</html>