<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>å­¤ç‹¬æ„Ÿãƒ¡ãƒ¼ã‚¿ãƒ¼è¨ºæ–­ï½œã²ã¨ã‚Šæ„Ÿã®è³ªã¨å¼·ã•ã‚’ã‚„ã•ã—ãè¦‹ãˆã‚‹åŒ–</title>
<meta name="description" content="15å•Ã—5ä»¶æ³•ã§ã€ã„ã¾æ„Ÿã˜ã‚‹â€œã²ã¨ã‚Šæ„Ÿâ€ã®è³ªã¨å¼·ã•ã‚’ã‚„ã•ã—ãè¦‹ãˆã‚‹åŒ–ã€‚çµ†ãƒ»ç¤¾äº¤ãƒªã‚ºãƒ ãƒ»è‡ªå·±é–‹ç¤ºãƒ»å¢ƒç•Œç–²åŠ´ãƒ»ç½®æ›ã¤ãªãŒã‚Šã®5å› å­ã‚’å¯è¦–åŒ–ã—ã€çŸ­ã„ä¸€æ­©ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã¤ãã€‚">
<meta name="theme-color" content="#0F2A1F">
<!-- OG -->
<meta property="og:type" content="website">
<meta property="og:title" content="å­¤ç‹¬æ„Ÿãƒ¡ãƒ¼ã‚¿ãƒ¼è¨ºæ–­">
<meta property="og:description" content="15å•Ã—5ä»¶æ³•ã§â€œã²ã¨ã‚Šæ„Ÿâ€ã®è³ªã¨å¼·ã•ã‚’ã‚„ã•ã—ãè¦‹ãˆã‚‹åŒ–ã€‚5å› å­ãƒãƒ¼ã¨ãƒŸãƒ‹ä¸€æ­©ã¤ãã€‚">
<meta property="og:url" content="https://haisuikounozarigani.github.io/shindan/lonely-meter.html">
<meta property="og:image" content="https://haisuikounozarigani.github.io/shindan/assets/results/lonely-meter/t00.webp">
<style>
  :root{
    --bg:#f4f7f6;
    --paper:#fff;
    --ink:#10231c;
    --muted:#5a7268;
    --line:#e3ebe7;
    --accent:#8c6bff;      /* hotãƒ†ãƒ¼ãƒæ—¢å®š */
    --accent2:#E6C689;     /* å·®ã—å…‰ */
    --forest:#0F2A1F;      /* æŒ‡å®šè‰² */
  }
  html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Noto Sans JP","Hiragino Sans","Hiragino Kaku Gothic ProN","Yu Gothic",Meiryo,sans-serif}
  a{color:var(--forest);text-decoration:none}
  .wrap{max-width:980px;margin:0 auto;padding:16px}
  header.hd{position:relative;background:linear-gradient(160deg,#f1f6f3, #e8efe9);border-bottom:1px solid var(--line)}
  header.hd .wrap{padding:20px 16px 10px}
  .ttl{font-weight:800;font-size:1.35rem;letter-spacing:.02em}
  .sub{color:var(--muted);font-size:.95rem}

  /* å›ºå®šé€²æ—ãƒãƒ¼ï¼ˆnohæº–æ‹ ï¼‰ */
  .progress-fixed{position:sticky;top:0;z-index:20;height:8px;background:var(--line)}
  .progress-bar{height:100%;border-radius:6px;background:var(--accent);transition:width .2s ease}

  figure.hero{margin:12px 0;border:1px solid var(--line);border-radius:16px;overflow:hidden;background:#fff}
  figure.hero img{display:block;width:100%;height:auto}

  .paper{background:var(--paper);border:1px solid var(--line);border-radius:16px;padding:16px;margin:14px 0}
  .qnum{font-weight:700;color:#2c3e36}
  .qtext{margin:.4rem 0 1rem}
  .opts{display:grid;grid-template-columns:1fr;gap:8px}
  .btn{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:12px 14px;border:1px solid var(--line);border-radius:12px;background:#fff;cursor:pointer;transition:.12s}
  .btn[aria-pressed="true"]{outline:2px solid var(--accent2);background:#fff8e8}
  .btn:hover{transform:translateY(-1px)}
  .opt-note{color:#7b8b84;font-size:.9rem}
  .ctrls{display:flex;gap:8px;margin-top:12px}
  .ctrls button{padding:10px 14px;border-radius:10px;border:1px solid var(--line);background:#f6faf8;cursor:pointer}
  .ctrls button.primary{background:var(--forest);color:#fff;border-color:#0b1e17}
  .hint{font-size:.9rem;color:#5c6d65}

  .result{display:none}
  .rank{display:inline-block;padding:.2em .6em;border-radius:999px;background:#efe8ff;color:#4b3a7f;font-weight:700;margin-left:.4em}
  .flex{display:flex;gap:16px;flex-wrap:wrap}
  .result .imgbox{flex:1 1 280px;min-width:260px}
  .result .imgbox img{width:100%;height:auto;border-radius:14px;border:1px solid var(--line);display:block}
  .result .text{flex:2 1 360px;min-width:300px}
  .bars{display:grid;grid-template-columns:1fr;gap:10px;margin-top:10px}
  .bar{background:#f0f4f2;border:1px solid var(--line);border-radius:10px;overflow:hidden}
  .bar .h{display:flex;justify-content:space-between;align-items:center;padding:6px 10px;font-size:.92rem}
  .bar .b{height:10px;background:linear-gradient(90deg,var(--accent),var(--accent2));width:0%}
  .meta{color:#6b7a72;font-size:.92rem}
  .footer-note{font-size:.88rem;color:#6b7a72}
  .back{display:inline-block;margin:10px 0 20px;padding:10px 14px;border-radius:10px;border:1px solid var(--line);background:#f6faf8}

  .mini-toast{position:fixed;left:50%;bottom:24px;transform:translateX(-50%) translateY(20px);opacity:0;background:#1d2c26;color:#fff;padding:8px 12px;border-radius:999px;font-size:.9rem;transition:.25s;z-index:40}
  .mini-toast.show{opacity:1;transform:translateX(-50%) translateY(0)}

  /* ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ */
  [role="progressbar"]{width:100%}
  
  /* â”€â”€ å‰å›ã®å›ç­”ï¼šã‚¹ãƒãƒ›è¦–èªæ€§UP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.prev-list{list-style:none;padding-left:0;margin:.4rem 0 .2rem .9rem}
.prev-item{display:flex;gap:8px;align-items:flex-start;padding:6px 0;border-bottom:1px solid var(--line)}
/* è³ªå•æ–‡ã¯2è¡Œã§çœç•¥ï¼ˆæ”¹è¡Œä½ç½®ã¯è‡ªç„¶ã«ä»»ã›ã‚‹ï¼‰ */
.prev-q{flex:1;min-width:0;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;overflow:hidden;overflow-wrap:anywhere}
/* å›ç­”ãƒ©ãƒ™ãƒ«ã¯1è¡Œå›ºå®šã®ãƒãƒƒãƒ—åŒ–ï¼ˆæŠ˜ã‚Šè¿”ã•ãªã„ï¼‰ */
.prev-a{flex:0 0 auto;white-space:nowrap;border:1px solid var(--line);border-radius:999px;padding:2px 8px;font-size:.9rem;background:#f6faf8}
</style>
</head>

<body data-id="lonely-meter">
<header class="hd" role="banner">
  <div class="wrap">
    <div class="ttl">å­¤ç‹¬æ„Ÿãƒ¡ãƒ¼ã‚¿ãƒ¼è¨ºæ–­ <span class="rank" aria-label="5æ®µéšãƒ©ãƒ³ã‚¯">Lv?</span></div>
    <div class="sub">ã€Œã„ã¾æ„Ÿã˜ã‚‹â€œã²ã¨ã‚Šæ„Ÿâ€ã®è³ªã¨å¼·ã•ã€ã‚’ã‚„ã•ã—ãè¦‹ãˆã‚‹åŒ–ã€‚ã•ã£ã¨ç­”ãˆã¦ãƒŸãƒ‹ä¸€æ­©ã¸ã€‚</div>
  </div>
</header>

<!-- å›ºå®šé€²æ—ãƒãƒ¼ -->
<div class="progress-fixed"><div class="progress-bar" style="width:0%"></div></div>

<main class="wrap" id="app" role="main" aria-live="polite">
  <!-- ãƒ’ãƒ¼ãƒ­ãƒ¼ -->
  <figure class="hero">
    <img src="/shindan/assets/results/lonely-meter/t00.webp" alt="æœ¨æ¼ã‚Œæ—¥ã®æ£®ã®å…¥å£ã¨å°å¾„" loading="lazy">
  </figure>

  <!-- è³ªå•ã‚«ãƒ¼ãƒ‰ -->
  <section id="quiz" class="paper" aria-label="è³ªå•ã‚»ã‚¯ã‚·ãƒ§ãƒ³">
    <div class="qnum" id="qnum">Q1/15</div>
    <div class="qtext" id="qtext">â€¦</div>
    <div class="opts" id="opts" role="group" aria-label="å›ç­”ã‚’é¸æŠ">
      <!-- 5ä»¶æ³•ï¼ˆæ•°å­—ç¦æ­¢â†’ãƒ†ã‚­ã‚¹ãƒˆï¼‰ -->
      <!-- ç”Ÿæˆæ™‚ã«åŸ‹ã‚è¾¼ã¿ -->
    </div>
    <div class="ctrls">
      <button type="button" id="prevBtn">ã‚‚ã©ã‚‹</button>
      <button type="button" id="nextBtn" class="primary">æ¬¡ã¸</button>
    </div>
    <div class="hint" id="hint">æŠ¼ã—ãŸç¬é–“ã«å°ã•ãªã”è¤’ç¾âœ¨ï¼ˆä¿å­˜ã•ã‚Œã¾ã™ï¼‰</div>
  </section>

  <!-- çµæœ -->
  <section id="result" class="paper result" aria-label="çµæœã‚»ã‚¯ã‚·ãƒ§ãƒ³">
    <h2 style="margin-top:0">çµæœ</h2>
    <div class="flex">
      <div class="imgbox">
        <img id="resultImg" src="" alt="" loading="lazy">
      </div>
      <div class="text">
        <h3 id="resultTitle" style="margin:.2rem 0 0;"></h3>
        <p id="resultLines" style="white-space:pre-line;margin:.4rem 0 1rem"></p>
        <div class="meta" id="resultMeta"></div>
        <div class="bars" id="bars"></div>
      </div>
    </div>

    <details style="margin-top:14px">
      <summary>ç ”ç©¶ãƒ¡ãƒ¢</summary>
      <ul style="margin:.4rem 0 .2rem .9rem">
        <li>çŸ­ã„äº¤æµï¼ˆæŒ¨æ‹¶ãƒ»1åˆ†é€šè©±ï¼‰ã§ã‚‚ã€æ°—åˆ†ã‚„â€œã¤ãªãŒã‚Šæ„Ÿâ€ãŒå°‘ã—ä¸Šå‘ãå‚¾å‘ãŒã‚ã‚‹ã¨è¨€ã‚ã‚Œã¾ã™ã€‚</li>
        <li>å°ã•ãªå…±åŒä½œæ¥­ï¼ˆæ•£æ­©ãƒ»å®¶äº‹ã‚·ã‚§ã‚¢ç­‰ï¼‰ã¯æ‰€å±æ„Ÿã¨è‡ªå·±åŠ¹åŠ›æ„Ÿã‚’åŠ©ã‘ã‚‹ã¨ã®å ±å‘ŠãŒã‚ã‚Šã¾ã™ã€‚â€»å€‹äººå·®ã‚ã‚Š</li>
      </ul>
    </details>

<!-- å‰å›ã®å›ç­”ï¼ˆãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼‰ -->
<details id="prevBlock" style="margin-top:10px">
  <summary>å‰å›ã®å›ç­”ï¼ˆä¸€è¦§ï¼‰</summary>
  <ul id="prevList" class="prev-list"></ul>
</details>

    <p class="footer-note" style="margin-top:12px">â€»æœ¬ãƒšãƒ¼ã‚¸ã¯å¨¯æ¥½ï¼‹è‡ªå·±ç†è§£ã®è£œåŠ©ã‚’ç›®çš„ã¨ã—ãŸç°¡æ˜“ãƒ†ã‚¹ãƒˆã§ã™ã€‚ä½“èª¿ã‚„ä¸èª¿ãŒç¶šãå ´åˆã¯å°‚é–€æ©Ÿé–¢ã¸ã”ç›¸è«‡ãã ã•ã„ã€‚</p>
<button type="button" class="back" id="restartBtn" aria-label="æœ€åˆã‹ã‚‰ã‚„ã‚Šç›´ã™">æœ€åˆã‹ã‚‰ã‚„ã‚Šç›´ã™</button>
    <a class="back" href="https://haisuikounozarigani.github.io/shindan/">è¨ºæ–­ä¸€è¦§ã«æˆ»ã‚‹</a>
  </section>
</main>

<div class="mini-toast" id="toast" role="status" aria-live="polite">è¨˜éŒ²ã—ãŸã‚ˆ âœ…</div>

<script>
/* ===== å›ºå®šé€²æ—ãƒãƒ¼æ›´æ–°é–¢æ•°ï¼ˆè¦å®šï¼‰ ===== */
function updateProgress(p){
  document.querySelector('.progress-bar').style.width = Math.max(0,Math.min(100,p)) + '%';
}

/* ===== ãƒ‡ãƒ¼ã‚¿å®šç¾© ===== */
const SLUG = 'lonely-meter';
const LS_ANS = `shindan:${SLUG}:answers`;
const LS_IDX = `shindan:${SLUG}:index`;
const LS_DONE = `shindan:${SLUG}:done`;
const LS_LASTANS = `shindan:${SLUG}:lastAnswers`; // å‰å›å®Œäº†æ™‚ã®å›ç­”ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆ

const FACTORS = ['BOND','RHY','OPEN','BOUND','DIGI'];
const FACTOR_LABEL = {
  BOND:'çµ†ã®è³ª',
  RHY:'ç¤¾äº¤ãƒªã‚ºãƒ ',
  OPEN:'è‡ªå·±é–‹ç¤º',
  BOUND:'å¢ƒç•Œç–²åŠ´',
  DIGI:'ç½®æ›ã¤ãªãŒã‚Š'
};
const TYPE_NAME = {
  BOND:'çµ†ã†ã™ã‚',
  RHY:'ãƒªã‚ºãƒ æ¬ ã‘',
  OPEN:'èƒ¸ã®éµ',
  BOUND:'å¢ƒç•Œã¤ã‹ã‚Œ',
  DIGI:'ç”»é¢ã¾ã•ã‚Š'
};
const TYPE_ANIMAL = {BOND:'ğŸ¦Œ',RHY:'ğŸ¦',OPEN:'ğŸ‡',BOUND:'ğŸ¦”',DIGI:'ğŸ’¡'}; // DIGI=ãƒ›ã‚¿ãƒ«â†’å…‰çµµæ–‡å­—

// 15å•ãƒ»5ä»¶æ³•ï¼ˆ0â€“4ï¼‰â˜…ã¯åè»¢
const QUESTIONS = [
  {t:'ã„ã–ã¨ã„ã†æ™‚ã«é ¼ã‚Œã‚‹äººãŒæ€ã„æµ®ã‹ã°ãªã„ã€‚', key:'BOND', rev:false},
  {t:'æ°—æŒã¡ã‚’åˆ†ã‹ã£ã¦ã‚‚ã‚‰ãˆã¦ã„ãªã„æ„Ÿã˜ãŒç¶šãã€‚', key:'BOND', rev:false},
  {t:'å®‰å¿ƒã§ãã‚‹ç›¸æ‰‹ã¨æœˆ1å›ã¯ã‚†ã£ãã‚Šè©±ã—ã¦ã„ã‚‹ã€‚', key:'BOND', rev:true},
  {t:'æŒ¨æ‹¶ã‚„é›‘è«‡ãŒå°‘ãªãã€æ—¥ãŒç©ºããŒã¡ã€‚', key:'RHY', rev:false},
  {t:'äºˆå®šãŒãªã„æ—¥ã¯å£°ã‚’å‡ºã•ãšã«çµ‚ã‚ã‚‹ã“ã¨ãŒå¤šã„ã€‚', key:'RHY', rev:false},
  {t:'é€±1å›ã¯çŸ­ã„äº¤æµï¼ˆ5ã€œ10åˆ†ï¼‰ãŒã‚ã‚‹ã€‚', key:'RHY', rev:true},
  {t:'è¿‘æ³ã‚„æ„Ÿæƒ…ã‚’å°‘ã—ã§ã‚‚è©±ã™ã®ãŒã‚€ãšã‹ã—ã„ã€‚', key:'OPEN', rev:false},
  {t:'å¼±ã¿ã‚’è¦‹ã›ã‚‹ã¨è·é›¢ã‚’ç½®ã‹ã‚Œãã†ã§ã“ã‚ã„ã€‚', key:'OPEN', rev:false},
  {t:'â€œæµ…ã‚â€ãªã‚‰è©±ã—ã¦ã‚‚ã„ã„ç›¸æ‰‹ãŒã„ã‚‹ã€‚', key:'OPEN', rev:true},
  {t:'äººã¥ãåˆã„ã§æ°—ã‚’ã¤ã‹ã„ã™ãã¦ãã£ãŸã‚Šã€‚', key:'BOUND', rev:false},
  {t:'æ–­ã‚ŠãŸã„æ™‚ã«è¨€ã„ã«ããã¦æŠ±ãˆè¾¼ã¿ãŒã¡ã€‚', key:'BOUND', rev:false},
  {t:'ç„¡ç†ã—ãªã„ç·šã‚’æ±ºã‚ã‚‹ã®ãŒä¸Šæ‰‹ã„ã€‚', key:'BOUND', rev:true},
  {t:'ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚„é…ä¿¡ãŒä¸»ãªâ€œã¤ãªãŒã‚Šâ€ã«ãªã£ã¦ã„ã‚‹ã€‚', key:'DIGI', rev:false},
  {t:'SNSã§æ¯”ã¹ã¦è½ã¡è¾¼ã‚€ã“ã¨ãŒã‚ˆãã‚ã‚‹ã€‚', key:'DIGI', rev:false},
  {t:'ç”»é¢ã‚’é–‰ã˜ã¦ä¼‘ã‚€æ™‚é–“ã‚’ã¨ã‚Œã¦ã„ã‚‹ã€‚', key:'DIGI', rev:true},
];

const LABELS = ['ãœã‚“ãœã‚“','ã¨ãã©ã','ã©ã¡ã‚‰ã¨ã‚‚','ã‘ã£ã“ã†','ã‹ãªã‚Š']; // æ•°å­—ç¦æ­¢â†’ãƒ†ã‚­ã‚¹ãƒˆ

/* ===== çŠ¶æ…‹ ===== */
let idx = 0;
let answers = new Array(QUESTIONS.length).fill(null);

/* ===== è¦ç´ å‚ç…§ ===== */
const $qnum = document.getElementById('qnum');
const $qtext = document.getElementById('qtext');
const $opts = document.getElementById('opts');
const $prev = document.getElementById('prevBtn');
const $next = document.getElementById('nextBtn');
const $quiz = document.getElementById('quiz');
const $result = document.getElementById('result');
const $resultImg = document.getElementById('resultImg');
const $resultTitle = document.getElementById('resultTitle');
const $resultLines = document.getElementById('resultLines');
const $resultMeta = document.getElementById('resultMeta');
const $bars = document.getElementById('bars');
const $restart = document.getElementById('restartBtn');
const $toast = document.getElementById('toast');

/* ===== åˆæœŸåŒ–ï¼ˆå¾©å…ƒï¼‰ ===== */
(function restore(){
  try{
    const savedAns = JSON.parse(localStorage.getItem(LS_ANS) || 'null');
    const savedIdx = JSON.parse(localStorage.getItem(LS_IDX) || '0');
    if(Array.isArray(savedAns) && savedAns.length === QUESTIONS.length){
      answers = savedAns;
      idx = Math.min(Math.max(0, +savedIdx || 0), QUESTIONS.length-1);
      // ã™ã§ã«å…¨å›ç­”æ¸ˆã¿ãªã‚‰çµæœã¸
      if(answers.every(v => v !== null)){ showResult(); return; }
    }
  }catch(_){}
  renderQuestion();
})();

/* ===== ç”»é¢æç”» ===== */
function renderQuestion(){
  const q = QUESTIONS[idx];
  $qnum.textContent = `Q${idx+1}/${QUESTIONS.length}`;
  $qtext.textContent = q.t;
  $opts.innerHTML = '';
  LABELS.forEach((lab,i)=>{
    const btn = document.createElement('button');
    btn.type = 'button';
    btn.className = 'btn';
    btn.setAttribute('aria-pressed', answers[idx]===i ? 'true':'false');
    btn.innerHTML = `<span>${lab}</span><span class="opt-note">${descFor(i)}</span>`;
    btn.addEventListener('click',()=>{
      selectAnswer(i);
    });
    $opts.appendChild(btn);
  });
  $prev.disabled = (idx===0);
  $next.textContent = (idx===QUESTIONS.length-1)? 'çµæœã‚’è¦‹ã‚‹':'æ¬¡ã¸';
  const done = answers.filter(v=>v!==null).length;
  updateProgress(Math.round(done/QUESTIONS.length*100));
  document.querySelector('.rank').textContent = `Lv?`;
}

function descFor(i){
  // è»½ã„èª¬æ˜ï¼ˆå ±é…¬æ„Ÿï¼‰
  switch(i){
    case 0: return 'ã»ã¼ãªã„';
    case 1: return 'ã™ã“ã—';
    case 2: return 'ã©ã¡ã‚‰ã¨ã‚‚';
    case 3: return 'ã‚ˆãã‚ã‚‹';
    case 4: return 'ã¨ã¦ã‚‚ã‚ã‚‹';
  }
  return '';
}

/* ===== å›ç­”å‡¦ç† ===== */
function selectAnswer(v){
  answers[idx] = v; // 0â€“4
  persist();
  showToast('è¨˜éŒ²ã—ãŸã‚ˆ âœ…');
  markPressed(v);
  // è‡ªå‹•ã§æ¬¡ã¸ï¼ˆå°ä¼‘æ­¢ï¼‰
  setTimeout(()=>{
    if(idx < QUESTIONS.length-1){ idx++; renderQuestion(); }
    else { showResult(); }
  }, 140);
}

function markPressed(v){
  [...$opts.children].forEach((el,i)=> el.setAttribute('aria-pressed', i===v ? 'true' : 'false'));
}

$prev.addEventListener('click', ()=>{
  if(idx>0){ idx--; persist(); renderQuestion(); }
});
$next.addEventListener('click', ()=>{
  if(idx<QUESTIONS.length-1){ idx++; persist(); renderQuestion(); }
  else { showResult(); }
});

/* ===== ä¿å­˜ ===== */
function persist(){
  try{
    localStorage.setItem(LS_ANS, JSON.stringify(answers));
    localStorage.setItem(LS_IDX, JSON.stringify(idx));
  }catch(_){}
}

/* ===== ã‚¹ã‚³ã‚¢è¨ˆç®— ===== */
// å› å­ã‚¹ã‚³ã‚¢ï¼šå„0â€“12ï¼ˆ3å•Ã—4ç‚¹ï¼‰ã€‚â˜…ã¯ 4â†”0 åè»¢
function compute(){
  const sums = {BOND:0,RHY:0,OPEN:0,BOUND:0,DIGI:0};
  QUESTIONS.forEach((q,i)=>{
    let v = answers[i];
    if(v==null) v = 0;
    // 0â€“4 ã‚’ â€œã²ã¨ã‚Šæ„Ÿâ€æ–¹å‘ã«å¯„ã›ã‚‹
    let score = q.rev ? (4 - v) : v;
    // 4ç‚¹åŒ–ï¼ˆãã®ã¾ã¾0-4ç‚¹/å•ï¼‰
    sums[q.key] += score;
  });
  // ç·åˆ 0â€“60 â†’ æ­£è¦åŒ– 0â€“100
  const total = Object.values(sums).reduce((a,b)=>a+b,0);
  const totalPct = Math.round(total/60*100);
  return {sums,total,totalPct};
}

/* ===== ç”»åƒå¸¯åŸŸå‰²å½“ï¼ˆ0â€“39: t01 / 40â€“59: t02 / 60â€“74: t03 / 75â€“89: t04 / 90â€“100: t05ï¼‰ ===== */
function imageFor(pct){
  let file='t01.webp', lv=1, name='ã²ã ã¾ã‚Š';
  if(pct<=39){ file='t01.webp'; lv=1; name='ã²ã ã¾ã‚Š'; }
  else if(pct<=59){ file='t02.webp'; lv=2; name='å½±ã•ã™'; }
  else if(pct<=74){ file='t03.webp'; lv=3; name='ã¾ã©ã‹ã’'; }
  else if(pct<=89){ file='t04.webp'; lv=4; name='ã†ã™é—‡'; }
  else { file='t05.webp'; lv=5; name='ç¯ã‚Šå¾…ã¡'; }
  return {file,lv,name};
}

/* ===== çµæœãƒ†ã‚­ã‚¹ãƒˆï¼ˆãƒ¬ãƒ™ãƒ«åœŸå°ï¼‹ã‚¿ã‚¤ãƒ—ã‚¹ãƒ‘ã‚¤ã‚¹ï¼‹ãƒŸãƒ‹ä¸€æ­©ï¼‰ ===== */
function levelBase(lv){
  switch(lv){
    case 1: return {base:'ç”¨äº‹ãŒã‚ã‚Œã°è©±ã›ã‚‹ã€‚', step:'æŒ¨æ‹¶ï¼‹ã²ã¨è¨€'};
    case 2: return {base:'é€£çµ¡ãŒâ€œã‚ã¨ã§â€ã«ãªã‚ŠãŒã¡ã€‚', step:'1åˆ†ãƒœã‚¤ã‚¹'};
    case 3: return {base:'ä¸‹æ›¸ããŒå¢—ãˆãŒã¡ã€‚', step:'äº‹å®Ÿï¼‹æ„Ÿæƒ…1èª'};
    case 4: return {base:'ä¼šã†å‰ã‹ã‚‰ç–²ã‚Œäºˆæ„Ÿã€‚', step:'æ•£æ­©5åˆ†â†’ä¸€è¨€'};
    case 5: return {base:'å£°ã‚’å‡ºã•ãªã„æ—¥ãŒç¶šãã€‚', step:'å®šå‹ã€Œä»Šæ—¥ã¯é›£ã—ã„ã€'};
  }
  return {base:'',step:''};
}
function spiceBy(type){
  switch(type){
    case 'BOND': return 'æ·±ã„ç›¸æ‰‹ã¯ã„ã‚‹ãŒå›æ•°å°‘ãªã‚ã€‚';
    case 'RHY':  return 'ç”¨äº‹ãŒãªã„ã¨ç„¡éŸ³ã«ãªã‚ŠãŒã¡ã€‚';
    case 'OPEN': return 'æµ…ãé–‹ã‘ã‚‹ãªã‚‰ã„ã‘ã‚‹ã€ã®ä¸€æ­©æ‰‹å‰ã€‚';
    case 'BOUND':return 'æ–­ã‚Œãšæ¶ˆè€—â†’é¿ã‘ã¦ä¼‘ã‚€ã®ãƒ«ãƒ¼ãƒ—ã€‚';
    case 'DIGI': return 'ç”»é¢ã§ã¯æº€ãŸã•ã‚Œã«ãã„ã€‚';
  }
  return '';
}

/* ===== çµæœè¡¨ç¤º ===== */
function showResult(){
	
	function restartQuiz(){
  // å›ç­”ã¨ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’åˆæœŸåŒ–
  answers = new Array(QUESTIONS.length).fill(null);
  idx = 0;
  // ä¿å­˜ã‚’ã‚¯ãƒªã‚¢ï¼ˆå®Œäº†ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã¯æ®‹ã™ï¼‰
  try{
    localStorage.removeItem(LS_ANS);
    localStorage.removeItem(LS_IDX);
  }catch(_){}
  // ç”»é¢ã‚’æˆ»ã™
  $result.style.display = 'none';
  $quiz.style.display = 'block';
  updateProgress(0);
  renderQuestion();
  // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã¨ãƒˆãƒ¼ã‚¹ãƒˆ
  window.scrollTo({top:0, behavior:'smooth'});
  showToast('æœ€åˆã‹ã‚‰ã¯ã˜ã‚ã‚‹ã‚ˆ');
}

// ãƒœã‚¿ãƒ³ã«ã‚¤ãƒ™ãƒ³ãƒˆä»˜ä¸
if($restart){
  $restart.addEventListener('click', restartQuiz);
}
	
  // æœªå›ç­”ã¯0æ‰±ã„ã§é›†è¨ˆ
  const {sums,totalPct} = compute();

// â¬‡ å‰å›ã®å›ç­”ã‚’èª­ã¿å‡ºã—ã€ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’æç”»
try{
  const prev = JSON.parse(localStorage.getItem(LS_LASTANS) || 'null');
  const $block = document.getElementById('prevBlock');
  const $list  = document.getElementById('prevList');
  if(prev && Array.isArray(prev.answers) && $block && $list){
    $list.innerHTML = '';
    prev.answers.forEach((v,i)=>{
  const li = document.createElement('li');
  li.className = 'prev-item';
  const lab = (typeof v === 'number' && v>=0 && v<LABELS.length) ? LABELS[v] : 'â€”';
  li.innerHTML = `<span class="prev-q">Q${i+1}ï¼š${QUESTIONS[i].t}</span><span class="prev-a">ã€Œ${lab}ã€</span>`;
  $list.appendChild(li);
});
    $block.open = false; // é–‹ãç›´ã—æ™‚ã¯é–‰ã˜ãŸçŠ¶æ…‹ã§è¡¨ç¤º
  }
}catch(_){}

  // ãƒˆãƒƒãƒ—å› å­ï¼ˆåŒç‚¹ãªã‚‰äºŒé‡è¡¨è¨˜ï¼‰
  const entries = Object.entries(sums).sort((a,b)=>b[1]-a[1]);
  const topVal = entries[0][1];
  const tops = entries.filter(([k,v])=> v===topVal).map(([k])=>k);
  const topTypeLabel = tops.map(k=> TYPE_NAME[k]).join(' Ã— ');
  const topAnimal = tops.map(k=> TYPE_ANIMAL[k]).join('');

  const img = imageFor(totalPct);
  const base = levelBase(img.lv);

  // 1è¡Œç›®ï¼šLv/ã‚¿ã‚¤ãƒ—
  const line1 = `Lv${img.lv}ï¼ˆ${img.name}ï¼‰ï¼ã‚¿ã‚¤ãƒ—ï¼š${topTypeLabel}`;
  // 2è¡Œç›®ï¼šæ£®ã®ä¸€è¨€
  const mood = ['æœ¨æ¼ã‚Œæ—¥','ç´°ã„éœ§','éœ§ãŒå¢—ã™','æ¿ƒã„éœ§','é ã„ç¯'][img.lv-1];
  const line2 = `æ£®ã®ä¸€è¨€ï¼š${mood}`;
  // 3è¡Œç›®ï¼šã‚ã‚‹ã‚ã‚‹ï¼ˆçŸ­å¥ï¼‰
  const line3 = (()=>{
    switch(img.lv){
      case 1:return 'ã€Œç”¨äº‹ãªã‚‰è©±ã›ã‚‹ã€ã‚ã‚‹ã‚ã‚‹';
      case 2:return 'è¿”ä¿¡ãŒã¤ã„å…ˆå»¶ã°ã—';
      case 3:return 'ä¸‹æ›¸ãã«çœ ã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸';
      case 4:return 'ä¼šã†å‰ã‹ã‚‰æ°—åŠ›ã‚²ãƒ¼ã‚¸æ¸›';
      case 5:return 'å£°ã®ãªã„æ—¥ãŒç¶šã';
    }
  })();
  // 4è¡Œç›®ï¼šãƒŸãƒ‹ä¸€æ­©
  const line4 = `ãƒŸãƒ‹ä¸€æ­©ï¼š${base.step}`;

// ç”»åƒã¨ã‚¿ã‚¤ãƒˆãƒ«
const IMG_BASE = '/shindan/assets/results/lonely-meter/';
$resultImg.src = IMG_BASE + img.file;
const altMap = {
  't01.webp':'å‹•ç‰©ã«å›²ã¾ã‚Œã‚‹äººã¨æŸ”ã‚‰ã‹ãªå…‰',
  't02.webp':'å°‘ã—è·é›¢ã®ã‚ã‚‹å‹•ç‰©ã¨è–„ã„éœ§',
  't03.webp':'è¿‘ãã®å°é³¥ã¨é ã„ã‚­ãƒ„ãƒã€éœ§ãŒå¢—ã™',
  't04.webp':'æ¿ƒã„éœ§ã®æ£®ã¨é ã„ã‚«ãƒ©ã‚¹',
  't05.webp':'æ·±ã„éœ§ã®æ£®ã§å°ã•ãªç¯ã‚Šã«å‘ã‹ã†äººå½±'
};
$resultImg.alt = altMap[img.file] || 'æ£®ã®æƒ…æ™¯';
$resultTitle.textContent = `ç·åˆã²ã¨ã‚Šæ„Ÿï¼š${totalPct} / 100`;

// ğŸŒ³ ã‚³ãƒ¡ãƒ³ãƒˆã‚’ã‚‚ã†å°‘ã—é•·ãã™ã‚‹
const baseComment = (() => {
  switch(img.lv){
    case 1: return 'ã‚ãŸãŸã‹ãªè·é›¢æ„Ÿã®ä¸­ã§ã€è‡ªç„¶ä½“ã§éã”ã›ã¦ã„ã‚‹çŠ¶æ…‹ã€‚ã¨ãã©ãã®é™ã‘ã•ã‚‚ã€ã‚ãªãŸã«ã¨ã£ã¦å¤§åˆ‡ãªå……é›»æ™‚é–“ã§ã™ã€‚';
    case 2: return 'å°‘ã—äººã¨ã®è·é›¢ãŒã§ãã‚„ã™ã„æ™‚æœŸã€‚æ°—ã¥ã‹ãªã„ã†ã¡ã«ã€Œã¾ãŸä»Šåº¦ã€ã¨å¾Œå›ã—ã«ã—ã¦ã„ã‚‹ã ã‘ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚';
    case 3: return 'è‡ªåˆ†ã®ä¸–ç•Œã«ã“ã‚‚ã‚‹æ™‚é–“ãŒå¢—ãˆã€å¤–ã¨å†…ã®ãƒãƒ©ãƒ³ã‚¹ã‚’æ¢ã—ã¦ã„ã‚‹æ®µéšã€‚å­¤ç‹¬ãŒæ‚ªã„ã‚ã‘ã§ã¯ãªãã€æ•´ç†ã®é€”ä¸­ã§ã™ã€‚';
    case 4: return 'äººã«ä¼šã†å‰ã‹ã‚‰æ°—åŠ›ã‚’æ¶ˆè€—ã—ã¦ã—ã¾ã†ã‚µã‚¤ã‚¯ãƒ«ã€‚å¿ƒã®ãƒãƒƒãƒ†ãƒªãƒ¼ã‚’å®ˆã‚‹ãŸã‚ã«ã€ä¼šã‚ãªã„æ—¥ã‚’ã€Œç½ªæ‚ªæ„Ÿãªã—ã€ã§éã”ã—ã¦ã€‚';
    case 5: return 'æ·±ã„éœ§ã®ã‚ˆã†ãªé™ã‘ã•ã«åŒ…ã¾ã‚Œã¦ã„ã¾ã™ã€‚ã„ã¾ã¯å£°ã‚’å‡ºã™ã‚ˆã‚Šã€ã¾ãšç¯ã‚Šã‚’è¦‹ã¤ã‘ã‚‹æ™‚é–“ã€‚å°ã•ãªé€£çµ¡ã§ã‚‚å……åˆ†ã§ã™ã€‚';
  }
})();

$resultLines.textContent =
  [line1,
   line2,
   (topAnimal ? topAnimal + ' ' : '') + line3,
   base.base + spiceBy(tops[0]),
   baseComment,
   'ãƒŸãƒ‹ä¸€æ­©ï¼š' + base.step
  ].join('\n');

  // ãƒ¡ã‚¿
  document.querySelector('.rank').textContent = `Lv${img.lv}`;
  $resultMeta.textContent = `ãƒˆãƒƒãƒ—å› å­ï¼š${topTypeLabel}ã€€ï¼ˆåŒç‚¹: ${tops.length>1?'ã‚ã‚Š':'ãªã—'}ï¼‰`;

  // å› å­ãƒãƒ¼ï¼ˆ0â€“12â†’pctï¼‰
  $bars.innerHTML = '';

// å‰å›å› å­ã‚µãƒãƒªï¼ˆãªã‘ã‚Œã° nullï¼‰
let prevSums = null;
try{
  const prev = JSON.parse(localStorage.getItem(LS_LASTANS) || 'null');
  if(prev && Array.isArray(prev.answers) && prev.answers.length === QUESTIONS.length){
    // ç°¡æ˜“å†è¨ˆç®—ï¼šéå»ã®å›ç­”ã§ä»Šã®è¨­å•å®šç¾©ã‚’æµç”¨
    const tmpAnswers = answers;            // é€€é¿
    answers = prev.answers.slice();
    prevSums = compute().sums;
    answers = tmpAnswers;                  // å…ƒã«æˆ»ã™
  }
}catch(_){}

FACTORS.forEach(key=>{
  const val = sums[key];
  const pct = Math.round(val/12*100);
  const diff = (prevSums ? Math.round((val - prevSums[key]) / 12 * 100) : null);
  const diffTxt = (diff===null) ? '' : (diff>0 ? `ï¼ˆ+${diff}%ï¼‰` : (diff<0 ? `ï¼ˆ${diff}%ï¼‰` : 'ï¼ˆÂ±0ï¼‰'));
    const wrap = document.createElement('div');
    wrap.className = 'bar';
    wrap.innerHTML = `
  <div class="h">
    <span>${FACTOR_LABEL[key]}ï¼ˆ${TYPE_NAME[key]}ï¼‰</span>
    <span>${pct}%${diffTxt}</span>
  </div>
  <div class="b" style="width:${pct}%" aria-label="${FACTOR_LABEL[key]}ã®ã‚¹ã‚³ã‚¢ ${pct}%"></div>
`;
    $bars.appendChild(wrap);
  });

  // åˆ‡æ›¿
  $quiz.style.display = 'none';
  $result.style.display = 'block';
  
  // åˆ‡æ›¿
$quiz.style.display = 'none';
$result.style.display = 'block';

// â¬‡ ä»Šå›ã®å›ç­”ã‚’ã€Œå‰å›å›ç­”ã€ã¨ã—ã¦ä¿å­˜ï¼ˆæ¬¡å›ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”¨ï¼‰
try{
  localStorage.setItem(LS_LASTANS, JSON.stringify({answers: answers.slice(), ts: Date.now()}));
}catch(_){}

  // å®Œäº†ãƒãƒ¼ã‚­ãƒ³ã‚°
  try{ localStorage.setItem(LS_DONE, String(Date.now())); }catch(_){}

  // ã¿ã‚“ãªã®ã“ã“ã‚ ï¼† ã‚ãªãŸã®Lv åŠ ç®—ãƒ•ãƒƒã‚¯
  document.dispatchEvent(new Event('result:ready'));
}

/* ===== ãƒˆãƒ¼ã‚¹ãƒˆ ===== */
let toastTimer = null;
function showToast(msg){
  $toast.textContent = msg || 'OK';
  $toast.classList.add('show');
  clearTimeout(toastTimer);
  toastTimer = setTimeout(()=> $toast.classList.remove('show'), 850);
}

/* ===== åˆå›ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚° ===== */
renderQuestion();
</script>

<!-- ã¿ã‚“ãªã®ã“ã“ã‚ï¼ˆå…±é€šIIFEï¼šä¿å­˜ï¼‹CountAPIï¼‰ -->
<script>(function(){
  var DONE_KEY='specimens:open:byid', TOTAL_KEY='specimens:open:total';
  var MY_ID=document.body.getAttribute('data-id')||'lonely-meter';
  var NS='haisuikounozarigani_shindan', KEY='specimens_open_total';
  var marked=false;
  function mark(){ if(marked) return; marked=true;
    try{
      var t=(+localStorage.getItem(TOTAL_KEY)||0)+1;
      localStorage.setItem(TOTAL_KEY,String(t));
      var map={}; try{ map=JSON.parse(localStorage.getItem(DONE_KEY)||'{}'); }catch(_){}
      map[MY_ID]=(map[MY_ID]||0)+1;
      localStorage.setItem(DONE_KEY, JSON.stringify(Object.assign({},map,{_ts:Date.now()})));
      var url='https://api.countapi.xyz/hit/'+NS+'/'+KEY;
      if(navigator.sendBeacon){ try{ navigator.sendBeacon(url); }catch(_){ } }
      else{ fetch(url,{mode:'cors',cache:'no-store',keepalive:true}).catch(function(){}); }
    }catch(_){}
  }
  document.addEventListener('result:ready', mark);
  setTimeout(mark, 2000); // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
}());</script>

</body>
</html>