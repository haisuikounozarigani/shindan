<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>å†·é…·ã‚¢ã‚¤ã‚¹ã‚¯ãƒªãƒ¼ãƒ è¨ºæ–­ï¼ˆMach-IVæº–æ‹ ãƒ»20å•ï¼‰</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{ --brand:#b86b77; --chip:#f4f1ef; --bg:#fffaf6; }
    body{font-family:sans-serif;background:var(--bg);color:#333;padding:20px}
    h1{text-align:center;color:var(--brand);margin:0 0 14px}
    .legend{max-width:860px;margin:0 auto 16px;font-size:.95em;color:#555}
    .progress-wrap{max-width:860px;margin:0 auto 18px}
    .progress{height:10px;background:#eee;border-radius:999px;overflow:hidden}
    .bar{height:100%;width:0;background:var(--brand);transition:width .2s}
    .count{margin-top:6px;color:#666;font-size:.9em;text-align:right}

    form{max-width:860px;margin:auto;background:#fff;padding:18px;border-radius:12px;box-shadow:0 0 12px #e5d4cf}
    .question{margin:20px 0}
    .qhead{display:flex;justify-content:space-between;gap:8px;align-items:center;margin:0 0 8px;font-weight:600}
    .qstatus{font-weight:600;font-size:.85em;color:#888}
    .qstatus.done{color:var(--brand)}
    .scale{display:grid;grid-template-columns:repeat(5,1fr);gap:10px}
    .chip{display:block;position:relative;border-radius:10px;background:var(--chip);text-align:center;padding:12px 8px;cursor:pointer;border:2px solid #e9e1de;user-select:none}
    .chip input{position:absolute;inset:0;opacity:0}
    .chip span{display:block}
    .chip input:checked + span{
      background:var(--brand);color:#fff;border-radius:8px;padding:8px 6px;
      box-shadow:0 0 0 2px var(--brand) inset, 0 4px 10px rgba(184,107,119,.25);
      transform:scale(1.02);
    }
    .chip:hover{border-color:#d7c6c2}
    .chip input:focus-visible + span{outline:3px solid #ffd9e1;outline-offset:2px;border-radius:8px}
    .btn{display:block;margin:22px auto 0;padding:12px 22px;font-size:1.1em;background:var(--brand);color:#fff;border:none;border-radius:10px;cursor:pointer}

    #result{max-width:860px;margin:22px auto 0;background:#fff;border:1px solid #eadad6;padding:18px;border-radius:10px}
    #result h2{margin:0 0 8px;color:#b16370}
    .row{display:flex;flex-wrap:wrap;gap:10px;align-items:center}
    .tag{display:inline-block;background:#f6eef0;border:1px solid #e0cfd0;border-radius:999px;padding:6px 12px;font-size:.9em;color:#7b4d57}
    .lead{margin:8px 0 10px;color:#555}
    .img{width:100%;height:auto;border-radius:10px;box-shadow:0 8px 20px rgba(0,0,0,.08);margin:8px 0}
    .actions{display:flex;gap:10px;margin-top:12px;flex-wrap:wrap}
    .a-btn{flex:1;text-align:center;text-decoration:none;background:#f7f2f1;border:1px solid #e3d2cd;padding:10px;border-radius:10px;color:#7b4d57;font-weight:700}
    .a-btn:hover{background:#f1e7e5}
  </style>
</head>
<body>
  <h1>ğŸ¦ å†·é…·ã‚¢ã‚¤ã‚¹ã‚¯ãƒªãƒ¼ãƒ è¨ºæ–­ï¼ˆMach-IVæº–æ‹ ï¼‰</h1>
  <div class="legend">5ä»¶æ³•ï¼š1 ã¾ã£ãŸãå½“ã¦ã¯ã¾ã‚‰ãªã„ ï¼ 2 ã‚ã¾ã‚Šå½“ã¦ã¯ã¾ã‚‰ãªã„ ï¼ 3 ã©ã¡ã‚‰ã¨ã‚‚ã„ãˆãªã„ ï¼ 4 ã‚„ã‚„å½“ã¦ã¯ã¾ã‚‹ ï¼ 5 ã¨ã¦ã‚‚å½“ã¦ã¯ã¾ã‚‹</div>

  <div class="progress-wrap">
    <div class="progress"><div id="bar" class="bar"></div></div>
    <div id="count" class="count">0 / 20 å›ç­”</div>
  </div>

  <form id="quizForm" aria-live="polite"></form>
  <button class="btn" type="button" onclick="calculate()">è¨ºæ–­ã™ã‚‹</button>

  <div id="result" style="display:none;"></div>

  <script>
    // Mach-IV 20é …ç›®ï¼ˆrev:true ã¯é€†è»¢ï¼‰
    const items = [
      { text: "ç›®çš„ã®ãŸã‚ãªã‚‰æœ¬éŸ³ã‚’éš ã™ã“ã¨ã‚‚å¿…è¦ã ã¨æ€ã†", rev: false },
      { text: "é“å¾³çš„ã«æ­£ã—ã„ã¨ç¢ºä¿¡ã§ããªã„ãªã‚‰ã€è¡Œå‹•ã™ã¹ãã§ã¯ãªã„", rev: true },
      { text: "å‡ºä¸–ã™ã‚‹äººã®å¤šãã¯ã€æ­£ç›´ã§æ½”ç™½ã ã¨æ€ã†", rev: true },
      { text: "é‡è¦äººç‰©ã«ã¯ãŠä¸–è¾ã‚’ä½¿ã†ã®ãŒè³¢ã„ã‚„ã‚Šæ–¹ã ", rev: false },
      { text: "ãŸã¨ãˆä¸åˆ©ã§ã‚‚ã€ä»–äººã«ã†ãã‚’ã¤ãã¹ãã§ã¯ãªã„", rev: true },
      { text: "äººã‚’å‹•ã‹ã™ã«ã¯ã€ç›¸æ‰‹ãŒèããŸã„ã“ã¨ã‚’è¨€ã†ã®ãŒä¸€ç•ªã ", rev: false },
      { text: "èª°ã‹ã‚’å®Œå…¨ã«ä¿¡é ¼ã™ã‚‹ã®ã¯å±é™ºã ã¨æ€ã†", rev: false },
      { text: "è¿‘é“ã‚’ä½¿ã‚ãšåŠªåŠ›ã™ã‚Œã°ã€å¿…ãšå ±ã‚ã‚Œã‚‹ã‚‚ã®ã ", rev: true },
      { text: "äººã¯åŸºæœ¬çš„ã«å–„è‰¯ã§ã€å…¬æ­£ã«æŒ¯ã‚‹èˆã†ã¨æ€ã†", rev: true },
      { text: "æˆåŠŸã«ã¯ã€æ™‚ã«ãƒ«ãƒ¼ãƒ«ã‚’æ›²ã’ã‚‹ã“ã¨ãŒæ¬ ã‹ã›ãªã„", rev: false },
      { text: "ãƒãƒ£ãƒ³ã‚¹ãŒã‚ã£ã¦ã‚‚ã€ä¸å…¬å¹³ãªåˆ©å¾—ã¯çµ¶å¯¾ã«å¾—ãªã„", rev: true },
      { text: "ã†ã¾ãç«‹ã¡å›ã‚‹ã«ã¯ã€å¤šå°‘ã®â€œæ“ä½œâ€ã¯å¿…è¦ã ", rev: false },
      { text: "äººå‰ã§ã¯ã€æœ¬å¿ƒã‚’è¦‹ã›ãªã„æ–¹ãŒå®‰å…¨ã ã¨æ€ã†", rev: false },
      { text: "ãŸã¨ãˆæã§ã‚‚ã€æ­£ç›´ã•ã‚’æœ€å„ªå…ˆã™ã‚‹ã¹ãã ", rev: true },
      { text: "å¤šãã®äººã¯ã€è¦‹è¿”ã‚ŠãŒãªã‘ã‚Œã°å”åŠ›ã—ãªã„ã¨æ€ã†", rev: false },
      { text: "äººé–“é–¢ä¿‚ã§ã¯ã€èª æ„ã•ãˆã‚ã‚Œã°ååˆ†ã†ã¾ãã„ã", rev: true },
      { text: "äº¤æ¸‰ã§ã¯â€œè¦ç¯„â€ã‚ˆã‚Šâ€œçµæœâ€ã‚’é‡è¦–ã™ã‚‹ã¹ãã ", rev: false },
      { text: "äººã‚’åˆ©ç”¨ã™ã‚‹ãã‚‰ã„ãªã‚‰ã€æ©Ÿä¼šã‚’é€ƒã—ã¦ã‚‚ã‚ˆã„", rev: true },
      { text: "é‡è¦ãªæƒ…å ±ã¯ã€æœ‰åˆ©ã«ãªã‚‹ã¾ã§ä¼ã›ã¦ãŠãã¹ãã ", rev: false },
      { text: "ç´„æŸã¯çŠ¶æ³ãŒå¤‰ã‚ã£ã¦ã‚‚ã€å¿…ãšå®ˆã‚‹ã¹ãã ", rev: true }
    ];

    const scaleLabels = [
      "1ï¼ˆã¾ã£ãŸãå½“ã¦ã¯ã¾ã‚‰ãªã„ï¼‰","2ï¼ˆã‚ã¾ã‚Šå½“ã¦ã¯ã¾ã‚‰ãªã„ï¼‰","3ï¼ˆã©ã¡ã‚‰ã¨ã‚‚ã„ãˆãªã„ï¼‰","4ï¼ˆã‚„ã‚„å½“ã¦ã¯ã¾ã‚‹ï¼‰","5ï¼ˆã¨ã¦ã‚‚å½“ã¦ã¯ã¾ã‚‹ï¼‰"
    ];

    const TAGLINE = {
      "ã‚½ãƒ•ãƒˆã‚¯ãƒªãƒ¼ãƒ ":"é§†ã‘å¼•ãã‚¼ãƒ­ã€ç›´çƒã™ãã¦é€†ã«æœ€å¼·",
      "ãƒãƒ‹ãƒ©ã‚¢ã‚¤ã‚¹":"åŸºæœ¬ã¯æ­£æ”»æ³•ã€ã¨ãã©ãå°ãƒ¯ã‚¶",
      "ã‚¸ã‚§ãƒ©ãƒ¼ãƒˆ":"ç”˜ã•ã¨å†·é™ã•ã®ã‚¹ã‚¤ãƒƒãƒãƒ£ãƒ¼",
      "ã‚½ãƒ«ãƒ™":"æ°·ç‚¹ä¸‹ã®å†·é™ã€å‹ã¡ç­‹ç›´è¡Œ",
      "ã‚¯ãƒªã‚¹ã‚¿ãƒ«ã‚¢ã‚¤ã‚¹":"æ°·ã®ç­–å£«ã€æœ€é©è§£ã‚’å–ã‚Šã«ã„ã"
    };

    // ã‚¿ã‚¤ãƒ— â†’ ç”»åƒãƒ•ã‚©ãƒ«ãƒ€ã®ã‚¹ãƒ©ãƒƒã‚°
    const TYPE_TO_SLUG = {
      "ã‚½ãƒ•ãƒˆã‚¯ãƒªãƒ¼ãƒ ":"softcream",
      "ãƒãƒ‹ãƒ©ã‚¢ã‚¤ã‚¹":"vanilla",
      "ã‚¸ã‚§ãƒ©ãƒ¼ãƒˆ":"gelato",
      "ã‚½ãƒ«ãƒ™":"sorbet",
      "ã‚¯ãƒªã‚¹ã‚¿ãƒ«ã‚¢ã‚¤ã‚¹":"crystalice"
    };

    const form   = document.getElementById("quizForm");
    const bar    = document.getElementById("bar");
    const count  = document.getElementById("count");
    const result = document.getElementById("result");

    // è³ªå•ç”Ÿæˆ
    items.forEach((it, i) => {
      const div = document.createElement("div");
      div.className = "question";
      const qid = `q${i}`;
      let options = "";
      for (let n = 0; n < 5; n++) {
        const id = `${qid}_${n+1}`;
        options += `
          <label class="chip" for="${id}">
            <input id="${id}" type="radio" name="${qid}" value="${n+1}" />
            <span>${scaleLabels[n]}</span>
          </label>`;
      }
      div.innerHTML = `
        <p class="qhead"><span>Q${i+1}. ${it.text}</span><span id="${qid}_status" class="qstatus">æœªé¸æŠ</span></p>
        <div class="scale">${options}</div>`;
      form.appendChild(div);
    });

    // é€²æ—è¡¨ç¤º
    document.addEventListener("change", (e) => {
      if (!e.target.name?.startsWith("q")) return;
      const qid = e.target.name;
      const st = document.getElementById(`${qid}_status`);
      if (st){ st.textContent = "é¸æŠæ¸ˆ"; st.classList.add("done"); }
      updateProgress();
    });
    function updateProgress(){
      const checked = Array.from(document.querySelectorAll('input[type="radio"]:checked'));
      const answeredQs = new Set(checked.map(i=>i.name)).size;
      const totalQ = items.length;
      const pct = Math.round(answeredQs/totalQ*100);
      bar.style.width = pct + "%";
      count.textContent = `${answeredQs} / ${totalQ} å›ç­”`;
    }

    // ç”»åƒã‚»ãƒƒãƒˆï¼ˆ01ã®ã¿ï¼‰ã€‚PNGâ†’ã ã‚ãªã‚‰WebPã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
    function setImage(imgEl, slug){
      const base = `/shindan/assets/results/ice/${slug}/01`;
      imgEl.onerror = null;
      imgEl.src = `${base}.png`;
      imgEl.onerror = () => { if (imgEl.src.endsWith('.png')) imgEl.src = `${base}.webp`; };
    }

    function calculate() {
      // æœªå›ç­”ãƒã‚§ãƒƒã‚¯
      for (let i = 0; i < items.length; i++) {
        if (!document.querySelector(`input[name="q${i}"]:checked`)) {
          alert(`æœªå›ç­”ã®è¨­å•ãŒã‚ã‚Šã¾ã™ï¼ˆQ${i+1}ï¼‰`);
          return;
        }
      }
      // æ¡ç‚¹ï¼ˆé€†è»¢é …ç›®ã¯ 6 - å€¤ï¼‰
      let sum = 0;
      for (let i = 0; i < items.length; i++) {
        let v = parseInt(document.querySelector(`input[name="q${i}"]:checked`).value,10);
        if (items[i].rev) v = 6 - v;
        sum += v;
      }
      // 20ã€œ100ç‚¹ â†’ 0ã€œ100% ã«ç·šå½¢å¤‰æ›
      const machPct = Math.round((sum - 20) / 80 * 100);

      // ã‚¿ã‚¤ãƒ—åˆ¤å®š
      let type="";
      if (machPct <= 20) type="ã‚½ãƒ•ãƒˆã‚¯ãƒªãƒ¼ãƒ ";
      else if (machPct <= 40) type="ãƒãƒ‹ãƒ©ã‚¢ã‚¤ã‚¹";
      else if (machPct <= 60) type="ã‚¸ã‚§ãƒ©ãƒ¼ãƒˆ";
      else if (machPct <= 80) type="ã‚½ãƒ«ãƒ™";
      else type="ã‚¯ãƒªã‚¹ã‚¿ãƒ«ã‚¢ã‚¤ã‚¹";

      const tagline = TAGLINE[type] || "";
      const slug = TYPE_TO_SLUG[type];

      // çµæœæç”»ï¼ˆã‚µã‚¤ãƒˆå†…ç”»åƒ1æšï¼‰
      result.style.display = "block";
      result.innerHTML = `
        <h2>çµæœ</h2>
        <div class="row">
          <span class="tag">å†·é…·åº¦ï¼š${machPct}%</span>
          <span class="tag">${type}</span>
        </div>
        <p class="lead">ä¸€è¨€ã¾ã¨ã‚ï¼š${tagline}</p>
        <img id="ice-img" class="img" alt="${type} ã®çµæœç”»åƒ" decoding="async">
        <div class="actions">
          <a class="a-btn" href="/shindan/">ğŸ”™ è¨ºæ–­ä¸€è¦§ã¸æˆ»ã‚‹</a>
          <a class="a-btn" href="#" onclick="window.scrollTo({top:0,behavior:'smooth'});return false;">ğŸ” ã‚‚ã†ä¸€åº¦ã‚„ã‚‹</a>
        </div>
      `;

      // 01ç”»åƒã‚’è¡¨ç¤º
      const img = document.getElementById('ice-img');
      setImage(img, slug);

      window.scrollTo(0, document.body.scrollHeight);
    }
  </script>
</body>
</html>
