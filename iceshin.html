<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
<title>冷酷アイスクリーム・セルフチェック（独自再構成・20問）</title>
<meta name="description" content="20問×5件法で“マキャヴェリズム傾向”の雰囲気を可視化。Mach-IVなどの研究知見にヒントを得た独自再構成のセルフチェックです（エンタメ＋自己理解向け／公式の心理検査ではありません／医療用途ではありません）。">
  <style>
    :root{ --brand:#b86b77; --chip:#f4f1ef; --bg:#fffaf6; --hl:#ffe7ee }
    *{box-sizing:border-box}
    body{font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans JP",sans-serif;background:var(--bg);color:#333;padding:20px;margin:0}
    h1{text-align:center;color:var(--brand);margin:0 0 14px}
    .legend{max-width:860px;margin:0 auto 16px;font-size:.95em;color:#555}

    .progress-wrap{max-width:860px;margin:0 auto 18px}
    .progress{height:10px;background:#eee;border-radius:999px;overflow:hidden}
    .bar{height:100%;width:0;background:var(--brand);transition:width .2s}
    .count{margin-top:6px;color:#666;font-size:.9em;text-align:right}

    form{max-width:860px;margin:auto;background:#fff;padding:18px;border-radius:12px;box-shadow:0 0 12px #e5d4cf}
    .question{margin:20px 0}
    .qhead{display:flex;justify-content:space-between;gap:8px;align-items:center;margin:0 0 8px;font-weight:600}
    .qstatus{font-weight:600;font-size:.85em;color:#888}
    .qstatus.done{color:var(--brand)}

    .scale{display:grid;grid-template-columns:1fr;gap:10px}

    /* ラジオ＋行ハイライト */
    .chip{display:flex;align-items:center;gap:10px;padding:12px 10px;border-radius:10px;background:var(--chip);
          border:1.5px solid #e9e1de; cursor:pointer; user-select:none; transition:.12s ease}
    .chip input{appearance:none; inline-size:1.05em; block-size:1.05em; border-radius:50%;
                border:2px solid #9d7a83; display:inline-block; position:relative; flex:0 0 auto; background:#fff}
    .chip input:checked{border-color:var(--brand)}
    .chip input:checked::after{content:""; position:absolute; inset:3px; border-radius:50%; background:var(--brand)}
    .chip.on{border-color:#e3bcc6; background:var(--hl); box-shadow:0 6px 18px rgba(184,107,119,.12)}
    .chip:focus-within{outline:3px solid #ffd9e1; outline-offset:2px}

    .btn{display:block;margin:22px auto 0;padding:12px 22px;font-size:1.05em;background:var(--brand);color:#fff;border:none;border-radius:10px;cursor:pointer}

    #result{max-width:860px;margin:22px auto 0;background:#fff;border:1px solid #eadad6;padding:18px;border-radius:10px}
    #result h2{margin:0 0 8px;color:#b16370}
    .row{display:flex;flex-wrap:wrap;gap:10px;align-items:center}
    .tag{display:inline-block;background:#f6eef0;border:1px solid #e0cfd0;border-radius:999px;padding:6px 12px;font-size:.9em;color:#7b4d57}
    .lead{margin:8px 0 10px;color:#555}
    .img{width:100%;height:auto;border-radius:10px;box-shadow:0 8px 20px rgba(0,0,0,.08);margin:8px 0}

    /* 二軸バー */
    .kbars{margin-top:8px;display:grid;gap:8px}
    .krow{display:flex;align-items:center;gap:10px}
    .klabel{min-width:9em;color:#7b4d57;font-weight:700}
    .kbar{flex:1;height:10px;background:#f1e7e5;border-radius:999px;overflow:hidden}
    .kbar span{display:block;height:100%;width:0;background:var(--brand);transition:width .4s ease}
    .knum{width:3.2em;text-align:right;color:#7b4d57;font-weight:700}

    .actions{display:flex;gap:10px;margin-top:12px;flex-wrap:wrap}
    .a-btn{flex:1;text-align:center;text-decoration:none;background:#f7f2f1;border:1px solid #e3d2cd;padding:10px;border-radius:10px;color:#7b4d57;font-weight:700}
    .a-btn:hover{background:#f1e7e5}
  </style>
</head>
<body>
<h1>🍦 冷酷アイスクリーム・セルフチェック（独自再構成）</h1>
  <div class="legend">5件法：1 まったく当てはまらない ／ 2 あまり当てはまらない ／ 3 どちらともいえない ／ 4 やや当てはまる ／ 5 とても当てはまる</div>
<section id="legal-note" style="max-width:860px;margin:14px auto;background:#fff;border:1px solid #eadad6;border-radius:10px;padding:12px">
  <h2 style="margin:4px 0 6px;font-size:1rem;color:#7b4d57">ご利用にあたって</h2>
  <ul style="margin:6px 0 0 1.2em;line-height:1.8;color:#555">
    <li><strong>非提携・非公式：</strong>本コンテンツは「Mach-IV」等の研究知見に<span style="white-space:nowrap">ヒントを得た</span><strong>独自再構成</strong>です。公式の質問項目・採点方法は使用しておらず、権利者の承認・提携・推奨を意味しません。</li>
    <li><strong>医療・心理診断ではありません：</strong>娯楽＋自己理解のためのセルフチェックであり、医療的・心理的な診断／治療／助言を目的としません。つらさや不調が続く場合は専門家へご相談ください。</li>
    <li><strong>プライバシー：</strong>回答は端末内でのみ処理され、サーバー送信は行いません。</li>
    <li><strong>表現について：</strong>「冷酷」等は便宜上の比喩表現であり、特定の個人・団体に対する価値判断やラベリングの意図はありません。</li>
    <li><strong>免責：</strong>法令で認められる範囲で、本コンテンツの利用に伴う損失・損害について当サイトは責任を負いません。</li>
  </ul>
</section>
  <div class="progress-wrap">
    <div class="progress"><div id="bar" class="bar"></div></div>
    <div id="count" class="count">0 / 20 回答</div>
  </div>

  <form id="quizForm" aria-live="polite"></form>
  <button class="btn" type="button" onclick="calculate()">診断する</button>

  <div id="result" style="display:none;"></div>

  <script>
    // タイプ→画像フォルダ（01のみ）
    const TYPE_TO_SLUG = {
      "ソフトクリーム":"softcream",
      "バニラアイス":"vanilla",
      "ジェラート":"gelato",
      "ソルベ":"sorbet",
      "クリスタルアイス":"crystalice"
    };

    // 一言
    const TAGLINE = {
      "ソフトクリーム":"駆け引きゼロ、直球すぎて逆に最強",
      "バニラアイス":"基本は正攻法、ときどき小ワザ",
      "ジェラート":"甘さと冷静さのスイッチャー",
      "ソルベ":"氷点下の冷静、勝ち筋直行",
      "クリスタルアイス":"氷の策士、最適解を取りにいく"
    };

    // Mach-IV 20項目（rev:true は逆転）＋ facet: tactics/views（二軸）
    const items = [
      { text:"目的のためなら本音を隠すことも必要だと思う",           rev:false, facet:"tactics" },
      { text:"道徳的に正しいと確信できないなら、行動すべきではない",   rev:true,  facet:"views"   },
      { text:"出世する人の多くは、正直で潔白だと思う",               rev:true,  facet:"views"   },
      { text:"重要人物にはお世辞を使うのが賢いやり方だ",             rev:false, facet:"tactics" },
      { text:"たとえ不利でも、他人にうそをつくべきではない",         rev:true,  facet:"tactics" },
      { text:"人を動かすには、相手が聞きたいことを言うのが一番だ",     rev:false, facet:"tactics" },
      { text:"誰かを完全に信頼するのは危険だと思う",                 rev:false, facet:"views"   },
      { text:"近道を使わず努力すれば、必ず報われるものだ",           rev:true,  facet:"views"   },
      { text:"人は基本的に善良で、公正に振る舞うと思う",             rev:true,  facet:"views"   },
      { text:"成功には、時にルールを曲げることが欠かせない",         rev:false, facet:"tactics" },
      { text:"チャンスがあっても、不公平な利得は絶対に得ない",       rev:true,  facet:"tactics" },
      { text:"うまく立ち回るには、多少の“操作”は必要だ",             rev:false, facet:"tactics" },
      { text:"人前では、本心を見せない方が安全だと思う",             rev:false, facet:"tactics" },
      { text:"たとえ損でも、正直さを最優先するべきだ",               rev:true,  facet:"tactics" },
      { text:"多くの人は、見返りがなければ協力しないと思う",         rev:false, facet:"views"   },
      { text:"人間関係では、誠意さえあれば十分うまくいく",           rev:true,  facet:"views"   },
      { text:"交渉では“規範”より“結果”を重視するべきだ",           rev:false, facet:"tactics" },
      { text:"人を利用するくらいなら、機会を逃してもよい",           rev:true,  facet:"tactics" },
      { text:"重要な情報は、有利になるまで伏せておくべきだ",         rev:false, facet:"tactics" },
      { text:"約束は状況が変わっても、必ず守るべきだ",               rev:true,  facet:"tactics" }
    ];

    const scaleLabels = [
      "1（まったく当てはまらない）","2（あまり当てはまらない）",
      "3（どちらともいえない）","4（やや当てはまる）","5（とても当てはまる）"
    ];

    const form   = document.getElementById("quizForm");
    const bar    = document.getElementById("bar");
    const count  = document.getElementById("count");
    const result = document.getElementById("result");

    // 質問描画
    items.forEach((it, i) => {
      const fs = document.createElement("fieldset");
      fs.className = "question";
      const qid = `q${i}`;
      fs.innerHTML = `<legend class="qhead"><span>Q${i+1}. ${it.text}</span><span id="${qid}_status" class="qstatus">未選択</span></legend>`;
      const scale = document.createElement("div");
      scale.className = "scale";
      for (let n=0;n<5;n++){
        const id = `${qid}_${n+1}`;
        scale.innerHTML += `
          <label class="chip">
            <input id="${id}" type="radio" name="${qid}" value="${n+1}">
            <span>${scaleLabels[n]}</span>
          </label>`;
      }
      fs.appendChild(scale);
      form.appendChild(fs);
    });

    // 行ハイライト＆進捗
    document.addEventListener("change", (e) => {
      if (!e.target.matches('input[type="radio"][name^="q"]')) return;
      const name = e.target.name;
      document.querySelectorAll(`input[name="${name}"]`).forEach(inp=>{
        inp.closest('.chip').classList.toggle('on', inp.checked);
      });
      const st = document.getElementById(`${name}_status`);
      if (st){ st.textContent = "選択済"; st.classList.add("done"); }
      updateProgress();
    });
    function updateProgress(){
      const answered = new Set([...document.querySelectorAll('input[type="radio"]:checked')].map(i=>i.name)).size;
      const totalQ = items.length;
      const pct = Math.round(answered/totalQ*100);
      bar.style.width = pct + "%";
      count.textContent = `${answered} / ${totalQ} 回答`;
    }

    // 画像読込（01.png → だめなら 01.webp）
    function setImage(imgEl, slug){
      const base = `/shindan/assets/results/ice/${slug}/01`;
      imgEl.onerror = null;
      imgEl.src = `${base}.png`;
      imgEl.onerror = ()=>{ if(imgEl.src.endsWith('.png')) imgEl.src = `${base}.webp`; };
    }

    function pct(sum, count){
      const min = 1 * count, max = 5 * count;
      return Math.round((sum - min) / (max - min) * 100);
    }

    function calculate(){
      // 回答チェック
      for (let i=0;i<items.length;i++){
        if (!document.querySelector(`input[name="q${i}"]:checked`)){
          alert(`未回答の設問があります（Q${i+1}）`);
          return;
        }
      }

      // 合計＆二軸集計
      let sumAll = 0;
      const facets = { tactics:0, views:0 };
      const counts = { tactics:0, views:0 };

      for (let i=0;i<items.length;i++){
        let v = parseInt(document.querySelector(`input[name="q${i}"]:checked`).value,10);
        if (items[i].rev) v = 6 - v;  // 逆転
        sumAll += v;
        const f = items[i].facet;
        facets[f] += v;
        counts[f] += 1;
      }

      // 0〜100% に変換
      const machPct = Math.round((sumAll - 20) / 80 * 100); // 全体
      const tacticsPct = pct(facets.tactics, counts.tactics);
      const viewsPct   = pct(facets.views,   counts.views);

      // タイプ判定（全体％で）
      let type="";
      if (machPct <= 20) type="ソフトクリーム";
      else if (machPct <= 40) type="バニラアイス";
      else if (machPct <= 60) type="ジェラート";
      else if (machPct <= 80) type="ソルベ";
      else type="クリスタルアイス";

      const slug = TYPE_TO_SLUG[type];
      const tagline = TAGLINE[type] || "";

      // 結果描画
      result.style.display = "block";
      result.innerHTML = `
        <h2>結果</h2>
        <div class="row">
          <span class="tag">冷酷度：${machPct}%</span>
          <span class="tag">${type}</span>
        </div>
        <p class="lead">一言まとめ：${tagline}</p>

        <div class="kbars" aria-label="二軸スコア">
          <div class="krow">
            <span class="klabel">計略（Tactics）</span>
            <div class="kbar"><span id="barTac"></span></div>
            <span id="pctTac" class="knum">${tacticsPct}%</span>
          </div>
          <div class="krow">
            <span class="klabel">懐疑（Views）</span>
            <div class="kbar"><span id="barView"></span></div>
            <span id="pctView" class="knum">${viewsPct}%</span>
          </div>
        </div>

        <img id="ice-img" class="img" alt="${type} の結果画像" decoding="async">

        <div class="actions">
          <a class="a-btn" href="/shindan/">🔙 診断一覧へ戻る</a>
          <a class="a-btn" href="#" onclick="window.scrollTo({top:0,behavior:'smooth'});return false;">🔁 もう一度やる</a>
        </div>
      `;

      // バーと画像
      document.getElementById('barTac').style.width  = tacticsPct + '%';
      document.getElementById('barView').style.width = viewsPct   + '%';
      setImage(document.getElementById('ice-img'), slug);

      window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
    }
  </script>
</body>
</html>
```0

