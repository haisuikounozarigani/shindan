<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>æ°—çƒã‚¨ã‚¹ã‚±ãƒ¼ãƒ—è¨ºæ–­ â€” ã©ã‚Œã ã‘ç¾å®Ÿã‹ã‚‰â€œé›¢é™¸â€ã—ã‚„ã™ã„ã‹</title>
<meta name="description" content="25é …ç›®ãƒ»5ä»¶æ³•ã€‚é€ƒé¿/æ°—æ™´ã‚‰ã—/ä¸Šã®ç©º/ç€åœ°åŠ›ã‹ã‚‰â€œé›¢é™¸ã—ã‚„ã™ã•â€ã‚’ï¼…è¡¨ç¤ºã€‚">
<meta name="theme-color" content="#f6f4ff">
<link rel="preload" as="image" href="/shindan/assets/results/balloon-escape/t01.webp">
<style>
:root{
  --accent:#6b6bd9; --accent2:#b96ad6;
  --ink:#26263a; --muted:#667087; --paper:#fff;
  --bg1:#fffafe; --bg2:#f3f4ff; --line:#e7e6f2;
}
*{box-sizing:border-box}
html,body{margin:0;padding:0}
body{
  color:var(--ink);
  background:linear-gradient(180deg,var(--bg1),var(--bg2));
  font-family:"Noto Sans JP",system-ui,-apple-system,"Segoe UI",Roboto,"Hiragino Kaku Gothic ProN",sans-serif;
  line-height:1.9;
}
.wrap{max-width:980px;margin:18px auto;padding:0 14px}
header.hd{display:grid;grid-template-columns:56px 1fr;gap:12px;align-items:center;margin:8px 0}
.logo{width:56px;height:56px;border-radius:14px;background:linear-gradient(135deg,#f0eaff,#e7f0ff);display:grid;place-items:center;font-size:28px}
h1{margin:0;font-size:clamp(22px,4.6vw,34px);letter-spacing:.02em;color:#5a57ce}
.sub{margin:4px 0 0;color:var(--muted);font-size:.96em}
.card{background:var(--paper);border:1px solid var(--line);border-radius:16px;padding:14px;margin:12px 0}
.pill{display:inline-block;padding:4px 8px;border:1px solid var(--line);border-radius:999px;background:#fff;color:#6b6a77;font-size:.88em}
.small{color:var(--muted);font-size:.96em}

/* ğŸ“Š sticky progressï¼ˆrailæº–æ‹ ï¼‰ */
.sticky{position:sticky;top:0;z-index:20;margin:-6px -14px 12px;padding:8px 14px;background:rgba(255,255,255,.85);backdrop-filter:blur(6px) saturate(1.05);border-bottom:1px solid #e9edf7;display:flex;align-items:center;gap:10px}
.progress{height:8px;background:#edf2fb;border-radius:999px;flex:1;overflow:hidden}
.progress>span{display:block;height:100%;width:0;background:linear-gradient(90deg,var(--accent),var(--accent2));transition:width .25s ease}
.btn{padding:10px 14px;border:1px solid var(--line);border-radius:12px;background:#fff;cursor:pointer}
.btn.primary{background:linear-gradient(90deg,var(--accent),var(--accent2));border-color:transparent;color:#fff;font-weight:700}
.btn:active{transform:translateY(1px)}

/* è¨­å•ï¼ˆ5ä»¶æ³•ï¼‰ */
fieldset.q{border:1px solid var(--line);border-radius:12px;padding:10px;margin:10px 0;background:#fff}
legend{font-weight:700}
.scale{display:grid;grid-template-columns:repeat(5,minmax(66px,1fr));gap:8px;margin-top:8px}
.scale input{position:absolute;opacity:0;pointer-events:none}
.scale label{display:grid;place-items:center;border:1px solid #e5e9f3;border-radius:10px;padding:8px;cursor:pointer;user-select:none;background:#fff}
.scale input:checked+label{outline:2px solid var(--accent);border-color:transparent}
mark.need{animation:need 1.6s ease}
@keyframes need{0%{box-shadow:0 0 0 0 rgba(74,168,255,.45)}100%{box-shadow:0 0 0 0 rgba(74,168,255,0)}}

/* çµæœï¼šæ­£æ–¹å½¢ãƒ’ãƒ¼ãƒ­ãƒ¼ */
.hero-square{display:grid;place-items:center;border:1px solid var(--line);border-radius:16px;background:#fff;overflow:hidden}
.hero-square figure{margin:0;width:min(560px,100%);max-width:100%;aspect-ratio:1/1;border-bottom:1px solid var(--line);background:#f7f9ff}
.hero-square img{width:100%;height:100%;object-fit:cover;display:block}
.hero-square figcaption{padding:14px 12px;width:100%;line-height:1.7}
.title-row{display:flex;align-items:center;gap:6px;flex-wrap:wrap}
.badge-size{display:inline-flex;align-items:center;gap:6px;padding:4px 8px;border-radius:999px;background:#fff;border:1px solid var(--line);font-size:.85em;margin-left:6px}
.sep{height:1px;background:var(--line);margin:16px 0}

/* å› å­ãƒãƒ¼ï¼ˆï¼…è¡¨ç¤ºï¼‰ */
#factorBox{max-width:720px;margin-inline:auto}
.factors{display:grid;gap:12px}
.meter{display:grid;gap:8px}
.meter .row{display:flex;align-items:center;justify-content:space-between;gap:8px}
.meter .row .name{font-weight:700}
.mbar{height:10px;border:1px solid #e5e9f3;border-radius:999px;overflow:hidden;background:#f7f8fc}
.mbar>span{display:block;height:100%;width:0;background:linear-gradient(90deg,var(--accent),var(--accent2))}

/* ãƒ•ãƒƒã‚¿ãƒ¼æ“ä½œ */
.actions-bottom{display:flex;justify-content:center}
@media (max-width:560px){
  .wrap{padding:0 10px}
  .sticky{top:calc(env(safe-area-inset-top) + 0px); padding:8px 10px}
  .scale{grid-template-columns:repeat(2,1fr)}
  .scale label{padding:12px 8px;font-size:14px}
  .card{padding:12px}
}
</style>
</head>
<body data-id="balloon-escape">
<main class="wrap" id="app">
  <header class="hd">
    <div class="logo">ğŸˆ</div>
    <div>
      <h1>æ°—çƒã‚¨ã‚¹ã‚±ãƒ¼ãƒ—è¨ºæ–­</h1>
      <p class="sub">25é …ç›®ãƒ»5ä»¶æ³•ã§ã€Œã©ã‚Œã ã‘ç¾å®Ÿã‹ã‚‰â€œé›¢é™¸â€ã—ã‚„ã™ã„ã‹ã€ã‚’å¯è¦–åŒ–ã—ã¾ã™ï¼ˆé€ƒé¿/æ°—æ™´ã‚‰ã—/ä¸Šã®ç©º/ç€åœ°åŠ›ï¼‰ã€‚</p>
    </div>
  </header>

  <!-- ğŸ“Š sticky progress -->
  <div class="sticky" aria-live="polite">
    <span aria-hidden="true">ğŸ“Š</span>
    <div class="progress" aria-label="å›ç­”é€²æ—" role="progressbar" aria-valuemin="0" aria-valuemax="25" aria-valuenow="0"><span id="prog"></span></div>
    <button class="btn primary" id="doScore">è¨ºæ–­ã™ã‚‹</button>
  </div>

  <!-- èª¬æ˜ -->
  <section class="card">
    <div class="pill">è³ªå•æ•°ï¼š25</div>
    <div class="pill" style="margin-left:6px">å½¢å¼ï¼š1â€“5ï¼ˆ1 ã¾ã£ãŸãå½“ã¦ã¯ã¾ã‚‰ãªã„ï¼5 ã¨ã¦ã‚‚å½“ã¦ã¯ã¾ã‚‹ï¼‰</div>
    <p class="small" style="margin-top:8px">å€‹äººã®å‚¾å‘æŠŠæ¡ãŒç›®çš„ã®å¨¯æ¥½ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã§ã™ã€‚ç´ ç›´ã«è¿‘ã„ã‚‚ã®ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚</p>
  </section>

  <!-- è¨­å• -->
  <section class="card" id="questions">
    <h2 style="margin:4px 0 8px">è¨­å•ï¼ˆ5ä»¶æ³•ï¼‰</h2>
    <form id="quiz" novalidate></form>
    <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:10px">
      <button type="button" class="btn" id="clearAns">å›ç­”ã‚’ã‚¯ãƒªã‚¢</button>
      <button type="button" class="btn primary" id="doScore2">è¨ºæ–­ã™ã‚‹</button>
    </div>
  </section>

  <!-- çµæœ -->
  <section class="card" id="result" aria-live="polite">
    <div id="resEmpty">
      <span class="pill">ã¾ã çµæœã¯ã‚ã‚Šã¾ã›ã‚“</span>
      <p class="small">å…¨25å•ã«å›ç­”ã—ã¦ã€Œè¨ºæ–­ã™ã‚‹ã€ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚</p>
    </div>

    <div id="resArea" style="display:none">
      <!-- æ­£æ–¹å½¢ãƒ’ãƒ¼ãƒ­ãƒ¼ï¼ˆt01.webpã€œt06.webpï¼‰ -->
      <div class="hero-square" role="region" aria-label="ãƒ©ãƒ³ã‚¯ã®ã‚¤ãƒ¡ãƒ¼ã‚¸" style="margin:10px 0">
        <figure>
          <img id="heroImg" src="/shindan/assets/results/balloon-escape/t01.webp" alt="â€”" loading="lazy" width="600" height="600">
        </figure>
        <figcaption>
          <div class="title-row">
            <div id="heroTitle" style="font-weight:800">â€”</div>
            <span class="badge-size" id="rangeBadge">â€”</span>
          </div>
          <div class="small" id="tagline" style="margin-top:4px">â€”</div>
          <div class="small" id="sumLine" style="margin-top:6px;color:#6b6a77">â€”</div>
        </figcaption>
      </div>

      <!-- å› å­ãƒãƒ¼ï¼ˆï¼…ï¼‰ -->
      <div class="factors" id="factorBox" aria-label="å› å­ã‚¹ã‚³ã‚¢ï¼ˆï¼…ï¼‰" style="margin:10px 0 6px"></div>

      <div class="sep"></div>
      <p class="small" id="bandMsg" style="max-width:68ch;margin:0 auto"></p>

      <div class="sep"></div>
      <div class="actions-bottom">
        <a class="btn" href="/shindan/" id="backLink" aria-label="è¨ºæ–­ä¸€è¦§ã«æˆ»ã‚‹">è¨ºæ–­ä¸€è¦§ã«æˆ»ã‚‹</a>
      </div>
    </div>
  </section>

  <section class="card">
    <h3 style="margin:4px 0 8px">ã”åˆ©ç”¨ã«ã‚ãŸã£ã¦</h3>
    <ul class="small" style="margin:6px 0 0 1.2em; line-height:1.8">
      <li><strong>éå…¬å¼ï¼ç‹¬è‡ªåˆ¶ä½œï¼š</strong>ç ”ç©¶ä¸€èˆ¬ã®çŸ¥è¦‹ã«ãƒ’ãƒ³ãƒˆã‚’å¾—ãŸå‰µä½œã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã§ã™ï¼ˆå…¬å¼å°ºåº¦ã®æ¡ç‚¹ã§ã¯ã‚ã‚Šã¾ã›ã‚“ï¼‰ã€‚</li>
      <li><strong>åŒ»ç™‚ãƒ»é¸æŠœç”¨é€”ã§ã¯ã‚ã‚Šã¾ã›ã‚“ï¼š</strong>å¨¯æ¥½ï¼‹è‡ªå·±ç†è§£å‘ã‘ã®ã‚»ãƒ«ãƒ•ãƒã‚§ãƒƒã‚¯ã§ã™ã€‚</li>
      <li><strong>ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ï¼š</strong>å›ç­”ã¯ç«¯æœ«å†…ã§å‡¦ç†ãƒ»ä¿å­˜ã•ã‚Œã€å›ç­”å†…å®¹ã‚„å€‹äººã‚’ç‰¹å®šã§ãã‚‹æƒ…å ±ã¯ã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡ã•ã‚Œã¾ã›ã‚“ã€‚çµæœè¡¨ç¤ºæ™‚ã«åŒ¿åã®ä»¶æ•°ã‚«ã‚¦ãƒ³ãƒˆã®ã¿é€ä¿¡ã™ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚</li>
      <li><strong>è¡¨ç¾ã®é…æ…®ï¼š</strong>çµæœã‚’ã‚‚ã£ã¦ä»–è€…ã‚’æ–­å®šãƒ»ãƒ©ãƒ™ãƒªãƒ³ã‚°ã—ãªã„ã§ãã ã•ã„ã€‚</li>
      <li><strong>å…è²¬ï¼š</strong>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„åˆ©ç”¨ã«ã‚ˆã‚Šç”Ÿã˜ãŸã„ã‹ãªã‚‹æå¤±ãƒ»æå®³ã‚‚å½“ã‚µã‚¤ãƒˆã¯è²¬ä»»ã‚’è² ã„ã¾ã›ã‚“ã€‚</li>
    </ul>
  </section>
</main>

<script>
(function(){
  // ===== ãƒšãƒ¼ã‚¸å®šç¾© =====
  var SLUG = "balloon-escape";
  var TITLE = "æ°—çƒã‚¨ã‚¹ã‚±ãƒ¼ãƒ—è¨ºæ–­";
  var IMG_BASE = "/shindan/assets/results/balloon-escape/"; // t01.webp..t06.webp
  var ANS_KEY = "specimens:"+SLUG+":answers";                // é–‹ãç›´ã—ä¿å­˜ã‚­ãƒ¼

  // ===== è³ªå•ã‚»ãƒƒãƒˆï¼ˆæ–‡è¨€ã¯å¤‰æ›´ã›ãšï¼‰ =====
  var ITEMS = [
    {k:1,  t:'å«Œãªæ°—æŒã¡ãŒæ¥ãã†ã ã¨ã€å…ˆã«ç”¨äº‹ã‚’ä½œã£ã¦é¿ã‘ã‚‹ã€‚',                   cat:'EA'},
    {k:2,  t:'ä¸å®‰ã‚’æ„Ÿã˜ãŸã‚‰ã€äººã‚„å ´æ‰€ã”ã¨è·é›¢ã‚’å–ã‚‹ã€‚',                             cat:'EA'},
    {k:3,  t:'ã¤ã‚‰ã„è¨˜æ†¶ã‚’æ€ã„å‡ºã—ãã†ãªæ˜ ç”»ã‚„éŸ³æ¥½ã¯é¿ã‘ãŒã¡ã€‚',                     cat:'EA'},
    {k:4,  t:'æ°—ã¾ãšã„ä¼šè©±ã«ãªã‚Šãã†ãªã‚‰ã€è©±é¡Œã‚’æ€¥ã«å¤‰ãˆã‚‹ã€‚',                       cat:'EA'},
    {k:5,  t:'æ‚©ã¿ã¯å‘ãåˆã†ã‚ˆã‚Šã€è¦‹ãªã‹ã£ãŸã“ã¨ã«ã—ãŸã„ã€‚',                         cat:'EA'},
    {k:6,  t:'ç· åˆ‡ãŒè¿‘ã¥ãã¨ã€åˆ¥ã®ç°¡å˜ãªä½œæ¥­ã«é€ƒã’ã‚‹ã€‚',                             cat:'EA'},
    {k:7,  t:'ï¼ˆRï¼‰ä¸å¿«ã§ã‚‚ã€å¿…è¦ãªã‚‰ã‚„ã‚‹ã¹ãã“ã¨ã«å–ã‚Šã‹ã‹ã‚Œã‚‹ã€‚',                   cat:'EA', rev:true},
    {k:8,  t:'ï¼ˆRï¼‰ä¸å®‰ãŒã‚ã£ã¦ã‚‚ã€å°‘ã—ãšã¤æ…£ã‚‰ã—ã¦å‘ãåˆãˆã‚‹ã€‚',                     cat:'EA', rev:true},
    {k:9,  t:'å¿ƒãŒé‡ã„æ—¥ã¯ã€ã¤ã„ã‚¹ãƒãƒ›ã‚„å‹•ç”»ã§æ°—ã‚’ãã‚‰ã™ã€‚',                           cat:'EA'},
    {k:10, t:'å¿ƒé…ã”ã¨ãŒã‚ã‚‹æ™‚ã€çœ ã£ã¦ã‚„ã‚Šã™ã”ãã†ã¨ã™ã‚‹ã€‚',                           cat:'EA'},

    {k:11, t:'ã—ã‚“ã©ã„ã¨ãã¯ã€åˆ¥ã®æ¥½ã—ã„ã“ã¨ã§æ°—ã‚’ç´›ã‚‰ã‚ã›ã‚‹ã€‚',                       cat:'COPE'},
    {k:12, t:'ã‚„ã‚‹æ°—ãŒå‡ºãªã„ã¨ã€è¨ˆç”»ãã®ã‚‚ã®ã‚’ã‚„ã‚ã¦ã—ã¾ã†ã€‚',                         cat:'COPE'},
    {k:13, t:'å•é¡ŒãŒå¤§ãã„ã¨ã€æ”¾ã£ã¦ãŠã‘ã°ãã®ã†ã¡éãã‚‹ã¨æ€ã†ã€‚',                     cat:'COPE'},
    {k:14, t:'å¤±æ•—ã—ãã†ãªã‚‰ã€æœ€åˆã‹ã‚‰æ‰‹ã‚’å‡ºã•ãªã„ã€‚',                                 cat:'COPE'},

    {k:15, t:'è©±ã‚’èã„ã¦ã„ã¦ã‚‚ã€æ°—ã¥ã‘ã°åˆ¥ã®ã“ã¨ã‚’è€ƒãˆã¦ã„ã‚‹ã€‚',                       cat:'MW'},
    {k:16, t:'ä½œæ¥­ä¸­ã«ã€ä¸Šç©ºã‚’æ•£æ­©ã—ã¦ã„ã‚‹ã¿ãŸã„ã«æ„è­˜ãŒé ã®ãã€‚',                     cat:'MW'},
    {k:17, t:'èª­æ›¸ã‚„å‹•ç”»ã®é€”ä¸­ã§ã€å†…å®¹ã‚’è¦šãˆã¦ã„ãªã„ã“ã¨ãŒã‚ã‚‹ã€‚',                     cat:'MW'},
    {k:18, t:'ï¼ˆRï¼‰å¿…è¦ãªå ´é¢ã§ã¯ã€æ³¨æ„ã‚’é•·ãä¿ã¦ã‚‹ã€‚',                                 cat:'MW', rev:true},
    {k:19, t:'ã¤ã„ç©ºæƒ³ã«ãµã‘ã£ã¦ã€æ™‚é–“ã®æ„Ÿè¦šã‚’ãªãã™ã€‚',                               cat:'MW'},

    {k:20, t:'å›°ã£ã¦ã‚‚ã€ä¼‘ã‚“ã§ã‹ã‚‰ç¾å®Ÿã«æˆ»ã£ã¦ç«‹ã¦ç›´ã›ã‚‹ã€‚',                           cat:'BRS'},
    {k:21, t:'äºˆæƒ³å¤–ã§ã‚‚ã€è½ã¡ç€ã„ã¦å¯¾å‡¦ã«æˆ»ã‚Œã‚‹ã€‚',                                   cat:'BRS'},
    {k:22, t:'ï¼ˆRï¼‰ä¸€åº¦ã¤ã¾ãšãã¨ã€ã—ã°ã‚‰ãä½•ã‚‚æ‰‹ã«ã¤ã‹ãªã„ã€‚',                         cat:'BRS', rev:true},
    {k:23, t:'æ°—æŒã¡ãŒä¹±ã‚Œã¦ã‚‚ã€å‘¼å¸ã‚’æ•´ãˆã‚‹ã¨ç«‹ã¡ä¸ŠãŒã‚Œã‚‹ã€‚',                         cat:'BRS'},
    {k:24, t:'ï¼ˆRï¼‰å•é¡ŒãŒç¶šãã¨ã€æŠ•ã’å‡ºã—ãŸããªã‚‹ã€‚',                                   cat:'BRS', rev:true},
    {k:25, t:'è‡ªåˆ†ãªã‚Šã®ã€Œæˆ»ã‚‹ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã€ï¼ˆä¾‹ï¼šäººã«é€£çµ¡ï¼å¯ã‚‹ï¼é£Ÿäº‹ï¼æ­©ã ãªã©ï¼‰ã‚’æŒã£ã¦ã„ã‚‹ã€‚', cat:'BRS'}
  ];
  var LABELS = ['1 ã¾ã£ãŸãå½“ã¦ã¯ã¾ã‚‰ãªã„','2 ã‚ã¾ã‚Šå½“ã¦ã¯ã¾ã‚‰ãªã„','3 ã©ã¡ã‚‰ã¨ã‚‚ã„ãˆãªã„','4 ã‚„ã‚„å½“ã¦ã¯ã¾ã‚‹','5 ã¨ã¦ã‚‚å½“ã¦ã¯ã¾ã‚‹'];

  // ===== DOMå‚ç…§ =====
  var qWrap = document.getElementById("quiz");
  var prog  = document.getElementById("prog");
  var resEmpty = document.getElementById("resEmpty");
  var resArea  = document.getElementById("resArea");
  var heroImg  = document.getElementById("heroImg");
  var heroTitle= document.getElementById("heroTitle");
  var rangeBadge= document.getElementById("rangeBadge");
  var tagline  = document.getElementById("tagline");
  var bandMsg  = document.getElementById("bandMsg");
  var sumLine  = document.getElementById("sumLine");
  var factorBox= document.getElementById("factorBox");

  // è¨­å•ã‚’railé¢¨ fieldsetã§æç”»
  function renderQuestions(){
    var html = ITEMS.map(function(it){
      var opts = LABELS.map(function(lbl, i){
        var v=i+1, id='q'+it.k+'-'+v;
        return '<input id="'+id+'" type="radio" name="q'+it.k+'" value="'+v+'"><label for="'+id+'">'+lbl+'</label>';
      }).join('');
      return '<fieldset class="q" id="fs-'+it.k+'">'
           +   '<legend>'+it.k+'. '+it.t.replace('ï¼ˆRï¼‰','')+'</legend>'
           +   '<div class="scale" role="radiogroup" aria-label="'+it.k+'">'+opts+'</div>'
           + '</fieldset>';
    }).join('');
    qWrap.innerHTML = html;
  }

  // ä¿å­˜/å¾©å…ƒ
  function saveAnswers(){
    try{
      var out = {};
      ITEMS.forEach(function(it){
        var chk = qWrap.querySelector('input[name="q'+it.k+'"]:checked');
        if(chk){ out[String(it.k)] = parseInt(chk.value,10); }
      });
      localStorage.setItem(ANS_KEY, JSON.stringify({ts:Date.now(), ans:out}));
    }catch(e){}
  }
  function restoreAnswers(){
    try{
      var raw = localStorage.getItem(ANS_KEY); if(!raw) return;
      var box = JSON.parse(raw)||{}; var ans=box.ans||{};
      Object.keys(ans).forEach(function(k){
        var v = ans[k];
        var el = qWrap.querySelector('#q'+k+'-'+v);
        if(el){ el.checked = true; }
      });
      updateProgress();
    }catch(e){}
  }
  function wipeAnswers(){ try{ localStorage.removeItem(ANS_KEY); }catch(e){} }

  // é€²æ—
  function answeredCount(){ return qWrap.querySelectorAll('input[type="radio"]:checked').length; }
  function updateProgress(){
    var a = answeredCount(), total=ITEMS.length;
    prog.style.width = Math.round(100*a/total) + "%";
    var shell = document.querySelector('.progress');
    if(shell){
      shell.setAttribute('aria-valuenow', String(a));
      shell.setAttribute('aria-label','å›ç­”é€²æ—ï¼š'+a+' / '+total);
    }
  }

  // æœªå›ç­”ã‚¸ãƒ£ãƒ³ãƒ—
  function firstUnanswered(){
    for(var i=1;i<=ITEMS.length;i++){
      if(!qWrap.querySelector('input[name="q'+i+'"]:checked')) return i;
    }
    return 0;
  }
  function needJump(n){
    var fs = document.getElementById('fs-'+n);
    if(fs){
      fs.classList.add('need');
      fs.scrollIntoView({behavior:"smooth",block:"center"});
      setTimeout(function(){ fs.classList.remove('need'); }, 1600);
    }
  }

  // math util
  var rev5 = function(v){ return 6 - v; };
  var mean = function(arr){ return arr.reduce(function(a,b){return a+b;},0) / arr.length; };
  function erf(x){const s=Math.sign(x);x=Math.abs(x);const a1=0.254829592,a2=-0.284496736,a3=1.421413741,a4=-1.453152027,a5=1.061405429,p=0.3275911;const t=1/(1+p*x);const y=1-(((((a5*t+a4)*t)+a3)*t+a2)*t+a1)*t*Math.exp(-x*x);return s*y;}
  var cdf = function(z){ return 0.5*(1+erf(z/Math.SQRT2)); };

  // ã‚¹ã‚³ã‚¢é›†è¨ˆ
  function collect(){
    var vals={};
    for(var i=1;i<=ITEMS.length;i++){
      var el = qWrap.querySelector('input[name="q'+i+'"]:checked'); if(!el) return null;
      vals[i] = parseInt(el.value,10);
    }
    return vals;
  }
  function calcScore(vals){
    var EA   = mean([ vals[1],vals[2],vals[3],vals[4],vals[5],vals[6], rev5(vals[7]),rev5(vals[8]), vals[9],vals[10] ]);
    var COPE = mean([ vals[11],vals[12],vals[13],vals[14] ]);
    var MW   = mean([ vals[15],vals[16],vals[17], rev5(vals[18]), vals[19] ]);
    var BRS  = mean([ vals[20],vals[21], rev5(vals[22]), vals[23], rev5(vals[24]), vals[25] ]);

    // ä¸­å¿ƒ3.0ã‚’åŸºæº–ã«è¿‘ä¼¼æ¨™æº–åŒ–ï¼ˆBRSã¯é€†ç¬¦å·ï¼‰
    var zH = ((EA-3)+(COPE-3)+(MW-3)-(BRS-3)) / 2;
    var pct = Math.round(cdf(zH) * 100);
    return {EA:EA, COPE:COPE, MW:MW, BRS:BRS, z:{H:zH}, pct:pct};
  }

  // ãƒ©ãƒ³ã‚¯ â†’ ç”»åƒ/æ–‡è¨€ï¼ˆæ–‡è¨€å¤‰æ›´ãªã—ï¼‰
  function band(zH){
    if(zH<=-1.0) return {name:'åœ°ä¸Šä¿‚ç•™ï¼ˆãƒ­ãƒ¼ãƒ—äºŒé‡çµã³ï¼‰', key:'A'};
    if(zH<=-0.33) return {name:'ä½ç©ºã•ã‚“ã½', key:'B'};
    if(zH<=+0.33) return {name:'é›²é–“ãƒ”ã‚¯ãƒ‹ãƒƒã‚¯', key:'C'};
    if(zH<=+0.99) return {name:'é›²ä¸Šãƒˆãƒ©ãƒ™ãƒ©ãƒ¼', key:'D'};
    if(zH<=+1.64) return {name:'æˆå±¤åœãƒ©ãƒ³ãƒŠãƒ¼', key:'E'};
    return {name:'å®‡å®™ã¾ã§æ°—çƒï¼ˆé€šä¿¡é€”çµ¶æ³¨æ„ï¼‰', key:'F'};
  }
  var IMG_MAP = {A:'t01.webp', B:'t02.webp', C:'t03.webp', D:'t04.webp', E:'t05.webp', F:'t06.webp'};
  var bandMsgMap = {
    A:'åœ°é¢æ´¾ã€‚é›¢é™¸ã—ã™ããšã€æ—¥å¸¸ã®ã‚„ã‚‹ã“ã¨ã‚’ã€Œã¡ã‚ƒã‚“ã¨å›ã›ã‚‹ã€å®Ÿå‹™ã®é¬¼ã€‚ãŸã¾ã«5åˆ†ã ã‘â€œé›²è¦‹ä¼‘æ†©â€ã‚’å…¥ã‚Œã‚‹ã¨ç™ºæƒ³ãŒã‚„ã‚ã‚‰ã‹ããªã‚Šã¾ã™ã€‚çª“éš›ã§æ·±å‘¼å¸â†’ä¸€æ¯ã®æ°´â†’å¸°é‚„ã€ã®ãƒŸãƒ‹å¾€å¾©ãŒç›¸æ€§â—ã€‚',
    B:'ãµã‚ã£ã¨ä½ç©ºã€‚æ°—æ™´ã‚‰ã—ã¯ä¸Šæ‰‹ã ã‘ã©ã€ã¡ã‚ƒã‚“ã¨æˆ»ã£ã¦ãã‚‹å¾‹å„€ã•ã‚‚ã‚ã‚Šã€‚æ°—æ™´ã‚‰ã—ã¯ã€Œå ´æ‰€ã‹æ™‚é–“ã‚’é™å®šã€ã™ã‚‹ã¨ç½ªæ‚ªæ„Ÿã‚¼ãƒ­ã§åŠ¹æœé•·æŒã¡ï¼ˆä¾‹ï¼šå°æ‰€ã§å‹•ç”»5åˆ†ã ã‘ï¼‰ã€‚æœ€å¾Œã¯ã‚¿ã‚¤ãƒãƒ¼ã§å¸°é‚„åˆå›³ã‚’ã€‚',
    C:'ã»ã©ã‚ˆã„ä¸­é–“ã€‚é ‘å¼µã‚‹ã‚‚ã‚µãƒœã‚‹ã‚‚ãƒãƒ©ãƒ³ã‚¹æ´¾ã€‚ç–²ã‚ŒãŸæ—¥ã¯ã€Œ5åˆ†é›²ä¸Šâ†’10åˆ†ã‚¿ã‚¹ã‚¯â†’5åˆ†å¸°é‚„ã€ã®ãƒ«ãƒ¼ãƒ—ã‚’ã€‚æˆ»ã‚Šã®å„€å¼ã¯â€œæ¤…å­ã‹ã‚‰ç«‹ã£ã¦æ°´ã‚’é£²ã‚€â€ã§ã‚‚OKã€‚è‡ªåˆ†ãªã‚Šã®å¸°ã‚Šé“ã‚’1ã¤æ±ºã‚ã‚‹ã¨å¼·ã„ã€‚',
    D:'ä¸ŠãŒã‚‹ã®ã¯å¾—æ„ã€‚ã ã‹ã‚‰ã“ãé™ã‚Šã‚‹ä»•æ›ã‘ã‚’å…ˆã«ç”¨æ„ã—ã‚ˆã†ã€‚ã€Œé€šçŸ¥OFFï¼‹ã‚¿ã‚¤ãƒãƒ¼ONã€ã€Œçµ‚ã‚ã£ãŸã‚‰èª°ã‹ã«ä¸€è¨€ã€ãªã©å¸°é‚„ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚’å›ºå®šã™ã‚‹ã¨æœ€å¼·ã€‚æ²¡å…¥ã¯æ­¦å™¨ã€å¸°è·¯ã¯ä¿é™ºã€‚ä¸¡æ–¹æŒã¤ã¨ç„¡æ•µã§ã™ã€‚',
    E:'ä¸Šæ˜‡æ°—æµã¤ã‚ˆã‚ã€‚æ¥½ã—ã„ã»ã©é…¸ç´ ï¼ˆç¡çœ ãƒ»ã”ã¯ã‚“ãƒ»ä¼šè©±ï¼‰ãŒè¶³ã‚Šãªããªã‚ŠãŒã¡ã€‚1æ—¥ã®ã©ã“ã‹ã«â€œå¸°é‚„ãƒã‚¤ãƒ³ãƒˆâ€ã‚’å›ºå®šã—ã¦ã€ãƒ¡ãƒ¢ã‚’è¦‹ãˆã‚‹æ‰€ã«ã€‚æ¨é€²åŠ›ã¯ãã®ã¾ã¾ã€ç‡ƒæ–™ã ã‘åˆ‡ã‚‰ã•ãªã„é‹ç”¨ã¸ã€‚',
    F:'MAXä¸Šæ˜‡ã‚¿ã‚¤ãƒ—ã€‚æ°—ã¥ãã¨æˆå±¤åœã©ã“ã‚ã‹å®‡å®™æ—…è¡Œã€‚å¸°é‚„è¨“ç·´ã¯ã€Œå°ã•ãæ¯æ—¥åŒæ™‚åˆ»ã€ã§ï¼šâ‘ å§¿å‹¢ã‚’ç›´ã™ â‘¡æ°´ã‚’é£²ã‚€ â‘¢äººã«ä¸€è¨€ â‘£çŸ­ã„ç”¨äº‹ã§ä½“ã‚’å‹•ã‹ã™ã€‚å®‰å…¨ç´¢ãŒå¤ªããªã‚‹ã»ã©ã€å†’é™ºã¯è‡ªç”±ã«ãªã‚Šã¾ã™ã€‚'
  };

  function pct(v){ return Math.max(2, Math.min(100, v)); }
  function meanToPct(m){ return Math.round((m-1)/4*100); }

  // å› å­ãƒãƒ¼æç”»
  function renderFactors(sc){
    var items = [
      {name:'ç·åˆï¼ˆé›¢é™¸ã—ã‚„ã™ã•ï¼‰', val:sc.pct,    kind:'H'},
      {name:'å›é¿ï¼ˆEAï¼‰',           val:meanToPct(sc.EA)},
      {name:'å›é¿æ–¹ç•¥ï¼ˆCOPEï¼‰',     val:meanToPct(sc.COPE)},
      {name:'ä¸Šã®ç©ºï¼ˆMWï¼‰',         val:meanToPct(sc.MW)},
      {name:'ç€åœ°åŠ›ï¼ˆBRSï¼‰',        val:meanToPct(sc.BRS)}
    ];
    factorBox.innerHTML = items.map(function(e,i){
      var id='mbar-'+i;
      return '<div class="meter" role="group" aria-label="'+e.name+'">'
           +   '<div class="row"><div class="name">'+e.name+'</div><div class="pct" id="'+id+'-pct">'+e.val+'%</div></div>'
           +   '<div class="mbar" aria-hidden="true"><span id="'+id+'" style="width:'+e.val+'%"></span></div>'
           + '</div>';
    }).join('');
  }

  // çµæœæç”»
  function render(sc){
    var b = band(sc.z.H);
    heroImg.src = IMG_BASE + (IMG_MAP[b.key] || 't03.webp');
    heroImg.alt = b.name+' ã®ã‚¤ãƒ¡ãƒ¼ã‚¸';
    heroTitle.textContent = b.name;
    rangeBadge.textContent = 'ã‚ãªãŸã®ä½ç½®ï¼š'+sc.pct+'%';
    tagline.textContent = 'é›¢é™¸å‚¾å‘ãƒ‘ãƒ¼ã‚»ãƒ³ã‚¿ã‚¤ãƒ«';
    sumLine.textContent  = 'ç·åˆï¼š'+sc.pct+'% ï¼ EA '+meanToPct(sc.EA)+'% ï¼ COPE '+meanToPct(sc.COPE)+'% ï¼ MW '+meanToPct(sc.MW)+'% ï¼ BRS '+meanToPct(sc.BRS)+'%';
    bandMsg.textContent  = bandMsgMap[b.key];

    renderFactors(sc);
    resEmpty.style.display = 'none';
    resArea.style.display  = 'block';
    document.getElementById("result").scrollIntoView({behavior:"smooth",block:"start"});

    try{
      document.dispatchEvent(new Event('result:ready')); // ã¿ã‚“ãªã®ã“ã“ã‚Lv ç”¨
      localStorage.setItem("specimens:last", JSON.stringify({ id: SLUG, title: TITLE, href: location.pathname }));
    }catch(e){}
  }


  // è¨ºæ–­ãƒœã‚¿ãƒ³ã‹ã‚‰å‘¼ã¶æœ¬ä½“
  function doScore(){
    var miss = firstUnanswered();
    if(miss){ alert("æœªå›ç­”ãŒã‚ã‚Šã¾ã™ã€‚å…¨25å•ã«ãŠç­”ãˆãã ã•ã„ã€‚"); needJump(miss); return; }
    saveAnswers();
    var vals = collect();
    var sc   = calcScore(vals);
    render(sc);
  }

  // åˆæœŸåŒ–
  renderQuestions();
  restoreAnswers();
  updateProgress();

  // ç›£è¦–ãƒ»æ“ä½œ
  qWrap.addEventListener("change", function(e){
    if(e.target && e.target.type==="radio"){ saveAnswers(); updateProgress(); }
  }, true);
  document.getElementById("doScore").addEventListener("click", doScore, false);
  document.getElementById("doScore2").addEventListener("click", doScore, false);
  document.getElementById("clearAns").addEventListener("click", function(){
    var radios = qWrap.querySelectorAll('input[type="radio"]');
    for(var i=0;i<radios.length;i++){ radios[i].checked = false; }
    wipeAnswers();
    resArea.style.display = "none";
    resEmpty.style.display = "";
    updateProgress();
    window.scrollTo({top:0,behavior:"smooth"});
  }, false);

  // æˆ»ã‚‹ãƒªãƒ³ã‚¯ã®lastä¿å­˜
  var back = document.getElementById("backLink");
  if(back){
    back.addEventListener("click", function(){
      try{ localStorage.setItem("specimens:last", JSON.stringify({ id: SLUG, title: TITLE, href: location.pathname })); }catch(e){}
    }, false);
  }
})();
</script>

<!-- ã¿ã‚“ãªã®ã“ã“ã‚Lvï¼ˆresult:readyã§ +1 ï¼ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ä»˜ï¼‰ -->
<script>
(function(){
  'use strict';
  var DONE_KEY='specimens:open:byid', TOTAL_KEY='specimens:open:total', GLOBAL_LAST='specimens:open:global:last';
  var MY_ID=(document.body&&document.body.getAttribute('data-id'))||'balloon-escape';
  var COUNTAPI_NS='haisuikounozarigani_shindan', COUNTAPI_KEY='specimens_open_total';
  function hitEveryone(){
    var url='https://api.countapi.xyz/hit/'+COUNTAPI_NS+'/'+COUNTAPI_KEY;
    if(navigator.sendBeacon){ try{ navigator.sendBeacon(url); }catch(_){ } }
    else{ fetch(url,{mode:'cors',cache:'no-store',keepalive:true}).catch(function(){}); }
  }
  var marked=false;
  function markOnce(){
    if(marked) return; marked=true;
    try{
      localStorage.setItem(TOTAL_KEY, String((+localStorage.getItem(TOTAL_KEY)||0)+1));
      var map={}; try{ map=JSON.parse(localStorage.getItem(DONE_KEY)||'{}'); }catch(_){}
      map[MY_ID]=(map[MY_ID]||0)+1;
      localStorage.setItem(DONE_KEY, JSON.stringify(Object.assign({},map,{_ts:Date.now()})));
      hitEveryone();
      try{ localStorage.setItem(GLOBAL_LAST, String((+localStorage.getItem(GLOBAL_LAST)||0)+1)); }catch(_){}
    }catch(_){}
  }
  document.addEventListener('result:ready', markOnce);
  setTimeout(markOnce, 2000);
})();
</script>
</body>
</html>