<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ãƒ©ãƒ¼ãƒ¡ãƒ³å¥åº·è¨ºæ–­ï½œ20é …ç›®ã§â€œã„ã¾ã®æ•´ã„åº¦â€ã‚’ãƒã‚§ãƒƒã‚¯</title>
<meta name="description" content="å¥åº·ç¿’æ…£ï¼ãƒ©ãƒ¼ãƒ¡ãƒ³ã®ä»•è¾¼ã¿ã«è¦‹ç«‹ã¦ã‚‹20é …ç›®ãƒ»5å› å­ã®ã‚»ãƒ«ãƒ•ãƒã‚§ãƒƒã‚¯ã€‚0â€“100ã§æ•´ã„åº¦ã‚’å¯è¦–åŒ–ã—ã€6ãƒ©ãƒ™ãƒ«ï¼ˆå¡©/é†¤æ²¹/é¶ç™½æ¹¯/å‘³å™Œ/å®¶ç³»/äºŒéƒç³»ï¼‰ã¨å®Ÿè·µçš„ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’è¡¨ç¤ºï¼ˆå¨¯æ¥½ï¼‹è‡ªå·±ç†è§£ç”¨ï¼‰ã€‚">
<meta name="theme-color" content="#fff7f0">
<style>
	figure.hero{margin:10px 0;border:1px solid var(--line);border-radius:14px;overflow:hidden;background:#fff}
  :root{--bg1:#fff7f0;--bg2:#fff1f1;--paper:#fff;--ink:#1c1714;--muted:#776b64;--line:#f0e5da;--accent:#ff994d;--accent2:#ffc864}
  *{box-sizing:border-box} html,body{height:100%}
  body{margin:0;color:var(--ink);font-family:"Noto Sans JP",system-ui,-apple-system,Segoe UI,Roboto,"Hiragino Kaku Gothic ProN","Yu Gothic UI","YuGothic",Meiryo,sans-serif;background:linear-gradient(160deg,var(--bg1),var(--bg2));line-height:1.9;letter-spacing:.02em}
  header{position:sticky;top:0;z-index:5;background:rgba(255,255,255,.92);backdrop-filter:saturate(1.05) blur(8px);border-bottom:1px solid var(--line)}
  header .in{max-width:980px;margin:auto;padding:12px 16px;display:flex;gap:12px;align-items:center}
  h1{font-size:18px;margin:0;font-weight:800}
  .crumb{margin-left:auto;color:var(--muted);font-size:12px}
  main{max-width:980px;margin:0 auto;padding:22px 16px 120px}
  .panel{background:var(--paper);border:1px solid var(--line);border-radius:16px;padding:16px;box-shadow:0 10px 28px rgba(0,0,0,.06)}
  .lead{color:var(--muted);margin-top:6px}
  .warn{margin:12px 0;border:1px dashed #ffd7b8;background:#fff8ef;color:#3f2a1b;padding:10px;border-radius:12px}
  .warn strong{color:#c35a00}
  .section-title{margin:12px 0 8px;font-size:15px;font-weight:800}
  .q{border-top:1px solid var(--line);padding:12px 0}
  .q:first-child{border-top:0}
  .q .ttl{font-weight:700}
  .scale{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
  .opt{flex:1 1 180px;min-width:160px;border:1px solid var(--line);border-radius:12px;padding:8px 10px;display:flex;gap:8px;align-items:center;background:#fff;cursor:pointer}
  .opt input{accent-color:var(--accent);transform:translateY(1px)}
  .muted{color:var(--muted)}
  .progress{display:flex;align-items:center;gap:10px;margin-top:12px}
  .bar{flex:1;height:8px;background:#ffe8d6;border-radius:999px;overflow:hidden}
  .bar > i{display:block;height:100%;width:0;background:linear-gradient(90deg,var(--accent),var(--accent2));transition:width .25s ease}
  .actions{display:flex;gap:10px;margin-top:14px;flex-wrap:wrap}
  .btn{appearance:none;border:1px solid var(--line);background:linear-gradient(180deg,#fff,#faf7f2);padding:10px 14px;border-radius:12px;cursor:pointer;font-weight:700;color:var(--ink)}
  .btn.primary{background:linear-gradient(90deg,var(--accent),var(--accent2));color:#fff;border-color:transparent}
  .btn[disabled]{opacity:.55;cursor:not-allowed}
  .btn.linklike{background:#fff}
  #result{margin-top:18px;display:none}
  .stage{display:flex;align-items:center;gap:8px;flex-wrap:wrap;font-weight:800}
  .badge{padding:2px 8px;border-radius:999px;border:1px solid var(--line);font-size:12px;background:#fff}
  .big{font-size:20px;font-weight:900}
  .copy{color:#3a2a1f;margin:6px 0 0}
  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:10px;margin-top:10px}
  .card{border:1px solid var(--line);border-radius:14px;padding:12px;background:#fff}
  .card .name{font-weight:800}
  .meter{height:6px;background:#ffe8d6;border-radius:999px;overflow:hidden;margin-top:8px}
  .meter > i{display:block;height:100%;background:linear-gradient(90deg,var(--accent),var(--accent2))}
  .small{font-size:.95em}
  details{margin-top:8px}
  summary{cursor:pointer;color:#6b4020;font-weight:700}
  .tips ul{margin:.3em 0 .2em 1.2em;padding:0}
  .tips li{margin:.12em 0}
  .savebar{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
  .footnote{color:#806b5d;margin-top:14px}
  /* ğŸ“Š sticky progressï¼ˆrailæº–æ‹ ï¼‰ */
.sticky{position:sticky;top:0;z-index:20;margin:-6px -16px 12px;padding:8px 16px;
  background:rgba(255,255,255,.85);backdrop-filter:blur(6px) saturate(1.05);
  border-bottom:1px solid var(--line);display:flex;align-items:center;gap:10px}
.sticky .progress{height:8px;background:#ffe8d6;border-radius:999px;flex:1;overflow:hidden}
.sticky .progress>span{display:block;height:100%;width:0;
  background:linear-gradient(90deg,var(--accent),var(--accent2));transition:width .25s ease}
</style>
<!-- çµæœã‚«ãƒ¼ãƒ‰ä¿å­˜ï¼ˆä»»æ„ï¼‰ã€‚ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã§ã‚‚å‹•ä½œã™ã‚‹ã‚ˆã†CDNã‚’ä½¿ç”¨ã€å¤±æ•—æ™‚ã¯å°åˆ·ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ -->
<script defer src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
</head>
<body data-id="ramen-health">
<header><div class="in">
  <h1>ãƒ©ãƒ¼ãƒ¡ãƒ³å¥åº·è¨ºæ–­</h1>
  <span class="crumb">20é …ç›®Ã—5å› å­ãƒ»5ä»¶æ³• â†’ 0â€“100ï¼‹6ãƒ©ãƒ™ãƒ«</span>
</div></header>

<main>
  <section class="panel" id="quiz">
    <div>
      <div class="ttl"><strong>5å› å­</strong>ï¼ˆã‚¹ãƒ¼ãƒ—/éºº/ãƒãƒ£ãƒ¼ã‚·ãƒ¥ãƒ¼/ãƒã‚®/æµ·è‹”ï¼‰ã§â€œã„ã¾ã®æ•´ã„åº¦â€ã‚’ãƒã‚§ãƒƒã‚¯ã€‚20é …ç›®ãƒ»5ä»¶æ³•ã§ã‚¹ã‚³ã‚¢åŒ–ã—ã¾ã™ã€‚</div>
      <p class="lead">ç­”ãˆæ–¹ï¼ˆ1ã€œ5ï¼‰ï¼š1 ã¾ã£ãŸãå½“ã¦ã¯ã¾ã‚‰ãªã„ï¼2 ã‚ã¾ã‚Šå½“ã¦ã¯ã¾ã‚‰ãªã„ï¼3 ã©ã¡ã‚‰ã¨ã‚‚è¨€ãˆãªã„ï¼4 ã‚„ã‚„å½“ã¦ã¯ã¾ã‚‹ï¼5 ã¨ã¦ã‚‚å½“ã¦ã¯ã¾ã‚‹</p>
    </div>

    
    <!-- ğŸ“Š sticky progressï¼ˆrailæº–æ‹ ï¼‰ -->
<div class="sticky" aria-live="polite">
  <span aria-hidden="true">ğŸ“Š</span>
  <div class="progress" role="progressbar" aria-valuemin="0" aria-valuemax="20" aria-valuenow="0">
    <span id="prog"></span>
  </div>
  <!-- ãƒœã‚¿ãƒ³ã¯ã“ã“ã«å‡ºã™ï¼šidã¯æ—¢å­˜ã¨åŒã˜ #btnCalc -->
  <button id="btnCalc" class="btn primary" disabled>çµæœã‚’è¦‹ã‚‹</button>
</div>

<!-- è³ªå• -->
    <div id="qbox"></div>
    <!-- æ“ä½œ -->
    <div class="actions">
      <button id="btnReset" class="btn">ãƒªã‚»ãƒƒãƒˆ</button>
      <a href="/shindan/" class="btn linklike" role="button">è¨ºæ–­ä¸€è¦§ã«æˆ»ã‚‹</a>
      
      <p class="warn"><strong>æ³¨æ„ï¼š</strong>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¯<b>å¨¯æ¥½ï¼‹è‡ªå·±ç†è§£ã®ç›®å®‰</b>ã‚’ç›®çš„ã¨ã—ãŸã‚»ãƒ«ãƒ•ãƒã‚§ãƒƒã‚¯ã§ã™ã€‚
<br>åŒ»ç™‚çš„ãªè¨ºæ–­ãƒ»æ²»ç™‚ãƒ»åŠ©è¨€ã‚’ç›®çš„ã¨ã—ã¾ã›ã‚“ã€‚å¼·ã„ä¸èª¿ãŒç¶šãå ´åˆã¯åŒ»ç™‚æ©Ÿé–¢ã‚„å°‚é–€å®¶ã¸ã€‚
<br>è¡¨ç¤ºãƒ©ãƒ™ãƒ«ï¼ˆå¡©/é†¤æ²¹/â€¦ï¼‰ã¯<b>æ¯”å–©</b>ã§ã‚ã‚Šã€å®Ÿåœ¨å•†å“ãƒ»æ¥­æ…‹ã®å„ªåŠ£ã‚„é–¢é€£ã‚’æ„å‘³ã—ã¾ã›ã‚“ã€‚</br>
å›ç­”ã¯ç«¯æœ«å†…ã§å‡¦ç†ãƒ»ä¿å­˜ã•ã‚Œã€å›ç­”å†…å®¹ã‚„å€‹äººã‚’ç‰¹å®šã§ãã‚‹æƒ…å ±ã¯ã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡ã•ã‚Œã¾ã›ã‚“ã€‚
<br>çµæœè¡¨ç¤ºæ™‚ã«åŒ¿åã®ä»¶æ•°ã‚«ã‚¦ãƒ³ãƒˆã®ã¿é€ä¿¡ã™ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚
    </div>

    <!-- çµæœ -->
    <div id="result" class="panel">
      <div id="resultCard">
        <h2 class="section-title" style="font-size:18px">çµæœ</h2>
        <div id="head" class="stage" style="margin-bottom:8px"></div>
        <!-- ãƒ’ãƒ¼ãƒ­ãƒ¼ç”»åƒï¼ˆ01=å¡© â€¦ 06=äºŒéƒç³»ï¼‰ -->
<figure class="hero" aria-hidden="true">
  <img id="heroImg" src="" alt="" style="width:100%;height:auto;display:block" loading="lazy">
</figure>
        <div class="copy" id="heroCopy"></div>

        <h3 class="section-title">å› å­ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ5å› å­ï¼‰</h3>
        <div class="grid" id="all"></div>

        <div class="tips" id="quick"></div>

        <details>
          <summary>ã‚¹ã‚³ã‚¢æ›ç®—ãƒ«ãƒ¼ãƒ«</summary>
          <div class="small muted">
            <p>é€†è»¢é …ç›®ï¼š<code>vR = 6 - v</code>ã€‚å„å› å­ã¯4é …ç›®å¹³å‡ï¼ˆ1â€“5ï¼‰â†’ <code>pct = Math.round(((avg-1)/4)*100)</code>ï¼ˆ0â€“100ï¼‰ã€‚ç·åˆï¼5å› å­ã®å¹³å‡ï¼ˆå››æ¨äº”å…¥ï¼‰ã€‚</p>
            <p>ãƒ©ãƒ™ãƒ«ï¼š90â€“100=å¡©ï¼75â€“89=é†¤æ²¹ï¼60â€“74=é¶ç™½æ¹¯ï¼45â€“59=å‘³å™Œï¼30â€“44=å®¶ç³»ï¼0â€“29=äºŒéƒç³»ã€‚</p>
          </div>
        </details>
      </div>

      <div class="savebar">
        <button id="btnSave" class="btn">çµæœã‚«ãƒ¼ãƒ‰ã‚’ç”»åƒä¿å­˜</button>
        <button id="btnPrint" class="btn">å°åˆ·/ä¿å­˜ï¼ˆPDFï¼‰</button>
      </div>

      <div class="footnote small">
        æ¦‚å¿µã®èª¬æ˜ï¼ˆå°‚é–€ç‰ˆï¼‰ï¼š
        <ul>
          <li><b>ã‚¹ãƒ¼ãƒ—ï¼ç¡çœ ï¼ˆSLPï¼‰</b>ï¼šé‡ãƒ»è³ªãƒ»ã‚¿ã‚¤ãƒŸãƒ³ã‚°ãƒ»å›å¾©æ„Ÿã®ç·åˆã€‚å…¥çœ â‰¤30åˆ†ã€å°±èµ·æ™‚åˆ»ã®åˆ†æ•£ãŒå°ã€æ—¥ä¸­ã®çœ æ°—ä½ãŒç›®å®‰ã€‚æ…¢æ€§ç¡çœ ä¸è¶³ãƒ»ç¤¾ä¼šçš„æ™‚å·®ã¯é£Ÿæ¬²èª¿æ•´ã¨æƒ…å‹•åˆ¶å¾¡ã«æ³¢åŠã€‚</li>
          <li><b>éººï¼é£Ÿäº‹ãƒªã‚ºãƒ ï¼ˆTIMï¼‰</b>ï¼šæ¦‚æ—¥æ™‚è¨ˆã«æ²¿ã†æ‘‚é£Ÿã‚¿ã‚¤ãƒŸãƒ³ã‚°ã®å®‰å®šæ€§ã€‚æœé£Ÿã®å®šç€ã€å°±å¯3hå‰ã®æ‘‚é£Ÿå›é¿ã€ã‚«ãƒ­ãƒªãƒ¼å‰å€’ã—ã¯è¡€ç³–å¿œç­”ã¨ç¡çœ ã‚’æ”¯ãˆã‚‹ã€‚</li>
          <li><b>ãƒãƒ£ãƒ¼ã‚·ãƒ¥ãƒ¼ï¼æ „é¤Šï¼ˆNUTï¼‰</b>ï¼šä¸»é£Ÿãƒ»ä¸»èœãƒ»å‰¯èœã®ãƒãƒ©ãƒ³ã‚¹ã€‚ååˆ†ãªãŸã‚“ã±ãã€é£Ÿç‰©ç¹Šç¶­/å¾®é‡æ „é¤Šã€ç²¾è£½åº¦ã®ä½ã„ä¸»é£Ÿã€‚UPFãƒ»é«˜GI/GLã®éå¤šã¯æº€è…¹æ„Ÿãƒ»è¡€ç³–å®‰å®šãƒ»ä½“é‡ç®¡ç†ã«ä¸åˆ©ã€‚</li>
          <li><b>ãƒã‚®ï¼æ´»å‹•ï¼ˆMOVï¼‰</b>ï¼šNEATï¼‹ä¸­å¼·åº¦ã€‚é•·åº§ä½ã®åˆ†æ–­ï¼ˆæ¯æ™‚1â€“2åˆ†èµ·ç«‹/æ­©è¡Œï¼‰ã€é€Ÿæ­©10åˆ†ãƒ–ãƒ­ãƒƒã‚¯ã€æ—¥å…‰æ›éœ²ãŒç¡çœ ãƒ»æ°—åˆ†ãƒ»ä»£è¬ã«æ³¢åŠã€‚</li>
          <li><b>æµ·è‹”ï¼å›å¾©ï¼ˆRECï¼‰</b>ï¼šè‡ªå¾‹ç¥çµŒã®ãƒªã‚«ãƒãƒªãƒ¼ã¨èªçŸ¥çš„ã‚ªãƒ•ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã€‚çµ‚æ¥­ã®å„€å¼ã€Worryãƒªã‚¹ãƒˆâ†’æ¬¡ã®ä¸€æ‰‹ã€ç”»é¢ã‚ªãƒ•ãŒå…¥çœ ãƒ»æƒ…å‹•åå¿œæ€§ã‚’æ•´ãˆã‚‹ã€‚</li>
        </ul>
        <div class="muted">â€»åŒ»ç™‚ã®ä»£æ›¿ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ä½“èª¿ä¸è‰¯ãŒç¶šãå ´åˆã¯å°‚é–€æ©Ÿé–¢ã¸ã€‚</div>
      </div>
    </div>
  </section>
</main>

<script>
(function(){
  // ===== å› å­å®šç¾©ï¼ˆã‚³ãƒ¼ãƒ‰/åç§°ï¼‰ =====
  var FACTORS = [
    { key:'SLP', name:'ã‚¹ãƒ¼ãƒ—ï¼ç¡çœ ', desc:'å°±èµ·æ™‚åˆ»ã®ä¸€è²«æ€§ãƒ»å…¥çœ æ½œæ™‚ãƒ»æ—¥ä¸­ã®çœ æ°—ãªã©' },
    { key:'TIM', name:'éººï¼é£Ÿäº‹ãƒªã‚ºãƒ ', desc:'æœé£Ÿãƒ»å°±å¯3hå‰ã®é£Ÿæ­¢ã‚ãƒ»é£Ÿäº‹æ™‚é–“ã®å®‰å®š' },
    { key:'NUT', name:'ãƒãƒ£ãƒ¼ã‚·ãƒ¥ãƒ¼ï¼æ „é¤Š', desc:'ãŸã‚“ã±ããƒ»é£Ÿç‰©ç¹Šç¶­ãƒ»UPF/æšã’ç‰©ã®é »åº¦' },
    { key:'MOV', name:'ãƒã‚®ï¼æ´»å‹•', desc:'NEATï¼‹ä¸­å¼·åº¦ï¼ˆé•·åº§ä½ã®åˆ†æ–­ãƒ»é€Ÿæ­©ãƒ»æ—¥å…‰ï¼‰' },
    { key:'REC', name:'æµ·è‹”ï¼å›å¾©', desc:'çµ‚æ¥­ã®å„€å¼ãƒ»é€šçŸ¥ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ»ãƒªãƒ©ã‚¯ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³' }
  ];

  // ===== è³ªå•ï¼ˆ20é …ç›®ãƒ»é€†è»¢Rã‚ã‚Šï¼‰ =====
  var ITEMS = [
    // SLP
    {key:'SLP', t:'å°±å¯ãƒ»èµ·åºŠã®æ™‚åˆ»ã¯ãŠãŠã‚€ã­ä¸€å®šã«ã§ãã¦ã„ã‚‹ã€‚', rev:false},
    {key:'SLP', t:'å¸ƒå›£ã«å…¥ã£ã¦ã‹ã‚‰30åˆ†ä»¥å†…ã«çœ ã‚Œã¦ã„ã‚‹ã€‚', rev:false},
    {key:'SLP', t:'ï¼ˆRï¼‰é€±ã®åŠã°ã¯å¯ä¸è¶³ã§ã€æ—¥ä¸­ã®çœ æ°—ãŒã¤ã¥ãã‚„ã™ã„ã€‚', rev:true},
    {key:'SLP', t:'å°±å¯å‰ã¯ç”»é¢æ™‚é–“ã‚’çŸ­ãã§ãã¦ã„ã‚‹ã€‚', rev:false},

    // TIM
    {key:'TIM', t:'æœé£Ÿã‚’é£Ÿã¹ã‚‹ç¿’æ…£ãŒã‚ã‚‹ã€‚', rev:false},
    {key:'TIM', t:'å°±å¯3æ™‚é–“å‰ä»¥é™ã¯é£Ÿã¹ãªã„ã“ã¨ãŒå¤šã„ã€‚', rev:false},
    {key:'TIM', t:'ï¼ˆRï¼‰å¤œé…ã„æ™‚é–“ã«ãƒ‰ã‚«é£Ÿã„ã—ã¦ã—ã¾ã†ã“ã¨ãŒå¤šã„ã€‚', rev:true},
    {key:'TIM', t:'1æ—¥ã®é£Ÿäº‹æ™‚é–“å¸¯ãŒå¤§ãããƒ–ãƒ¬ãªã„ã€‚', rev:false},

    // NUT
    {key:'NUT', t:'æ¯é£Ÿã€è‚‰ãƒ»é­šãƒ»åµãƒ»å¤§è±†ãªã©ã®ãŸã‚“ã±ãæºã‚’æ„è­˜ã—ã¦ã„ã‚‹ã€‚', rev:false},
    {key:'NUT', t:'é‡èœã‚„é£Ÿç‰©ç¹Šç¶­ã‚’ã—ã£ã‹ã‚Šæ‘‚ã‚Œã¦ã„ã‚‹ã€‚', rev:false},
    {key:'NUT', t:'ï¼ˆRï¼‰è“å­ã‚„æ¸…æ¶¼é£²æ–™ãŒä¸»ãªé–“é£Ÿã«ãªã‚ŠãŒã¡ã ã€‚', rev:true},
    {key:'NUT', t:'è¶…åŠ å·¥é£Ÿå“ã‚„æšã’ç‰©ã‚’â€œé€£æ—¥â€ã«ã—ãªã„ã‚ˆã†èª¿æ•´ã§ãã‚‹ã€‚', rev:false},

    // MOV
    {key:'MOV', t:'é€Ÿæ­©ãªã©ä¸­å¼·åº¦ã®æ´»å‹•ã‚’ã€1æ—¥åˆè¨ˆ30åˆ†ä»¥ä¸Šã§ãã¦ã„ã‚‹ã€‚', rev:false},
    {key:'MOV', t:'é•·æ™‚é–“åº§ã‚Šã£ã±ãªã—ã«ãªã‚‰ãªã„ã‚ˆã†ã€å°ä¼‘æ­¢ã‚’æŒŸã‚ã¦ã„ã‚‹ã€‚', rev:false},
    {key:'MOV', t:'ï¼ˆRï¼‰ä¼‘æ—¥ã¯ã»ã¼ä¸€æ—¥ä¸­åº§ã£ã¦éã”ã™ã“ã¨ãŒå¤šã„ã€‚', rev:true},
    {key:'MOV', t:'æ—¥å…‰ã‚„å¤–æ°—ã«è§¦ã‚Œã‚‹æ™‚é–“ã‚’æ„è­˜çš„ã«ã¤ãã£ã¦ã„ã‚‹ã€‚', rev:false},

    // REC
    {key:'REC', t:'ä»•äº‹ã‚„å‹‰å¼·ã®çµ‚ã‚ã‚Šã«ã€ã‚ªãƒ•ã¸åˆ‡ã‚Šæ›¿ãˆã‚‹â€œå„€å¼â€ãŒã‚ã‚‹ã€‚', rev:false},
    {key:'REC', t:'ã‚¹ãƒˆãƒ¬ã‚¹ãŒé«˜ã„æ—¥ã¯ã€äººã«ç›¸è«‡ã—ãŸã‚Šæ›¸ãå‡ºã—ãŸã‚Šã§ãã‚‹ã€‚', rev:false},
    {key:'REC', t:'ï¼ˆRï¼‰å¤œã¾ã§ã‚¹ãƒãƒ›é€šçŸ¥ã«è¿½ã‚ã‚Œã€æ°—ãŒä¼‘ã¾ã‚‰ãªã„ã“ã¨ãŒå¤šã„ã€‚', rev:true},
    {key:'REC', t:'å…¥æµ´ãƒ»ã‚¹ãƒˆãƒ¬ãƒƒãƒãƒ»å‘¼å¸ãªã©ã€ãƒªãƒ©ãƒƒã‚¯ã‚¹æ™‚é–“ã‚’å–ã‚Œã¦ã„ã‚‹ã€‚', rev:false}
  ];

  // 5ä»¶æ³•
  var SCALE = [
    {v:1, label:'1 ã¾ã£ãŸãå½“ã¦ã¯ã¾ã‚‰ãªã„'},
    {v:2, label:'2 ã‚ã¾ã‚Šå½“ã¦ã¯ã¾ã‚‰ãªã„'},
    {v:3, label:'3 ã©ã¡ã‚‰ã¨ã‚‚è¨€ãˆãªã„'},
    {v:4, label:'4 ã‚„ã‚„å½“ã¦ã¯ã¾ã‚‹'},
    {v:5, label:'5 ã¨ã¦ã‚‚å½“ã¦ã¯ã¾ã‚‹'}
  ];

  // DOM
  function $(q,root){return (root||document).querySelector(q)}
  function $$(q,root){return Array.prototype.slice.call((root||document).querySelectorAll(q))}
  var qbox = $('#qbox'), prog = $('#prog');
  var btnCalc = $('#btnCalc'), btnReset = $('#btnReset');
  var res = $('#result'), head = $('#head'), allBox = $('#all');
  var heroImg = $('#heroImg'), heroCopy = $('#heroCopy'), quick = $('#quick');

  // Utils
  function shuffle(a){ for(var i=a.length-1;i>0;i--){ var j=Math.floor(Math.random()*(i+1)); var t=a[i]; a[i]=a[j]; a[j]=t; } return a; }
  function pctFromAvg(avg){ var p=Math.round(((avg-1)/4)*100); if(p<0)p=0; if(p>100)p=100; return p; }
// ç”»åƒãƒ•ã‚©ãƒ«ãƒ€ï¼ˆå¿…è¦ãªã‚‰ãƒ‘ã‚¹ã‚’æ›¸ãæ›ãˆã¦ãã ã•ã„ï¼‰
  var HERO_IMG_BASE = '/shindan/assets/results/ramen-health/';

  // ç·åˆã‚¹ã‚³ã‚¢â†’ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«åï¼ˆ01=å¡© â€¦ 06=äºŒéƒç³»ï¼‰
function heroImageFor(p){
  var idx;
  if(p>=90) idx=1;
  else if(p>=75) idx=2;
  else if(p>=60) idx=3;
  else if(p>=45) idx=4;
  else if(p>=30) idx=5;
  else idx=6;
  return ('0'+idx).slice(-2)+'.png';
}
  // ãƒ©ãƒ™ãƒ«
  function overallLabel(p){
    if(p>=90) return 'å¡©ï¼ˆä»•è¾¼ã¿å®Œç’§ï¼‰';
    if(p>=75) return 'é†¤æ²¹ï¼ˆæ•´ãˆä¸Šæ‰‹ï¼‰';
    if(p>=60) return 'é¶ç™½æ¹¯ï¼ˆã»ã©ã‚ˆã„æ¿ƒåº¦ï¼‰';
    if(p>=45) return 'å‘³å™Œï¼ˆã‚„ã‚„é‡ãŸã‚ï¼‰';
    if(p>=30) return 'å®¶ç³»ï¼ˆèª¿æ•´ãŒå¿…è¦ï¼‰';
    return 'äºŒéƒç³»ï¼ˆã¾ãšä¸€ç®‡æ‰€ã ã‘ç·©ã‚ã‚‹ï¼‰';
  }

  // ç·åˆã‚³ãƒ¡ãƒ³ãƒˆ
  function overallStory(p){
    if(p>=90) return 'ä»•è¾¼ã¿å®Œç’§ã€‚ç¡çœ ãƒªã‚ºãƒ ã¨å›å¾©ã®â€œç«å…¥ã‚Œâ€ãŒæ±ºã¾ã‚Šã€1æ—¥ã‚’é€šã—ã¦æ¾„ã‚“ã ã‚­ãƒ¬ã€‚ä»Šã®å‹ã‚’å£Šã•ãªã„ã‚ˆã†ã€<b>é€±1ã®â€œå®Œå…¨ä¼‘æ¯â€ã‚’ãƒ¬ã‚·ãƒ”åŒ–</b>ã—ã¦å®ˆã‚‹ã¨é•·æŒã¡ã€‚';
    if(p>=75) return 'æ•´ãˆä¸Šæ‰‹ã€‚åŸºç¤ãŒæƒã„ã€æ™‚æŠ˜ã®å´©ã‚Œã‚‚æˆ»ã›ã‚‹æ®µå–ã‚Šã€‚è©°ã‚ã‚‹ãªã‚‰<b>åº§ã‚Šã£ã±ãªã—ã®åˆ†æ–­</b>ã¨<b>å°±å¯å‰ã®ç”»é¢ã‚ªãƒ•</b>ã‚’ã‚‚ã†ä¸€æ®µã€‚';
    if(p>=60) return 'ã»ã©ã‚ˆã„æ¿ƒåº¦ã€‚ãƒ™ãƒ¼ã‚¹ã¯è‰¯ãã€æ•°ç‚¹ã®ã‚¯ã‚»ãŒæ¿ã‚Šã«ã€‚æœ€çŸ­åŠ¹æœã¯<b>å°±å¯3æ™‚é–“å‰ã®é£Ÿæ­¢ã‚</b>ï¼‹<b>æœã®å¤–å…‰</b>ã€‚';
    if(p>=45) return 'ã‚„ã‚„é‡ãŸã‚ã€‚ç¡çœ /é£Ÿäº‹/æ´»å‹•ã®ã©ã‚Œã‹ãŒæ»ç•™æ°—å‘³ã€‚<b>ä¸€ç®‡æ‰€ã ã‘</b>ç‹™ã„æ’ƒã¡ã§æ”¹å–„ï¼ˆä¾‹ï¼šæ¯æ™‚1â€“2åˆ†ã®ç«‹ã¡ä¸ŠãŒã‚Šï¼‰ã€‚';
    if(p>=30) return 'èª¿æ•´ãŒå¿…è¦ã€‚æ¿ƒåº¦ã¯é­…åŠ›çš„ã ãŒã€å›å¾©ã®æµ·è‹”ãŒæº¶ã‘ã¦ã‚‹ã‹ã‚‚ã€‚<b>å¤œã®é€šçŸ¥åˆ¶é™</b>ã¨<b>çŸ­ã„æ•£æ­©</b>ã‹ã‚‰ã€‚';
    return 'ã¾ãšä¸€ç®‡æ‰€ã ã‘ç·©ã‚ã‚‹ã€‚å…¨éƒ¨ã‚„ã‚ã†ã¨ã›ãšã€<b>æœ€ã‚‚ãƒ©ã‚¯ãªä¸€æ‰‹</b>ï¼ˆä¾‹ï¼šå¯ã‚‹30åˆ†å‰ã«ç”»é¢ã‚’ä¼ã›ã‚‹ï¼‰ã‚’14æ—¥å›ºå®šã€‚';
  }

  // å› å­åˆ¥ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ï¼ˆ75+/50â€“74/<50ï¼‰
  var FB = {
    SLP:{hi:'æ·±ã¿ã®ã‚ã‚‹ã‚¹ãƒ¼ãƒ—ã€‚<b>èµ·åºŠæ™‚åˆ»ã®ä¸€è²«æ€§</b>ã‚’æ ¸ã«ç¶™ç¶šã€‚', mid:'è³ªã¯å‡ºã¦ã„ã‚‹ã€‚<b>å…¥çœ å‰30åˆ†ã®å…‰é‡ãƒ€ã‚¦ãƒ³</b>ã§+5ã‚’ç‹™ãˆã‚‹ã€‚', low:'ç¤¾ä¼šçš„æ™‚å·®ã®å½±éŸ¿å¤§ã€‚<b>èµ·åºŠå›ºå®šâ†’æœå…‰â†’ã‚«ãƒ•ã‚§ã‚¤ãƒ³ã¯14æ™‚ã¾ã§</b>ã‚’2é€±ã€‚'},
    TIM:{hi:'éººä¸ŠãŒã‚Šè‰¯å¥½ã€‚<b>å‰å€’ã—ã‚«ãƒ­ãƒªãƒ¼</b>ã‚’æ„è­˜ã™ã‚‹ã¨ç²˜ã‚ŠUPã€‚', mid:'çµ‚ç›¤ã«å´©ã‚ŒãŒã¡ã€‚<b>å°±å¯3hå‰ã®é£Ÿæ­¢ã‚</b>ã‚’â€œæ›œæ—¥å›ºå®šâ€ã§ã€‚', low:'å¤œå‹ãƒ‰ã‚«é£Ÿã„ãŒä¸»å› ã€‚<b>æœä¸€å£ï¼‹æ˜¼ã—ã£ã‹ã‚Š</b>ã®2æœ¬ç«‹ã¦ã«ã€‚'},
    NUT:{hi:'ãƒãƒ£ãƒ¼ã‚·ãƒ¥ãƒ¼åšã„ã€‚<b>ãŸã‚“ã±ãÃ—é£Ÿç‰©ç¹Šç¶­</b>ã®å‹ã‚’ç¶­æŒã€‚', mid:'é–“é£ŸãŒæ¿ã‚Šã€‚<b>æ°´åˆ†â†’é«˜ã‚«ã‚«ã‚ª/ãƒŠãƒƒãƒ„</b>ã«ç½®æ›ã€‚', low:'UPFéå¤šã€‚<b>å¹³æ—¥â€œé€£æ—¥ã—ãªã„â€</b>ãƒ«ãƒ¼ãƒ«â†’é€±1ã ã‘è§£ç¦ã€‚'},
    MOV:{hi:'ãƒã‚®ãŒé¦™ã‚‹ã€‚<b>é€Ÿæ­©10åˆ†Ã—3</b>ã®ç¶­æŒã§ç¡çœ ã«ã‚‚æ³¢åŠã€‚', mid:'åº§ä½ãŒé•·ã„ã€‚<b>æ¯æ™‚â€œç«‹ã¤â€ãƒˆãƒªã‚¬ãƒ¼</b>ï¼ˆçµ¦æ°´/ãƒˆã‚¤ãƒ¬/éšæ®µï¼‰ã€‚', low:'ã¾ãšã¯<b>å®¶å†…ç§»å‹•ã®å¢—é‡</b>â†’<b>æ—¥å…‰5â€“10åˆ†</b>ã‹ã‚‰ã€‚'},
    REC:{hi:'æµ·è‹”ã§è¼ªéƒ­ãã£ãã‚Šã€‚<b>çµ‚æ¥­â†’å…¥æµ´/æ•£æ­©</b>ã®å„€å¼ãŒåŠ¹ã„ã¦ã‚‹ã€‚', mid:'é€šçŸ¥ã«è£‚ã‘ç›®ã€‚<b>19â€“ç¿Œ7æ™‚ã¯é€šçŸ¥OFF</b>ã‚’è©¦ç”¨ã€‚', low:'å¿ƒèº«ã®â€œå‡ºæ±æŠœã‘â€ã€‚<b>æ¹¯èˆ¹10åˆ†ï¼‹å‘¼å¸1åˆ†</b>ã§â€œåˆ‡æ›¿ãˆâ€ã‚’ä½œã‚‹ã€‚'}
  };

  // Quick Tipsï¼ˆæœ€ä¸‹ä½=3è¡Œï¼æ¬¡ç‚¹=2è¡Œï¼‰
  var TIPS_PRIMARY = {
    SLP:['èµ·åºŠæ™‚åˆ»ã‚’æ¯æ—¥å›ºå®š','æœã®å¤–å…‰ã‚’2â€“10åˆ†','ã‚«ãƒ•ã‚§ã‚¤ãƒ³ã¯14æ™‚ã¾ã§'],
    TIM:['å°±å¯3hå‰ã«é£Ÿæ­¢ã‚','æœã¯ä¸€å£ã§ã‚‚æ‘‚ã‚‹','é£Ÿäº‹æ™‚é–“ã‚’æ¯æ—¥ã ã„ãŸã„åŒã˜ã«'],
    NUT:['æ¯é£ŸãŸã‚“ã±ãæºã‚’å…¥ã‚Œã‚‹','é–“é£Ÿã¯æ°´åˆ†â†’ãƒŠãƒƒãƒ„/é«˜ã‚«ã‚«ã‚ªã¸','UPF/æšã’ç‰©ã¯â€œé€£æ—¥ã—ãªã„â€'],
    MOV:['æ¯æ™‚1â€“2åˆ†ç«‹ã¤/æ­©ã','é€Ÿæ­©10åˆ†ã‚’1ã€œ3ã‚»ãƒƒãƒˆ','æ—¥å…‰/å¤–æ°—ã«5â€“10åˆ†'],
    REC:['çµ‚æ¥­â†’å…¥æµ´/æ•£æ­©ã®å„€å¼','é€šçŸ¥ã®å¤œé–“OFFã‚’è©¦ã™','æ¹¯èˆ¹10åˆ†ï¼‹å‘¼å¸1åˆ†']
  };
  var TIPS_SECONDARY = {
    SLP:['å°±å¯å‰30åˆ†ã®æ¸›å…‰','å¸ƒå›£ã«å…¥ã‚‹æ™‚åˆ»ã®ç›®æ¨™åŒ–'],
    TIM:['æ˜¼ã«ä¸»ã‚«ãƒ­ãƒªãƒ¼ã‚’å¯„ã›ã‚‹','å¤œã®é–“é£Ÿã¯åˆ¥å®¤/è²·ã„ç½®ãã—ãªã„'],
    NUT:['é‡èœã¯å…ˆã«ç››ã‚‹/å…ˆã«é£Ÿã¹ã‚‹','é£²æ–™ã¯ç„¡ç³–ãƒ™ãƒ¼ã‚¹ã«'],
    MOV:['éšæ®µ/é å›ã‚Šã‚’é¸ã¶','å®¶äº‹NEATï¼ˆæƒé™¤/æ´—æ¿¯ï¼‰ã‚’å¢—ã‚„ã™'],
    REC:['Worryãƒªã‚¹ãƒˆâ†’æ¬¡ã®ä¸€æ‰‹','å¯ã‚‹30åˆ†å‰ã«ç”»é¢ä¼ã›']
  };

  // ãƒ©ãƒ³ãƒ€ãƒ åŒ–ï¼ˆæ¯å›ï¼‰
  var QUESTIONS = shuffle(ITEMS.map(function(it,idx){return { key:it.key, t:it.t, rev:it.rev, idx:idx };}));
  var TOTAL = QUESTIONS.length;

  // è³ªå•æç”»
  QUESTIONS.forEach(function(q,i){
    var s=document.createElement('section'); s.className='q';
    var inner = '<div class="ttl">Q'+(i+1)+'. '+q.t+'</div><div class="scale" role="group" aria-label="è³ªå• '+(i+1)+'">';
    inner += SCALE.map(function(sc){
      var id='q'+(i+1)+'-'+sc.v;
      return '<label class="opt" for="'+id+'"><input type="radio" name="q'+(i+1)+'" id="'+id+'" value="'+sc.v+'"><span>'+sc.label+'</span></label>';
    }).join('');
    inner += '</div>';
    s.innerHTML = inner;
    qbox.appendChild(s);
  });

  // é€²æ—
  // ã„ãã¤å›ç­”æ¸ˆã¿ã‹æ•°ãˆã‚‹
function answeredCount(){
  var c = 0;
  for(var i=1;i<=TOTAL;i++){
    if(document.querySelector('input[name="q'+i+'"]:checked')) c++;
  }
  return c;
}

  function updateProgress(){
  var n = answeredCount();
  // rail é¢¨ã®å¤ªã„ãƒãƒ¼ã«å¹…ã ã‘åæ˜ ï¼ˆãƒ†ã‚­ã‚¹ãƒˆã¯å‡ºã•ãªã„ï¼‰
  if (prog) prog.style.width = Math.round(n/TOTAL*100)+'%';

  // ARIAï¼ˆã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ï¼‰
  var sh = document.querySelector('.sticky .progress');
  if (sh){
    sh.setAttribute('aria-valuemin','0');
    sh.setAttribute('aria-valuemax', String(TOTAL));
    sh.setAttribute('aria-valuenow', String(n));
  }

  // å…¨å•å›ç­”ã§ã€Œçµæœã‚’è¦‹ã‚‹ã€ã‚’æœ‰åŠ¹åŒ–
  btnCalc.disabled = (n !== TOTAL);
}
  document.addEventListener('change', function(e){
    var nm = e && e.target ? e.target.name : '';
    if(nm && nm.indexOf('q')===0) updateProgress();
  });
  updateProgress();

  // é›†è¨ˆ
  function collect(){
    var vals={};
    for(var i=1;i<=TOTAL;i++){
      var el=document.querySelector('input[name="q'+i+'"]:checked'); if(!el) return null;
      vals[i]=+el.value;
    }
    return vals;
  }
  function compute(vals){
    var sums={}, cnts={}; FACTORS.forEach(function(f){sums[f.key]=0; cnts[f.key]=0;});
    QUESTIONS.forEach(function(q,idx){
      var v = vals[idx+1]; if(q.rev) v = 6 - v;
      sums[q.key]+=v; cnts[q.key]+=1;
    });
    var factors = FACTORS.map(function(f){
      var avg = sums[f.key]/(cnts[f.key]||1);
      var pct = pctFromAvg(avg);
      return { key:f.key, name:f.name, desc:f.desc, pct:pct, avg:Math.round(avg*10)/10 };
    }).sort(function(a,b){ return b.pct-a.pct || b.avg-a.avg; });
    var overall = Math.round(factors.reduce(function(a,b){return a+b.pct;},0)/factors.length);
    return {factors:factors, overall:overall};
  }

  // å› å­ã‚³ãƒ¡ãƒ³ãƒˆ
  function factorComment(k,pct){
    var s=FB[k]; if(!s) return '';
    if(pct>=75) return s.hi;
    if(pct>=50) return s.mid;
    return s.low;
  }
  function band(p){ if(p>=75) return 'é«˜ã‚'; if(p>=50) return 'ä¸­é–“'; return 'ä½ã‚'; }

  // çµæœæç”»
  function render(vals){
    var out = compute(vals), factors=out.factors, overall=out.overall;

    // ãƒ˜ãƒƒãƒ€
    head.innerHTML =
      '<span class="badge">ç·åˆï¼š<span class="big">'+overall+'</span></span>'+
      '<span class="badge">ãƒ©ãƒ™ãƒ«ï¼š<b>'+overallLabel(overall)+'</b></span>';

// ãƒ’ãƒ¼ãƒ­ãƒ¼ç”»åƒ
var imgFile = heroImageFor(overall);
if (heroImg){
  heroImg.src = HERO_IMG_BASE + imgFile;
  heroImg.alt = 'ç·åˆãƒ©ãƒ™ãƒ«ï¼š' + overallLabel(overall) + 'ï¼ˆç”»åƒ ' + imgFile + 'ï¼‰';
}
// ç·åˆã‚³ãƒ¡ãƒ³ãƒˆ
heroCopy.innerHTML =
  '<div><b>ç·åˆã‚³ãƒ¡ãƒ³ãƒˆ</b></div>' +
  '<div>' + overallStory(overall) + '</div>';

    // å› å­ã‚«ãƒ¼ãƒ‰
    allBox.innerHTML='';
    factors.forEach(function(f){
      var card=document.createElement('article'); card.className='card small';
      var inner =
        '<div class="name" style="display:flex;align-items:center;gap:8px;flex-wrap:wrap">'+
          '<span>'+f.name+'</span>'+
          '<span class="badge">'+f.pct+'%</span>'+
          '<span class="badge">'+band(f.pct)+'</span>'+
        '</div>'+
        '<div class="muted" style="margin:.2em 0 .4em">'+f.desc+'</div>'+
        '<div class="meter"><i style="width:'+f.pct+'%"></i></div>'+
        '<div style="margin-top:.6em">'+factorComment(f.key, f.pct)+'</div>';
      card.innerHTML=inner;
      allBox.appendChild(card);
    });

    // Quick Tipsï¼ˆæœ€ä¸‹ä½ï¼æ¬¡ç‚¹ï¼‰
    var low  = factors.slice(-1)[0];
    var low2 = factors.slice(-2,-1)[0];
    function li(items){ return '<ul>'+items.map(function(t){return '<li>'+t+'</li>';}).join('')+'</ul>'; }
    var tip1 = TIPS_PRIMARY[low.key] || [];
    var tip2 = TIPS_SECONDARY[low2.key] || [];
    quick.innerHTML =
      '<h3 class="section-title">ã¾ãš1ã¤ã ã‘æ•´ãˆã‚‹ãªã‚‰</h3>'+
      '<div class="card small"><div class="name">'+low.name+'ï¼ˆç¾çŠ¶ '+low.pct+'%ï¼‰</div>'+li(tip1.slice(0,3))+'</div>'+
      '<div class="card small"><div class="name">æ¬¡ã« '+low2.name+'ï¼ˆ'+low2.pct+'%ï¼‰</div>'+li(tip2.slice(0,2))+'</div>';

    res.style.display='block';
    res.scrollIntoView({behavior:'smooth',block:'start'});
  }

  // ãƒœã‚¿ãƒ³
  $('#btnCalc').addEventListener('click', function(){ var vals=collect(); if(!vals) return; render(vals); });
  $('#btnReset').addEventListener('click', function(){
    $$('input[type="radio"]').forEach(function(i){i.checked=false;});
    pbar.style.width='0%'; ptext.textContent='0 / 20';
    res.style.display='none'; head.innerHTML=''; allBox.innerHTML=''; heroCopy.textContent=''; quick.innerHTML='';
    $('#btnCalc').disabled=true;
  });

  // ä¿å­˜æ©Ÿèƒ½
  $('#btnSave').addEventListener('click', function(){
    try{
      if(window.html2canvas){
        var node = document.getElementById('resultCard');
        html2canvas(node,{scale:2,backgroundColor:'#ffffff'}).then(function(cv){
          var a=document.createElement('a'); a.href=cv.toDataURL('image/png'); a.download='ramen-health-result.png'; a.click();
        });
      } else { window.print(); }
    }catch(e){ window.print(); }
  });
  $('#btnPrint').addEventListener('click', function(){ window.print(); });
})();
</script>
<script>
/* ============================================================
   è¨ºæ–­ãƒšãƒ¼ã‚¸å…±é€šã‚¹ãƒ‹ãƒšãƒƒãƒˆï¼ˆã‚³ãƒ”ãƒšç”¨ï¼‰
   1) å›ç­”ã®è‡ªå‹•ä¿å­˜ãƒ»è‡ªå‹•å¾©å…ƒï¼ˆå…¥åŠ›ä¸­ã‚‚é€æ¬¡ä¿å­˜ï¼‰
   2) çµæœè¡¨ç¤ºã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ã€Œæ¸ˆã€ï¼‹ ã‚ãªãŸã®Lv +1
   3) ã¿ã‚“ãªã®ã“ã“ã‚Lvï¼ˆCountAPIï¼‰ã« +1ï¼ˆå¤±æ•—ã¯ç„¡è¦–ï¼‰
   ------------------------------------------------------------
   â˜…ç½®ãå ´æ‰€ï¼šå„è¨ºæ–­HTMLã® </body> ã®ç›´å‰
   â˜…ãƒšãƒ¼ã‚¸IDï¼š<body data-id="xxxxx"> ã‚’æ¨å¥¨ï¼ˆæœªè¨­å®šã§ã‚‚å‹•ä½œï¼‰
============================================================ */
(function(){
  'use strict';

  // ===== å›ºå®šã‚­ãƒ¼ï¼šindex.html ã¨åˆã‚ã›ã¦ã‚ã‚Šã¾ã™ =====
  var DONE_KEY   = 'specimens:open:byid';   // è¨ºæ–­ã”ã¨ã®ã€Œæ¸ˆã€ãƒãƒƒãƒ—
  var TOTAL_KEY  = 'specimens:open:total';  // ã‚ãªãŸã®ã“ã“ã‚Lvï¼ˆåˆè¨ˆï¼‰
  var GLOBAL_LAST= 'specimens:open:global:last'; // ã¿ã‚“ãªã®Lvã®å‰å›è¡¨ç¤ºã‚­ãƒ£ãƒƒã‚·ãƒ¥

  // ===== ã“ã®ãƒšãƒ¼ã‚¸ã®ID =====
  var MY_ID = (document.body && document.body.getAttribute('data-id')) || 'unknown';

  // ===== å›ç­”ä¿å­˜ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ï¼ˆã“ã®è¨ºæ–­ã ã‘ã®ç®±ï¼‰ =====
  var ANSWER_KEY = 'specimens:answers:' + MY_ID;

  // ===== ã¿ã‚“ãªã®Lvï¼ˆCountAPIè¨­å®šï¼‰ =====
  var COUNTAPI_NS  = 'haisuikounozarigani_shindan';
  var COUNTAPI_KEY = 'specimens_open_total';
  function countapiHit(){
    var url = 'https://api.countapi.xyz/hit/'+COUNTAPI_NS+'/'+COUNTAPI_KEY;
    if(navigator.sendBeacon){
      try{ navigator.sendBeacon(url); }catch(_){}
    }else{
      fetch(url, {mode:'cors', cache:'no-store', keepalive:true}).catch(function(){});
    }
  }

  // ---------- å›ç­”ã®ä¿å­˜/å¾©å…ƒ ----------
  function loadState(){
    try{ return JSON.parse(localStorage.getItem(ANSWER_KEY) || '{}'); }catch(_){ return {}; }
  }
  function saveState(obj){
    try{ localStorage.setItem(ANSWER_KEY, JSON.stringify(obj)); }catch(_){}
  }
  function saveField(el){
    if(!el || !el.name) return;
    var st = loadState();
    var nm = el.name;

    if(el.type === 'radio'){
      // ãƒ©ã‚¸ã‚ªã¯é¸ã°ã‚ŒãŸ value ã‚’ä¿å­˜
      var chosen = (el.form || document).querySelector('input[type="radio"][name="'+nm+'"]:checked');
      st[nm] = chosen ? {t:'r', v: chosen.value} : {t:'r', v:null};
    }else if(el.type === 'checkbox'){
      // ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã¯åŒåã‚°ãƒ«ãƒ¼ãƒ—ã®ãƒã‚§ãƒƒã‚¯æ¸ˆã¿ value é…åˆ—
      var all = (el.form || document).querySelectorAll('input[type="checkbox"][name="'+nm+'"]');
      var vals = [];
      all.forEach(function(c){ if(c.checked) vals.push(c.value || 'on'); });
      st[nm] = {t:'c', v: vals};
    }else if(el.tagName==='SELECT'){
      if(el.multiple){
        var arr=[]; [].slice.call(el.options).forEach(function(o){ if(o.selected) arr.push(o.value); });
        st[nm] = {t:'m', v: arr};
      }else{
        st[nm] = {t:'s', v: el.value};
      }
    }else{
      // text / number / textarea ãªã©
      st[nm] = {t:'t', v: el.value};
    }
    saveState(st);
  }
  function restoreOnce(){
    var st = loadState();
    var names = Object.keys(st);
    if(!names.length) return false;

    names.forEach(function(nm){
      var info = st[nm]; if(!info) return;

      if(info.t==='r'){
        var r = document.querySelector('input[type="radio"][name="'+nm+'"][value="'+CSS.escape(String(info.v))+'"]');
        if(r){ r.checked = true; r.dispatchEvent(new Event('change',{bubbles:true})); }
      }else if(info.t==='c'){
        var all = document.querySelectorAll('input[type="checkbox"][name="'+nm+'"]');
        var set = new Set(info.v||[]);
        all.forEach(function(c){ c.checked = set.has(c.value || 'on'); });
      }else if(info.t==='m'){
        var sel = document.querySelector('select[name="'+nm+'"]');
        if(sel){
          var setm = new Set(info.v||[]);
          [].slice.call(sel.options).forEach(function(o){ o.selected = setm.has(o.value); });
        }
      }else if(info.t==='s'){
        var s = document.querySelector('select[name="'+nm+'"]');
        if(s){ s.value = info.v; }
      }else{
        var t = document.querySelector('[name="'+nm+'"]');
        if(t){ t.value = info.v==null? '' : String(info.v); }
      }
    });
    // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ç­‰ã‚’æ›´æ–°ã—ãŸã„UIã®ãŸã‚ã€è»½ã change ã‚’æŠ•ã’ã‚‹
    try{
      document.dispatchEvent(new Event('change', {bubbles:true}));
    }catch(_){}
    return true;
  }
  // å…¥åŠ›ç›£è¦–ï¼ˆä¿å­˜ï¼‰
  document.addEventListener('change', function(e){
    var el = e.target;
    if(!(el instanceof HTMLElement)) return;
    if(el.matches('input[name], select[name], textarea[name]')) saveField(el);
  }, true);
  document.addEventListener('input', function(e){
    var el = e.target;
    if(!(el instanceof HTMLElement)) return;
    if(el.matches('input[type="text"][name], input:not([type])[name], textarea[name]')) saveField(el);
  }, true);

  // å¾©å…ƒã¯ã€Œå…¥åŠ›ãŒæç”»ã•ã‚Œã¦ã‹ã‚‰ã€ä¸€åº¦ã ã‘è©¦ã¿ã‚‹ï¼ˆå‹•çš„ç”Ÿæˆã«ã‚‚å¯¾å¿œï¼‰
  (function restoreWhenReady(){
    var TRY_MAX=12, tries=0;
    function tick(){
      tries++;
      // å…¥åŠ›ãŒä¸€ã¤ã§ã‚‚è¦‹ã¤ã‹ã£ã¦ã‹ã‚‰å¾©å…ƒ
      var hasAny = document.querySelector('input[name], select[name], textarea[name]');
      if(hasAny){
        restoreOnce(); return;
      }
      if(tries<TRY_MAX){ setTimeout(tick, 300); }
    }
    if(document.readyState==='complete' || document.readyState==='interactive'){ tick(); }
    else document.addEventListener('DOMContentLoaded', tick);
  })();

  // ãƒªã‚»ãƒƒãƒˆç³»ãƒœã‚¿ãƒ³ãŒã‚ã‚Œã°ä¿å­˜ã‚‚å‰Šé™¤ï¼ˆ#btnReset / data-role="reset" ã‚’æƒ³å®šï¼‰
  function clearAnswers(){
    try{ localStorage.removeItem(ANSWER_KEY); }catch(_){}
  }
  document.addEventListener('click', function(e){
    var t = e.target;
    if(!(t instanceof HTMLElement)) return;
    if(t.id==='btnReset' || t.matches('[data-role="reset"]')) clearAnswers();
  }, true);

  // ---------- çµæœç¢ºå®šã§ã€Œæ¸ˆã€ï¼‹LvåŠ ç®— ----------
  var marked = false;
  function markOnce(){
    if(marked) return; marked = true;
    try{
      // 1) ã‚ãªãŸã®ã“ã“ã‚Lv åˆè¨ˆ +1
      var total = (+localStorage.getItem(TOTAL_KEY) || 0) + 1;
      localStorage.setItem(TOTAL_KEY, String(total));

      // 2) ã“ã®è¨ºæ–­ã®ã€Œæ¸ˆã€ã‚’ +1ï¼ˆä»–ã‚¿ãƒ–å³æ™‚åæ˜ ç”¨ã«ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—æ··ãœã‚‹ï¼‰
      var map={}; try{ map = JSON.parse(localStorage.getItem(DONE_KEY) || '{}'); }catch(_){}
      map[MY_ID] = (map[MY_ID] || 0) + 1;
      localStorage.setItem(DONE_KEY, JSON.stringify(Object.assign({}, map, {_ts: Date.now()})));

      // 3) ã¿ã‚“ãªã®ã“ã“ã‚Lv +1ï¼ˆè¡¨ç¤ºã¯ index å´ã§å–å¾—ï¼ã“ã“ã§ã¯é€ã‚‹ã ã‘ï¼‰
      countapiHit();
      // ã¤ã„ã§ã«å‰å›ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚‚+1ï¼ˆindexåˆæœŸè¡¨ç¤ºã®è¦‹æ „ãˆæ”¹å–„ï¼‰
      try{
        var last = (+localStorage.getItem(GLOBAL_LAST) || 0) + 1;
        localStorage.setItem(GLOBAL_LAST, String(last));
      }catch(_){}
    }catch(_){}
  }

  // A) çµæœãŒæç”»ã•ã‚ŒãŸåˆå›³ï¼ˆæ¨å¥¨ï¼šå„ãƒšãƒ¼ã‚¸ã®é›†è¨ˆå®Œäº†æ™‚ã« dispatch ã—ã¦ãã ã•ã„ï¼‰
  //   ä¾‹ï¼‰document.dispatchEvent(new Event('result:ready'));
  document.addEventListener('result:ready', markOnce);

  // B) ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼šçµæœUIãŒè¦‹ãˆã¦ã‹ã‚‰2ç§’å¾Œã«ä¸€åº¦ã ã‘å®Ÿè¡Œï¼ˆæˆ»ã‚‹ç„¡ã—ã§ã‚‚ç¢ºå®Ÿã«ã€Œæ¸ˆã€ï¼‰
  setTimeout(markOnce, 2000);
})();
</script>
</body>
</html>