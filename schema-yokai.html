<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ã‚¹ã‚­ãƒ¼ãƒå¦–æ€ª è¨ºæ–­ï¼ˆ20é …ç›®ãƒ»5ä»¶æ³•ï¼‰</title>
<meta name="description" content="ã‚¨ãƒ³ã‚¿ãƒ¡ç”¨ã‚»ãƒ«ãƒ•ãƒã‚§ãƒƒã‚¯ã€‚20é …ç›®ãƒ»0ã€œ4ã§ç­”ãˆã‚‹ã¨ã€ã‚ãªãŸã®ä¸­ã§é¡”ã‚’å‡ºã—ã‚„ã™ã„â€œã‚¹ã‚­ãƒ¼ãƒå¦–æ€ªâ€ã‚’å¯è¦–åŒ–ã—ã¾ã™ã€‚åŒ»ç™‚ç›®çš„ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚">
<meta name="theme-color" content="#fff7fd">
<style>
  :root{
    --bg1:#fff7fd; --bg2:#f5f7ff; --paper:#fff; --ink:#14131a; --muted:#6b6a77;
    --line:#ece4f2; --accent:#8c6bff; --accent2:#ff8fc7;
  }
  *{box-sizing:border-box} html,body{height:100%}
  body{margin:0;color:var(--ink);font-family:"Noto Sans JP",system-ui,-apple-system,Segoe UI,Roboto,"Hiragino Kaku Gothic ProN","Yu Gothic UI","YuGothic",Meiryo,sans-serif;background:linear-gradient(160deg,var(--bg1),var(--bg2));line-height:1.85;letter-spacing:.02em}
  header{position:sticky;top:0;z-index:5;background:rgba(255,255,255,.88);backdrop-filter:saturate(1.1) blur(8px);border-bottom:1px solid var(--line)}
  header .in{max-width:960px;margin:auto;padding:12px 16px;display:flex;gap:12px;align-items:center}
  h1{font-size:18px;margin:0;font-weight:800}
  .crumb{margin-left:auto;color:var(--muted);font-size:12px}

  main{max-width:960px;margin:0 auto;padding:22px 16px 120px}
  .panel{background:var(--paper);border:1px solid var(--line);border-radius:16px;padding:16px;box-shadow:0 10px 28px rgba(0,0,0,.06)}
  .lead{color:var(--muted);margin-top:6px}
  .q{border-top:1px solid var(--line);padding:12px 0}
  .q:first-child{border-top:0}
  .q .ttl{font-weight:700}
  .scale{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
  .opt{flex:1 1 180px;min-width:160px;border:1px solid var(--line);border-radius:12px;padding:8px 10px;display:flex;gap:8px;align-items:center;background:#fff;cursor:pointer}
  .opt input{accent-color:var(--accent)}
  .muted{color:var(--muted)}
  .progress{display:flex;align-items:center;gap:10px;margin-top:12px}
  .bar{flex:1;height:8px;background:#f0ecfb;border-radius:999px;overflow:hidden}
  .bar > i{display:block;height:100%;width:0;background:linear-gradient(90deg,var(--accent),var(--accent2));transition:width .25s ease}
  .actions{display:flex;gap:10px;margin-top:14px;flex-wrap:wrap}
  .btn{appearance:none;border:1px solid var(--line);background:linear-gradient(180deg,#fff,#f7f7fb);padding:10px 14px;border-radius:12px;cursor:pointer;font-weight:700}
  .btn.primary{background:linear-gradient(90deg,var(--accent),var(--accent2));color:#fff;border-color:transparent}
  .btn[disabled]{opacity:.55;cursor:not-allowed}

  /* Results */
  /* ç¸¦é•·ã‚¤ãƒ©ã‚¹ãƒˆç”¨ï¼š3:4æ ã«åã‚ã‚‹ï¼ˆã¯ã¿å‡ºã•ãšä¸­å¤®å¯„ã›ï¼‰ */
.y-ill{
  margin:8px auto;
  border:1px solid var(--line);
  border-radius:12px;
  background:#fff;
  max-width:520px;                /* ã‚¹ãƒãƒ›ã§ã‚‚PCã§ã‚‚å·¨å¤§åŒ–ã—ãªã„ä¸Šé™ */
  aspect-ratio:3/4;               /* ç¸¦é•·æ  */
  display:grid; place-items:center;
  overflow:hidden;                /* ã¯ã¿å‡ºã—é˜²æ­¢ */
}
.y-ill > img{
  width:100%; height:100%;
  object-fit:contain;             /* ç”»åƒã¯ãƒˆãƒªãƒŸãƒ³ã‚°ã›ãšå…¨ä½“è¡¨ç¤º */
  display:block;
}
  /* ğŸ“Š sticky progressï¼ˆä¸Šéƒ¨å›ºå®šï¼‰ */
.sticky{
  position:sticky; top:0; z-index:20;
  margin:-6px 0 12px; padding:8px 12px;
  background:rgba(255,255,255,.88);
  backdrop-filter:blur(6px) saturate(1.05);
  border-bottom:1px solid var(--line);
  display:flex; gap:10px; align-items:center;
}
.sticky .bar{ flex:1; height:8px }
.sticky .bar>i{ display:block; height:100%; width:0;
  background:linear-gradient(90deg,var(--accent),var(--accent2));
  transition:width .25s ease;
}

/* Results */
  #result{margin-top:18px;display:none}
  .yokai-top{display:grid;grid-template-columns:1fr;gap:12px}
  .card{border:1px solid var(--line);border-radius:14px;padding:12px;background:#fff}
  .card .name{font-weight:800}
  .tag{display:inline-block;margin-left:8px;padding:2px 8px;border-radius:999px;border:1px solid var(--line);font-size:12px;background:#fff}
  .score{font-variant-numeric:tabular-nums}
  .tips li{margin-left:1.2em}
  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:10px;margin-top:10px}
  .small{font-size:.95em}
  .warn{margin-top:14px;border:1px dashed #e5c2d6;background:#fff5fa;color:#432; padding:10px;border-radius:12px}
  .warn strong{color:#b12a6b}
  @media (max-width:380px){ .opt{min-width:unset} }
</style>
</head>
<body data-id="schema-yokai">
<header><div class="in">
  <h1>ã‚¹ã‚­ãƒ¼ãƒå¦–æ€ª è¨ºæ–­</h1>
  <span class="crumb">20é …ç›®ãƒ»0ã€œ4 â†’ ä¸Šä½ã®â€œå¦–æ€ªâ€ã‚’è¡¨ç¤º</span>
</div></header>

<main>
  <!-- sticky progress -->
  <div class="sticky" aria-live="polite">
    <div class="bar" aria-label="å›ç­”é€²æ—"><i id="pbar"></i></div>
    <div id="ptext" class="muted">0 / 20</div>
  </div>
  <section class="panel" id="quiz">
    <div>
      <div class="ttl"><strong>ã‚ãªãŸã®ä¸­ã§â€œé¡”ã‚’å‡ºã—ã‚„ã™ã„å¦–æ€ªâ€</strong>ã‚’ã‚†ã‚‹ã£ã¨å¯è¦–åŒ–ã—ã¾ã™ã€‚</div>
      <p class="lead">ç­”ãˆæ–¹ï¼ˆ0ã€œ4ï¼‰ï¼š0 ã¾ã£ãŸãå½“ã¦ã¯ã¾ã‚‰ãªã„ï¼1 å°‘ã—ï¼2 ã¨ãã©ãï¼3 ã‚ˆãï¼4 ã»ã¨ã‚“ã©ã„ã¤ã‚‚</p>
      <p class="warn"><strong>æ³¨æ„ï¼š</strong>ã“ã®è¨ºæ–­ã¯ã‚¨ãƒ³ã‚¿ãƒ¡ç”¨ã®ã‚»ãƒ«ãƒ•ãƒã‚§ãƒƒã‚¯ã§ã™ã€‚åŒ»ç™‚ãƒ»è¨ºæ–­ãƒ»æ²»ç™‚ã‚’ç›®çš„ã¨ã—ãŸã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã”åˆ©ç”¨ã¯è‡ªå·±åˆ¤æ–­ãƒ»è‡ªå·±è²¬ä»»ã§ã€‚å¿ƒèº«ã®ä¸èª¿ãŒç¶šãå ´åˆã¯åŒ»ç™‚æ©Ÿé–¢ã‚„å°‚é–€å®¶ã«ã”ç›¸è«‡ãã ã•ã„ã€‚</p>
    </div>


    <div id="qbox"></div>

  <div class="actions">
  <button id="btnCalc" class="btn primary" disabled>çµæœã‚’è¦‹ã‚‹</button>
  <button id="btnReset" class="btn" type="button">ãƒªã‚»ãƒƒãƒˆ</button>
  <a href="/shindan/" class="btn linklike" role="button">è¨ºæ–­ä¸€è¦§ã«æˆ»ã‚‹</a>
</div>

    <div id="result" class="panel">
    	
<section>
      <h2 style="margin:0 0 4px;font-size:18px">çµæœ</h2>
      <p class="lead" id="topLead">ã‚ãªãŸã®ä¸­ã§ä»Šã€é¡”ã‚’å‡ºã—ã‚„ã™ã„å¦–æ€ªãŸã¡</p>

      <!-- ä¸Šä½è¡¨ç¤º -->
      <div class="yokai-top" id="topCards"></div>

      <!-- ä¸€è¦§ï¼ˆã‚¹ã‚³ã‚¢ï¼†å‡ºæ²¡åº¦ï¼‰ -->
      <h3 style="margin:14px 0 6px;font-size:16px">å…¨ä½“ã®æ§˜å­</h3>
      <div class="grid" id="allCards"></div>

      <p class="warn small">â€» è¡¨ç¤ºã¯ã‚»ãƒ«ãƒ•ã‚±ã‚¢ã®ç›®å®‰ã§ã™ã€‚ã‚¹ã‚³ã‚¢ãŒé«˜ã„ï¼æ‚ªã„ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚çŠ¶æ³ã‚„è³‡è³ªã®è¡¨ã¨è£ã¨ã—ã¦æ‰±ã£ã¦ãã ã•ã„ã€‚</p>
    </div>
    
    <section class="panel small" id="legal-note" style="margin-top:12px">
  <h3 style="margin:6px 0;font-size:15px">ã”åˆ©ç”¨ã«ã‚ãŸã£ã¦</h3>
  <ul class="small muted" style="margin:6px 0 0 1.2em;line-height:1.8">
    <li><strong>éææºãƒ»éå…¬å¼ï¼š</strong>ã€Œã‚¹ã‚­ãƒ¼ãƒã€ã€Œã‚¹ã‚­ãƒ¼ãƒç™‚æ³•ã€ç­‰ã¸ã®è¨€åŠã¯ç ”ç©¶ä¸€èˆ¬ã®èª¬æ˜ã§ã‚ã‚Šã€æ¨©åˆ©è€…ã®æ‰¿èªãƒ»ææºãƒ»æ¨å¥¨ã‚’æ„å‘³ã—ã¾ã›ã‚“ã€‚æœ¬ãƒšãƒ¼ã‚¸ã®è¨­å•ãƒ»é…ç‚¹ãƒ»çµæœè¡¨ç¾ã¯å½“ã‚µã‚¤ãƒˆã®<strong>ç‹¬è‡ªåˆ¶ä½œ</strong>ã§ã€å…¬å¼ã®è³ªå•ç¥¨ï¼ˆä¾‹ï¼šYoung Schema Questionnaire ç­‰ï¼‰ã‚„æ¡ç‚¹æ–¹æ³•ã¯ä½¿ç”¨ã—ã¦ã„ã¾ã›ã‚“ã€‚</li>
    <li><strong>åŒ»ç™‚ç”¨é€”ã§ã¯ã‚ã‚Šã¾ã›ã‚“ï¼š</strong>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¯å¨¯æ¥½ï¼‹è‡ªå·±ç†è§£ã®ãŸã‚ã®ã‚»ãƒ«ãƒ•ãƒã‚§ãƒƒã‚¯ã§ã‚ã‚Šã€åŒ»ç™‚çš„ãªè¨ºæ–­ãƒ»æ²»ç™‚ãƒ»åŠ©è¨€ã‚’ç›®çš„ã¨ã—ã¾ã›ã‚“ã€‚å¼·ã„è‹¦ç—›ã‚„ä¸èª¿ãŒç¶šãå ´åˆã¯ã€åŒ»ç™‚æ©Ÿé–¢ã‚„å°‚é–€å®¶ã«ã”ç›¸è«‡ãã ã•ã„ã€‚</li>
    <li><strong>ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ï¼š</strong>å›ç­”ã¯ç«¯æœ«å†…ã§å‡¦ç†ãƒ»ä¿å­˜ã•ã‚Œã€å›ç­”å†…å®¹ã‚„å€‹äººã‚’ç‰¹å®šã§ãã‚‹æƒ…å ±ã¯ã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡ã•ã‚Œã¾ã›ã‚“ã€‚çµæœè¡¨ç¤ºæ™‚ã«åŒ¿åã®ä»¶æ•°ã‚«ã‚¦ãƒ³ãƒˆã®ã¿é€ä¿¡ã™ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚</li>
    <li><strong>è¡¨ç¾ã«ã¤ã„ã¦ï¼š</strong>ã€Œå¦–æ€ªã€ã¯å‰µä½œä¸Šã®æ¯”å–©ã§ã™ã€‚å®Ÿåœ¨ã®æ°‘ä¿—ãƒ»å›£ä½“ç­‰ã‚’æ¶æ„ã™ã‚‹æ„å›³ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</li>
    <li><strong>å…è²¬ï¼š</strong>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®åˆ©ç”¨ã«ã‚ˆã‚Šç”Ÿã˜ãŸã„ã‹ãªã‚‹æå¤±ãƒ»æå®³ã«ã¤ã„ã¦ã‚‚ã€å½“ã‚µã‚¤ãƒˆã¯è²¬ä»»ã‚’è² ã„ã¾ã›ã‚“ã€‚</li>
  </ul>
    
  </section>
</main>

<script>
(()=> {
  // ===== è¨­å•ï¼ˆ20ï¼‰ =====
  const ITEMS = [
    {k:1,  t:'100ç‚¹ã˜ã‚ƒãªã„ã¨ãƒ¢ãƒ¤ãƒ¢ãƒ¤ã—ã‚„ã™ã„ã€‚'},
    {k:2,  t:'äººã‹ã‚‰ã®è©•ä¾¡ã‚„ã€Œã„ã„ã­ã€ãŒæ°—ã«ãªã£ã¦ä»•æ–¹ãªã„ã€‚'},
    {k:3,  t:'ã¤ã‚‰ã„æ°—æŒã¡ã¯è„‡ã«ç½®ã„ã¦ã€æ„Ÿã˜ãªã„ãµã‚Šã§é€²ã‚ãŒã¡ã€‚'},
    {k:4,  t:'èª°ã‹ã«ç”˜ãˆãŸã‚Šå¯„ã‚Šã‹ã‹ã£ãŸã‚Šã™ã‚‹ã®ãŒè‹¦æ‰‹ã ã€‚'},
    {k:5,  t:'è¦ªåˆ‡ã®è£ã‚’èª­ã‚“ã§ã—ã¾ã„ã€ç´ ç›´ã«å—ã‘å–ã‚Šã«ãã„ã€‚'},
    {k:6,  t:'è¤’ã‚ã‚‰ã‚Œã¦ã‚‚ã€ŒãŸã¾ãŸã¾ã€ã¨æ€ã„ãŒã¡ã ã€‚'},
    {k:7,  t:'ã¿ã‚“ãªã®è¼ªã«å…¥ã£ã¦ã‚‚ã€ã©ã“ã‹å¤–å´ã«ã„ã‚‹æ„Ÿã˜ãŒã™ã‚‹ã€‚'},
    {k:8,  t:'å°ã•ãªå¤±æ•—ã§ã‚‚ã€å…¨éƒ¨ãŒãƒ€ãƒ¡ã«ãªã‚‹æ°—ãŒã—ã¦èº«æ§‹ãˆã‚‹ã€‚'},
    {k:9,  t:'è‡ªåˆ†ã®éƒ½åˆã‚’é€šã—ãŸããªã‚Šã€é †ç•ªã‚„ãƒ«ãƒ¼ãƒ«ã‚’é£›ã°ã—ãŸããªã‚‹ã“ã¨ãŒã‚ã‚‹ã€‚'},
    {k:10, t:'ã¤ã„ä»–äººã‚’å„ªå…ˆã—ã¦ã€è‡ªåˆ†ã®ç•ªã‚’å¾Œå›ã—ã«ã—ã¦ã—ã¾ã†ã€‚'},
    {k:11, t:'äºˆå®šãŒå°‘ã—ã§ã‚‚å´©ã‚Œã‚‹ã¨ã€ã‚„ã‚Šç›´ã—ãŸããªã£ã¦æ­¢ã¾ã‚‹ã€‚'},
    {k:12, t:'ç„¡è¦–ã•ã‚ŒãŸã‹ã‚‚â€¦ã¨åå¿œãŒé…ã„ã ã‘ã§ã‚‚ä¸å®‰ã«ãªã‚‹ã€‚'},
    {k:13, t:'æ³£ããŸã„æ™‚ã§ã‚‚ã€Œå¹³æ°—ã€ã‚’è£…ã£ã¦ã—ã¾ã†ã€‚'},
    {k:14, t:'è¦ªã—ã„äººã«ã‚‚æœ¬éŸ³ã‚’é ¼ã‚‹ã‚ˆã‚Šã€é»™ã£ã¦è€ãˆã‚‹ã“ã¨ãŒå¤šã„ã€‚'},
    {k:15, t:'è¤’ã‚è¨€è‘‰ã‚’ãã®ã¾ã¾ä¿¡ã˜ã‚‰ã‚Œãªã„ã€‚è£ãŒã‚ã‚‹æ°—ãŒã™ã‚‹ã€‚'},
    {k:16, t:'è‡ªåˆ†ã®æ¬ ç‚¹ãŒç›®ã«ã¤ã„ã¦ã€é­…åŠ›ã‚ˆã‚Šå…ˆã«æµ®ã‹ã¶ã€‚'},
    {k:17, t:'èª˜ã‚ã‚Œã¦ã‚‚æ–­ã£ã¦ã—ã¾ã„ã€ã‚ã¨ã§å¾Œæ‚”ã™ã‚‹ã“ã¨ãŒã‚ã‚‹ã€‚'},
    {k:18, t:'å…ˆã®å¿ƒé…ã‚’è†¨ã‚‰ã¾ã›ã¦â€œæœ€æ‚ªâ€ã‚’æƒ³åƒã—ã‚„ã™ã„ã€‚'},
    {k:19, t:'æ¸‹æ»ã‚„è¡Œåˆ—ã§ã€Œè‡ªåˆ†ã ã‘ã§ã‚‚å…ˆã«â€¦ã€ã¨ã„ã†æ°—æŒã¡ãŒæ¹§ãã€‚'},
    {k:20, t:'æ–­ã‚‹ã¨ç½ªæ‚ªæ„ŸãŒå¼·ãã€è‡ªåˆ†ã®ç”¨äº‹ã‚’ã¤ã¶ã—ãŒã¡ã ã€‚'},
  ];
  const SCALE = [
    {v:0, label:'0 ã¾ã£ãŸãå½“ã¦ã¯ã¾ã‚‰ãªã„'},
    {v:1, label:'1 å°‘ã—å½“ã¦ã¯ã¾ã‚‹'},
    {v:2, label:'2 ã¨ãã©ãå½“ã¦ã¯ã¾ã‚‹'},
    {v:3, label:'3 ã‚ˆãå½“ã¦ã¯ã¾ã‚‹'},
    {v:4, label:'4 ã»ã¨ã‚“ã©ã„ã¤ã‚‚å½“ã¦ã¯ã¾ã‚‹'},
  ];

  // ===== ã‚¹ã‚­ãƒ¼ãƒå¦–æ€ªå®šç¾©ï¼ˆ2é …ç›®=æº€ç‚¹8ï¼‰ =====
  const YOKAI = [
    {key:'tengu',   name:'å¤©ç‹—ï¼ˆå®Œç’§ä¸»ç¾©ï¼‰',        items:[1,11],
      catch:'100ç‚¹ä»¥å¤–ã¯é€šã•ãªã„é–€ç•ªã€‚',
      desc:'åŸºæº–ãŒé«˜ãã€ç´°éƒ¨ã¾ã§æ•´ãˆãªã„ã¨è½ã¡ç€ã‹ãªã„ã‚¿ã‚¤ãƒ—ã€‚è‰¯ã•ã¯â€œå“è³ªã®å®ˆè­·ç¥â€ã ã‘ã©ã€ç–²ã‚Œã‚„ã™ã•ã¨å…ˆå»¶ã°ã—ã‚’æ‹›ãã‚„ã™ã„ã€‚ã‚´ãƒ¼ãƒ«ã‚’ã€Œæº€ç‚¹ã€ã‹ã‚‰ã€Œç›®çš„ã«åˆã†ååˆ†ã€ã«èª¿æ•´ã§ãã‚‹ã¨ã€åŠ›ãŒé•·æŒã¡ã—ã¾ã™ã€‚',
      cbt:['ã€Œååˆ†ãƒ©ã‚¤ãƒ³ã€ã‚’ä¸€æ–‡ã§æ±ºã‚ã‚‹ï¼ˆä¾‹ï¼šä¼ã‚ã‚Œã°OKï¼‰ã€‚','ã‚ãˆã¦â€œ7å‰²æå‡ºâ€ã‚’ä¸€ã¤å…¥ã‚Œã¦ã€å›°ã‚Šã”ã¨ãŒèµ·ãã‚‹ã‹è¦³å¯Ÿã€‚','æ€è€ƒè¨˜éŒ²ï¼šã€Œä»Šã€ã©ã‚“ãªâ€œã¹ãâ€ãŒæµ®ã‹ã‚“ã ï¼Ÿã€â†’åè¨¼ã‚’ä¸€è¡Œã€‚']},
    {key:'rokuro',  name:'ã‚ãã‚é¦–ï¼ˆæ‰¿èªãƒ»è©•ä¾¡ï¼‰',  items:[2,12],
      catch:'é¦–ãŒä¼¸ã³ã¦ã€ä»–äººã®è¦–ç·šã‚’è¿½ã„ã‹ã‘ãŒã¡ã€‚',
      desc:'è©•ä¾¡ã‚„ã€Œã„ã„ã­ã€ã«æ°—æŒã¡ãŒæºã‚Œã‚„ã™ã„ã‚¿ã‚¤ãƒ—ã€‚å¤–éƒ¨ã®æ‹æ‰‹ã¯å¤§äº‹ã ã‘ã©ã€â€œè‡ªåˆ†ã®è©•ä¾¡è¡¨â€ãŒã‚¹ã‚«ã‚¹ã‚«ã ã¨ç–²ã‚Œã¾ã™ã€‚è¡Œå‹•ã®ä¾¡å€¤ã‚’ã€è‡ªåˆ†ã®è¨€è‘‰ã§æ¡ç‚¹ã—ç›´ã™ç¿’æ…£ãŒåŠ¹ãã¾ã™ã€‚',
      cbt:['ä»Šæ—¥ã®è¡Œå‹•ã‚’è‡ªåˆ†åŸºæº–ã§â˜…3ã¤æ¡ç‚¹ï¼ˆåŠªåŠ›ãƒ»å­¦ã³ãƒ»è¦ªåˆ‡ï¼‰ã€‚','SNSã®â€œè¦³å®¢â€æ™‚é–“ã‚’ã‚¿ã‚¤ãƒãƒ¼ã§åŒºåˆ‡ã‚‹ï¼ˆä¾‹ï¼š10åˆ†ï¼‰ã€‚','ã€Œä»–äººã®è©•ä¾¡ï¼å‚è€ƒã€è‡ªåˆ†ã®ä¾¡å€¤ï¼è‡ªåˆ†ãŒæ±ºã‚ã‚‹ã€ã¨æ›¸ã„ã¦è²¼ã‚‹ã€‚']},
    {key:'nurick',  name:'ã¬ã‚Šã‹ã¹ï¼ˆæ„Ÿæƒ…å›é¿ï¼‰',    items:[3,13],
      catch:'æ°—æŒã¡ãŒæ¥ã‚‹ã¨ã€ã™ã£ã¨å£ã«ãªã‚‹ã€‚',
      desc:'ã¤ã‚‰ã•ã‚’æ„Ÿã˜ãªã„ã‚ˆã†ã«â€œå¹³æ°—â€ã§æŠ¼ã—é€šã—ãŒã¡ãªã‚¿ã‚¤ãƒ—ã€‚çŸ­æœŸçš„ã«ã¯æ¥½ã ã‘ã©ã€æœªå‡¦ç†ã®æ„Ÿæƒ…ãŒæºœã¾ã‚Šã‚„ã™ã„ã€‚ã¾ãšã¯â€œæ„Ÿã˜ã¦åã¥ã‘ã‚‹â€å°ã•ãªç·´ç¿’ã‹ã‚‰ã€‚',
      cbt:['1åˆ†ã‚¹ã‚­ãƒ£ãƒ³ï¼šã€Œä»Šã¯ã€æ‚²/æ€’/ä¸å®‰/å–œ/ç–²ã€‘ã©ã‚ŒãŒä½•å‰²ï¼Ÿã€','æ„Ÿæƒ…ã«åå‰â†’è¡Œå‹•ã‚’1ã¤ï¼ˆä¾‹ï¼šä¸å®‰60%â†’æ·±å‘¼å¸Ã—3å›ï¼‰ã€‚','å›é¿ã—ãŸã„å ´é¢ã‚’â€œ10æ®µéšè¡¨â€ã«åˆ†ã‘ã€ä½ã„æ®µã‹ã‚‰å°‘ã—æ›éœ²ã€‚']},
    {key:'snow',    name:'é›ªå¥³ï¼ˆæƒ…ç·’ä¸è¶³ï¼‰',        items:[4,14],
      catch:'é ¼ã‚‹ã‚ˆã‚Šå‡ã‚‰ã›ã‚‹ã€‚',
      desc:'äººã«ç”˜ãˆã‚‹ãƒ»åŠ©ã‘ã‚’æ±‚ã‚ã‚‹ãŒè‹¦æ‰‹ã§ã€ä½•ã§ã‚‚è‡ªåˆ†ã§æŠ±ãˆãŒã¡ã€‚å¼·ã•ã¯ç¾ç‚¹ã ã‘ã©ã€å­¤è»å¥®é—˜ã¯æ¶ˆè€—ã—ã¾ã™ã€‚â€œå°ã•ãé ¼ã‚€â€ã®æˆåŠŸä½“é¨“ãŒã€å¿ƒã®æ¸©åº¦ã‚’æˆ»ã—ã¾ã™ã€‚',
      cbt:['ç ‚ç³–ã²ã¨åŒ™ãƒ¬ãƒ™ãƒ«ã®ä¾é ¼ã‚’1ã¤ï¼ˆã€Œã“ã®å°ç­’ã ã‘æ¸¡ã—ã¦ã€ï¼‰ã€‚','Iãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç·´ç¿’ï¼šã€Œç§ã¯ä»Šã“ã“ãŒé›£ã—ã„ã€‚æ‰‹ä¼ã£ã¦ã‚‚ã‚‰ãˆã‚‹ï¼Ÿã€','å—ã‘å–ã£ãŸè¦ªåˆ‡ã‚’ãƒ¡ãƒ¢ã—ã¦â€œå€Ÿã‚Šâ€ã§ã¯ãªãâ€œå¾ªç’°â€ã¨ãƒ©ãƒ™ãƒ«æ›¿ãˆã€‚']},
    {key:'fox',     name:'åŒ–ã‘ç‹ï¼ˆä¸ä¿¡ãƒ»è­¦æˆ’ï¼‰',    items:[5,15],
      catch:'è£ã‚’èª­ã¿ã™ãã¦ã€ç¬‘é¡”ã«ã‚‚ç½ ã‚’æ„Ÿã˜ã‚‹ã€‚',
      desc:'äººã®å–„æ„ã‚’ä¿¡ã˜ã«ããã€ã¾ãšç–‘ã£ã¦ã—ã¾ã†ã‚¿ã‚¤ãƒ—ã€‚èº«ã‚’å®ˆã‚‹çŸ¥æµã§ã‚‚ã‚ã‚‹ã‘ã‚Œã©ã€é–¢ä¿‚ãŒç´°ã‚Šã‚„ã™ã„ã€‚ç™½é»’ã®é–“ã«â€œã‚°ãƒ¬ãƒ¼ã®è¨¼æ‹ â€ã‚’é›†ã‚ã‚‹ã¨ã€å¿ƒãŒã»ã©ã‘ã¾ã™ã€‚',
      cbt:['æœ€è¿‘ã®â€œä¿¡ç”¨ã§ããŸå°ã•ãªäº‹å®Ÿâ€ã‚’3ã¤ãƒ¡ãƒ¢ã€‚','ä¿¡é ¼ã®æ®µéšãƒªã‚¹ãƒˆã‚’ä½œã‚Šã€ä½ãƒªã‚¹ã‚¯ã®ãŠé¡˜ã„ã‚’è©¦ã™ã€‚','è‡ªå‹•æ€è€ƒã€Œãã£ã¨è£ãŒâ€¦ã€â†’ç¢ºç‡è¦‹ç©ã‚Šâ†’ä»£æ¡ˆï¼ˆ50%â†’20%ãªã‚‰OKï¼‰ã€‚']},
    {key:'noppe',   name:'ã®ã£ãºã‚‰ã¼ã†ï¼ˆæ¥ãƒ»æ¬ é™¥æ„Ÿï¼‰',items:[6,16],
      catch:'é¡ã‚’è¦‹ã‚‹ã¨ã€æ¬ ç‚¹ã°ã‹ã‚Šã€‚',
      desc:'ã»ã‚è¨€è‘‰ã‚’å—ã‘å–ã‚Šã«ããã€å¼±ã¿ï¼è‡ªåˆ†ã®å…¨ä½“ã ã¨æ„Ÿã˜ã‚„ã™ã„ã€‚è¦–é‡ãŒâ€œæ¬ ç‚¹ã‚ºãƒ¼ãƒ â€ã«ãªã£ã¦ã„ã‚‹ã ã‘ã®ã“ã¨ãŒå¤šã„ã€‚äº‹å®Ÿãƒ™ãƒ¼ã‚¹ã§â€œç­‰èº«å¤§ã®è¼ªéƒ­â€ã‚’æãç›´ãã†ã€‚',
      cbt:['è‡ªåˆ†ã®é•·æ‰€ãƒ»è²¢çŒ®ã‚’â€œäº‹å®Ÿã¤ãâ€ã§3ã¤æ›¸ãã€‚','åè¨¼ã‚«ãƒ¼ãƒ‰ï¼šã€Œãã‚Œã§ã‚‚ç§ãŒã‚„ã‚Œã¦ã„ã‚‹æ ¹æ‹ ã¯ï¼Ÿã€ã‚’ä¸€è¡Œã€‚','é¡ã®å‰ã‚»ãƒ«ãƒ•ãƒˆãƒ¼ã‚¯ï¼šã€Œæ¬ ç‚¹ã¯ä¸€éƒ¨ã€ç§ã¯å…¨ä½“ã€ã€‚']},
    {key:'oneeye',  name:'ä¸€ã¤ç›®å°åƒ§ï¼ˆå­¤ç«‹æ„Ÿï¼‰',    items:[7,17],
      catch:'è¼ªã®å¤–ã«ç«‹ã£ã¦ã—ã¾ã†ã€‚',
      desc:'èª˜ã„ã‚’æ–­ã‚ŠãŒã¡ãƒ»è·é›¢ã‚’ã¨ã‚ŠãŒã¡ã§ã€ã‚ã¨ã§å¾Œæ‚”ã™ã‚‹ã“ã¨ã‚‚ã€‚â€œæ€¥ã«æ·±ãâ€ã‚ˆã‚Šâ€œè–„ãé•·ãâ€ãŒç¶šãã¾ã™ã€‚å¾®æ¥è§¦ã®ç©ã¿ä¸Šã’ãŒåŠ¹ãç›®æŠœç¾¤ã€‚',
      cbt:['æ¥è§¦ãƒãƒ¼ãƒ‰ãƒ«è¡¨ã‚’ä½œã‚Šã€æœ€ä¸‹æ®µã®è¡Œå‹•ã‚’ä»Šæ—¥ã²ã¨ã¤ï¼ˆä¼šé‡ˆ/æ—¢èª­è¿”ã—ï¼‰ã€‚','ä¼šè©±ã‚¹ã‚¿ãƒ¼ã‚¿ãƒ¼ã‚’3ã¤ã‚¹ãƒˆãƒƒã‚¯ï¼ˆå¤©æ°—/ç›¸æ‰‹ã®è¿‘æ³/ãŠç¤¼ï¼‰ã€‚','ã€Œ10å›ä¸­3å›ã§ååˆ†ã€ã‚’åˆè¨€è‘‰ã«ã€é‡ã‚’å…ˆã«ã€‚']},
    {key:'umibozu', name:'æµ·åŠä¸»ï¼ˆç ´å±€åŒ–ï¼‰',        items:[8,18],
      catch:'å°æ³¢ã‚’è¦‹ã¦ã€æ´¥æ³¢ã‚’æƒ³åƒã€‚',
      desc:'æœ€æ‚ªã®ã‚·ãƒŠãƒªã‚ªã‚’ç´ æ—©ãæã„ã¦ã—ã¾ã†ã‚¿ã‚¤ãƒ—ã€‚å‚™ãˆã®æ‰èƒ½ã§ã‚‚ã‚ã‚‹ã‘ã‚Œã©ã€ç–²å¼Šã‚‚ã—ã‚„ã™ã„ã€‚ç¢ºç‡ã¨å¯¾å‡¦ç­–ã‚’æ•°å­—ã§å‡ºã™ã¨ã€æƒ³åƒã®å·¨å¤§ã•ãŒç¸®ã¿ã¾ã™ã€‚',
      cbt:['æœ€æ‚ªã®ç¢ºç‡ã‚’ï¼…ã§æ¨å®šâ†’æ ¹æ‹ â†’åŠåˆ†ã«å†è¦‹ç©ã‚Šã€‚','ã€Œèµ·ããŸæ™‚ã®ãƒ—ãƒ©ãƒ³A/Bã€ã‚’å„2è¡Œã§ç”¨æ„ã€‚','åã™ã†åœæ­¢èªï¼šã€Œä»Šã¯â€œç›®ã®å‰ã®ä¸€æ‰‹â€ã«æˆ»ã‚‹ã€ã€‚']},
    {key:'nurari',  name:'ã¬ã‚‰ã‚Šã²ã‚‡ã‚“ï¼ˆç‰¹æ¨©ãƒ»è‡ªå·±ä¸­ï¼‰',items:[9,19],
      catch:'è‡ªåˆ†ã®é †ç•ªã ã‘ã€ã™ã‚‹ã‚Šã¨å‰ã¸ã€‚',
      desc:'è‡ªåˆ†ãƒ«ãƒ¼ãƒ«ã‚’å„ªå…ˆã—ã‚„ã™ãã€è¡å‹•ã§å‰²ã‚Šè¾¼ã¿ã‚„ã™ã„ã€‚è‡ªå·±ä¸»å¼µã®å¼·ã•è‡ªä½“ã¯è³‡è³ªã€‚è¦–ç‚¹å–ã‚Šã¨â€œå…±é€šãƒ«ãƒ¼ãƒ«â€ã®æ„è­˜ã‚’è¶³ã›ã°ã€å‘¨å›²ã¨å™›ã¿åˆã„ã¾ã™ã€‚',
      cbt:['ã€Œç›¸æ‰‹ã®ç«‹å ´ãªã‚‰ï¼Ÿã€ã‚’30ç§’ã ã‘æƒ³åƒã—ã¦ã‹ã‚‰è¡Œå‹•ã€‚','å…±é€šãƒ«ãƒ¼ãƒ«ã‚’æ›¸ãå‡ºã—ã€è‡ªåˆ†ã ã‘ã®ä¾‹å¤–ã‚’1ã¤æ¸›ã‚‰ã™ã€‚','è¡å‹•ã®åˆå›³ãŒæ¥ãŸã‚‰10ç§’åœæ­¢â†’ä»£æ›¿æ¡ˆã‚’1ã¤ã€‚']},
    {key:'zashiki', name:'åº§æ•·ç«¥å­ï¼ˆè‡ªå·±çŠ ç‰²ï¼‰',    items:[10,20],
      catch:'äººã®ç”¨äº‹ãŒæœ€å„ªå…ˆã€ã¤ã„è‡ªåˆ†ã¯å¾Œå›ã—ã€‚',
      desc:'å„ªã—ã•ãŒçœ‹æ¿ã€‚ã§ã‚‚â€œå¸¸ã«ä»–äººå„ªå…ˆâ€ã¯ã€é™ã‹ãªæ€’ã‚Šã¨ç–²ã‚Œã‚’å‘¼ã³ã¾ã™ã€‚â€œã‚„ã•ã—ã„NOâ€ã¨â€œè‡ªåˆ†ã®ç•ªâ€ã‚’äºˆå®šã«å…¥ã‚Œã‚‹ã®ãŒã‚³ãƒ„ã€‚',
      cbt:['NOãƒˆãƒ¬ï¼šã€Œä»Šã¯é›£ã—ã„ã‘ã©ã€æ¥é€±ãªã‚‰æ‰‹ä¼ãˆã‚‹ã€ã€‚','ä»Šæ—¥ã®äºˆå®šã«â€œè‡ªåˆ†ã®å›å¾©10åˆ†â€ã‚’å…ˆã«ç¢ºä¿ã€‚','å½¹å‰²ã®è¨€ã„æ›ãˆï¼šã€ŒçŠ ç‰²ã€â†’ã€Œé¸ã‚“ã§ä¸ãˆã‚‹ã€ã€‚']},
  ];
// === çµæœç”»åƒ ===
const IMG_BASE = '/shindan/assets/results/schema-yokai/';
const NUM_MAP = {
  tengu:'01',    // å¤©ç‹—
  rokuro:'02',   // ã‚ãã‚é¦–
  nurick:'03',   // ã¬ã‚Šã‹ã¹ï¼ˆã‚³ãƒ¼ãƒ‰ç¶´ã‚Šã«åˆã‚ã›ã‚‹ï¼‰
  snow:'04',     // é›ªå¥³
  fox:'05',      // åŒ–ã‘ç‹
  noppe:'06',    // ã®ã£ãºã‚‰ã¼ã†
  oneeye:'07',   // ä¸€ã¤ç›®å°åƒ§
  umibozu:'08',  // æµ·åŠä¸»
  nurari:'09',   // ã¬ã‚‰ã‚Šã²ã‚‡ã‚“
  zashiki:'10'   // åº§æ•·ã‚ã‚‰ã—/ç«¥å­
};
const imgFor = (key)=> `${IMG_BASE}${NUM_MAP[key]||'01'}.png`;
  // ===== DOM =====
  const $ = (q,root=document)=>root.querySelector(q);
  const $$ = (q,root=document)=>[...root.querySelectorAll(q)];
  const qbox = $('#qbox'), pbar = $('#pbar'), ptext = $('#ptext');
  const btnCalc = $('#btnCalc'), btnReset = $('#btnReset');
  const res = $('#result'), topCards = $('#topCards'), allCards = $('#allCards');

  // è³ªå•æç”»
  ITEMS.forEach(item=>{
    const s = document.createElement('section');
    s.className = 'q';
    s.innerHTML = `
      <div class="ttl">Q${item.k}. ${item.t}</div>
      <div class="scale" role="group" aria-label="Q${item.k}">
        ${SCALE.map(sc=>{
          const id = `q${item.k}-${sc.v}`;
          return `<label class="opt" for="${id}">
            <input type="radio" name="q${item.k}" id="${id}" value="${sc.v}">
            <span>${sc.label}</span>
          </label>`;
        }).join('')}
      </div>`;
    qbox.appendChild(s);
  });

  // é€²æ—
  function answeredCount(){ return ITEMS.filter(it => $('input[name="q'+it.k+'"]:checked')).length; }
  function updateProgress(){
    const n=answeredCount(), total=ITEMS.length;
    ptext.textContent = `${n} / ${total}`;
    pbar.style.width = Math.round(n/total*100)+'%';
    btnCalc.disabled = n!==total;
  }
  document.addEventListener('change', e=>{ if(e.target.name?.startsWith('q')) updateProgress(); });
  updateProgress();

  // é›†è¨ˆ
  function collect(){
    const vals={};
    for(const it of ITEMS){
      const el = $('input[name="q'+it.k+'"]:checked'); if(!el) return null;
      vals[it.k] = +el.value;
    }
    return vals;
  }
  function score(vals){
    return YOKAI.map(y=>{
      const s = (vals[y.items[0]]||0) + (vals[y.items[1]]||0);
      let level='å†¬çœ ä¸­', tag='low';
      if (s>=6) { level='ã‚ˆãé¡”ã‚’å‡ºã™'; tag='high'; }
      else if (s>=4) { level='ã¨ãã©ãå‡ºæ²¡ä¸­'; tag='mid'; }
      return {key:y.key, name:y.name, score:s, level, tag, catch:y.catch, desc:y.desc, cbt:y.cbt};
    }).sort((a,b)=>b.score-a.score);
  }

  // è¡¨ç¤º
  function el(tag, cls, html){ const x=document.createElement(tag); if(cls) x.className=cls; if(html!=null) x.innerHTML=html; return x; }

  function render(scored){
    // ä¸Šä½1ã€œ2ä½“
    topCards.innerHTML='';
    const top = scored.slice(0,2);
    top.forEach(({key,name,score,level,catch:ct,desc,cbt})=>{
      const card = el('article','card');
      card.innerHTML = `
        <div class="name">${name} <span class="tag score">åˆè¨ˆ ${score}/8</span> <span class="tag">${level}</span></div>
<figure class="y-ill">
  <img src="${imgFor(key)}" alt="${name} ã®ã‚¤ãƒ©ã‚¹ãƒˆ" loading="lazy">
</figure>
<p><strong>ã‚­ãƒ£ãƒƒãƒï¼š</strong>${ct}</p>
        <p>${desc}</p>
        <div><strong>ã‚»ãƒ«ãƒ•ã‚±ã‚¢ã®ãƒ’ãƒ³ãƒˆ</strong></div>
        <ul class="tips">${cbt.map(t=>`<li>${t}</li>`).join('')}</ul>
      `;
      topCards.appendChild(card);
    });

    // ä¸€è¦§
    allCards.innerHTML='';
    scored.forEach(({name,score,level,tag})=>{
      const card = el('div','card small');
      const color = tag==='high' ? 'linear-gradient(90deg,#8c6bff,#ff8fc7)' : (tag==='mid' ? '#efe9ff' : '#f7f7fb');
      const badgeStyle = tag==='high' ? 'color:#fff;border-color:transparent;background:linear-gradient(90deg,#8c6bff,#ff8fc7)' : '';
      card.innerHTML = `
        <div class="name" style="display:flex;align-items:center;gap:8px">
          <span>${name}</span>
          <span class="tag score" style="${badgeStyle}">${score}/8</span>
          <span class="tag">${level}</span>
        </div>
        <div class="meter" style="height:6px;background:#f0ecfb;border-radius:999px;overflow:hidden;margin-top:8px">
          <i style="display:block;height:100%;width:${(score/8*100).toFixed(0)}%;background:${color}"></i>
        </div>
      `;
      allCards.appendChild(card);
    });

    res.style.display='block';
res.scrollIntoView({behavior:'smooth',block:'start'});
try{ document.dispatchEvent(new Event('result:ready')); }catch(_){}
  }

  // ã‚¤ãƒ™ãƒ³ãƒˆ
  btnCalc.addEventListener('click', ()=>{
    const vals = collect(); if(!vals) return;
    const scored = score(vals);
    render(scored);
  });

  btnReset.addEventListener('click', ()=>{
    $$('input[type="radio"]').forEach(i=>i.checked=false);
    updateProgress();
    res.style.display='none';
  });
})();
</script>
<script>
/* ============================================================
   è¨ºæ–­ãƒšãƒ¼ã‚¸å…±é€šã‚¹ãƒ‹ãƒšãƒƒãƒˆï¼ˆã‚³ãƒ”ãƒšç”¨ï¼‰
   1) å›ç­”ã®è‡ªå‹•ä¿å­˜ãƒ»è‡ªå‹•å¾©å…ƒï¼ˆå…¥åŠ›ä¸­ã‚‚é€æ¬¡ä¿å­˜ï¼‰
   2) çµæœè¡¨ç¤ºã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ã€Œæ¸ˆã€ï¼‹ ã‚ãªãŸã®Lv +1
   3) ã¿ã‚“ãªã®ã“ã“ã‚Lvï¼ˆCountAPIï¼‰ã« +1ï¼ˆå¤±æ•—ã¯ç„¡è¦–ï¼‰
   ------------------------------------------------------------
   â˜…ç½®ãå ´æ‰€ï¼šå„è¨ºæ–­HTMLã® </body> ã®ç›´å‰
   â˜…ãƒšãƒ¼ã‚¸IDï¼š<body data-id="xxxxx"> ã‚’æ¨å¥¨ï¼ˆæœªè¨­å®šã§ã‚‚å‹•ä½œï¼‰
============================================================ */
(function(){
  'use strict';

  // ===== å›ºå®šã‚­ãƒ¼ï¼šindex.html ã¨åˆã‚ã›ã¦ã‚ã‚Šã¾ã™ =====
  var DONE_KEY   = 'specimens:open:byid';   // è¨ºæ–­ã”ã¨ã®ã€Œæ¸ˆã€ãƒãƒƒãƒ—
  var TOTAL_KEY  = 'specimens:open:total';  // ã‚ãªãŸã®ã“ã“ã‚Lvï¼ˆåˆè¨ˆï¼‰
  var GLOBAL_LAST= 'specimens:open:global:last'; // ã¿ã‚“ãªã®Lvã®å‰å›è¡¨ç¤ºã‚­ãƒ£ãƒƒã‚·ãƒ¥

  // ===== ã“ã®ãƒšãƒ¼ã‚¸ã®ID =====
  var MY_ID = (document.body && document.body.getAttribute('data-id')) || 'unknown';

  // ===== å›ç­”ä¿å­˜ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ï¼ˆã“ã®è¨ºæ–­ã ã‘ã®ç®±ï¼‰ =====
  var ANSWER_KEY = 'specimens:answers:' + MY_ID;

  // ===== ã¿ã‚“ãªã®Lvï¼ˆCountAPIè¨­å®šï¼‰ =====
  var COUNTAPI_NS  = 'haisuikounozarigani_shindan';
  var COUNTAPI_KEY = 'specimens_open_total';
  function countapiHit(){
    var url = 'https://api.countapi.xyz/hit/'+COUNTAPI_NS+'/'+COUNTAPI_KEY;
    if(navigator.sendBeacon){
      try{ navigator.sendBeacon(url); }catch(_){}
    }else{
      fetch(url, {mode:'cors', cache:'no-store', keepalive:true}).catch(function(){});
    }
  }

  // ---------- å›ç­”ã®ä¿å­˜/å¾©å…ƒ ----------
  function loadState(){
    try{ return JSON.parse(localStorage.getItem(ANSWER_KEY) || '{}'); }catch(_){ return {}; }
  }
  function saveState(obj){
    try{ localStorage.setItem(ANSWER_KEY, JSON.stringify(obj)); }catch(_){}
  }
  function saveField(el){
    if(!el || !el.name) return;
    var st = loadState();
    var nm = el.name;

    if(el.type === 'radio'){
      // ãƒ©ã‚¸ã‚ªã¯é¸ã°ã‚ŒãŸ value ã‚’ä¿å­˜
      var chosen = (el.form || document).querySelector('input[type="radio"][name="'+nm+'"]:checked');
      st[nm] = chosen ? {t:'r', v: chosen.value} : {t:'r', v:null};
    }else if(el.type === 'checkbox'){
      // ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã¯åŒåã‚°ãƒ«ãƒ¼ãƒ—ã®ãƒã‚§ãƒƒã‚¯æ¸ˆã¿ value é…åˆ—
      var all = (el.form || document).querySelectorAll('input[type="checkbox"][name="'+nm+'"]');
      var vals = [];
      all.forEach(function(c){ if(c.checked) vals.push(c.value || 'on'); });
      st[nm] = {t:'c', v: vals};
    }else if(el.tagName==='SELECT'){
      if(el.multiple){
        var arr=[]; [].slice.call(el.options).forEach(function(o){ if(o.selected) arr.push(o.value); });
        st[nm] = {t:'m', v: arr};
      }else{
        st[nm] = {t:'s', v: el.value};
      }
    }else{
      // text / number / textarea ãªã©
      st[nm] = {t:'t', v: el.value};
    }
    saveState(st);
  }
  function restoreOnce(){
    var st = loadState();
    var names = Object.keys(st);
    if(!names.length) return false;

    names.forEach(function(nm){
      var info = st[nm]; if(!info) return;

      if(info.t==='r'){
        var r = document.querySelector('input[type="radio"][name="'+nm+'"][value="'+CSS.escape(String(info.v))+'"]');
        if(r){ r.checked = true; r.dispatchEvent(new Event('change',{bubbles:true})); }
      }else if(info.t==='c'){
        var all = document.querySelectorAll('input[type="checkbox"][name="'+nm+'"]');
        var set = new Set(info.v||[]);
        all.forEach(function(c){ c.checked = set.has(c.value || 'on'); });
      }else if(info.t==='m'){
        var sel = document.querySelector('select[name="'+nm+'"]');
        if(sel){
          var setm = new Set(info.v||[]);
          [].slice.call(sel.options).forEach(function(o){ o.selected = setm.has(o.value); });
        }
      }else if(info.t==='s'){
        var s = document.querySelector('select[name="'+nm+'"]');
        if(s){ s.value = info.v; }
      }else{
        var t = document.querySelector('[name="'+nm+'"]');
        if(t){ t.value = info.v==null? '' : String(info.v); }
      }
    });
    // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ç­‰ã‚’æ›´æ–°ã—ãŸã„UIã®ãŸã‚ã€è»½ã change ã‚’æŠ•ã’ã‚‹
    try{
      document.dispatchEvent(new Event('change', {bubbles:true}));
    }catch(_){}
    return true;
  }
  // å…¥åŠ›ç›£è¦–ï¼ˆä¿å­˜ï¼‰
  document.addEventListener('change', function(e){
    var el = e.target;
    if(!(el instanceof HTMLElement)) return;
    if(el.matches('input[name], select[name], textarea[name]')) saveField(el);
  }, true);
  document.addEventListener('input', function(e){
    var el = e.target;
    if(!(el instanceof HTMLElement)) return;
    if(el.matches('input[type="text"][name], input:not([type])[name], textarea[name]')) saveField(el);
  }, true);

  // å¾©å…ƒã¯ã€Œå…¥åŠ›ãŒæç”»ã•ã‚Œã¦ã‹ã‚‰ã€ä¸€åº¦ã ã‘è©¦ã¿ã‚‹ï¼ˆå‹•çš„ç”Ÿæˆã«ã‚‚å¯¾å¿œï¼‰
  (function restoreWhenReady(){
    var TRY_MAX=12, tries=0;
    function tick(){
      tries++;
      // å…¥åŠ›ãŒä¸€ã¤ã§ã‚‚è¦‹ã¤ã‹ã£ã¦ã‹ã‚‰å¾©å…ƒ
      var hasAny = document.querySelector('input[name], select[name], textarea[name]');
      if(hasAny){
        restoreOnce(); return;
      }
      if(tries<TRY_MAX){ setTimeout(tick, 300); }
    }
    if(document.readyState==='complete' || document.readyState==='interactive'){ tick(); }
    else document.addEventListener('DOMContentLoaded', tick);
  })();

  // ãƒªã‚»ãƒƒãƒˆç³»ãƒœã‚¿ãƒ³ãŒã‚ã‚Œã°ä¿å­˜ã‚‚å‰Šé™¤ï¼ˆ#btnReset / data-role="reset" ã‚’æƒ³å®šï¼‰
  function clearAnswers(){
    try{ localStorage.removeItem(ANSWER_KEY); }catch(_){}
  }
  document.addEventListener('click', function(e){
    var t = e.target;
    if(!(t instanceof HTMLElement)) return;
    if(t.id==='btnReset' || t.matches('[data-role="reset"]')) clearAnswers();
  }, true);

  // ---------- çµæœç¢ºå®šã§ã€Œæ¸ˆã€ï¼‹LvåŠ ç®— ----------
  var marked = false;
  function markOnce(){
    if(marked) return; marked = true;
    try{
      // 1) ã‚ãªãŸã®ã“ã“ã‚Lv åˆè¨ˆ +1
      var total = (+localStorage.getItem(TOTAL_KEY) || 0) + 1;
      localStorage.setItem(TOTAL_KEY, String(total));

      // 2) ã“ã®è¨ºæ–­ã®ã€Œæ¸ˆã€ã‚’ +1ï¼ˆä»–ã‚¿ãƒ–å³æ™‚åæ˜ ç”¨ã«ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—æ··ãœã‚‹ï¼‰
      var map={}; try{ map = JSON.parse(localStorage.getItem(DONE_KEY) || '{}'); }catch(_){}
      map[MY_ID] = (map[MY_ID] || 0) + 1;
      localStorage.setItem(DONE_KEY, JSON.stringify(Object.assign({}, map, {_ts: Date.now()})));

      // 3) ã¿ã‚“ãªã®ã“ã“ã‚Lv +1ï¼ˆè¡¨ç¤ºã¯ index å´ã§å–å¾—ï¼ã“ã“ã§ã¯é€ã‚‹ã ã‘ï¼‰
      countapiHit();
      // ã¤ã„ã§ã«å‰å›ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚‚+1ï¼ˆindexåˆæœŸè¡¨ç¤ºã®è¦‹æ „ãˆæ”¹å–„ï¼‰
      try{
        var last = (+localStorage.getItem(GLOBAL_LAST) || 0) + 1;
        localStorage.setItem(GLOBAL_LAST, String(last));
      }catch(_){}
    }catch(_){}
  }

  // A) çµæœãŒæç”»ã•ã‚ŒãŸåˆå›³ï¼ˆæ¨å¥¨ï¼šå„ãƒšãƒ¼ã‚¸ã®é›†è¨ˆå®Œäº†æ™‚ã« dispatch ã—ã¦ãã ã•ã„ï¼‰
  //   ä¾‹ï¼‰document.dispatchEvent(new Event('result:ready'));
  document.addEventListener('result:ready', markOnce);

  // B) ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼šçµæœUIãŒè¦‹ãˆã¦ã‹ã‚‰2ç§’å¾Œã«ä¸€åº¦ã ã‘å®Ÿè¡Œï¼ˆæˆ»ã‚‹ç„¡ã—ã§ã‚‚ç¢ºå®Ÿã«ã€Œæ¸ˆã€ï¼‰
  setTimeout(markOnce, 2000);
})();
</script>
</body>
</html>