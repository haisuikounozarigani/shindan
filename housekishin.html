<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>å®çŸ³ã‚¿ã‚¤ãƒ—æ‹æ„›è¨ºæ–­</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="theme-color" content="#fdf6f0">
  <style>
    :root{ --brand:#b86b77; --card:#fff; --bg:#fdf6f0; --muted:#7b6b6b; }
    *{ box-sizing:border-box }
    body{
      font-family: system-ui,-apple-system,"Segoe UI",Roboto,"Hiragino Kaku Gothic ProN","Noto Sans JP",sans-serif;
      background: var(--bg); color:#333; margin:0; padding:22px;
    }
    .wrap{ max-width:960px; margin:0 auto }
    h1{ text-align:center; color:var(--brand); margin:4px 0 14px; font-size:clamp(20px,4vw,30px) }
    .card{ background:var(--card); padding:20px; border-radius:12px; box-shadow:0 6px 18px rgba(0,0,0,.08) }
    .meta{ display:flex; justify-content:space-between; gap:12px; color:#666; font-size:12px; margin:0 2px 12px }
    .question{ margin:20px 0 }
    .question p{ margin:0 0 10px; font-weight:600 }
    .scale{ display:grid; gap:8px }
    .scale label{ display:flex; align-items:center; gap:10px; background:#f4f4f4; padding:10px; border-radius:10px; cursor:pointer }
    .scale input{ accent-color:var(--brand) }
    .actions{ display:flex; justify-content:center; gap:10px; flex-wrap:wrap; margin-top:18px }
    .btn{ background:var(--brand); color:#fff; border:none; border-radius:10px; padding:12px 18px; font-size:16px; cursor:pointer }
    .btn.secondary{ background:#8a8a8a }
    .btn.linklike{ background:#fff; color:var(--brand); border:1px solid #e8d3d6 }
    #resultArea{ margin-top:22px }
    #resultTitle{ color:var(--brand); text-align:center; margin:0 0 10px; white-space:pre-line }
    #resultImgWrap{ display:grid; place-items:center; gap:8px }
    #resultImg{ width:min(780px,100%); height:auto; border-radius:10px; box-shadow:0 8px 24px rgba(0,0,0,.12) }
    #tips{ color:var(--muted); font-size:12px; text-align:center }
    .scores{ margin-top:16px; color:#555; font-size:14px }
    .scores h3{ margin:8px 0 6px; font-size:15px; color:#6d5559 }
    .scores .grid{ display:grid; grid-template-columns:repeat(auto-fit,minmax(160px,1fr)); gap:8px }
    .scores .item{ background:#f7f3f1; border:1px solid #efe3e2; border-radius:10px; padding:8px 10px }
    .footerActions{ display:flex; justify-content:center; gap:10px; flex-wrap:wrap; margin:18px 0 4px }
    .note{ color:#766; text-align:center; font-size:12px; margin-top:10px }
    a.inline{ color:var(--brand); text-decoration:none; border-bottom:1px dashed currentColor }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>ğŸ’ å®çŸ³ã‚¿ã‚¤ãƒ— æ‹æ„›è¨ºæ–­</h1>

    <div class="card">
      <div class="meta" role="status" aria-live="polite">
        <span id="progress">æœªå›ç­” 32 / 32</span>
        <span>5ä»¶æ³•ï¼š1ï¼ˆã¾ã£ãŸãå½“ã¦ã¯ã¾ã‚‰ãªã„ï¼‰ã€œ5ï¼ˆã¨ã¦ã‚‚å½“ã¦ã¯ã¾ã‚‹ï¼‰</span>
      </div>

      <form id="quizForm"></form>

      <div class="actions">
        <button type="button" class="btn" onclick="calculate()">è¨ºæ–­ã™ã‚‹</button>
        <button type="button" class="btn secondary" onclick="resetForm()">ãƒªã‚»ãƒƒãƒˆ</button>
      </div>

      <!-- çµæœè¡¨ç¤º -->
      <section id="resultArea" class="hidden" aria-label="è¨ºæ–­çµæœ">
        <h2 id="resultTitle"></h2>

        <div id="resultImgWrap">
          <img id="resultImg" alt="è¨ºæ–­çµæœç”»åƒ" decoding="async">
          <div class="actions">
            <button id="showSummary" type="button" class="btn linklike">ç›¸æ€§ã¾ã¨ã‚ï¼ˆ05ï¼‰ã‚’è¦‹ã‚‹</button>
            <button id="showMain" type="button" class="btn linklike hidden">è¨ºæ–­çµæœï¼ˆã‚¿ã‚¤ãƒ—Ã—æ„›ç€ï¼‰ã«æˆ»ã™</button>
          </div>
          <p id="tips">ç”»åƒãŒã†ã¾ãè¡¨ç¤ºã•ã‚Œãªã„å ´åˆã¯ã€é•·æŠ¼ã—ã§å†èª­ã¿è¾¼ã¿ãƒ»ä¿å­˜ã§ãã¾ã™ã€‚</p>
        </div>

        <!-- ã‚¹ã‚³ã‚¢ã®æ¦‚è¦ï¼ˆä¸Šä½å‚¾å‘ã‚’æŠŠæ¡ã—ã‚„ã™ãã™ã‚‹ã‚ªãƒã‚±ï¼‰ -->
        <div class="scores" id="scoreBox" hidden>
          <h3>ã‚ãªãŸã®å‚¾å‘ï¼ˆã‚¹ã‚³ã‚¢ï¼‰</h3>
          <div class="grid" id="scoreGrid"></div>
        </div>

        <div class="footerActions">
          <a class="btn secondary" href="/shindan/" aria-label="è¨ºæ–­ä¸€è¦§ã«æˆ»ã‚‹">è¨ºæ–­ä¸€è¦§ã¸æˆ»ã‚‹</a>
          <button class="btn linklike" type="button" onclick="window.scrollTo({top:0,behavior:'smooth'})">ãƒšãƒ¼ã‚¸ä¸Šéƒ¨ã¸</button>
        </div>

        <p class="note">â€» æœ¬è¨ºæ–­ã¯å‚¾å‘ã‚’ç¤ºã™å‚è€ƒæƒ…å ±ã§ã™ã€‚åŒ»ç™‚ãƒ»å¿ƒç†çš„ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆã®ä»£æ›¿ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
      </section>
    </div>
  </div>

  <script>
    // --- è³ªå•ï¼ˆ32å•ï¼‰ ---
    const questions = [
      // Erosï¼ˆæƒ…ç†±ï¼‰
      "æ‹æ„›ã¯é‹å‘½ã®ã‚ˆã†ãªã‚‚ã®ã§ã‚ã‚‹ã¨æ„Ÿã˜ã‚‹",
      "ä¸€ç›®æƒšã‚Œã™ã‚‹ã“ã¨ãŒå¤šã„",
      "æ‹æ„›ä¸­ã¯ç†æƒ³ã‚’è¿½ã„æ±‚ã‚ãŒã¡",
      "æ‹æ„›ã¯æ„Ÿæƒ…ãŒã™ã¹ã¦ã ã¨æ€ã†",
      // Ludusï¼ˆéŠæˆ¯ï¼‰
      "æ‹æ„›ã¯ã‚²ãƒ¼ãƒ ã®ã‚ˆã†ãªæ¥½ã—ã•ãŒå¤§äº‹",
      "è¤‡æ•°ã®äººã«åŒæ™‚ã«å¥½æ„ã‚’æŒã¤ã“ã¨ãŒã‚ã‚‹",
      "æ‹æ„›ã«è‡ªç”±ãŒå¿…è¦ã ã¨æ€ã†",
      "æ·±åˆ»ã™ãã‚‹æ‹æ„›ã¯è‹¦æ‰‹",
      // Storgeï¼ˆå‹æ„›ï¼‰
      "æ‹æ„›ã¯å‹æƒ…ã‹ã‚‰å§‹ã¾ã‚‹ã®ãŒç†æƒ³",
      "ä¿¡é ¼é–¢ä¿‚ã‚’å¤§äº‹ã«ã—ãŸã„",
      "æ‹äººã¨ã¯é•·ã„æ™‚é–“ã‚’ã‹ã‘ã¦é–¢ä¿‚ã‚’ç¯‰ããŸã„",
      "æ‹äººã¨è¦ªå‹ã®ã‚ˆã†ãªé–¢ä¿‚ãŒç†æƒ³",
      // Maniaï¼ˆç†±ç‹‚ï¼‰
      "ç›¸æ‰‹ãŒè‡ªåˆ†ã‚’ã©ã†æ€ã£ã¦ã„ã‚‹ã‹å¸¸ã«æ°—ã«ãªã‚‹",
      "æ‹äººã«ä¸å®‰ã‚’æ„Ÿã˜ã‚‹ã“ã¨ãŒå¤šã„",
      "æ‹æ„›ä¸­ã¯ç›¸æ‰‹ã«ä¾å­˜ã—ã‚„ã™ã„",
      "å°‘ã—ã®å¤‰åŒ–ã§ä¸å®‰ã«ãªã‚‹",
      // Pragmaï¼ˆå®Ÿåˆ©ï¼‰
      "ç›¸æ‰‹ã®æ¡ä»¶ï¼ˆä»•äº‹ãƒ»æ€§æ ¼ãªã©ï¼‰ã‚’é‡è¦–ã™ã‚‹",
      "æ‹æ„›ã«ãŠã„ã¦æå¾—ã‚’è€ƒãˆã‚‹ã“ã¨ãŒã‚ã‚‹",
      "å®‰å®šã—ãŸå°†æ¥ã‚’æƒ³åƒã§ãã‚‹ç›¸æ‰‹ã‚’é¸ã¶",
      "æ‹äººé¸ã³ã¯è¨ˆç”»çš„ã«ã—ãŸã„",
      // Agapeï¼ˆç„¡å„Ÿï¼‰
      "ç›¸æ‰‹ã®å¹¸ã›ã‚’è‡ªåˆ†ã®ã“ã¨ã®ã‚ˆã†ã«æ€ã†",
      "æ‹æ„›ã§ã¯è‡ªåˆ†ã‚’çŠ ç‰²ã«ã—ã¦ã‚‚æ§‹ã‚ãªã„",
      "ç›¸æ‰‹ã®æˆé•·ã‚’æ”¯ãˆãŸã„ã¨æ€ã†",
      "æ‹äººã«ç„¡æ¡ä»¶ã®æ„›ã‚’æ³¨ãã¹ãã ã¨æ€ã†",
      // ä¸å®‰ï¼ˆAnxiousï¼‰
      "æ‹äººãŒé›¢ã‚Œã¦ã„ãã®ã§ã¯ã¨ä¸å®‰ã«ãªã‚‹",
      "äº›ç´°ãªã“ã¨ã§å«Œã‚ã‚ŒãŸã¨æ„Ÿã˜ã¦ã—ã¾ã†",
      "æ‹äººã®è¿”ä¿¡ãŒé…ã„ã¨æ°—ã«ãªã£ã¦ã—ã¾ã†",
      "æ‹æ„›é–¢ä¿‚ãŒå£Šã‚Œã‚‹ã®ãŒæ€–ã„",
      // å›é¿ï¼ˆAvoidantï¼‰
      "äººã«é ¼ã‚‹ã“ã¨ãŒè‹¦æ‰‹",
      "æ‹æ„›ã«è¸ã¿è¾¼ã¿ã™ãã‚‹ã¨ä¸å®‰ã«ãªã‚‹",
      "è¦ªå¯†ã«ãªã‚‹ã¨é€ƒã’ãŸããªã‚‹",
      "è·é›¢æ„Ÿã‚’ä¿ã£ãŸé–¢ä¿‚ã®æ–¹ãŒè½ã¡ç€ã"
    ];

    const scaleLabels = [
      "1ï¼ˆã¾ã£ãŸãå½“ã¦ã¯ã¾ã‚‰ãªã„ï¼‰",
      "2ï¼ˆã‚ã¾ã‚Šå½“ã¦ã¯ã¾ã‚‰ãªã„ï¼‰",
      "3ï¼ˆã©ã¡ã‚‰ã¨ã‚‚ã„ãˆãªã„ï¼‰",
      "4ï¼ˆã‚„ã‚„å½“ã¦ã¯ã¾ã‚‹ï¼‰",
      "5ï¼ˆã¨ã¦ã‚‚å½“ã¦ã¯ã¾ã‚‹ï¼‰"
    ];

    // --- ãƒ•ã‚©ãƒ¼ãƒ æç”» ---
    const form = document.getElementById("quizForm");
    const progressEl = document.getElementById("progress");
    questions.forEach((q, i) => {
      const div = document.createElement("div");
      div.className = "question";
      div.innerHTML = `<p>Q${i + 1}. ${q}</p>
        <div class="scale">
          ${scaleLabels.map((label, n) => `
            <label><input type="radio" name="q${i + 1}" value="${n + 1}"> ${label}</label>
          `).join("")}
        </div>`;
      form.appendChild(div);
    });

    function updateProgress(){
      const answered = Array.from({length: questions.length})
        .filter((_,i)=>document.querySelector(`input[name="q${i+1}"]:checked`)).length;
      progressEl.textContent = `æœªå›ç­” ${questions.length - answered} / ${questions.length}`;
    }
    form.addEventListener("change", updateProgress);
    updateProgress();

    // --- ãƒ©ãƒ™ãƒ«ãƒ»ãƒ‘ã‚¹è¨­å®š ---
    const loveJP = { eros:"æƒ…ç†±", ludus:"éŠæˆ¯", storge:"å‹æ„›", mania:"ç†±ç‹‚", pragma:"å®Ÿåˆ©", agape:"ç„¡å„Ÿ" };
    const attachJP = { secure:"å®‰å®š", anxious:"ä¸å®‰", avoidant:"å›é¿", fearful:"æã‚Œå›é¿" };

    // ç”»åƒã¯ houseki-bundle/{style}/01..05.png ã‚’ä½¿ç”¨
    const ATTACH_TO_NO = { secure:"01", avoidant:"02", anxious:"03", fearful:"04" }; // 05 ã¯ã¾ã¨ã‚

    // --- ã‚¹ã‚¿ã‚¤ãƒ«Ã—æ„›ç€ â†’ å®çŸ³åï¼ˆè¡¨ç¤ºç”¨ï¼‰ ---
    const gemMap = {
      eros:   { anxious:"ãƒ•ã‚¡ã‚¤ã‚¢ã‚ªãƒ‘ãƒ¼ãƒ«",   secure:"ã‚¬ãƒ¼ãƒãƒƒãƒˆ",          avoidant:"ã‚¹ãƒ”ãƒãƒ«",           fearful:"ãƒ«ãƒ“ãƒ¼" },
      ludus:  { anxious:"ã‚¿ãƒ³ã‚¶ãƒŠã‚¤ãƒˆ",       secure:"ã‚·ãƒˆãƒªãƒ³",            avoidant:"ã‚¿ãƒ¼ã‚³ã‚¤ã‚º",         fearful:"ã‚¢ãƒ‘ã‚¿ã‚¤ãƒˆ" },
      storge: { anxious:"ãƒ ãƒ¼ãƒ³ã‚¹ãƒˆãƒ¼ãƒ³",     secure:"ã‚¢ã‚¯ã‚¢ãƒãƒªãƒ³",        avoidant:"ãƒšãƒªãƒ‰ãƒƒãƒˆ",         fearful:"ãƒ©ãƒ–ãƒ©ãƒ‰ãƒ©ã‚¤ãƒˆ" },
      pragma: { anxious:"ãƒ–ãƒ«ãƒ¼ãƒˆãƒ‘ãƒ¼ã‚º",     secure:"ã‚µãƒ•ã‚¡ã‚¤ã‚¢",          avoidant:"ãƒ–ãƒ©ãƒƒã‚¯ã‚ªãƒ‹ã‚­ã‚¹",   fearful:"ã‚¹ãƒ¢ãƒ¼ã‚­ãƒ¼ã‚¯ã‚©ãƒ¼ãƒ„" },
      mania:  { anxious:"ã‚¨ãƒ¡ãƒ©ãƒ«ãƒ‰",         secure:"ã‚¢ãƒ¬ã‚­ã‚µãƒ³ãƒ‰ãƒ©ã‚¤ãƒˆ", avoidant:"ã‚ªãƒ–ã‚·ãƒ‡ã‚£ã‚¢ãƒ³",     fearful:"ã‚ªãƒ‘ãƒ¼ãƒ«" },
      agape:  { anxious:"ãƒ”ãƒ³ã‚¯ãƒˆãƒ«ãƒãƒªãƒ³",   secure:"ãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰",        avoidant:"ãƒ¢ãƒ«ã‚¬ãƒŠã‚¤ãƒˆ",       fearful:"ãƒ­ãƒ¼ã‚ºã‚¯ã‚©ãƒ¼ãƒ„" }
    };

    // --- è¨ºæ–­å‡¦ç† ---
    function calculate() {
      let s = {
        eros:0, ludus:0, storge:0, mania:0, pragma:0, agape:0,
        anxiety:0, avoidance:0
      };

      for (let i = 1; i <= questions.length; i++) {
        const v = parseInt(document.querySelector(`input[name='q${i}']:checked`)?.value);
        if (!v) { alert(`å…¨ã¦ã®è³ªå•ã«ç­”ãˆã¦ãã ã•ã„ã€‚\næœªå›ç­”ã®è¨­å•ãŒã‚ã‚Šã¾ã™ï¼ˆQ${i}ï¼‰ã€‚`); return; }
        if (i <=  4) s.eros      += v;
        else if (i <=  8) s.ludus  += v;
        else if (i <= 12) s.storge += v;
        else if (i <= 16) s.mania  += v;
        else if (i <= 20) s.pragma += v;
        else if (i <= 24) s.agape  += v;
        else if (i <= 28) s.anxiety += v;
        else              s.avoidance += v;
      }

      // æ‹æ„›ã‚¹ã‚¿ã‚¤ãƒ«æœ€å¤§å€¤
      const loveType = Object.entries(s).slice(0,6).sort((a,b)=>b[1]-a[1])[0][0];

      // æ„›ç€ã‚¿ã‚¤ãƒ—åˆ¤å®šï¼ˆå„4ã€œ20ç‚¹æƒ³å®šã€‚ã—ãã„å€¤ã¯çµŒé¨“çš„ã«11ï¼‰
      let attachType = "secure";
      if (s.anxiety >= 11 && s.avoidance >= 11) attachType = "fearful";
      else if (s.anxiety >= 11) attachType = "anxious";
      else if (s.avoidance >= 11) attachType = "avoidant";

      // è¡¨ç¤º
      const gemName = gemMap[loveType]?.[attachType] || "ï¼ˆå®çŸ³åï¼‰";
      const title = `ã‚ãªãŸã®å®çŸ³ã‚¿ã‚¤ãƒ—ã¯ã€Œ${gemName}ã€\nï¼ˆæ‹æ„›ã‚¹ã‚¿ã‚¤ãƒ«ï¼š${loveJP[loveType]} Ã— æ„›ç€ï¼š${attachJP[attachType]}ï¼‰`;
      const resultTitle = document.getElementById("resultTitle");
      resultTitle.textContent = title;

      // ç”»åƒãƒ‘ã‚¹ï¼ˆçµæœï¼‰
      const base = "/shindan/assets/results/houseki-bundle";
      const imgMain = `${base}/${loveType}/${ATTACH_TO_NO[attachType]}.png`; // 01..04
      const imgSummary = `${base}/${loveType}/05.png`;

      const img = document.getElementById("resultImg");
      const area = document.getElementById("resultArea");
      const showSummaryBtn = document.getElementById("showSummary");
      const showMainBtn = document.getElementById("showMain");

      // ç”»åƒèª­ã¿è¾¼ã¿ï¼ˆã‚¨ãƒ©ãƒ¼æ™‚ã¯ã¾ã¨ã‚ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰
      img.src = imgMain;
      img.onerror = () => { img.onerror = null; img.src = imgSummary; };

      // åˆ‡æ›¿ãƒœã‚¿ãƒ³
      showSummaryBtn.onclick = () => { img.src = imgSummary; showSummaryBtn.classList.add("hidden"); showMainBtn.classList.remove("hidden"); };
      showMainBtn.onclick    = () => { img.src = imgMain;    showMainBtn.classList.add("hidden");    showSummaryBtn.classList.remove("hidden"); };

      area.classList.remove("hidden");

      // ã‚¹ã‚³ã‚¢æ¦‚è¦³ï¼ˆä¸Šä½2ã‚¹ã‚¿ã‚¤ãƒ«ãŒåˆ†ã‹ã‚‹ï¼‰
      const sg = document.getElementById("scoreGrid");
      const sb = document.getElementById("scoreBox");
      const pairs = Object.entries({eros:s.eros,ludus:s.ludus,storge:s.storge,mania:s.mania,pragma:s.pragma,agape:s.agape})
        .sort((a,b)=>b[1]-a[1]);
      sg.innerHTML = pairs.map(([k,v],i)=>`<div class="item">${i<2?'â­ï¸':''}${loveJP[k]}ï¼š${v} ç‚¹</div>`).join("");
      sb.hidden = false;

      updateProgress();
      window.scrollTo({ top: document.body.scrollHeight, behavior: "smooth" });
    }

    function resetForm(){
      form.reset();
      document.getElementById("resultArea").classList.add("hidden");
      document.getElementById("resultTitle").textContent = "";
      document.getElementById("scoreGrid").innerHTML = "";
      document.getElementById("scoreBox").hidden = true;
      updateProgress();
      window.scrollTo({top:0, behavior:"smooth"});
    }

    // small helper
    function $(sel){ return document.querySelector(sel); }
    // åˆæœŸ hidden ç”¨
    document.querySelectorAll('.hidden').forEach(()=>{});
  </script>
  <style>.hidden{ display:none !important }</style>
</body>
</html>
