<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<title>å®çŸ³ã‚¿ã‚¤ãƒ—æ‹æ„›è¨ºæ–­</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
:root{
  --brand:#b86b77; --card:#fff; --bg:#fdf6f0; --fg:#333; --muted:#6b6b6b;
  --chip:#f7e8e4; --line:#eadad6;
}
*{box-sizing:border-box}
body{font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Hiragino Kaku Gothic ProN","Noto Sans JP",sans-serif;
     background:var(--bg); color:var(--fg); margin:0; padding:22px;}
.wrap{max-width:880px;margin:0 auto}
h1{text-align:center;color:var(--brand);margin:4px 0 14px;font-size:clamp(20px,4vw,30px)}
.card{background:var(--card);padding:20px;border-radius:12px;box-shadow:0 6px 18px rgba(0,0,0,.08)}
.meta{display:flex;justify-content:space-between;gap:12px;color:var(--muted);font-size:12px;margin:0 2px 12px}
.question{margin:22px 0}
.question p{margin:0 0 10px;font-weight:600}
.scale{display:grid;gap:8px}
.scale label{display:flex;align-items:center;gap:10px;background:#f4f4f4;padding:10px;border-radius:10px;cursor:pointer}
.scale input{accent-color:var(--brand)}
.actions{display:flex;justify-content:center;gap:10px;flex-wrap:wrap;margin-top:18px}
.btn{background:var(--brand);color:#fff;border:none;border-radius:10px;padding:12px 18px;font-size:16px;cursor:pointer}
.btn.secondary{background:#8a8a8a}
#resultArea{margin-top:20px}
.result-head{text-align:center;margin:0 0 10px}
.gem-name{font-size:1.1em;color:#8a545a;font-weight:700}
.result-img{width:100%;height:auto;display:block;border-radius:12px;box-shadow:0 8px 24px rgba(0,0,0,.10)}
.ctas{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin-top:12px}
.linkbtn{display:inline-block;text-decoration:none;background:#fff;border:1px solid var(--line);color:#533;padding:10px 14px;border-radius:999px}
.linkbtn.primary{background:var(--brand);color:#fff;border-color:transparent}
.note{color:var(--muted);text-align:center;margin-top:10px;font-size:.92em}

/* ç›¸æ€§ãƒœãƒƒã‚¯ã‚¹ */
.compat{margin-top:14px;display:flex;gap:10px;flex-wrap:wrap;justify-content:center}
.badge{display:inline-flex;align-items:center;gap:6px;background:var(--chip);border:1px solid var(--line);padding:8px 12px;border-radius:999px}
.badge small{opacity:.8}

/* ç°¡æ˜“ãƒ“ãƒ¥ãƒ¼ã‚¢ï¼ˆã¾ã¨ã‚ 01ã€œ05 ã‚’è»½ãè¡¨ç¤ºï¼‰ */
.viewer{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;z-index:10}
.viewer .inner{background:#fff;border-radius:12px;max-width:min(92vw,860px);max-height:86vh;display:flex;flex-direction:column}
.viewer header{display:flex;justify-content:space-between;align-items:center;padding:10px 12px;border-bottom:1px solid #eee}
.viewer header strong{font-weight:700}
.viewer .stage{position:relative;padding:10px}
.viewer img{display:block;max-width:100%;max-height:68vh;margin:0 auto;border-radius:8px}
.viewer .nav{display:flex;justify-content:space-between;gap:8px;padding:10px;border-top:1px solid #eee}
.viewer .nav button{flex:1;padding:10px;border-radius:10px;border:1px solid #ddd;background:#fff;cursor:pointer}
.viewer .close{border:none;background:#fff;padding:8px 10px;border-radius:8px;cursor:pointer}

.footerbar{position:sticky;bottom:0;display:flex;gap:10px;justify-content:center;margin-top:14px;
  padding:10px;background:rgba(255,255,255,.9);backdrop-filter:blur(6px) saturate(1.05);border-top:1px solid #efdeda}
.footerbar a{padding:8px 12px;border:1px solid #eadad6;border-radius:999px;text-decoration:none;color:#533;background:#fff}

@media (max-width:360px){ .linkbtn.share{display:none} }
</style>
</head>
<body>
<div class="wrap">
  <h1>ğŸ’ å®çŸ³ã‚¿ã‚¤ãƒ— æ‹æ„›è¨ºæ–­ ğŸ’</h1>

  <div class="card">
    <div class="meta">
      <span id="progress">æœªå›ç­” 32 / 32</span>
      <span>5ä»¶æ³•ï¼š1ï¼ˆã¾ã£ãŸãå½“ã¦ã¯ã¾ã‚‰ãªã„ï¼‰ã€œ5ï¼ˆã¨ã¦ã‚‚å½“ã¦ã¯ã¾ã‚‹ï¼‰</span>
    </div>

    <form id="quizForm"></form>

    <div class="actions">
      <button type="button" class="btn" onclick="calculate()">è¨ºæ–­ã™ã‚‹</button>
      <button type="button" class="btn secondary" onclick="resetForm()">ãƒªã‚»ãƒƒãƒˆ</button>
    </div>

    <section id="resultArea" aria-live="polite"></section>
  </div>

  <p class="note">â€» æœ¬è¨ºæ–­ã¯å‚¾å‘ã®ç›®å®‰ã§ã™ã€‚æ–­å®šã¯è¡Œã„ã¾ã›ã‚“ã€‚</p>
</div>

<!-- SNSãƒãƒ¼ï¼ˆå›ºå®šå°ç·šï¼‰ -->
<nav class="footerbar">
  <a href="https://x.com/zariganitabe24?s=21" target="_blank" rel="noopener">X</a>
  <a href="https://www.instagram.com/zariganitabetai7?igsh=MTdzc245MDJrdWZzYw%3D%3D&utm_source=qr" target="_blank" rel="noopener">Instagram</a>
  <a href="https://line.me/ti/p/JO0O0lvpKY" target="_blank" rel="noopener">LINE</a>
  <a href="https://seikaku.my.canva.site/" target="_blank" rel="noopener">è‡ªå·±ç´¹ä»‹</a>
</nav>

<!-- ã‚¹ã‚¿ã‚¤ãƒ«ã¾ã¨ã‚ã®ç°¡æ˜“ãƒ“ãƒ¥ãƒ¼ã‚¢ -->
<div id="viewer" class="viewer" role="dialog" aria-modal="true" aria-label="ã‚¹ã‚¿ã‚¤ãƒ«ã¾ã¨ã‚ç”»åƒ">
  <div class="inner">
    <header>
      <strong id="viewerTitle">ã¾ã¨ã‚</strong>
      <button class="close" onclick="Viewer.hide()">é–‰ã˜ã‚‹ âœ•</button>
    </header>
    <div class="stage">
      <img id="viewerImg" src="" alt="ã¾ã¨ã‚ç”»åƒ">
    </div>
    <div class="nav">
      <button onclick="Viewer.prev()">â—€ å‰ã¸</button>
      <button onclick="Viewer.next()">æ¬¡ã¸ â–¶</button>
    </div>
  </div>
</div>

<script>
/* ===== è¨­å•ï¼ˆ32å•ï¼‰ ===== */
const questions = [
  // Erosï¼ˆæƒ…ç†±ï¼‰
  "æ‹æ„›ã¯é‹å‘½ã®ã‚ˆã†ãªã‚‚ã®ã§ã‚ã‚‹ã¨æ„Ÿã˜ã‚‹",
  "ä¸€ç›®æƒšã‚Œã™ã‚‹ã“ã¨ãŒå¤šã„",
  "æ‹æ„›ä¸­ã¯ç†æƒ³ã‚’è¿½ã„æ±‚ã‚ãŒã¡",
  "æ‹æ„›ã¯æ„Ÿæƒ…ãŒã™ã¹ã¦ã ã¨æ€ã†",
  // Ludusï¼ˆéŠæˆ¯ï¼‰
  "æ‹æ„›ã¯ã‚²ãƒ¼ãƒ ã®ã‚ˆã†ãªæ¥½ã—ã•ãŒå¤§äº‹",
  "è¤‡æ•°ã®äººã«åŒæ™‚ã«å¥½æ„ã‚’æŒã¤ã“ã¨ãŒã‚ã‚‹",
  "æ‹æ„›ã«è‡ªç”±ãŒå¿…è¦ã ã¨æ€ã†",
  "æ·±åˆ»ã™ãã‚‹æ‹æ„›ã¯è‹¦æ‰‹",
  // Storgeï¼ˆå‹æ„›ï¼‰
  "æ‹æ„›ã¯å‹æƒ…ã‹ã‚‰å§‹ã¾ã‚‹ã®ãŒç†æƒ³",
  "ä¿¡é ¼é–¢ä¿‚ã‚’å¤§äº‹ã«ã—ãŸã„",
  "æ‹äººã¨ã¯é•·ã„æ™‚é–“ã‚’ã‹ã‘ã¦é–¢ä¿‚ã‚’ç¯‰ããŸã„",
  "æ‹äººã¨è¦ªå‹ã®ã‚ˆã†ãªé–¢ä¿‚ãŒç†æƒ³",
  // Maniaï¼ˆç†±ç‹‚ï¼‰
  "ç›¸æ‰‹ãŒè‡ªåˆ†ã‚’ã©ã†æ€ã£ã¦ã„ã‚‹ã‹å¸¸ã«æ°—ã«ãªã‚‹",
  "æ‹äººã«ä¸å®‰ã‚’æ„Ÿã˜ã‚‹ã“ã¨ãŒå¤šã„",
  "æ‹æ„›ä¸­ã¯ç›¸æ‰‹ã«ä¾å­˜ã—ã‚„ã™ã„",
  "å°‘ã—ã®å¤‰åŒ–ã§ä¸å®‰ã«ãªã‚‹",
  // Pragmaï¼ˆå®Ÿåˆ©ï¼‰
  "ç›¸æ‰‹ã®æ¡ä»¶ï¼ˆä»•äº‹ãƒ»æ€§æ ¼ãªã©ï¼‰ã‚’é‡è¦–ã™ã‚‹",
  "æ‹æ„›ã«ãŠã„ã¦æå¾—ã‚’è€ƒãˆã‚‹ã“ã¨ãŒã‚ã‚‹",
  "å®‰å®šã—ãŸå°†æ¥ã‚’æƒ³åƒã§ãã‚‹ç›¸æ‰‹ã‚’é¸ã¶",
  "æ‹äººé¸ã³ã¯è¨ˆç”»çš„ã«ã—ãŸã„",
  // Agapeï¼ˆç„¡å„Ÿï¼‰
  "ç›¸æ‰‹ã®å¹¸ã›ã‚’è‡ªåˆ†ã®ã“ã¨ã®ã‚ˆã†ã«æ€ã†",
  "æ‹æ„›ã§ã¯è‡ªåˆ†ã‚’çŠ ç‰²ã«ã—ã¦ã‚‚æ§‹ã‚ãªã„",
  "ç›¸æ‰‹ã®æˆé•·ã‚’æ”¯ãˆãŸã„ã¨æ€ã†",
  "æ‹äººã«ç„¡æ¡ä»¶ã®æ„›ã‚’æ³¨ãã¹ãã ã¨æ€ã†",
  // ä¸å®‰ï¼ˆAnxiousï¼‰
  "æ‹äººãŒé›¢ã‚Œã¦ã„ãã®ã§ã¯ã¨ä¸å®‰ã«ãªã‚‹",
  "äº›ç´°ãªã“ã¨ã§å«Œã‚ã‚ŒãŸã¨æ„Ÿã˜ã¦ã—ã¾ã†",
  "æ‹äººã®è¿”ä¿¡ãŒé…ã„ã¨æ°—ã«ãªã£ã¦ã—ã¾ã†",
  "æ‹æ„›é–¢ä¿‚ãŒå£Šã‚Œã‚‹ã®ãŒæ€–ã„",
  // å›é¿ï¼ˆAvoidantï¼‰
  "äººã«é ¼ã‚‹ã“ã¨ãŒè‹¦æ‰‹",
  "æ‹æ„›ã«è¸ã¿è¾¼ã¿ã™ãã‚‹ã¨ä¸å®‰ã«ãªã‚‹",
  "è¦ªå¯†ã«ãªã‚‹ã¨é€ƒã’ãŸããªã‚‹",
  "è·é›¢æ„Ÿã‚’ä¿ã£ãŸé–¢ä¿‚ã®æ–¹ãŒè½ã¡ç€ã"
];

const scaleLabels = [
  "1ï¼ˆã¾ã£ãŸãå½“ã¦ã¯ã¾ã‚‰ãªã„ï¼‰",
  "2ï¼ˆã‚ã¾ã‚Šå½“ã¦ã¯ã¾ã‚‰ãªã„ï¼‰",
  "3ï¼ˆã©ã¡ã‚‰ã¨ã‚‚ã„ãˆãªã„ï¼‰",
  "4ï¼ˆã‚„ã‚„å½“ã¦ã¯ã¾ã‚‹ï¼‰",
  "5ï¼ˆã¨ã¦ã‚‚å½“ã¦ã¯ã¾ã‚‹ï¼‰"
];

/* ===== å®šç¾©ï¼šè¡¨ç¤ºåï¼ã‚¹ãƒ©ãƒƒã‚° ===== */
const LOVE_JP = { eros:"æƒ…ç†±", ludus:"éŠæˆ¯", storge:"å‹æ„›", mania:"ç†±ç‹‚", pragma:"å®Ÿåˆ©", agape:"ç„¡å„Ÿ" };
const ATTACH_JP = { secure:"å®‰å®š", anxious:"ä¸å®‰", avoidant:"å›é¿", fearful:"æã‚Œå›é¿" };

// å®çŸ³ã®ã‚¹ãƒ©ãƒƒã‚°ã¨æ—¥æœ¬èªåï¼ˆè¡¨è¨˜ã‚†ã‚Œé˜²æ­¢ï¼‰
const GEM_DEFS = {
  amethyst:"ã‚¢ãƒ¡ã‚¸ã‚¹ãƒˆ",
  spinel:"ã‚¹ãƒ”ãƒãƒ«",
  turquoise:"ã‚¿ãƒ¼ã‚³ã‚¤ã‚º",
  obsidian:"ã‚ªãƒ–ã‚·ãƒ‡ã‚£ã‚¢ãƒ³",
  citrine:"ã‚·ãƒˆãƒªãƒ³",
  apatite:"ã‚¢ãƒ‘ã‚¿ã‚¤ãƒˆ",
  emerald:"ã‚¨ãƒ¡ãƒ©ãƒ«ãƒ‰",
  rose_quartz:"ãƒ­ãƒ¼ã‚ºã‚¯ã‚©ãƒ¼ãƒ„",
  peridot:"ãƒšãƒªãƒ‰ãƒƒãƒˆ",
  opal:"ã‚ªãƒ‘ãƒ¼ãƒ«",
  aquamarine:"ã‚¢ã‚¯ã‚¢ãƒãƒªãƒ³",
  fire_opal:"ãƒ•ã‚¡ã‚¤ã‚¢ã‚ªãƒ‘ãƒ¼ãƒ«",
  black_onyx:"ãƒ–ãƒ©ãƒƒã‚¯ã‚ªãƒ‹ã‚­ã‚¹",
  moonstone:"ãƒ ãƒ¼ãƒ³ã‚¹ãƒˆãƒ¼ãƒ³",
  labradorite:"ãƒ©ãƒ–ãƒ©ãƒ‰ãƒ©ã‚¤ãƒˆ",
  sapphire:"ã‚µãƒ•ã‚¡ã‚¤ã‚¢",
  garnet:"ã‚¬ãƒ¼ãƒãƒƒãƒˆ",
  pink_tourmaline:"ãƒ”ãƒ³ã‚¯ãƒˆãƒ«ãƒãƒªãƒ³",
  diamond:"ãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰",
  morganite:"ãƒ¢ãƒ«ã‚¬ãƒŠã‚¤ãƒˆ",
  smoky_quartz:"ã‚¹ãƒ¢ãƒ¼ã‚­ãƒ¼ã‚¯ã‚©ãƒ¼ãƒ„",
  tanzanite:"ã‚¿ãƒ³ã‚¶ãƒŠã‚¤ãƒˆ",
  alexandrite:"ã‚¢ãƒ¬ã‚­ã‚µãƒ³ãƒ‰ãƒ©ã‚¤ãƒˆ",
  blue_topaz:"ãƒ–ãƒ«ãƒ¼ãƒˆãƒ‘ãƒ¼ã‚º",
  ruby:"ãƒ«ãƒ“ãƒ¼"
};

/* ===== loveÃ—attach â†’ gemï¼ˆã‚¹ãƒ©ãƒƒã‚°ï¼‰ ===== */
const GEM_MAP = {
  eros:   { anxious:"fire_opal", secure:"garnet",      avoidant:"spinel",        fearful:"ruby" },
  ludus:  { anxious:"tanzanite", secure:"citrine",     avoidant:"turquoise",     fearful:"apatite" },
  storge: { anxious:"moonstone", secure:"aquamarine",  avoidant:"peridot",       fearful:"labradorite" },
  pragma: { anxious:"blue_topaz",secure:"sapphire",    avoidant:"black_onyx",    fearful:"smoky_quartz" },
  mania:  { anxious:"emerald",   secure:"alexandrite", avoidant:"obsidian",      fearful:"opal" },
  agape:  { anxious:"pink_tourmaline", secure:"diamond", avoidant:"morganite", fearful:"rose_quartz" }
};

// gem â†’ love/attachï¼ˆç›¸äº’å‚ç…§ã‚’ä½œã‚‹ï¼šç›¸æ€§ãƒªãƒ³ã‚¯ç­‰ã§ä½¿ç”¨ï¼‰
const REVERSE = {};
for (const love in GEM_MAP){
  for (const attach in GEM_MAP[love]){
    const g = GEM_MAP[love][attach];
    REVERSE[g] = { love, attach };
  }
}

/* ===== ç›¸æ€§ï¼ˆã‚ãªãŸã®è¡¨ã«å®Œå…¨æº–æ‹ ï¼‰ ===== */
const COMPAT = {
  amethyst:        { good:"spinel",          bad:"turquoise" },
  obsidian:        { good:"citrine",         bad:"apatite" },
  emerald:         { good:"rose_quartz",     bad:"peridot" },
  opal:            { good:"apatite",         bad:"ruby" },
  aquamarine:      { good:"fire_opal",       bad:"black_onyx" },
  peridot:         { good:"turquoise",       bad:"emerald" },
  moonstone:       { good:"citrine",         bad:"smoky_quartz" },
  labradorite:     { good:"rose_quartz",     bad:"alexandrite" },
  sapphire:        { good:"garnet",          bad:"pink_tourmaline" },
  black_onyx:      { good:"tanzanite",       bad:"aquamarine" },
  blue_topaz:      { good:"morganite",       bad:"fire_opal" },
  smoky_quartz:    { good:"labradorite",     bad:"moonstone" },
  garnet:          { good:"sapphire",        bad:"turquoise" },
  spinel:          { good:"amethyst",        bad:"ruby" },
  fire_opal:       { good:"aquamarine",      bad:"spinel" },
  ruby:            { good:"diamond",         bad:"opal" },
  diamond:         { good:"ruby",            bad:"tanzanite" },
  morganite:       { good:"labradorite",     bad:"sapphire" },
  pink_tourmaline: { good:"apatite",         bad:"sapphire" },
  rose_quartz:     { good:"emerald",         bad:"spinel" },
  citrine:         { good:"moonstone",       bad:"obsidian" },
  turquoise:       { good:"peridot",         bad:"garnet" },
  tanzanite:       { good:"black_onyx",      bad:"emerald" },
  apatite:         { good:"pink_tourmaline", bad:"opal" }
};

/* ===== è¨­å•ã®æç”»ã¨é€²æ— ===== */
const form = document.getElementById("quizForm");
const progressEl = document.getElementById("progress");
questions.forEach((q, i) => {
  const div = document.createElement("div");
  div.className = "question";
  div.innerHTML = `<p>Q${i+1}. ${q}</p>
    <div class="scale">
      ${scaleLabels.map((label, n)=>`<label><input type="radio" name="q${i+1}" value="${n+1}"> ${label}</label>`).join("")}
    </div>`;
  form.appendChild(div);
});
function updateProgress(){
  const answered = questions.filter((_,i)=>document.querySelector(`input[name="q${i+1}"]:checked`)).length;
  progressEl.textContent = `æœªå›ç­” ${questions.length - answered} / ${questions.length}`;
}
form.addEventListener("change", updateProgress);
updateProgress();

/* ===== ã‚¹ã‚³ã‚¢è¨ˆç®— â†’ ã‚¿ã‚¤ãƒ—åˆ¤å®š ===== */
function calculate(){
  const scores = { eros:0,ludus:0,storge:0,mania:0,pragma:0,agape:0, anxiety:0,avoidance:0 };
  for(let i=1;i<=questions.length;i++){
    const v = parseInt(document.querySelector(`input[name="q${i}"]:checked`)?.value);
    if(!v){ alert(`å…¨ã¦ã®è³ªå•ã«ç­”ãˆã¦ãã ã•ã„ã€‚\næœªå›ç­”ã®è¨­å•ãŒã‚ã‚Šã¾ã™ï¼ˆQ${i}ï¼‰ã€‚`); return; }
    if (i<=4) scores.eros+=v;
    else if (i<=8) scores.ludus+=v;
    else if (i<=12) scores.storge+=v;
    else if (i<=16) scores.mania+=v;
    else if (i<=20) scores.pragma+=v;
    else if (i<=24) scores.agape+=v;
    else if (i<=28) scores.anxiety+=v;
    else scores.avoidance+=v;
  }
  // love æœ€å¤§
  const love = Object.entries(scores).slice(0,6).sort((a,b)=>b[1]-a[1])[0][0];
  // attach åˆ¤å®šï¼ˆé–¾å€¤ã¯æš«å®šï¼šå„4å•Ã—å¹³å‡2.75â‰’11ï¼‰
  let attach="secure";
  if (scores.anxiety>=11 && scores.avoidance>=11) attach="fearful";
  else if (scores.anxiety>=11) attach="anxious";
  else if (scores.avoidance>=11) attach="avoidant";

  const gem = GEM_MAP[love]?.[attach];
  renderResult({ love, attach, gem, scores });
  window.scrollTo({ top: document.body.scrollHeight, behavior:"smooth" });
}

/* ===== çµæœæç”» ===== */
function renderResult({ love, attach, gem, scores }){
  const result = document.getElementById("resultArea");
  if (!gem){ result.innerHTML = `<p>åˆ¤å®šã§ãã¾ã›ã‚“ã§ã—ãŸã€‚</p>`; return; }

  const gemJP = GEM_DEFS[gem];
  const imgPath = `/shindan/assets/results/houseki/${love}-${attach}/01.png`;
  const bundleBase = `/shindan/assets/results/houseki-bundle/${love}`;
  const compat = COMPAT[gem];

  // å…±æœ‰ãƒªãƒ³ã‚¯ï¼ˆæ·±ã„ãƒªãƒ³ã‚¯ï¼‰
  const shareURL = new URL(location.href);
  shareURL.searchParams.set("love", love);
  shareURL.searchParams.set("attach", attach);

  result.innerHTML = `
    <div class="result-head">
      <p>ã‚ãªãŸã®å®çŸ³ã‚¿ã‚¤ãƒ—ã¯ <span class="gem-name">ã€Œ${gemJP}ã€</span></p>
      <p>ï¼ˆæ‹æ„›ã‚¹ã‚¿ã‚¤ãƒ«ï¼š${LOVE_JP[love]} Ã— æ„›ç€ï¼š${ATTACH_JP[attach]}ï¼‰</p>
    </div>
    <img class="result-img" src="${imgPath}" alt="${gemJP} ã®çµæœç”»åƒ"
         onerror="this.alt='çµæœç”»åƒãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“';this.style.opacity=.35;">
    <div class="ctas">
      <button class="linkbtn" onclick="Viewer.show('${love}',1)" title="ã¾ã¨ã‚ç”»åƒï¼ˆ01ã€œ05ï¼‰ã‚’è¦‹ã‚‹">ã¾ã¨ã‚ï¼ˆ01â€“05ï¼‰ã‚’è¦‹ã‚‹</button>
      <a class="linkbtn primary" href="https://haisuikounozarigani.github.io/shindan/" target="_self">è¨ºæ–­ä¸€è¦§ã¸æˆ»ã‚‹</a>
      <button class="linkbtn share" onclick="copyShare('${shareURL.toString()}')">çµæœãƒªãƒ³ã‚¯ã‚’ã‚³ãƒ”ãƒ¼</button>
    </div>

    ${compat ? `
    <div class="compat">
      <span class="badge">è‰¯ã„ç›¸æ€§ï¼š<strong>${GEM_DEFS[compat.good]}</strong> <small>(å¥½ç›¸æ€§)</small></span>
      <span class="badge">æ‚ªã„ç›¸æ€§ï¼š<strong>${GEM_DEFS[compat.bad]}</strong> <small>(ç›¸æ€§ã«æ³¨æ„)</small></span>
    </div>` : ``}

    <p class="note">â€» ã¾ã¨ã‚ç”»åƒã®åˆ†é¡ï¼š01 å®‰å®šï¼02 å›é¿ï¼03 ä¸å®‰ï¼04 æã‚Œå›é¿ï¼05 ç›¸æ€§ã¾ã¨ã‚</p>
  `;
}

/* ===== å…±æœ‰ã‚³ãƒ”ãƒ¼ ===== */
function copyShare(text){
  navigator.clipboard?.writeText(text).then(()=>{
    alert("çµæœãƒªãƒ³ã‚¯ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼");
  }).catch(()=>{
    prompt("ã‚³ãƒ”ãƒ¼ã§ããªã„å ´åˆã¯ã€ä¸‹ã®URLã‚’æ‰‹å‹•ã§ã‚³ãƒ”ãƒ¼ã—ã¦ãã ã•ã„ã€‚", text);
  });
}

/* ===== ç°¡æ˜“ãƒ“ãƒ¥ãƒ¼ã‚¢ï¼ˆhouseki-bundle ç”¨ï¼š01ã€œ05ï¼‰ ===== */
const Viewer = (()=> {
  const el = document.getElementById('viewer');
  const img = document.getElementById('viewerImg');
  const title = document.getElementById('viewerTitle');
  let style = "eros", page = 1, max = 5;

  function srcOf(st, i){
    // PNGå„ªå…ˆã€å¤±æ•—ã—ãŸã‚‰webpã«è‡ªå‹•åˆ‡æ›¿
    const png = `/shindan/assets/results/houseki-bundle/${st}/${String(i).padStart(2,"0")}.png`;
    const webp= `/shindan/assets/results/houseki-bundle/${st}/${String(i).padStart(2,"0")}.webp`;
    img.onerror = function(){
      if (img.dataset.fallback!=="1"){ img.dataset.fallback="1"; img.src=webp; }
      else { img.alt="ç”»åƒãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"; }
    };
    return png;
  }
  function render(){
    title.textContent = `ã¾ã¨ã‚ï¼š${LOVE_JP[style]}ï¼ˆ${String(page).padStart(2,"0")} / 05ï¼‰`;
    img.dataset.fallback="0";
    img.src = srcOf(style, page);
  }
  return {
    show(st, start=1){ style=st; page=start; el.style.display="flex"; render(); },
    hide(){ el.style.display="none"; },
    next(){ page = page<max ? page+1 : 1; render(); },
    prev(){ page = page>1 ? page-1 : max; render(); }
  }
})();

/* ===== æ·±ã„ãƒªãƒ³ã‚¯ï¼ˆ?love=&attach=ï¼‰ã§ã®ç›´æ¥è¡¨ç¤ºã«ã‚‚å¯¾å¿œ ===== */
(function deepLink(){
  const p = new URLSearchParams(location.search);
  const love = p.get("love");
  const attach = p.get("attach");
  if (love && attach && GEM_MAP[love]?.[attach]){
    // ç–‘ä¼¼çš„ã«çµæœã ã‘å‡ºã™ï¼ˆè¨­å•ã‚¹ã‚­ãƒƒãƒ—ï¼‰
    renderResult({ love, attach, gem: GEM_MAP[love][attach], scores:{} });
  }
})();

/* ===== ãƒªã‚»ãƒƒãƒˆ ===== */
function resetForm(){
  form.reset();
  document.getElementById("resultArea").innerHTML = "";
  updateProgress();
  window.scrollTo({top:0, behavior:"smooth"});
}
</script>
</body>
</html>
