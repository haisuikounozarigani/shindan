<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ä¸ƒã¤ã®å¤§ç½ªè¨ºæ–­ï¼ˆ7å› å­ãƒ»28é …ç›®ï¼‰</title>
<meta name="description" content="ä¸ƒã¤ã®å¤§ç½ªãƒ¢ãƒãƒ¼ãƒ•ã§7é ˜åŸŸÃ—å„4é …ç›®ãƒ»5ä»¶æ³•ã§â€œã‚ãªãŸã®å‚¾å‘â€ã‚’å¯è¦–åŒ–ã—ã¾ã™ã€‚ã‚¨ãƒ³ã‚¿ãƒ¡ç”¨ã‚»ãƒ«ãƒ•ãƒã‚§ãƒƒã‚¯ï¼ˆåŒ»ç™‚ç›®çš„ã§ã¯ã‚ã‚Šã¾ã›ã‚“ï¼‰ã€‚">
<meta name="theme-color" content="#fff7fd">

<!-- OG -->
<meta property="og:type" content="website">
<meta property="og:title" content="ä¸ƒã¤ã®å¤§ç½ªè¨ºæ–­ï½œä¸ƒã¤ã®å¤§ç½ªãƒ¢ãƒãƒ¼ãƒ•ã‚’ãƒã‚¤ãƒ«ãƒ‰å†æ§‹æˆ">
<meta property="og:description" content="7é ˜åŸŸÃ—å„4é …ç›®ï¼ˆ5ä»¶æ³•ï¼‰ã§â€œã„ã¾ã®å‚¾å‘â€ã‚’è¡¨ç¤ºã€‚ãƒˆãƒƒãƒ—2å› å­ãƒ»å…¨ä½“å¹³å‡ãƒ»è‡ªå·±èª¿å¾‹æŒ‡æ•°ã‚‚ç¢ºèªã§ãã¾ã™ã€‚">
<meta property="og:image" content="/shindan/assets/results/seven-sins/01.png">
<meta property="og:url" content="/shindan/seven-sins.html">

<style>
  :root{
    --bg1:#fff7fd; --bg2:#f5f7ff; --paper:#ffffff; --ink:#14131a; --muted:#6b6a77;
    --line:#ebe7f3; --accent:#8c6bff; --accent2:#ff8fc7; --good:#2bb673;
  }
  *{box-sizing:border-box} html,body{height:100%}
  body{margin:0;color:var(--ink);font-family:"Noto Sans JP",system-ui,-apple-system,Segoe UI,Roboto,"Hiragino Kaku Gothic ProN","Yu Gothic UI","YuGothic",Meiryo,sans-serif;background:linear-gradient(160deg,var(--bg1),var(--bg2));line-height:1.85;letter-spacing:.02em}
  header{position:sticky;top:0;z-index:5;background:rgba(255,255,255,.92);backdrop-filter:saturate(1.1) blur(8px);border-bottom:1px solid var(--line)}
  header .in{max-width:980px;margin:auto;padding:12px 16px;display:flex;gap:12px;align-items:center}
  h1{font-size:18px;margin:0;font-weight:800}
  .crumb{margin-left:auto;color:var(--muted);font-size:12px}

  main{max-width:980px;margin:0 auto;padding:22px 16px 120px}
  .panel{background:var(--paper);border:1px solid var(--line);border-radius:16px;padding:16px;box-shadow:0 10px 28px rgba(0,0,0,.06)}
  .lead{color:var(--muted);margin-top:6px}
  .warn{margin:12px 0;border:1px dashed #e9b6c8;background:#fff7fb;color:#432;padding:10px;border-radius:12px}
  .warn strong{color:#b12a6b}
  .section-title{margin:12px 0 8px;font-size:15px;font-weight:800}

  .q{border-top:1px solid var(--line);padding:12px 0}
  .q:first-child{border-top:0}
  .q .ttl{font-weight:700}
  .scale{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
  .opt{flex:1 1 180px;min-width:160px;border:1px solid var(--line);border-radius:12px;padding:8px 10px;display:flex;gap:8px;align-items:center;background:#fff;cursor:pointer}
  .opt input{accent-color:var(--accent);transform:translateY(1px)}
  .muted{color:var(--muted)}

  /* === sticky progressï¼ˆnoh/great-mindsæº–æ‹ ãƒ»ãƒ‘ãƒãƒ«å¹…ã„ã£ã±ã„ï¼‰ === */
.sticky{
  position: sticky;
  top: 56px;          /* ãƒ˜ãƒƒãƒ€ãƒ¼é«˜ã•ã«åˆã‚ã›ã¦ï¼ˆã‚ãªãŸã®ãƒšãƒ¼ã‚¸ã¯ 56px ãŒåˆã†ï¼‰ */
  z-index: 6;         /* ãƒ˜ãƒƒãƒ€ãƒ¼(z=5)ã®ã™ãä¸‹ã«æ•·ã */
  margin: -6px -16px 12px;
  padding: 8px 16px;
  background: rgba(255,255,255,.92);
  backdrop-filter: saturate(1.05) blur(8px);
  border-bottom: 1px solid var(--line);
  display: flex; align-items: center; gap: 10px;
}
.sticky .bar{
  flex:1; height:8px; background:#f0ecfb;
  border-radius:999px; overflow:hidden;
}
.sticky .bar > i{
  display:block; height:100%; width:0;
  background:linear-gradient(90deg,var(--accent),var(--accent2));
  transition:width .25s ease;
}
  .actions{display:flex;gap:10px;margin-top:14px;flex-wrap:wrap}
  .btn{appearance:none;border:1px solid var(--line);background:linear-gradient(180deg,#fff,#f7f7fb);padding:10px 14px;border-radius:12px;cursor:pointer;font-weight:700;color:var(--ink)}
  .btn.primary{background:linear-gradient(90deg,var(--accent),var(--accent2));color:#fff;border-color:transparent}
  .btn[disabled]{opacity:.55;cursor:not-allowed}
  .btn.linklike{background:#fff}

  /* Results */
  #result{margin-top:18px;display:none}
  figure.hero{margin:10px 0;border:1px solid var(--line);border-radius:14px;overflow:hidden;background:#fff}
  .badge{padding:2px 8px;border-radius:999px;border:1px solid var(--line);font-size:12px;background:#fff}
  .stage{display:flex;align-items:center;gap:8px;font-weight:800}
  .copy{color:#4a3d57;margin:6px 0 0}
  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:10px;margin-top:10px}
  .card{border:1px solid var(--line);border-radius:14px;padding:12px;background:#fff}
  .card .name{font-weight:800}
  .meter{height:6px;background:#f0ecfb;border-radius:999px;overflow:hidden;margin-top:8px}
  .meter > i{display:block;height:100%}
  .small{font-size:.95em}
  a.back{display:inline-flex;align-items:center;gap:8px;margin-top:16px;text-decoration:none;color:var(--muted)}
  a.back .ico{font-size:18px}
  details{margin-top:8px}
  summary{cursor:pointer;color:#5c4d7a;font-weight:700}
</style>
</head>
<body data-id="seven-sins">
<header><div class="in">
  <h1>ä¸ƒã¤ã®å¤§ç½ªè¨ºæ–­</h1>
  <span class="crumb">28é …ç›®ãƒ»1ã€œ5 â†’ ãƒˆãƒƒãƒ—2ï¼‹å…¨ä½“å¹³å‡ï¼‹è‡ªå·±èª¿å¾‹</span>
</div></header>

<main>
  <section class="panel" id="quiz">
    <div>
      <div class="ttl"><strong>ä¸ƒã¤ã®å¤§ç½ªãƒ¢ãƒãƒ¼ãƒ•ã‚’ãƒã‚¤ãƒ«ãƒ‰å†æ§‹æˆ</strong>ã—ã€7å› å­Ã—å„4é …ç›®ã§â€œã„ã¾ã®å‚¾å‘â€ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚</div>
      <p class="lead">ç­”ãˆæ–¹ï¼ˆ1ã€œ5ï¼‰ï¼š1 å…¨ããªã„ï¼2 ãŸã¾ã«ï¼3 ã¨ãã©ãï¼4 ã‚ˆãã‚ã‚‹ï¼5 ã»ã¨ã‚“ã©ã„ã¤ã‚‚</p>
 

<!-- é€²æ—ï¼ˆä¸Šéƒ¨å›ºå®šï¼‰ -->
<div class="sticky" aria-live="polite">
  <span aria-hidden="true">ğŸ“Š</span>
  <div class="bar" aria-hidden="true"><i id="pbar"></i></div>
  <div id="ptext" class="muted">0 / 28</div>
</div>

<!-- è³ªå•ï¼ˆå› å­åã®è¡¨ç¤ºã¯ã—ãªã„ï¼é †ç•ªã‚‚æ¯å›ãƒ©ãƒ³ãƒ€ãƒ ï¼‰ -->
<div id="qbox"></div>

    <!-- æ“ä½œ -->
    <div class="actions">
      <button id="btnCalc" class="btn primary" disabled>çµæœã‚’è¦‹ã‚‹</button>
      <button id="btnReset" class="btn">ãƒªã‚»ãƒƒãƒˆ</button>
      <a href="/shindan/" class="btn linklike" role="button">è¨ºæ–­ä¸€è¦§ã«æˆ»ã‚‹</a>
    </div>

    <!-- çµæœ -->
    <div id="result" class="panel">
      <h2 class="section-title" style="font-size:18px">çµæœ</h2>
      <div id="head"></div>

      <figure class="hero"><img id="heroImg" src="" alt="" style="width:100%;height:auto;display:block" loading="lazy"></figure>
      <p class="copy" id="heroCopy"></p>

      <h3 class="section-title">ãƒˆãƒƒãƒ—2å› å­</h3>
      <div class="grid" id="top2"></div>

      <h3 class="section-title">å…¨ä½“ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ7å› å­ï¼‰</h3>
      <div class="grid" id="all"></div>

      <details>
        <summary>ãƒãƒ³ãƒ‰ï¼ˆ%ï¼‰ã®ã‚ã‚„ã™</summary>
        <div class="small muted">
          <p><b>é™ç©å¸¯</b> 0â€“24 ï¼ <b>å®‰å®šå¸¯</b> 25â€“49 ï¼ <b>æºã‚‰ãå¸¯</b> 50â€“74 ï¼ <b>å¼·æ´»æ€§å¸¯</b> 75â€“100</p>
        </div>
      </details>

      <p class="small muted" style="margin-top:10px">â€» ã‚¹ã‚³ã‚¢ã¯â€œä»Šã®å‚¾å‘â€ã®ç›®å®‰ã§ã™ã€‚é«˜ä½ã«è‰¯ã—æ‚ªã—ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚æ‰±ã„æ–¹ã®ãƒ’ãƒ³ãƒˆã¨ã—ã¦ã”åˆ©ç”¨ãã ã•ã„ã€‚</p>

      <div style="margin-top:14px">
        <a href="/shindan/" class="back"><span class="ico">â†©</span><span>è¨ºæ–­ä¸€è¦§ã«æˆ»ã‚‹</span></a>
      </div>
    </div>
  </section>
     <p class="warn"><strong>æ³¨æ„ï¼š</strong>ã“ã®è¨ºæ–­ã¯<b>ã‚¨ãƒ³ã‚¿ãƒ¡ç”¨ã®ã‚»ãƒ«ãƒ•ãƒã‚§ãƒƒã‚¯</b>ã§ã™ã€‚åŒ»ç™‚ãƒ»è¨ºæ–­ãƒ»æ²»ç™‚ã‚’ç›®çš„ã¨ã—ã¾ã›ã‚“ã€‚ã”åˆ©ç”¨ã¯è‡ªå·±åˆ¤æ–­ãƒ»è‡ªå·±è²¬ä»»ã§ã€‚<br>â€» ã‚«ãƒ†ã‚´ãƒªãƒ¼åã¯<b>æ¯”å–©ãƒ»æ¼”å‡ºè¡¨ç¾</b>ã§ã™ï¼ˆå®—æ•™çš„ãƒ»å€«ç†çš„ä¾¡å€¤åˆ¤æ–­ã¯æ„å›³ã—ã¦ã„ã¾ã›ã‚“ï¼‰</br>
å›ç­”ã¯ç«¯æœ«å†…ã§å‡¦ç†ãƒ»ä¿å­˜ã•ã‚Œã€å›ç­”å†…å®¹ã‚„å€‹äººã‚’ç‰¹å®šã§ãã‚‹æƒ…å ±ã¯ã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡ã•ã‚Œã¾ã›ã‚“ã€‚çµæœè¡¨ç¤ºæ™‚ã«åŒ¿åã®ä»¶æ•°ã‚«ã‚¦ãƒ³ãƒˆã®ã¿é€ä¿¡ã™ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚</p>
    </div>
</main>

<script>
(()=> {
  // ===== ç”»åƒãƒ‘ã‚¹ =====
  const IMG_BASE = '/shindan/assets/results/seven-sins/';
  const IMAGE_BY_KEY = {PR:'01.png', EN:'02.png', WR:'03.png', SL:'04.png', GD:'05.png', GL:'06.png', LU:'07.png'};

  // ===== è¡¨ç¤ºåï¼ˆçµæœã§ä½¿ã†è¦‹å‡ºã—ï¼šå¤§ç½ªåï¼‹ã‚„ã‚ã‚‰ã’ãƒ©ãƒ™ãƒ«ï¼‰ =====
  const DISPLAY = {
    PR:'å‚²æ…¢ï¼ˆè‡ªå·±é«˜æšï¼‰',
    EN:'å«‰å¦¬ï¼ˆæ¯”è¼ƒæ„Ÿåº¦ï¼‰',
    WR:'æ†¤æ€’ï¼ˆæ€’ã‚Šæ´»æ€§ï¼‰',
    SL:'æ€ æƒ°ï¼ˆå…ˆé€ã‚Šå‚¾å‘ï¼‰',
    GD:'å¼·æ¬²ï¼ˆæ‰€æœ‰ãƒ»åé›†å¿—å‘ï¼‰',
    GL:'æš´é£Ÿï¼ˆå¿«æ¥½ãƒ‰ãƒ©ã‚¤ãƒ–ï¼‰',
    LU:'è‰²æ¬²ï¼ˆè¦ªå¯†è¡å‹•ï¼‰'
  };

  // ===== å› å­å®šç¾©ï¼ˆå„4é …ç›®ãƒ»rev=é€†è»¢ï¼‰=====
  const FACTORS = [
    {key:'PR', name:'è‡ªå·±é«˜æšï¼ˆPrideï¼‰',
     items:[
       {t:'å®Ÿç¸¾ã‚„åŠªåŠ›ã‚’ã€ã¤ã„å¼·ã‚ã«ä¼ãˆãŸããªã‚‹', rev:false},
       {t:'å‘¨å›²ã®å ´é¢ã§ä¸»å°æ¨©ã‚’å–ã‚ŠãŸããªã‚‹', rev:false},
       {t:'å¼±ã¿ã‚„ãƒŸã‚¹ã‚‚ã€å¿…è¦ãªã‚‰ç‡ç›´ã«å…±æœ‰ã§ãã‚‹', rev:true},
       {t:'éå°è©•ä¾¡ã‚’æ„Ÿã˜ã‚‹ã¨ã€åç™ºã—ãŸããªã‚‹', rev:false},
     ]},
    {key:'EN', name:'æ¯”è¼ƒæ„Ÿåº¦ï¼ˆEnvyï¼‰',
     items:[
       {t:'åŒå¹´ä»£ã®æˆåŠŸã‚’è¦‹ã‚‹ã¨ã€æ°—æŒã¡ãŒæºã‚Œã‚‹', rev:false},
       {t:'SNSã§ä»–äººã¨æ¯”ã¹ã¦ã—ã¾ã†', rev:false},
       {t:'äººãã‚Œãã‚Œã®ãƒšãƒ¼ã‚¹ã ã¨è½ã¡ç€ã„ã¦æ‰ãˆç›´ã›ã‚‹', rev:true},
       {t:'èº«è¿‘ãªäººã¸ã®ç§°è³›ã«ã€ç„¦ã‚ŠãŒèŠ½ç”Ÿãˆã‚‹ã“ã¨ãŒã‚ã‚‹', rev:false},
     ]},
    {key:'WR', name:'æ€’ã‚Šæ´»æ€§ï¼ˆWrathï¼‰',
     items:[
       {t:'ä¸å…¬å¹³ã ã¨æ„Ÿã˜ã‚‹ã¨ã€å¿ƒæ‹ãŒä¸ŠãŒã‚‹', rev:false},
       {t:'å°ã•ãªç„¡ç¤¼ã§ã‚‚å†…å¿ƒã–ã‚ã¤ã', rev:false},
       {t:'ãã®å ´ã§è¨€ã„è¿”ã—ãŸããªã‚‹è¡å‹•ãŒå‡ºã‚‹', rev:false},
       {t:'é«˜ã¶ã£ã¦ã‚‚ã€ä¸€å‘¼å¸ãŠã‘ã‚‹', rev:true},
     ]},
    {key:'SL', name:'å…ˆé€ã‚Šå‚¾å‘ï¼ˆSlothï¼‰',
     items:[
       {t:'é¢å€’ã ã¨ã€åˆ¥ã®æ¥½ãªä½œæ¥­ã«é€ƒã’ã‚‹', rev:false},
       {t:'æ°—ã®é€²ã¾ãªã„ç”¨äº‹ã‚’å¾Œå›ã—ã«ã—ãŒã¡', rev:false},
       {t:'ç· åˆ‡ç›´å‰ã¾ã§å‹•ããŒé‡ããªã‚Šã‚„ã™ã„', rev:false},
       {t:'çŸ­æ™‚é–“ã§ã‚‚åŒºåˆ‡ã£ã¦ç€æ‰‹ã§ãã‚‹', rev:true},
     ]},
    {key:'GD', name:'æ‰€æœ‰ãƒ»åé›†å¿—å‘ï¼ˆGreedï¼‰',
     items:[
       {t:'å½¹ç«‹ã¡ãã†ãªæƒ…å ±ã‚„ç‰©ã‚’é›†ã‚ãŸããªã‚‹', rev:false},
       {t:'å¾—ã«ãªã‚Šãã†ãªè©±ã«å¿ƒãŒãã‚ãã‚ã™ã‚‹', rev:false},
       {t:'å¿…è¦ãªã„ã‚‚ã®ã¯æ‰‹æ”¾ã›ã‚‹', rev:true},
       {t:'æã‚’é¿ã‘ã‚ˆã†ã¨ã—ã¦é¸æŠãŒå›ºããªã‚‹', rev:false},
     ]},
    {key:'GL', name:'å¿«æ¥½ãƒ‰ãƒ©ã‚¤ãƒ–ï¼ˆGluttonyï¼‰',
     items:[
       {t:'æ°—åˆ†è»¢æ›ã®ã¤ã‚‚ã‚ŠãŒé•·å¼•ã„ã¦ã—ã¾ã†', rev:false},
       {t:'ã”è¤’ç¾ã‚’ç†ç”±ã«äºˆå®šã‚’å¤‰ãˆãŒã¡', rev:false},
       {t:'ç›®ã®å‰ã®æ¥½ã—ã•ã«æ³¨æ„ãŒæŒã£ã¦ã„ã‹ã‚Œã‚‹', rev:false},
       {t:'ã€Œæ°—åˆ†ã€ã¨ã€Œå¿…è¦ã€ã‚’åˆ†ã‘ã¦è€ƒãˆã‚‰ã‚Œã‚‹', rev:true},
     ]},
    {key:'LU', name:'è¦ªå¯†è¡å‹•ï¼ˆLustï¼šãƒã‚¤ãƒ«ãƒ‰ï¼‰',
     items:[
       {t:'è¦ªã—ã„äººã‹ã‚‰ã®åå¿œãŒé…ã„ã¨ã€ã™ãå¿ƒãŒã–ã‚ã¤ã', rev:false},
       {t:'æ–°ã—ã„å‡ºä¼šã„ã‚„ä¼šè©±ã«ã¨ãã‚ãã¨ã€ä»–ã®äºˆå®šã‚’å¾Œå›ã—ã«ã—ãŒã¡', rev:false},
       {t:'é€ã‚‹å‰ã«ä¸€åº¦è¦‹ç›´ã—ã¦ã€è½ã¡ç€ã„ã¦è¿”ä¿¡ã§ãã‚‹', rev:true},
       {t:'ã•ã³ã—ã•ã‚’åŸ‹ã‚ãŸãã¦ã€äºˆå®šå¤–ã®èª˜ã„ã‚„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ã‚ŠãŸããªã‚‹', rev:false},
     ]},
  ];

  // 5ä»¶æ³•ï¼ˆ1..5ï¼‰ â€»é€†è»¢ã¯ (6 - v)
  const SCALE = [
    {v:1, label:'1 å…¨ããªã„'},
    {v:2, label:'2 ãŸã¾ã«'},
    {v:3, label:'3 ã¨ãã©ã'},
    {v:4, label:'4 ã‚ˆãã‚ã‚‹'},
    {v:5, label:'5 ã»ã¨ã‚“ã©ã„ã¤ã‚‚'},
  ];

  // ===== èª¬æ˜ï¼†â€œã‚„ã‚ã‚‰ã’ãƒ†ã‚¯â€ =====
  const DESC = {
  PR:'è‡ªåˆ†ã®ä¾¡å€¤ã‚’ç¤ºã—ãŸã„æ°—æŒã¡ãŒå‰ã«å‡ºã‚„ã™ã„çŠ¶æ…‹ã§ã™ã€‚è‡ªä¿¡ã‚„ãƒªãƒ¼ãƒ‰åŠ›ã¨ã—ã¦åƒãã¾ã™ãŒã€ä¼ãˆæ–¹ãŒå¼·ã„ã¨é–¢ä¿‚ãŒããã—ã‚ƒãã—ãŒã¡ã€‚ã€Œå…±æœ‰ã€ã®ã¤ã‚‚ã‚Šã§ã‚‚ç›¸æ‰‹ã«ã¯ã€Œè‡ªæ…¢ã€ã«è¦‹ãˆã‚‹ã“ã¨ã‚‚ã‚ã‚Šã¾ã™ã€‚è¦–ç‚¹ã‚’å°‘ã—å…¥ã‚Œæ›¿ãˆã€å‘¨ã‚Šã¸ã®ãŠç¤¼ã‚‚æ·»ãˆã‚‹ã¨ã€åŠ›ãŒå‰å‘ãã«ä½¿ãˆã¾ã™ã€‚',
  EN:'æ¯”ã¹ã‚‹æ°—æŒã¡ãŒå¼·ã‚ã§ã™ã€‚ç›®æ¨™ã®ç«ç¨®ã«ã‚‚ãªã‚Šã¾ã™ãŒã€è¡Œãéãã‚‹ã¨è‡ªå·±åŠ¹åŠ›æ„ŸãŒä¸‹ãŒã‚Šã¾ã™ã€‚å¤–ã®ç‰©å·®ã—ã‚’ä¸€åº¦ã€Œæ˜¨æ—¥ã®è‡ªåˆ†ã€ã¨ã®æ¯”ã¹ã«æˆ»ã™ã¨ã€è½ã¡ç€ã„ã¦é€²ã‚ã¾ã™ã€‚',
  WR:'ä¸å…¬å¹³ã«ç´ æ—©ãåå¿œã—ã€å¢ƒç•Œã‚’å®ˆã‚ã†ã¨ã™ã‚‹åŠ›ãŒé«˜ã‚ã§ã™ã€‚å¤§äº‹ãªè³‡è³ªã§ã™ãŒã€æ—©ã„åæ’ƒã¯å¾Œæ‚”ã—ãŒã¡ã€‚ä½“ã®ç·Šå¼µã‚’ã»ã©ãã€æ€’ã‚Šã®ä¸‹ã«ã‚ã‚‹æœ¬å½“ã®æ°—æŒã¡ï¼ˆæ‚²ã—ã¿ãƒ»ä¸å®‰ãƒ»ç–²ã‚Œï¼‰ã«åå‰ã‚’ã¤ã‘ã‚‹ã¨è½ã¡ç€ãã‚„ã™ããªã‚Šã¾ã™ã€‚',
  SL:'å…ˆå»¶ã°ã—ãŒèµ·ãã‚„ã™ã„çŠ¶æ…‹ã§ã™ã€‚ã‚¨ãƒãƒ«ã‚®ãƒ¼ç¯€ç´„ã®çŸ¥æµã§ã‚‚ã‚ã‚Šã¾ã™ãŒã€ç¶šãã¨æ©Ÿä¼šã‚’é€ƒã—ã¾ã™ã€‚ç€æ‰‹ã¾ã§ã®æ‘©æ“¦ã‚’æ¸›ã‚‰ã—ã€ä½œæ¥­ã®å…¥å£ã‚’å°ã•ãã™ã‚‹å·¥å¤«ãŒåŠ¹ãã¾ã™ã€‚',
  GD:'å¢—ã‚„ã™ãƒ»å®ˆã‚‹æ–¹å‘ã«æ°—æŒã¡ãŒå‘ãã‚„ã™ã„çŠ¶æ…‹ã§ã™ã€‚å‚™ãˆã®æ‰èƒ½ã§ã™ãŒã€ã€ŒæŒã¤ã“ã¨ã€è‡ªä½“ãŒç›®çš„ã«ãªã‚‹ã¨é‡ããªã‚Šã¾ã™ã€‚æŒãŸãªãã¦ã‚‚æº€ãŸã›ã‚‹æ–¹æ³•ã‚’å…ˆã«æ¢ã™ã¨ã€è»½ãé€²ã‚ã¾ã™ã€‚',
  GL:'æ¥½ã—ã•ã«èˆµãŒåˆ‡ã‚‰ã‚Œã‚„ã™ã„çŠ¶æ…‹ã§ã™ã€‚å›å¾©ã‚„å‰µé€ æ€§ã«ã¯è‰¯ã„åé¢ã€çŸ­æœŸã®æ¥½ã—ã•ã«æµã•ã‚Œã‚„ã™ã„å±€é¢ã§ã‚‚ã‚ã‚Šã¾ã™ã€‚å°‘ã—å¾…ã¤å·¥å¤«ã¨ç’°å¢ƒã®èª¿æ•´ã€æ±ºã‚ã”ã¨ã®è‡ªå‹•åŒ–ã§ã€Œæ°—åˆ†ã€ã¨ã€Œç›®çš„ã€ã‚’åˆã‚ã›ã‚‰ã‚Œã¾ã™ã€‚',
  LU:'ã¤ãªãŒã‚Šã‚„æ‰¿èªã‚’æ±‚ã‚ã‚‹æ°—æŒã¡ãŒå¼·ã‚ã§ã™ã€‚è‡ªç„¶ãªå‹•æ©Ÿã§ã™ãŒã€å‹¢ã„ã§ã®é€£çµ¡ã¯å¢ƒç•Œã‚’ã™ã‚Šæ¸›ã‚‰ã™ã“ã¨ã‚‚ã€‚æ–‡é¢ã®çµ„ã¿ç«‹ã¦ã¨åˆ¥ã®æº€ãŸã—æ–¹ã‚’åˆã‚ã›ã‚‹ã¨ã€é–¢ä¿‚ã®è³ªã‚’ä¿ã¡ãªãŒã‚‰æº€ãŸã›ã¾ã™ã€‚'
};

  const SOFTEN = {
  PR:[
    'æˆæœã‚’ä¼ãˆã‚‹ã¨ãã¯ã€Œè‡ªåˆ†7ãƒ»å‘¨ã‚Š/é‹3ã€ã®é…åˆ†ã§ã€ãŠç¤¼ã‚‚ä¸€è¨€æ·»ãˆã‚‹ã€‚',
    'åŒã˜å†…å®¹ã‚’ç›¸æ‰‹ã®ç›®ç·šã§30ç§’æ›¸ãç›´ã™ï¼ˆç›¸æ‰‹ã®åˆ©ç‚¹â†’æ¬¡ã®ä¸€æ­©ï¼‰ã€‚',
    'äº‹å®Ÿâ†’è²¢çŒ®â†’å­¦ã³â†’å¼±ã¿1è¡Œã€ã®é †ã§è©±ã™ã€Œå‹ã€ã‚’ä½¿ã†ã€‚'
  ],
  EN:[
    'å¤–ã¨ã®æ¯”ã¹ã‚’ã€Œå…ˆé€±ã®è‡ªåˆ†ã€ã«æˆ»ã™ï¼ˆæ•°ã‚„æ™‚é–“ã§è¦‹ãˆã‚‹åŒ–ï¼‰ã€‚',
    'å«‰å¦¬â†’é¡˜ã„ã«ç¿»è¨³ï¼šä½•ã«æƒ¹ã‹ã‚ŒãŸã‹ã‚’åè©ã§æ›¸ãå‡ºã—â†’ä»Šæ—¥ã®æœ€å°ã®ä¸€æ­©ã€‚',
    'SNSã§æ°—ã¥ã„ãŸã“ã¨ã¯ãƒ¡ãƒ¢1è¡Œã«å†™ã—ã€ã‚¢ãƒ—ãƒªã¯ã„ã£ãŸã‚“é–‰ã˜ã‚‹ã€‚'
  ],
  WR:[
    'ã“ã¶ã—ã‚’10ç§’æ¡ã‚‹â†’10ç§’ã‚†ã‚‹ã‚ã‚‹Ã—3ã§ä½“ã®ç†±ã‚’ä¸‹ã’ã‚‹ã€‚',
    'æ€’ã‚Šã®ä¸‹ã®æ°—æŒã¡ï¼ˆæ‚²ã—ã¿/ä¸å®‰/ç–²ã‚Œï¼‰ã‚’ä¸€èªã§æ›¸ãâ†’ãã‚Œç”¨ã®å¯¾å‡¦ã‚’1ã¤ã€‚',
    'å¼·ã„æ–‡é¢ã¯ã€Œæ˜æ—¥é€ã‚‹ã€ã«è¨­å®šã—ã¦å¯ã‹ã›ã€æœã«è¦‹ç›´ã™ã€‚'
  ],
  SL:[
    '60ç§’ã ã‘ç’°å¢ƒæ•´ãˆï¼šæœºã®ä¸Šã‚’3ç‚¹ç‰‡ã¥ã‘ã€ä¸è¦ã‚¿ãƒ–ã‚’5ã¤é–‰ã˜ã‚‹ã€‚',
    'å¥½ããªæ›²1æ›²åˆ†ã ã‘ä½œæ¥­ã€‚çµ‚ã‚ã£ã¦ã‚‚OKï¼ˆå†é–‹ã—ã‚„ã™ã•ã‚’å„ªå…ˆï¼‰ã€‚',
    'å…¥å£ã ã‘ç€æ‰‹ï¼šãƒ•ã‚¡ã‚¤ãƒ«åã‚’ä»˜ã‘ã‚‹ï¼ã²ãªå½¢ã‚’è²¼ã‚‹ã€ã¾ã§ã§åˆæ ¼ã€‚'
  ],
  GD:[
    '1ã¤å¢—ã‚„ã™å‰ã«1ã¤æ‰‹æ”¾ã™ï¼ˆ1 in 1 outï¼‰ã€‚',
    'è²·ã†æ°—æŒã¡ãŒ7/10ä»¥ä¸Šã®æ™‚ã¯48æ™‚é–“å¯ã‹ã›ã¦ã‹ã‚‰æ±ºã‚ã‚‹ã€‚',
    'è²·ã‚ãšã«æº€ãŸã™æ¡ˆï¼ˆå…±æœ‰ãƒ»ãƒ¬ãƒ³ã‚¿ãƒ«ãƒ»å®šé¡ã‚µãƒ¼ãƒ“ã‚¹ï¼‰ã‚’å…ˆã«èª¿ã¹ã‚‹ã€‚'
  ],
  GL:[
    'æ¥½ã—ã¿ã¯15åˆ†å¾…ã£ã¦ã‹ã‚‰ã€‚ã‚¿ã‚¤ãƒãƒ¼å¾Œã«å®Ÿè¡ŒOKã€‚',
    'ã‚¹ãƒãƒ›ã¯ç™½é»’è¡¨ç¤ºï¼‹é€šçŸ¥ã¯ã¾ã¨ã‚ã¦å—ã‘ã‚‹ã€‚',
    'ã€Œï½ã—ãŸã‚‰â†’ï½ã™ã‚‹ã€ã®ç´„æŸï¼šã‚¿ã‚¹ã‚¯1ã¤â†’ä¼‘æ†©5åˆ†ã€ã‚’æ±ºã‚ã¦å®ˆã‚‹ã€‚'
  ],
  LU:[
    'é€ã‚‹å‰ã«ã€Œç›¸æ‰‹ã®äº‹æƒ…ã€ã€Œè‡ªåˆ†ã®é¡˜ã„ã€ã‚’1è¡Œãšã¤ãƒ¡ãƒ¢ã€‚',
    'çŸ­ã„å®šå‹æ–‡ï¼ˆç›®çš„â†’è¦ä»¶â†’é¸ã¹ã‚‹æ™‚é–“â†’çŒ¶äºˆï¼‰ã§é€ã‚‹ã€‚',
    'ã¾ãš3åˆ†ã ã‘ä½“ã‚’ã»ãã™ï¼å¤–ã®ç©ºæ°—ã‚’å¸ã†â†’ãã‚Œã‹ã‚‰é€£çµ¡ã€‚'
  ]
};

  // DOM
  const $  = (q,root=document)=>root.querySelector(q);
  const $$ = (q,root=document)=>[...root.querySelectorAll(q)];
  const qbox = $('#qbox'), pbar = $('#pbar'), ptext = $('#ptext');
  const btnCalc = $('#btnCalc'), btnReset = $('#btnReset');
  const res = $('#result'), head = $('#head'), heroImg = $('#heroImg'), heroCopy = $('#heroCopy');
  const top2Box = $('#top2'), allBox = $('#all');

  // === è¨­å•ã‚’ãƒ•ãƒ©ãƒƒãƒˆåŒ–ã—ã¦ã‚·ãƒ£ãƒƒãƒ•ãƒ«ï¼ˆå› å­åã¯è¡¨ç¤ºã—ãªã„ï¼‰ ===
  function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; } return a; }
  // è¨­å•é †ã‚’ä¿å­˜ã—ã¦å†ç¾ã™ã‚‹ï¼ˆé–‹ãç›´ã—ã§å›ç­”ãŒã‚ºãƒ¬ãªã„ï¼‰
const ORDER_KEY = 'specimens:order:' + ((document.body && document.body.getAttribute('data-id')) || 'seven-sins');

function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; } return a; }
function makePool(){
  return FACTORS.flatMap(f => f.items.map((it, idx) => ({
    key:f.key, text:it.t, rev:it.rev, ordKey:`${f.key}:${idx}`
  })));
}
function loadOrder(){
  try{
    const a = JSON.parse(localStorage.getItem(ORDER_KEY) || '[]');
    return Array.isArray(a) && a.length === FACTORS.reduce((n,f)=>n+f.items.length,0) ? a : null;
  }catch(_){ return null; }
}

// åˆå›ã¯ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã—ã¦é †åºã‚­ãƒ¼ã‚’ä¿å­˜ã€2å›ç›®ä»¥é™ã¯ä¿å­˜é †ã§å†æ§‹æˆ
let pool = makePool();
let order = loadOrder();
if(!order){
  shuffle(pool);
  order = pool.map(q => q.ordKey);
  try{ localStorage.setItem(ORDER_KEY, JSON.stringify(order)); }catch(_){}
} else {
  const byKey = Object.fromEntries(makePool().map(q => [q.ordKey, q]));
  pool = order.map(k => byKey[k]).filter(Boolean);
}

const QUESTIONS = pool.map(q => ({ key:q.key, text:q.text, rev:q.rev }));

  // è³ªå•æç”»ï¼ˆè¦‹å‡ºã—ãªã—ãƒ»å› å­åéè¡¨ç¤ºï¼‰
  QUESTIONS.forEach((q, i)=>{
    const s = document.createElement('section');
    s.className = 'q';
    s.innerHTML = `
      <div class="ttl">Q${i+1}. ${q.text}</div>
      <div class="scale" role="group" aria-label="è³ªå• ${i+1}">
        ${SCALE.map(sc=>{
          const id = `q${i+1}-${sc.v}`;
          return `<label class="opt" for="${id}">
            <input type="radio" name="q${i+1}" id="${id}" value="${sc.v}">
            <span>${sc.label}</span>
          </label>`;
        }).join('')}
      </div>`;
    qbox.appendChild(s);
  });

  // é€²æ—
  const TOTAL = QUESTIONS.length;
  function answeredCount(){ let n=0; for(let i=1;i<=TOTAL;i++){ if($('input[name="q'+i+'"]:checked')) n++; } return n; }
  function updateProgress(){
    const n=answeredCount();
    ptext.textContent = `${n} / ${TOTAL}`;
    pbar.style.width = Math.round(n/TOTAL*100)+'%';
    btnCalc.disabled = n!==TOTAL;
  }
  document.addEventListener('change', e=>{ if(e.target.name?.startsWith('q')) updateProgress(); });
  updateProgress();

  // é›†è¨ˆ
  function collect(){
    const vals={};
    for(let i=1;i<=TOTAL;i++){
      const el = $('input[name="q'+i+'"]:checked'); if(!el) return null;
      vals[i] = +el.value; // 1..5
    }
    return vals;
  }

  // ã‚¹ã‚³ã‚¢ç®—å‡ºï¼ˆå› å­åˆ¥ã«åˆç®—ï¼%åŒ–ã€è‡ªå·±èª¿å¾‹ï¼é€†è»¢é …ç›®ã®â€œç”Ÿå€¤â€å¹³å‡%ï¼‰
  function compute(vals){
    const sums = {PR:0,EN:0,WR:0,SL:0,GD:0,GL:0,LU:0};
    const counts = {PR:0,EN:0,WR:0,SL:0,GD:0,GL:0,LU:0};
    const revRaw = [];

    QUESTIONS.forEach((q, idx)=>{
      const v = vals[idx+1];           // 1..5
      if(q.rev) revRaw.push(v);        // ç”Ÿå€¤ã§ä¿æŒ
      const vv = q.rev ? (6 - v) : v;  // é€†è»¢é©ç”¨
      sums[q.key] += vv;
      counts[q.key] += 1;
    });

    const factors = Object.keys(sums).map(key=>{
      const avg = sums[key]/counts[key]; // 1..5
      const pct = Math.round(((avg-1)/4)*100); // 0..100
      const name = DISPLAY[key];
      return {key, name, img:IMAGE_BY_KEY[key], pct, avg:Math.round(avg*10)/10};
    }).sort((a,b)=>b.pct-a.pct);

    const overallPct = Math.round(factors.reduce((a,x)=>a+x.pct,0)/factors.length);
    const tuningPct = Math.round(((revRaw.reduce((a,v)=>a+v,0)/revRaw.length - 1)/4)*100);

    return {factors, overallPct, tuningPct};
  }

  // ãƒ©ãƒ™ãƒ«
  function bandLabel(p){ if(p>=75) return 'å¼·æ´»æ€§å¸¯'; if(p>=50) return 'æºã‚‰ãå¸¯'; if(p>=25) return 'å®‰å®šå¸¯'; return 'é™ç©å¸¯'; }

  function heroText(key, overall, tuning){
    const head = DISPLAY[key];
    return `ãƒˆãƒƒãƒ—å› å­ã¯<strong>ã€Œ${head}ã€</strong>ã€‚ã“ã‚Œã¯æ¯”å–©ä¸Šã®å‘¼ç§°ã§ã€å–„æ‚ªã®åˆ¤å®šã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ä»Šã¯ãã®å‚¾å‘ãŒå°‘ã—å¼·ã‚ã«å‡ºã¦ã„ã‚‹ã¨ã„ã†ã‚µã‚¤ãƒ³ã€‚<br>
    å…¨ä½“å¹³å‡ã¯<strong>${overall}%</strong>ã€è‡ªå·±èª¿å¾‹æŒ‡æ•°ã¯<strong>${tuning}%</strong>ã€‚è‡ªåˆ†ã¨ç’°å¢ƒã®å™›ã¿åˆã‚ã›ã‚’æ•´ãˆã‚Œã°ã€è³‡è³ªã¨ã—ã¦æ´»ã‹ã›ã¾ã™ã€‚`;
  }

  // æç”»
  function el(tag, cls, html){ const x=document.createElement(tag); if(cls) x.className=cls; if(html!=null) x.innerHTML=html; return x; }

  function render(vals){
    const {factors, overallPct, tuningPct} = compute(vals);
    const top = factors.slice(0,2);
    const topKey = top[0].key;

    // ãƒ˜ãƒƒãƒ€
    head.innerHTML = `
      <div class="stage">
        <span class="badge">å…¨ä½“å¹³å‡ ${overallPct}%</span>
        <span class="badge">è‡ªå·±èª¿å¾‹æŒ‡æ•° ${tuningPct}%</span>
      </div>
    `;

    // ç”»åƒï¼†ã‚³ãƒ”ãƒ¼ï¼ˆãƒˆãƒƒãƒ—å› å­ã«åˆã‚ã›ã‚‹ï¼‰
    heroImg.src = IMG_BASE + IMAGE_BY_KEY[topKey];
    heroImg.alt = top[0].name + 'ã®ã‚¤ãƒ¡ãƒ¼ã‚¸';
    heroCopy.innerHTML = heroText(topKey, overallPct, tuningPct);

    // ãƒˆãƒƒãƒ—2ï¼ˆé•·ã‚èª¬æ˜ï¼‹â€œã‚„ã‚ã‚‰ã’ãƒ†ã‚¯â€ï¼‰
    top2Box.innerHTML='';
    top.forEach(f=>{
      const b = bandLabel(f.pct);
      const tips = (SOFTEN[f.key]||[]).map(t=>`<li>${t}</li>`).join('');
      const card = el('article','card',`
        <div class="name" style="display:flex;align-items:center;gap:8px;flex-wrap:wrap">
          <span>${f.name}</span>
          <span class="badge">${f.pct}%</span>
          <span class="badge">${b}</span>
        </div>
        <div class="meter"><i style="width:${f.pct}%;background:linear-gradient(90deg,var(--accent),var(--accent2))"></i></div>
        <p style="margin:.7em 0 0">${DESC[f.key]}</p>
        <div class="small" style="margin:.6em 0 0"><b>ã‚„ã‚ã‚‰ã’ãƒ†ã‚¯</b></div>
        <ul class="small" style="margin:.3em 0 0 1.2em;padding:0">${tips}</ul>
      `);
      top2Box.appendChild(card);
    });

    // å…¨ä½“ï¼ˆçŸ­ç¸®è¡¨ç¤ºï¼‰
    allBox.innerHTML='';
    factors.forEach(f=>{
      const b = bandLabel(f.pct);
      const card = el('div','card small',`
        <div class="name" style="display:flex;align-items:center;gap:8px;flex-wrap:wrap">
          <span>${f.name}</span>
          <span class="badge">${f.pct}%</span>
          <span class="badge">${b}</span>
        </div>
        <div class="meter"><i style="width:${f.pct}%;background:linear-gradient(90deg,var(--accent),var(--accent2))"></i></div>
      `);
      allBox.appendChild(card);
    });

    res.style.display='block';
res.scrollIntoView({behavior:'smooth',block:'start'});
// çµæœç¢ºå®šã®åˆå›³ï¼ˆã¿ã‚“ãªã®ã“ã“ã‚Lv ã‚«ã‚¦ãƒ³ãƒˆç”¨ï¼‰
try{ document.dispatchEvent(new Event('result:ready')); }catch(_){}}

  // ã‚¤ãƒ™ãƒ³ãƒˆ
  btnCalc.addEventListener('click', ()=>{
    const vals = collect(); if(!vals) return;
    render(vals);
  });
  btnReset.addEventListener('click', ()=>{
  // å…¥åŠ›ã‚¯ãƒªã‚¢
  $$('input[type="radio"]').forEach(i=>i.checked=false);
  $('#pbar').style.width='0%'; $('#ptext').textContent='0 / ' + TOTAL;
  res.style.display='none';
  heroImg.removeAttribute('src'); heroImg.removeAttribute('alt'); heroCopy.textContent='';
  head.innerHTML=''; top2Box.innerHTML=''; allBox.innerHTML='';
  btnCalc.disabled = true;

  // ä¿å­˜ãƒ‡ãƒ¼ã‚¿ã‚‚å‰Šé™¤ï¼ˆå›ç­”ãƒ»è¨­å•é †ï¼‰
  try{
    const MY_ID = (document.body && document.body.getAttribute('data-id')) || 'seven-sins';
    localStorage.removeItem('specimens:answers:' + MY_ID);
    localStorage.removeItem('specimens:order:' + MY_ID);
  }catch(_){}

  // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹å†è¨ˆç®—
  try{ document.dispatchEvent(new Event('change',{bubbles:true})); }catch(_){}
});
})();
</script>
<script>
/* ============================================================
   è¨ºæ–­ãƒšãƒ¼ã‚¸å…±é€šã‚¹ãƒ‹ãƒšãƒƒãƒˆï¼ˆã‚³ãƒ”ãƒšç”¨ï¼‰
   1) å›ç­”ã®è‡ªå‹•ä¿å­˜ãƒ»è‡ªå‹•å¾©å…ƒï¼ˆå…¥åŠ›ä¸­ã‚‚é€æ¬¡ä¿å­˜ï¼‰
   2) çµæœè¡¨ç¤ºã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ã€Œæ¸ˆã€ï¼‹ ã‚ãªãŸã®Lv +1
   3) ã¿ã‚“ãªã®ã“ã“ã‚Lvï¼ˆCountAPIï¼‰ã« +1ï¼ˆå¤±æ•—ã¯ç„¡è¦–ï¼‰
   ------------------------------------------------------------
   â˜…ç½®ãå ´æ‰€ï¼šå„è¨ºæ–­HTMLã® </body> ã®ç›´å‰
   â˜…ãƒšãƒ¼ã‚¸IDï¼š<body data-id="xxxxx"> ã‚’æ¨å¥¨ï¼ˆæœªè¨­å®šã§ã‚‚å‹•ä½œï¼‰
============================================================ */
(function(){
  'use strict';

  // ===== å›ºå®šã‚­ãƒ¼ï¼šindex.html ã¨åˆã‚ã›ã¦ã‚ã‚Šã¾ã™ =====
  var DONE_KEY   = 'specimens:open:byid';   // è¨ºæ–­ã”ã¨ã®ã€Œæ¸ˆã€ãƒãƒƒãƒ—
  var TOTAL_KEY  = 'specimens:open:total';  // ã‚ãªãŸã®ã“ã“ã‚Lvï¼ˆåˆè¨ˆï¼‰
  var GLOBAL_LAST= 'specimens:open:global:last'; // ã¿ã‚“ãªã®Lvã®å‰å›è¡¨ç¤ºã‚­ãƒ£ãƒƒã‚·ãƒ¥

  // ===== ã“ã®ãƒšãƒ¼ã‚¸ã®ID =====
  var MY_ID = (document.body && document.body.getAttribute('data-id')) || 'unknown';

  // ===== å›ç­”ä¿å­˜ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ï¼ˆã“ã®è¨ºæ–­ã ã‘ã®ç®±ï¼‰ =====
  var ANSWER_KEY = 'specimens:answers:' + MY_ID;

  // ===== ã¿ã‚“ãªã®Lvï¼ˆCountAPIè¨­å®šï¼‰ =====
  var COUNTAPI_NS  = 'haisuikounozarigani_shindan';
  var COUNTAPI_KEY = 'specimens_open_total';
  function countapiHit(){
    var url = 'https://api.countapi.xyz/hit/'+COUNTAPI_NS+'/'+COUNTAPI_KEY;
    if(navigator.sendBeacon){
      try{ navigator.sendBeacon(url); }catch(_){}
    }else{
      fetch(url, {mode:'cors', cache:'no-store', keepalive:true}).catch(function(){});
    }
  }

  // ---------- å›ç­”ã®ä¿å­˜/å¾©å…ƒ ----------
  function loadState(){
    try{ return JSON.parse(localStorage.getItem(ANSWER_KEY) || '{}'); }catch(_){ return {}; }
  }
  function saveState(obj){
    try{ localStorage.setItem(ANSWER_KEY, JSON.stringify(obj)); }catch(_){}
  }
  function saveField(el){
    if(!el || !el.name) return;
    var st = loadState();
    var nm = el.name;

    if(el.type === 'radio'){
      // ãƒ©ã‚¸ã‚ªã¯é¸ã°ã‚ŒãŸ value ã‚’ä¿å­˜
      var chosen = (el.form || document).querySelector('input[type="radio"][name="'+nm+'"]:checked');
      st[nm] = chosen ? {t:'r', v: chosen.value} : {t:'r', v:null};
    }else if(el.type === 'checkbox'){
      // ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã¯åŒåã‚°ãƒ«ãƒ¼ãƒ—ã®ãƒã‚§ãƒƒã‚¯æ¸ˆã¿ value é…åˆ—
      var all = (el.form || document).querySelectorAll('input[type="checkbox"][name="'+nm+'"]');
      var vals = [];
      all.forEach(function(c){ if(c.checked) vals.push(c.value || 'on'); });
      st[nm] = {t:'c', v: vals};
    }else if(el.tagName==='SELECT'){
      if(el.multiple){
        var arr=[]; [].slice.call(el.options).forEach(function(o){ if(o.selected) arr.push(o.value); });
        st[nm] = {t:'m', v: arr};
      }else{
        st[nm] = {t:'s', v: el.value};
      }
    }else{
      // text / number / textarea ãªã©
      st[nm] = {t:'t', v: el.value};
    }
    saveState(st);
  }
  function restoreOnce(){
    var st = loadState();
    var names = Object.keys(st);
    if(!names.length) return false;

    names.forEach(function(nm){
      var info = st[nm]; if(!info) return;

      if(info.t==='r'){
        var r = document.querySelector('input[type="radio"][name="'+nm+'"][value="'+CSS.escape(String(info.v))+'"]');
        if(r){ r.checked = true; r.dispatchEvent(new Event('change',{bubbles:true})); }
      }else if(info.t==='c'){
        var all = document.querySelectorAll('input[type="checkbox"][name="'+nm+'"]');
        var set = new Set(info.v||[]);
        all.forEach(function(c){ c.checked = set.has(c.value || 'on'); });
      }else if(info.t==='m'){
        var sel = document.querySelector('select[name="'+nm+'"]');
        if(sel){
          var setm = new Set(info.v||[]);
          [].slice.call(sel.options).forEach(function(o){ o.selected = setm.has(o.value); });
        }
      }else if(info.t==='s'){
        var s = document.querySelector('select[name="'+nm+'"]');
        if(s){ s.value = info.v; }
      }else{
        var t = document.querySelector('[name="'+nm+'"]');
        if(t){ t.value = info.v==null? '' : String(info.v); }
      }
    });
    // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ç­‰ã‚’æ›´æ–°ã—ãŸã„UIã®ãŸã‚ã€è»½ã change ã‚’æŠ•ã’ã‚‹
    try{
      document.dispatchEvent(new Event('change', {bubbles:true}));
    }catch(_){}
    return true;
  }
  // å…¥åŠ›ç›£è¦–ï¼ˆä¿å­˜ï¼‰
  document.addEventListener('change', function(e){
    var el = e.target;
    if(!(el instanceof HTMLElement)) return;
    if(el.matches('input[name], select[name], textarea[name]')) saveField(el);
  }, true);
  document.addEventListener('input', function(e){
    var el = e.target;
    if(!(el instanceof HTMLElement)) return;
    if(el.matches('input[type="text"][name], input:not([type])[name], textarea[name]')) saveField(el);
  }, true);

  // å¾©å…ƒã¯ã€Œå…¥åŠ›ãŒæç”»ã•ã‚Œã¦ã‹ã‚‰ã€ä¸€åº¦ã ã‘è©¦ã¿ã‚‹ï¼ˆå‹•çš„ç”Ÿæˆã«ã‚‚å¯¾å¿œï¼‰
  (function restoreWhenReady(){
    var TRY_MAX=12, tries=0;
    function tick(){
      tries++;
      // å…¥åŠ›ãŒä¸€ã¤ã§ã‚‚è¦‹ã¤ã‹ã£ã¦ã‹ã‚‰å¾©å…ƒ
      var hasAny = document.querySelector('input[name], select[name], textarea[name]');
      if(hasAny){
        restoreOnce(); return;
      }
      if(tries<TRY_MAX){ setTimeout(tick, 300); }
    }
    if(document.readyState==='complete' || document.readyState==='interactive'){ tick(); }
    else document.addEventListener('DOMContentLoaded', tick);
  })();

  // ãƒªã‚»ãƒƒãƒˆç³»ãƒœã‚¿ãƒ³ãŒã‚ã‚Œã°ä¿å­˜ã‚‚å‰Šé™¤ï¼ˆ#btnReset / data-role="reset" ã‚’æƒ³å®šï¼‰
  function clearAnswers(){
    try{ localStorage.removeItem(ANSWER_KEY); }catch(_){}
  }
  document.addEventListener('click', function(e){
    var t = e.target;
    if(!(t instanceof HTMLElement)) return;
    if(t.id==='btnReset' || t.matches('[data-role="reset"]')) clearAnswers();
  }, true);

  // ---------- çµæœç¢ºå®šã§ã€Œæ¸ˆã€ï¼‹LvåŠ ç®— ----------
  var marked = false;
  function markOnce(){
    if(marked) return; marked = true;
    try{
      // 1) ã‚ãªãŸã®ã“ã“ã‚Lv åˆè¨ˆ +1
      var total = (+localStorage.getItem(TOTAL_KEY) || 0) + 1;
      localStorage.setItem(TOTAL_KEY, String(total));

      // 2) ã“ã®è¨ºæ–­ã®ã€Œæ¸ˆã€ã‚’ +1ï¼ˆä»–ã‚¿ãƒ–å³æ™‚åæ˜ ç”¨ã«ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—æ··ãœã‚‹ï¼‰
      var map={}; try{ map = JSON.parse(localStorage.getItem(DONE_KEY) || '{}'); }catch(_){}
      map[MY_ID] = (map[MY_ID] || 0) + 1;
      localStorage.setItem(DONE_KEY, JSON.stringify(Object.assign({}, map, {_ts: Date.now()})));

      // 3) ã¿ã‚“ãªã®ã“ã“ã‚Lv +1ï¼ˆè¡¨ç¤ºã¯ index å´ã§å–å¾—ï¼ã“ã“ã§ã¯é€ã‚‹ã ã‘ï¼‰
      countapiHit();
      // ã¤ã„ã§ã«å‰å›ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚‚+1ï¼ˆindexåˆæœŸè¡¨ç¤ºã®è¦‹æ „ãˆæ”¹å–„ï¼‰
      try{
        var last = (+localStorage.getItem(GLOBAL_LAST) || 0) + 1;
        localStorage.setItem(GLOBAL_LAST, String(last));
      }catch(_){}
    }catch(_){}
  }

  // A) çµæœãŒæç”»ã•ã‚ŒãŸåˆå›³ï¼ˆæ¨å¥¨ï¼šå„ãƒšãƒ¼ã‚¸ã®é›†è¨ˆå®Œäº†æ™‚ã« dispatch ã—ã¦ãã ã•ã„ï¼‰
  //   ä¾‹ï¼‰document.dispatchEvent(new Event('result:ready'));
  document.addEventListener('result:ready', markOnce);

  // B) ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼šçµæœUIãŒè¦‹ãˆã¦ã‹ã‚‰2ç§’å¾Œã«ä¸€åº¦ã ã‘å®Ÿè¡Œï¼ˆæˆ»ã‚‹ç„¡ã—ã§ã‚‚ç¢ºå®Ÿã«ã€Œæ¸ˆã€ï¼‰
  setTimeout(markOnce, 2000);
})();
</script>
</body>
</html>