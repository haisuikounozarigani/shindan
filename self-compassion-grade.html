<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ã‚»ãƒ«ãƒ•ã‚³ãƒ³ãƒ‘ãƒƒã‚·ãƒ§ãƒ³è¨ºæ–­ï½œ18å•ã§è¦‹ã‚‹ã€Œè‡ªåˆ†ã¸ã®æ‰±ã„ã‚°ãƒ¬ãƒ¼ãƒ‰ã€</title>
<meta name="description" content="18å•ã§ã€ã‚ãªãŸãŒè‡ªåˆ†ã‚’ã©ã‚Œãã‚‰ã„åŠ´ã‚ã‚Œã¦ã„ã‚‹ã‹ï¼ˆç¯€ç´„ã‚»ãƒ«ãƒ•ã‚±ã‚¢ã€œãƒªãƒˆãƒªãƒ¼ãƒˆä¼‘æš‡ã‚¯ãƒ©ã‚¹ã¾ã§ï¼‰ã‚’å¯è¦–åŒ–ã™ã‚‹ã‚»ãƒ«ãƒ•ã‚³ãƒ³ãƒ‘ãƒƒã‚·ãƒ§ãƒ³è¨ºæ–­ã€‚ã‚„ã•ã—ã•ãƒ»å…±é€šæ€§ãƒ»ä»Šã“ã“ãƒ»ä¼‘ã‚€è¨±å¯ãƒ»è‡ªå·±æ‰¹åˆ¤ãƒ»åèŠ»ã®6å› å­ã‹ã‚‰ãƒã‚§ãƒƒã‚¯ã—ã¾ã™ã€‚">
<meta name="theme-color" content="#fff7fd">

<!-- OG -->
<meta property="og:type" content="website">
<meta property="og:title" content="ã‚»ãƒ«ãƒ•ã‚³ãƒ³ãƒ‘ãƒƒã‚·ãƒ§ãƒ³è¨ºæ–­">
<meta property="og:description" content="18å•ã§ã€Œç¯€ç´„ã‚»ãƒ«ãƒ•ã‚±ã‚¢ã€œãƒªãƒˆãƒªãƒ¼ãƒˆä¼‘æš‡ã‚¯ãƒ©ã‚¹ã€ã¾ã§ã€ã„ã¾ã®è‡ªåˆ†ã¸ã®æ‰±ã„ã‚°ãƒ¬ãƒ¼ãƒ‰ã‚’ãƒã‚§ãƒƒã‚¯ã€‚">
<meta property="og:url" content="https://haisuikounozarigani.github.io/shindan/self-compassion-grade.html">
<meta property="og:image" content="https://haisuikounozarigani.github.io/shindan/assets/results/self-compassion-grade/t00.webp">

<style>
:root{
  --bg:#fdf7ff;
  --paper:#fff;
  --ink:#201322;
  --muted:#6a5b70;
  --line:#ece3f5;
  --accent:#8c6bff;   /* hot */
  --accent2:#ff8fc7;  /* duo */
}
html,body{
  margin:0;padding:0;
  background:var(--bg);
  color:var(--ink);
  font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Noto Sans JP","Hiragino Sans","Hiragino Kaku Gothic ProN","Yu Gothic",Meiryo,sans-serif;
}
a{color:#5b2ea8;text-decoration:none}
.wrap{max-width:980px;margin:0 auto;padding:16px}
header.hd{
  background:linear-gradient(160deg,#fff7fd,#f3ecff);
  border-bottom:1px solid var(--line);
}
header.hd .wrap{padding:20px 16px 10px}
.ttl{
  font-weight:800;font-size:1.35rem;letter-spacing:.02em;
  display:flex;gap:8px;align-items:center;flex-wrap:wrap;
}
.sub{color:var(--muted);font-size:.95rem}

/* ãƒ©ãƒ³ã‚¯ãƒãƒƒã‚¸ï¼ˆãƒ˜ãƒƒãƒ€ï¼‰ */
.rank{
  display:inline-flex;
  align-items:center;
  gap:4px;
  padding:.2em .7em;
  border-radius:999px;
  background:#f3e9ff;
  color:#4b266e;
  font-weight:700;
  font-size:.85rem;
}

/* å›ºå®šé€²æ—ãƒãƒ¼ï¼ˆnohæº–æ‹ ï¼‰ */
.progress-fixed{
  position:sticky;top:0;z-index:20;
  height:8px;background:var(--line)
}
.progress-bar{
  height:100%;border-radius:6px;
  background:linear-gradient(90deg,var(--accent),var(--accent2));
  transition:width .2s ease
}
[role="progressbar"]{width:100%}

/* ãƒ’ãƒ¼ãƒ­ãƒ¼ */
figure.hero{
  margin:12px 0;
  border:1px solid var(--line);
  border-radius:16px;
  overflow:hidden;
  background:#fff;
}
figure.hero img{
  display:block;width:100%;height:auto;
}

/* å…±é€šã‚«ãƒ¼ãƒ‰ */
.paper{
  background:var(--paper);
  border:1px solid var(--line);
  border-radius:16px;
  padding:16px;
  margin:14px 0;
}

/* ãƒ—ãƒ­ãƒ­ãƒ¼ã‚° */
#prologue h2{
  margin-top:0;
  font-size:1.1rem;
}
#prologue p{margin:.4rem 0}
#prologue .note{
  color:var(--muted);
  font-size:.9rem;
}
.start-btn{
  margin-top:12px;
  width:100%;
  padding:12px 16px;
  border-radius:999px;
  border:1px solid var(--accent);
  background:linear-gradient(135deg,var(--accent),var(--accent2));
  color:#fff;
  font-weight:700;
  letter-spacing:.03em;
  cursor:pointer;
  box-shadow:0 4px 10px rgba(0,0,0,.08);
  display:inline-flex;
  align-items:center;
  justify-content:center;
  gap:6px;
}
.start-btn span.emo{font-size:1.2rem}

/* è³ªå•ã‚¨ãƒªã‚¢ */
.qhead{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:8px;
}
.qnum{font-weight:700;color:#4c2b5f}
.qtag{
  font-size:.8rem;
  color:#7a6c86;
  padding:2px 8px;
  border-radius:999px;
  border:1px solid var(--line);
  background:#f9f3ff;
  display:inline-flex;
  align-items:center;
  gap:4px;
}
.qtext{margin:.6rem 0 1rem}
.opts{
  display:grid;
  grid-template-columns:1fr;
  gap:8px;
}
.btn{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  padding:12px 14px;
  border:1px solid var(--line);
  border-radius:12px;
  background:#fff;
  cursor:pointer;
  transition:.12s;
}
.btn[aria-pressed="true"]{
  outline:2px solid var(--accent2);
  background:#fff4fa;
}
.btn:hover{transform:translateY(-1px)}
.btn-label{font-weight:500}
.opt-note{color:#8b7b93;font-size:.9rem}
.ctrls{
  display:flex;
  gap:8px;
  margin-top:12px;
}
.ctrls button{
  padding:10px 14px;
  border-radius:10px;
  border:1px solid var(--line);
  background:#faf5ff;
  cursor:pointer;
}

/* çµæœã‚¨ãƒªã‚¢ */
.result{display:none}
.flex{display:flex;gap:16px;flex-wrap:wrap}
.result .imgbox{
  flex:1 1 280px;
  min-width:260px;
}
.result .imgbox img{
  width:100%;height:auto;
  border-radius:14px;
  border:1px solid var(--line);
  display:block;
}
.result .text{
  flex:2 1 360px;
  min-width:300px;
}
.result-title-main{
  margin:.2rem 0 0;
}
.result-title-sub{
  margin:.1rem 0 .6rem;
  font-size:.9rem;
  color:var(--muted);
}
.badge-line{
  display:flex;
  flex-wrap:wrap;
  gap:6px;
  align-items:center;
  margin:.2rem 0 .4rem;
}
.badge-pill{
  display:inline-flex;
  align-items:center;
  gap:4px;
  padding:2px 10px;
  border-radius:999px;
  background:#fff1fb;
  font-size:.85rem;
}

/* å› å­ãƒãƒ¼ */
.bars{
  display:grid;
  grid-template-columns:1fr;
  gap:10px;
  margin-top:10px;
}
.bar{
  background:transparent;
  border-radius:10px;
  padding:4px 0 6px;
}
.bar .h{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:2px 10px 4px;
  font-size:.9rem;
}
.bar .h span:first-child{font-weight:600}
.bar .track{
  margin:0 10px 4px;
  height:10px;
  border-radius:999px;
  background:#f3e9ff;
  overflow:hidden;
}
.bar .fill{
  height:100%;
  width:0%;
  background:linear-gradient(90deg,var(--accent),var(--accent2));
  border-radius:inherit;
  transition:width .25s ease-out;
}
.bar-desc{
  padding:0 10px 2px;
  font-size:.8rem;
  color:var(--muted);
}

/* å‰å›å›ç­” */
.prev-list{
  list-style:none;
  padding-left:0;
  margin:.4rem 0 .2rem .9rem;
}
.prev-item{
  display:flex;
  gap:8px;
  align-items:flex-start;
  padding:6px 0;
  border-bottom:1px solid var(--line);
}
.prev-q{
  flex:1;min-width:0;
  display:-webkit-box;
  -webkit-box-orient:vertical;
  -webkit-line-clamp:2;
  overflow:hidden;
  overflow-wrap:anywhere;
}
.prev-a{
  flex:0 0 auto;
  white-space:nowrap;
  border:1px solid var(--line);
  border-radius:999px;
  padding:2px 8px;
  font-size:.9rem;
  background:#faf5ff;
}


.gallery{
  margin-top:2px;
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(120px,1fr));
  gap:10px;
}
.gallery figure{
  margin:0;
  border:1px solid var(--line);
  border-radius:12px;
  background:#fff;
  padding:6px;
  text-align:center;
  font-size:.85rem;
  color:var(--muted);
  display:flex;
  flex-direction:column;
  gap:4px;
}
.gallery img{
  width:100%;
  height:auto;
  border-radius:8px;
  display:block;
}

/* ãã®ä»– */
.meta{color:#7a6c86;font-size:.92rem;clear:both;margin-top:.6rem}
.back{
  display:inline-block;
  margin:10px 0 20px;
  padding:10px 14px;
  border-radius:10px;
  border:1px solid var(--line);
  background:#faf5ff;
}

/* âœ…ã ã‘ã®ãƒˆãƒ¼ã‚¹ãƒˆ */
.mini-toast{
  position:fixed;
  left:50%;bottom:24px;
  transform:translateX(-50%) translateY(20px);
  opacity:0;
  background:#4c2b5f;
  color:#fff;
  padding:8px 12px;
  border-radius:999px;
  font-size:1.1rem;
  transition:.25s;
  z-index:40;
}
.mini-toast.show{
  opacity:1;
  transform:translateX(-50%) translateY(0);
}

/* å°ã•ã„ç”»é¢èª¿æ•´ */
@media (max-width:600px){
  header.hd .wrap{padding:16px 12px 8px}
  .paper{padding:14px 12px}
}

/* ç ”ç©¶ãƒ¡ãƒ¢ã®æŠ˜ã‚ŠãŸãŸã¿è¦‹ãŸç›® */
.meta-note{
  margin-top:8px;
  padding:8px 10px;
  border-radius:12px;
  border:1px solid var(--line);
  background:#fdf7ff;
  color:var(--muted);
  font-size:.9rem;
}
.meta-note summary{
  cursor:pointer;
  list-style:none;
  font-weight:600;
  display:flex;
  align-items:center;
  justify-content:space-between;
}
.meta-note[open]{
  background:#fff;
}
.meta-note ul{
  margin:.5rem 0 0 1.1rem;
  padding-left:0;
}
.fold-card{
  margin:10px 0 8px;  /* ä¸Š10px ä¸‹8px ã«çµ±ä¸€ */
  padding:8px 10px;
  border-radius:12px;
  border:1px solid var(--line);
  background:#fff;
  color:var(--muted);
  font-size:.9rem;
}
.fold-card summary{
  cursor:pointer;
  list-style:none;
  font-weight:600;
  display:flex;
  align-items:center;
  justify-content:space-between;
}
.fold-card[open]{
  background:#fdf7ff;
  box-shadow:0 3px 8px rgba(0,0,0,.03);
}
.fold-card[open] summary{
  margin-bottom:6px;
}
</style>
</head>

<body data-id="self-compassion-grade">
<header class="hd" role="banner">
  <div class="wrap">
    <div class="ttl">
      ã‚»ãƒ«ãƒ•ã‚³ãƒ³ãƒ‘ãƒƒã‚·ãƒ§ãƒ³è¨ºæ–­
      <span class="rank" aria-label="ç¾åœ¨ã®ã”è‡ªæ„›ãƒ©ãƒ³ã‚¯">
        <span>ğŸ§©</span><span>ãƒ©ãƒ³ã‚¯æœªåˆ¤å®š</span>
      </span>
    </div>
    <div class="sub">
      å¤±æ•—ã—ãŸè‡ªåˆ†ã‚’ã©ã“ã¾ã§å„ªã—ãæ‰±ãˆã‚‹ã‹ã‚’ã€18å•ã§ã‚†ã‚‹ã£ã¨ãƒã‚§ãƒƒã‚¯ã—ã¾ã™ã€‚
    </div>
  </div>
</header>

<!-- å›ºå®šé€²æ—ãƒãƒ¼ -->
<div class="progress-fixed" role="progressbar"
     aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
  <div class="progress-bar" style="width:0%"></div>
</div>

<main class="wrap" id="app" role="main" aria-live="polite">
  <!-- ãƒ’ãƒ¼ãƒ­ãƒ¼ -->
  <figure class="hero">
    <img src="/shindan/assets/results/self-compassion-grade/t00.webp"
         alt="å¤œæ™¯ãƒ©ã‚¦ãƒ³ã‚¸ã®äºŒäºº" loading="lazy">
  </figure>

  <!-- ãƒ—ãƒ­ãƒ­ãƒ¼ã‚° -->
  <section id="prologue" class="paper" aria-label="ãƒ—ãƒ­ãƒ­ãƒ¼ã‚°">
    <h2>ãƒ—ãƒ­ãƒ­ãƒ¼ã‚°ï¼šã‚ãªãŸã¸ã®æ‰±ã„ã‚°ãƒ¬ãƒ¼ãƒ‰</h2>
    <p>å¤±æ•—ã—ãŸã¨ãã€å‹ã ã¡ã«ã¯å„ªã—ã„è¨€è‘‰ã‚’é¸ã¹ã‚‹ã®ã«ã€è‡ªåˆ†ã«ã¯ä¸€ç•ªãã¤ã„ã‚»ãƒªãƒ•ã‚’ã¶ã¤ã‘ã¦ã—ã¾ã†â€”â€”ãã‚“ãªã“ã¨ã€ãªã„ï¼Ÿ</p>
    <p>ã‚»ãƒ«ãƒ•ã‚³ãƒ³ãƒ‘ãƒƒã‚·ãƒ§ãƒ³ãŒã‚ã‚‹ã¨ã€è½ã¡è¾¼ã‚“ã§ã‚‚ç«‹ã¡ç›´ã‚ŠãŒæ—©ããªã£ãŸã‚Šã€ç–²ã‚Œã«æ°—ã¥ã„ã¦ã¡ã‚ƒã‚“ã¨ä¼‘ã‚ãŸã‚Šã€ãƒŸã‚¹ã—ã¦ã‚‚ã€Œã‚‚ã†ãƒ€ãƒ¡ã ã€ã˜ã‚ƒãªãã¦ã€Œã•ã¦ã€ã©ã†ã—ã‚ˆã€ã¨è€ƒãˆã‚‰ã‚ŒãŸã‚Šã€‚</p>
    <p>ã˜ã‚ã˜ã‚<strong>å¿ƒã®ã‚¿ãƒ•ã•ã¨å„ªã—ã•</strong>ãŒä¸¡æ–¹è‚²ã£ã¦ã„ãã¾ã™ã€‚</p>
    <p>ã§ã‚‚å®Ÿéš›ã€ã‚ãªãŸã¯è‡ªåˆ†ã‚’ã©ã‚Œãã‚‰ã„åŠ´ã‚ã‚Œã¦ã‚‹ã‚“ã ã‚ã†ã€‚ã“ã®è¨ºæ–­ã§ã¯ã€18ã®è³ªå•ã‹ã‚‰ã€<strong>ç¯€ç´„ã‚»ãƒ«ãƒ•ã‚±ã‚¢ã€œãƒªãƒˆãƒªãƒ¼ãƒˆä¼‘æš‡ã‚¯ãƒ©ã‚¹</strong>ã¾ã§ã€ã„ã¾ã®ã€Œè‡ªåˆ†ã¸ã®æ‰±ã„ã‚°ãƒ¬ãƒ¼ãƒ‰ã€ã‚’è¦‹ã¦ã„ãã¾ã™ã€‚</p>
    <p class="note">â€»æ·±åˆ»ãªè¨ºæ–­ã§ã¯ãªãã€ã€Œè‡ªåˆ†ã¸ã®æ‰±ã„æ–¹ã€ã‚’ã‚†ã‚‹ãçœºã‚ã‚‹ãŸã‚ã®ãƒ†ã‚¹ãƒˆã§ã™ã€‚</p>
    <button type="button" id="startBtn" class="start-btn" aria-label="è¨ºæ–­ã‚’å§‹ã‚ã‚‹">
      <span class="emo">âœ¨</span><span>ã”è‡ªæ„›ã‚°ãƒ¬ãƒ¼ãƒ‰ã‚’ã®ãã„ã¦ã¿ã‚‹</span>
    </button>
  </section>

  <!-- è³ªå•ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
  <section id="quiz" class="paper" aria-label="è³ªå•ã‚»ã‚¯ã‚·ãƒ§ãƒ³" style="display:none">
    <div class="qhead">
      <div class="qnum" id="qnum">Q1/18</div>
      <div class="qtag" id="qtag">
        <span>ğŸ’¬</span><span>ã‚„ã•ã—ã•</span>
      </div>
    </div>
    <div class="qtext" id="qtext">â€¦</div>
    <div class="opts" id="opts" role="group" aria-label="å›ç­”ã‚’é¸æŠ"></div>
    <div class="ctrls">
      <button type="button" id="prevBtn">ã‚‚ã©ã‚‹</button>
    </div>
  </section>

  <!-- çµæœã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
  <section id="result" class="paper result" aria-label="çµæœã‚»ã‚¯ã‚·ãƒ§ãƒ³">
    <h2 style="margin-top:0">çµæœ</h2>
    <div class="flex">
      <div class="imgbox">
        <img id="resultImg" src="" alt="" loading="lazy">
      </div>
      <div class="text">
        <div class="badge-line">
          <span class="badge-pill" id="gradeBadge">
            <span>ğŸ§©</span><span>ãƒ©ãƒ³ã‚¯æœªåˆ¤å®š</span>
          </span>
          <span class="badge-pill" id="scoreBadge">
            ã‚¹ã‚³ã‚¢ â€” / 100
          </span>
        </div>
        <h3 class="result-title-main" id="resultTitle"></h3>
        <p class="result-title-sub" id="resultSubtitle"></p>
        <p id="resultLines" style="white-space:pre-line;margin:.4rem 0 1rem"></p>

        <!-- å› å­ãƒãƒ¼ï¼ˆ6æœ¬ï¼‰ -->
        <div class="bars" id="bars"></div>
      </div>
    </div>

    <!-- å‰å›ã®å›ç­”ï¼ˆä¸€è¦§ï¼‰ -->
    <details id="prevBlock" class="fold-card">
      <summary>ğŸ“ å‰å›ã®å›ç­”ï¼ˆä¸€è¦§ï¼‰</summary>
      <ul id="prevList" class="prev-list"></ul>
    </details>

    <!-- 5ãƒ©ãƒ³ã‚¯ã®ã”è‡ªæ„›ã‚®ãƒ£ãƒ©ãƒªãƒ¼ -->
    <details id="galleryBlock" class="fold-card">
      <summary>ğŸŒˆ ã”è‡ªæ„›ãƒ©ãƒ³ã‚¯ã®ã‚®ãƒ£ãƒ©ãƒªãƒ¼</summary>
      <div class="gallery">
        <figure>
          <img src="/shindan/assets/results/self-compassion-grade/t01.webp"
               alt="æ·±å¤œã‚ªãƒ•ã‚£ã‚¹ã®äºŒäºº" loading="lazy">
          <figcaption>ğŸƒâ€â™€ï¸ğŸ’» æ®‹æ¥­ãƒ‡ã‚¹ãƒãƒ¼ãƒãƒ¢ãƒ¼ãƒ‰</figcaption>
        </figure>
        <figure>
          <img src="/shindan/assets/results/self-compassion-grade/t02.webp"
               alt="æ•£ã‚‰ã‹ã£ãŸéƒ¨å±‹ã®äºŒäºº" loading="lazy">
          <figcaption>ğŸ  ã‚µãƒã‚¤ãƒãƒ«ãŠã†ã¡ãƒ¢ãƒ¼ãƒ‰</figcaption>
        </figure>
        <figure>
          <img src="/shindan/assets/results/self-compassion-grade/t03.webp"
               alt="æ¯›å¸ƒã¨ãƒã‚°ã®äºŒäºº" loading="lazy">
          <figcaption>ğŸ”Œ ãŠã†ã¡å……é›»ãƒ‡ãƒ¼</figcaption>
        </figure>
        <figure>
          <img src="/shindan/assets/results/self-compassion-grade/t04.webp"
               alt="ã‚«ãƒ•ã‚§çª“è¾ºã®äºŒäºº" loading="lazy">
          <figcaption>ğŸ° è¡—ã®ã”è¤’ç¾ãƒ‡ãƒ¼</figcaption>
        </figure>
        <figure>
          <img src="/shindan/assets/results/self-compassion-grade/t05.webp"
               alt="æµ·è¾ºãƒ†ãƒ©ã‚¹ã®äºŒäºº" loading="lazy">
          <figcaption>ğŸ ãƒªãƒˆãƒªãƒ¼ãƒˆä¼‘æš‡ã‚¯ãƒ©ã‚¹</figcaption>
        </figure>
      </div>
    </details>

    <!-- ç ”ç©¶ãƒ¡ãƒ¢ï¼ˆæŠ˜ã‚ŠãŸãŸã¿ï¼‰ -->
    <details class="meta-note" id="researchNotes">
      <summary>ğŸ“š ç ”ç©¶ãƒ¡ãƒ¢ã‚’ã²ã‚‰ã</summary>
      <ul>
        <li>ã‚»ãƒ«ãƒ•ã‚³ãƒ³ãƒ‘ãƒƒã‚·ãƒ§ãƒ³ã¯ã€Œè‡ªåˆ†ã¸ã®ã‚„ã•ã—ã•ã€ã€Œäººé–“ãªã‚‰èª°ã§ã‚‚å¤±æ•—ã™ã‚‹ã¨è¦‹ã‚‹è¦–ç‚¹ã€ã€Œä»Šã“ã“ã«æ³¨æ„ã‚’æˆ»ã™ã“ã¨ã€ã®3ã¤ã§èª¬æ˜ã•ã‚Œã‚‹ã“ã¨ãŒå¤šã„ã§ã™ã€‚</li>
        <li>å¤§å­¦ç”Ÿã‚„å¤§äººã‚’å¯¾è±¡ã«ã—ãŸç ”ç©¶ã§ã¯ã€ã‚»ãƒ«ãƒ•ã‚³ãƒ³ãƒ‘ãƒƒã‚·ãƒ§ãƒ³ãŒé«˜ã„ã»ã©ã€ã‚¹ãƒˆãƒ¬ã‚¹ã‚„ä¸å®‰ãŒä½ãã€å¹¸ç¦æ„Ÿã‚„ãƒ¬ã‚¸ãƒªã‚¨ãƒ³ã‚¹ï¼ˆç«‹ã¡ç›´ã‚Šã‚„ã™ã•ï¼‰ãŒé«˜ã„å‚¾å‘ãŒå ±å‘Šã•ã‚Œã¦ã„ã¾ã™ã€‚</li>
        <li>ã€Œè‡ªåˆ†ã«ç”˜ããªã‚‹ã ã‘ã§ã¯ï¼Ÿã€ã¨ã„ã†å¿ƒé…ã‚ˆã‚Šã‚‚ã€å¤±æ•—ã‹ã‚‰å­¦ã³ã‚„ã™ããªã‚‹ãƒ»é•·æœŸçš„ã«è¡Œå‹•ã‚’ç¶šã‘ã‚„ã™ããªã‚‹ã€ã¨ã„ã£ãŸçµæœãŒç›®ç«‹ã¡ã¾ã™ã€‚</li>
      </ul>
    </details>

    <!-- æ³¨æ„æ›¸ãã¯1ã¤ã ã‘æ®‹ã™ -->
    <p class="meta">â€»æœ¬ãƒšãƒ¼ã‚¸ã¯å¨¯æ¥½ï¼‹è‡ªå·±ç†è§£ã®è£œåŠ©ã‚’ç›®çš„ã¨ã—ãŸç°¡æ˜“ãƒ†ã‚¹ãƒˆã§ã™ã€‚ä½“èª¿ã‚„ä¸èª¿ãŒç¶šãå ´åˆã¯å°‚é–€æ©Ÿé–¢ã¸ã”ç›¸è«‡ãã ã•ã„ã€‚</p>

    <button type="button" class="back" id="restartBtn" aria-label="æœ€åˆã‹ã‚‰ã‚„ã‚Šç›´ã™">æœ€åˆã‹ã‚‰ã‚„ã‚Šç›´ã™</button>
    <a class="back" href="https://haisuikounozarigani.github.io/shindan/">è¨ºæ–­ä¸€è¦§ã«æˆ»ã‚‹</a>
  </section>
</main>

<!-- âœ…ã ã‘ã®ãƒˆãƒ¼ã‚¹ãƒˆ -->
<div class="mini-toast" id="toast" role="status" aria-live="polite">âœ…</div>

<script>
/* ===== å›ºå®šé€²æ—ãƒãƒ¼ ===== */
function updateProgress(p){
  var bar = document.querySelector('.progress-bar');
  var wrap = document.querySelector('.progress-fixed');
  var val = Math.max(0,Math.min(100,p));
  if(bar) bar.style.width = val + '%';
  if(wrap) wrap.setAttribute('aria-valuenow', String(val));
}

/* ===== å®šç¾© ===== */
const SLUG = 'self-compassion-grade';
const LS_ANS = `shindan:${SLUG}:answers`;
const LS_IDX = `shindan:${SLUG}:index`;
const LS_DONE = `shindan:${SLUG}:done`;
const LS_LASTANS = `shindan:${SLUG}:lastAnswers`;

/* å› å­ã‚­ãƒ¼ */
const FACTS = ['KIND','COMMON','NOW','REST','SCOLD','RUMIN'];

/* å› å­ã”ã¨ã®ãƒ©ãƒ™ãƒ«ï¼†èª¬æ˜ */
const FACT_LABEL = {
  KIND:'ã‚„ã•ã—ã•',
  COMMON:'å…±é€šæ€§ï¼ˆã¿ã‚“ãªã‚‚ã‚ã‚‹ï¼‰',
  NOW:'ä»Šã“ã“ã«æˆ»ã‚‹',
  REST:'ä¼‘ã‚€è¨±å¯',
  SCOLD:'è‡ªå·±æ‰¹åˆ¤ã²ã‹ãˆã‚',
  RUMIN:'åèŠ»ã‚¹ãƒˆãƒƒãƒ—åŠ›'
};
const FACT_DESC = {
  KIND:'å¤±æ•—ã—ãŸè‡ªåˆ†ã«ã€å‹ã ã¡ä¸¦ã¿ã®è¨€è‘‰ã‚’ã‹ã‘ã‚‰ã‚Œã‚‹ã‹',
  COMMON:'ã€Œäººé–“ãªã‚‰èª°ã§ã‚‚ã‚„ã‚ŠãŒã¡ã€ã¨è¦‹ã‚‰ã‚Œã‚‹ã‹',
  NOW:'éå»ãƒ«ãƒ¼ãƒ—ã‹ã‚‰ã€Œä»Šã©ã†ã™ã‚‹ï¼Ÿã€ã«æˆ»ã‚‹åŠ›',
  REST:'ä¼‘ã¿ã‚„ã”è¤’ç¾ã‚’è‡ªåˆ†ã«å‡ºã—ã¦ã‚ã’ã‚‰ã‚Œã‚‹ã‹',
  SCOLD:'è‡ªåˆ†è²¬ã‚ã‚’ã»ã©ã‚ˆãæ­¢ã‚ã¦ãŠã‘ã‚‹ã‹ï¼ˆä½ã„ã¨ã‚¬ãƒŸã‚¬ãƒŸåº¦å¼·ã‚ï¼‰',
  RUMIN:'ãã‚‹ãã‚‹è€ƒãˆã‚’åˆ‡ã‚Šä¸Šã’ã¦è¡Œå‹•ã«æˆ»ã‚Œã‚‹ã‹'
};

/* è‡ªå·±æ‰¹åˆ¤ãƒ»åèŠ»ã¯é€†è»¢å› å­ï¼ˆä½ã„ã»ã©ã‚»ãƒ«ãƒ•ã‚³ãƒ³ãƒ‘ãƒƒã‚·ãƒ§ãƒ³é«˜ã„ï¼‰ */
const REVERSED = {SCOLD:true,RUMIN:true};


/* å›ç­”ãƒ©ãƒ™ãƒ« */
const LABELS = ['ãœã‚“ãœã‚“','ã‚ã¾ã‚Š','ã©ã¡ã‚‰ã¨ã‚‚','ã‚ã‚Šã¨','ã¨ã¦ã‚‚'];

/* è¨­å• 18å•ï¼ˆ6å› å­Ã—å„3ï½œ0â€“4ï¼‰ */
const QUESTIONS = [
  // ã‚„ã•ã—ã•
  {t:'è½ã¡è¾¼ã‚“ã ã¨ãã€ã€Œãã‚“ãªæ—¥ã‚‚ã‚ã‚‹ã‚ˆã€ã¨è‡ªåˆ†ã«å£°ã‚’ã‹ã‘ã‚‰ã‚Œã‚‹ã€‚', key:'KIND'},
  {t:'ã†ã¾ãã„ã‹ãªã‹ã£ãŸè‡ªåˆ†ã‚’ã€å°‘ãªãã¨ã‚‚ã€Œãƒã‚«ã€ãªã©ã¨å‘¼ã°ãšã«æ¸ˆã‚€ã€‚', key:'KIND'},
  {t:'åŒã˜å¤±æ•—ã‚’å‹ã ã¡ãŒã—ãŸã‚‰ã€ãã®å‹ã ã¡ã«ã¯ã‚„ã•ã—ãå£°ã‚’ã‹ã‘ã‚‰ã‚Œã‚‹ã¨æ„Ÿã˜ã‚‹ã€‚', key:'KIND'},

  // å…±é€šæ€§
  {t:'ã€Œè‡ªåˆ†ã ã‘ãŒãƒ€ãƒ¡ã€ã§ã¯ãªãã€ã€Œäººé–“ãªã‚‰ã“ã†ã„ã†ã“ã¨ã‚‚ã‚ã‚‹ã€ã¨æ€ãˆã‚‹ã€‚', key:'COMMON'},
  {t:'SNSã§ã‚­ãƒ©ã‚­ãƒ©ã—ã¦è¦‹ãˆã‚‹äººã«ã‚‚ã€è£ã§å¤±æ•—ã‚„æ‚©ã¿ãŒã‚ã‚‹ã¨æƒ³åƒã§ãã‚‹ã€‚', key:'COMMON'},
  {t:'ã¤ã‚‰ã„ã¨ãã€ã€Œä¸–ç•Œä¸­ã§ä»Šã“ã®ç¬é–“ã«åŒã˜æ°—æŒã¡ã®äººãŒã„ã‚‹ã€ã¨è€ƒãˆã‚‰ã‚Œã‚‹ã€‚', key:'COMMON'},

  // ä»Šã“ã“
  {t:'å¤±æ•—ã—ãŸå¾Œã€ã€Œä½•åº¦ã‚‚æ€ã„å‡ºã™ã‚ˆã‚Šã€æ¬¡ã«æ´»ã‹ãã†ã€ã¨åˆ‡ã‚Šæ›¿ãˆã‚ˆã†ã¨ã™ã‚‹ã€‚', key:'NOW'},
  {t:'å¯ã‚‹ç›´å‰ã«è€ƒãˆè¾¼ã¿å§‹ã‚ãŸã‚‰ã€ã€Œä»Šã¯å¯ã‚‹æ™‚é–“ã€ã¨æ„è­˜çš„ã«åŒºåˆ‡ã‚ã†ã¨ã™ã‚‹ã€‚', key:'NOW'},
  {t:'ãƒŸã‚¹ã‚’ã—ãŸã¨ãã€è²¬ã‚ç¶šã‘ã‚‹ã‚ˆã‚Šã€Œæ¬¡ã«ä¸€ã¤ã ã‘å¤‰ãˆã‚‹ç‚¹ã€ã‚’æ¢ãã†ã¨ã™ã‚‹ã€‚', key:'NOW'},

  // ä¼‘ã‚€è¨±å¯
  {t:'ç–²ã‚Œã¦ã„ã‚‹ã¨ãã«ã€Œä»Šæ—¥ã¯æ—©ã‚ã«åˆ‡ã‚Šä¸Šã’ã¦ã‚‚ã„ã„ã€ã¨æ€ãˆã‚‹ã€‚', key:'REST'},
  {t:'ä½•ã‹ã‚’é ‘å¼µã£ãŸã‚ã¨ã€è‡ªåˆ†ã«å°ã•ãªã”è¤’ç¾ã‚’ã‚ã’ã‚‹ã“ã¨ãŒã‚ã‚‹ã€‚', key:'REST'},
  {t:'äºˆå®šãŒãã£ã—ã‚Šã§ã‚‚ã€ä½“èª¿æ¬¡ç¬¬ã§ã¯ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã‚„èª¿æ•´ã‚’æ¤œè¨ã§ãã‚‹ã€‚', key:'REST'},

  // è‡ªå·±æ‰¹åˆ¤ï¼ˆé€†è»¢ï¼‰
  {t:'ãƒŸã‚¹ã‚’ã™ã‚‹ã¨ã€ã€Œãªã‚“ã§ã“ã‚“ãªã“ã¨ã‚‚ã§ããªã„ã‚“ã ã€ã¨å¼·ãè‡ªåˆ†ã‚’è²¬ã‚ã‚‹ã€‚', key:'SCOLD'},
  {t:'å¤±æ•—ã—ãŸè‡ªåˆ†ã«ã€ä»–äººã«ã¯çµ¶å¯¾ã«è¨€ã‚ãªã„ãƒ¬ãƒ™ãƒ«ã®è¨€è‘‰ã‚’æŠ•ã’ã¦ã—ã¾ã†ã€‚', key:'SCOLD'},
  {t:'ã†ã¾ãã„ã‹ãªã‹ã£ãŸåŸå› ã‚’ã€ã¾ãšè‡ªåˆ†ã®æ€§æ ¼ã®ã›ã„ã«ã—ã¦ã—ã¾ã†ã€‚', key:'SCOLD'},

  // åèŠ»ï¼ˆé€†è»¢ï¼‰
  {t:'çµ‚ã‚ã£ãŸå‡ºæ¥äº‹ã‚’ã€ä½•åº¦ã‚‚é ­ã®ä¸­ã§å·»ãæˆ»ã—ã¦ã—ã¾ã†ã€‚', key:'RUMIN'},
  {t:'ã€Œã‚ã®ã¨ãã“ã†è¨€ãˆã°ã‚ˆã‹ã£ãŸã€ãŒç¹°ã‚Šè¿”ã—æµ®ã‹ã‚“ã§ã€ãªã‹ãªã‹çœ ã‚Œãªã„ã€‚', key:'RUMIN'},
  {t:'äººã«è¨€ã‚ã‚ŒãŸä¸€è¨€ã‚’ã€ä½•æ—¥ã‚‚ä½•åº¦ã‚‚æ€ã„å‡ºã—ã¦ã—ã¾ã†ã€‚', key:'RUMIN'}
];

/* ãƒ©ãƒ³ã‚¯æƒ…å ±ï¼šã‚¹ã‚³ã‚¢0â€“100ã§5æ®µéš */
const GRADE_DEF = [
  {
    id:'G1',
    min:0,max:39,
    emo:'ğŸƒâ€â™€ï¸ğŸ’»',
    label:'æ®‹æ¥­ãƒ‡ã‚¹ãƒãƒ¼ãƒãƒ¢ãƒ¼ãƒ‰',
    img:'t01.webp',
    alt:'æ·±å¤œã‚ªãƒ•ã‚£ã‚¹ã®äºŒäºº',
    title:'ã‚¿ã‚¹ã‚¯å„ªå…ˆã§ã€è‡ªåˆ†ã‚±ã‚¢ã¯å¾Œå›ã—æ°—å‘³ã€‚',
    sub:'ã€Œæ°—åˆã„ã§ãªã‚“ã¨ã‹ã€ãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«ãªã‚Šã‚„ã™ã„ã‚¾ãƒ¼ãƒ³ã€‚å¼·ã¿ã¯ç²˜ã‚Šå¼·ã•ã¨è²¬ä»»æ„Ÿã€‚ãŸã ã€ãã®ã¶ã‚“é™ç•Œã¾ã§èµ°ã‚ŠãŒã¡ã§ã€å€’ã‚Œã¦ã‹ã‚‰ãƒ–ãƒ¬ãƒ¼ã‚­ãŒã‹ã‹ã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚‚ã€‚ä»Šæ—¥ã®ä¸€æ‰‹ã ã‘ã€ã‚¿ã‚¹ã‚¯ã‚ˆã‚Šç¡çœ ã‚’å„ªå…ˆã—ã¦ã¿ã‚‹ã¨ã€å…¨ä½“ã®åŠ¹ç‡ã¯ã‚€ã—ã‚ä¸ŠãŒã‚Šã‚„ã™ããªã‚Šã¾ã™ã€‚',
    tip:'ä»Šæ—¥ã®ä¸€æ‰‹ï¼šå¯ã‚‹æ™‚é–“ã ã‘ã¯äºˆå®šã¨ã—ã¦å…ˆã«ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«å…¥ã‚Œã¦ãŠãã€‚'
  },
  {
    id:'G2',
    min:40,max:59,
    emo:'ğŸ ',
    label:'ã‚µãƒã‚¤ãƒãƒ«ãŠã†ã¡ãƒ¢ãƒ¼ãƒ‰',
    img:'t02.webp',
    alt:'æ•£ã‚‰ã‹ã£ãŸéƒ¨å±‹ã®äºŒäºº',
    title:'ã€Œã¨ã‚Šã‚ãˆãšç”Ÿãã‚‹ã€ã¯ç¢ºä¿ã§ãã¦ã„ã‚‹çŠ¶æ…‹ã€‚',
    sub:'ã¡ã‚ƒã‚“ã¨å®¶ã«ã¯å¸°ã‚‹ã—ã€æœ€ä½é™ã®ä¼‘æ†©ã‚‚ã¨ã‚Œã¦ã„ã‚‹ã‚¾ãƒ¼ãƒ³ã€‚å¼·ã¿ã¯ã€å´©ã‚Œãã‚‹å‰ã«è‡ªåˆ†ã‚’ãªã‚“ã¨ã‹å®ˆã‚Œã¦ã„ã‚‹ã¨ã“ã‚ã€‚ãŸã ã€Œã”ã»ã†ã³ï¼ã‚¸ãƒ£ãƒ³ã‚¯ã§ã”ã¾ã‹ã™ã€ã«ãªã‚Šã‚„ã™ãã€å›å¾©ã‚ˆã‚Šæ¶ˆè€—ãŒã¡ã‚‡ã£ã¨å‹ã¡æ°—å‘³ã‹ã‚‚ã€‚è‡ªåˆ†ã®ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚’æˆ»ã™ãŸã‚ã®ä¼‘ã¿ã‚’ã€æœˆ1å›ã ã‘ã§ã‚‚æ„è­˜çš„ã«ä½œã‚Œã‚‹ã¨ã‚°ãƒ¬ãƒ¼ãƒ‰ã‚¢ãƒƒãƒ—ã—ã‚„ã™ã„ã§ã™ã€‚',
    tip:'ä»Šæ—¥ã®ä¸€æ‰‹ï¼šæ¬¡ã®ã€Œä½•ã‚‚ã—ãªã„ä¼‘æ—¥ã€ã«ã€æ¹¯èˆ¹ã‹ã‚¹ãƒˆãƒ¬ãƒƒãƒã‚’10åˆ†ã ã‘è¶³ã—ã¦ã¿ã‚‹ã€‚'
  },
  {
    id:'G3',
    min:60,max:74,
    emo:'ğŸ”Œ',
    label:'ãŠã†ã¡å……é›»ãƒ‡ãƒ¼',
    img:'t03.webp',
    alt:'æ¯›å¸ƒã¨ãƒã‚°ã®äºŒäºº',
    title:'ã¡ã‚ƒã‚“ã¨å……é›»ã™ã‚‹æ—¥ã‚’ä½œã‚Œã¦ã„ã‚‹çŠ¶æ…‹ã€‚',
    sub:'æ¯›å¸ƒãƒ»æ¸©ã‹ã„é£²ã¿ç‰©ãƒ»ã‚†ã‚‹ã„å¨¯æ¥½ãªã©ã€å®¶ã§ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚’å›å¾©ã•ã›ã‚‹å·¥å¤«ãŒã§ãã¦ã„ã‚‹ã‚¾ãƒ¼ãƒ³ã€‚å¼·ã¿ã¯ã€ã€Œä¼‘ã‚€ï¼ã‚µãƒœã‚Šã€ã§ã¯ãªãã€ã€Œæ•´ãˆã‚‹æ™‚é–“ã€ã¨ã—ã¦æ‰±ãˆã¦ã„ã‚‹ã¨ã“ã‚ã€‚ä¸€æ–¹ã§ã€ã‚»ãƒ«ãƒ•ã‚±ã‚¢ãŒå®¶ã®ä¸­ã ã‘ã«åã‚‹ã¨ã€ä¸–ç•ŒãŒå°‘ã—ç‹­ãæ„Ÿã˜ã‚„ã™ã„ã‹ã‚‚ã€‚ã¨ãã©ãå¤–ã®æ™¯è‰²ã‚’å–ã‚Šã«ã„ãã¨ã€å¿ƒã®ç©ºæ°—ãŒå…¥ã‚Œæ›¿ã‚ã‚Šã‚„ã™ããªã‚Šã¾ã™ã€‚',
    tip:'ä»Šæ—¥ã®ä¸€æ‰‹ï¼šã„ã¤ã‚‚ã®ãŠã†ã¡å……é›»ã«ã€çª“ã®å¤–ã‚’5åˆ†çœºã‚ã‚‹ or è¿‘æ‰€ã‚’10åˆ†æ•£æ­©ã‚’è¶³ã—ã¦ã¿ã‚‹ã€‚'
  },
  {
    id:'G4',
    min:75,max:89,
    emo:'ğŸ°',
    label:'è¡—ã®ã”è¤’ç¾ãƒ‡ãƒ¼',
    img:'t04.webp',
    alt:'ã‚«ãƒ•ã‚§çª“è¾ºã®äºŒäºº',
    title:'å¤–ã®ä¸–ç•Œã‚‚ä½¿ã£ã¦ã€è‡ªåˆ†ã‚’ã‚ˆãåŠ´ã‚ã‚Œã¦ã„ã‚‹çŠ¶æ…‹ã€‚',
    sub:'ã‚«ãƒ•ã‚§ãƒ»è¡—æ­©ããƒ»å°æ—…è¡Œãªã©ã€æ—¥å¸¸ã®å¤–ã«å‡ºã¦è‡ªåˆ†ã‚’ã­ãã‚‰ã†æ™‚é–“ã‚’è²·ã„ã«è¡Œã‘ã¦ã„ã‚‹ã‚¾ãƒ¼ãƒ³ã€‚å¼·ã¿ã¯ã€ã€Œé ‘å¼µã‚Šã£ã±ãªã—ã€ã§ã¯ãªãã€ŒåŒºåˆ‡ã£ã¦å‘³ã‚ã†ã€ã‚¹ã‚­ãƒ«ã€‚ãŸã¾ã«ã€ã”è¤’ç¾ãŒä»–äººã¸ã®è¦‹ã›å ´ã¥ãã‚Šã«å¯„ã‚Šã™ãã‚‹ã¨ã€ç–²åŠ´ãŒæŠœã‘ãã‚‰ãªã„ã“ã¨ã‚‚ã€‚èª°ã«ã‚‚è¦‹ã›ãªã„ã”è¤’ç¾æ™‚é–“ã‚’å°‘ã—æ··ãœã‚‹ã¨ã€ã•ã‚‰ã«æ·±ãå›å¾©ã—ã‚„ã™ããªã‚Šã¾ã™ã€‚',
    tip:'ä»Šæ—¥ã®ä¸€æ‰‹ï¼šå†™çœŸã‚‚æŠ•ç¨¿ã‚‚ã—ãªã„ã€Œç§˜å¯†ã®ã”è¤’ç¾ã‚¿ã‚¤ãƒ ã€ã‚’1ã¤ã ã‘ä½œã£ã¦ã¿ã‚‹ã€‚'
  },
  {
    id:'G5',
    min:90,max:100,
    emo:'ğŸ',
    label:'ãƒªãƒˆãƒªãƒ¼ãƒˆä¼‘æš‡ã‚¯ãƒ©ã‚¹',
    img:'t05.webp',
    alt:'æµ·è¾ºãƒ†ãƒ©ã‚¹ã®äºŒäºº',
    title:'ç’°å¢ƒã”ã¨å¤‰ãˆã¦ã€è‡ªåˆ†ã‚’æ•´ãˆã‚‹ã“ã¨ã‚’è¨±ã›ã¦ã„ã‚‹çŠ¶æ…‹ã€‚',
    sub:'æ•°æ—¥å˜ä½ã§å ´æ‰€ã‚„ãƒªã‚ºãƒ ã‚’å¤‰ãˆã€ã€Œæ•´ãˆã‚‹ãŸã‚ã®æ™‚é–“ã€ã‚’ã—ã£ã‹ã‚Šå–ã‚Œã‚‹ã‚¾ãƒ¼ãƒ³ã€‚å¼·ã¿ã¯ã€å¿ƒã¨ä½“ã®ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã‚’å…ˆå›ã‚Šã§è¨ˆç”»ã§ãã‚‹ã¨ã“ã‚ã€‚å‘¨ã‚Šã‹ã‚‰ã€Œè´…æ²¢ã€ã¨è¦‹ãˆãŸã¨ã—ã¦ã‚‚ã€é•·æœŸçš„ã«ã¯ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã¨äººé–“é–¢ä¿‚ã‚’å®ˆã‚‹æŠ•è³‡ã«ãªã‚Šã‚„ã™ã„ã‚¯ãƒ©ã‚¹ã§ã™ã€‚ãŸã ã—ã€ä»–äººã«ã¯å³ã—ãè‡ªåˆ†ã«ã ã‘æ‰‹åšã„ã¨ã‚®ãƒ£ãƒƒãƒ—ãŒå‡ºã‚‹ã®ã§ã€ã‚„ã•ã—ã•ã®ä¸€éƒ¨ã‚’å¤–ã«ã‚‚ã‚·ã‚§ã‚¢ã§ãã‚‹ã¨ãƒãƒ©ãƒ³ã‚¹ãŒã‚ˆã‚Šè‰¯ããªã‚Šã¾ã™ã€‚',
    tip:'ä»Šæ—¥ã®ä¸€æ‰‹ï¼šè‡ªåˆ†ã«ã—ã¦ã„ã‚‹ã‚±ã‚¢ã‚’ã€èº«è¿‘ãªèª°ã‹1äººã«ã‚‚å°ã•ããŠã™ãã‚ã‘ã—ã¦ã¿ã‚‹ã€‚'
  }
];

/* ã‚¹ã‚³ã‚¢å¸¯ã‹ã‚‰ã‚°ãƒ¬ãƒ¼ãƒ‰ã‚’å–å¾— */
function gradeFromScore(pct){
  for(const g of GRADE_DEF){
    if(pct >= g.min && pct <= g.max) return g;
  }
  return GRADE_DEF[1]; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ä¸­é–“
}

/* ===== çŠ¶æ…‹ ===== */
let idx = 0;
let answers = new Array(QUESTIONS.length).fill(null);

/* ===== è¦ç´ å–å¾— ===== */
const $qnum = document.getElementById('qnum');
const $qtag = document.getElementById('qtag');
const $qtext = document.getElementById('qtext');
const $opts = document.getElementById('opts');
const $prev = document.getElementById('prevBtn');
const $quiz = document.getElementById('quiz');
const $result = document.getElementById('result');
const $resultImg = document.getElementById('resultImg');
const $resultTitle = document.getElementById('resultTitle');
const $resultSubtitle = document.getElementById('resultSubtitle');
const $resultLines = document.getElementById('resultLines');
const $bars = document.getElementById('bars');
const $restart = document.getElementById('restartBtn');
const $toast = document.getElementById('toast');
const $prologue = document.getElementById('prologue');
const $startBtn = document.getElementById('startBtn');
const $rankBadge = document.querySelector('.rank');
const $gradeBadge = document.getElementById('gradeBadge');
const $scoreBadge = document.getElementById('scoreBadge');

/* ===== åˆæœŸè¡¨ç¤ºï¼šå¾©å…ƒ or ãƒ—ãƒ­ãƒ­ãƒ¼ã‚° ===== */
(function init(){
  updateProgress(0);
  let savedAns = null;
  let savedIdx = 0;
  try{
    savedAns = JSON.parse(localStorage.getItem(LS_ANS) || 'null');
    savedIdx = JSON.parse(localStorage.getItem(LS_IDX) || '0');
  }catch(_){}
  const validArray = Array.isArray(savedAns) && savedAns.length === QUESTIONS.length;
  const hasAny = validArray && savedAns.some(v => v !== null);
  const allDone = validArray && savedAns.every(v => v !== null);

  if(allDone){
    answers = savedAns;
    idx = QUESTIONS.length - 1;
    renderQuestion(); // å†…éƒ¨çŠ¶æ…‹ã ã‘
    enterResultMode();
    showResult();
    return;
  }
  if(hasAny){
    answers = savedAns;
    idx = Math.min(Math.max(0, +savedIdx || 0), QUESTIONS.length-1);
    renderQuestion();
    enterQuizMode();
    return;
  }
  // å®Œå…¨æ–°è¦
  enterPrologueMode();
})();

/* ===== è¡¨ç¤ºåˆ‡æ›¿ ===== */
function enterPrologueMode(){
  if($prologue) $prologue.style.display = 'block';
  if($quiz) $quiz.style.display = 'none';
  if($result) $result.style.display = 'none';
  if($rankBadge){
    $rankBadge.innerHTML = '<span>ğŸ§©</span><span>ãƒ©ãƒ³ã‚¯æœªåˆ¤å®š</span>';
  }
  updateProgress(0);
}
function enterQuizMode(){
  if($prologue) $prologue.style.display = 'none';
  if($quiz) $quiz.style.display = 'block';
  if($result) $result.style.display = 'none';
}
function enterResultMode(){
  if($prologue) $prologue.style.display = 'none';
  if($quiz) $quiz.style.display = 'none';
  if($result) $result.style.display = 'block';
}

/* ===== è³ªå•æç”» ===== */
function renderQuestion(){
  const q = QUESTIONS[idx];
  $qnum.textContent = `Q${idx+1}/${QUESTIONS.length}`;
  $qtext.textContent = q.t;

  // ã‚¿ã‚°ï¼šå› å­ãŒãƒãƒ¬ãªã„ã‚ˆã†ã«å…±é€šãƒ©ãƒ™ãƒ«ã«å›ºå®š
  if($qtag){
    $qtag.innerHTML = `<span>ğŸ§ </span><span>ã”è‡ªæ„›ãƒã‚§ãƒƒã‚¯</span>`;
  }

  // é¸æŠè‚¢
  $opts.innerHTML = '';
  LABELS.forEach((lab,i)=>{
    const btn = document.createElement('button');
    btn.type = 'button';
    btn.className = 'btn';
    btn.setAttribute('aria-pressed', answers[idx]===i ? 'true':'false');
    btn.innerHTML =
      `<span class="btn-label">${lab}</span><span class="opt-note">${descFor(i)}</span>`;
    btn.addEventListener('click',()=> selectAnswer(i));
    $opts.appendChild(btn);
  });

  // ã€Œã‚‚ã©ã‚‹ã€ãƒœã‚¿ãƒ³
  $prev.disabled = (idx===0);

  // é€²æ—ãƒãƒ¼
  const done = answers.filter(v=>v!==null).length;
  updateProgress(Math.round(done/QUESTIONS.length*100));

  // ãƒ˜ãƒƒãƒ€ã®ãƒ©ãƒ³ã‚¯ã¯è¨­å•ä¸­ã¯å¸¸ã«ã€Œæœªåˆ¤å®šã€
  if($rankBadge){
    $rankBadge.innerHTML = '<span>ğŸ§©</span><span>ãƒ©ãƒ³ã‚¯æœªåˆ¤å®š</span>';
  }
}

function descFor(i){
  return ['ã»ã¨ã‚“ã©ãªã„','ã‚ã¾ã‚Šãªã„','åŠã€…ãã‚‰ã„','ã‘ã£ã“ã†ã‚ã‚‹','ã¨ã¦ã‚‚ã‚ˆãã‚ã‚‹'][i] || '';
}

/* ===== å›ç­”å‡¦ç† ===== */
function selectAnswer(v){
  answers[idx] = v; // 0â€“4
  persist();
  markPressed(v);
  showToast(); // âœ…ã ã‘
  setTimeout(()=>{
    if(idx < QUESTIONS.length-1){
      idx++;
      renderQuestion();
    }else{
      enterResultMode();
      showResult();
    }
  },140);
}
function markPressed(v){
  [...$opts.children].forEach((el,i)=>{
    el.setAttribute('aria-pressed', i===v ? 'true' : 'false');
  });
}
$prev.addEventListener('click', ()=>{
  if(idx>0){
    idx--;
    persist();
    renderQuestion();
  }
});

/* ãƒ—ãƒ­ãƒ­ãƒ¼ã‚° â†’ ã‚¹ã‚¿ãƒ¼ãƒˆ */
$startBtn.addEventListener('click', ()=>{
  if(!answers.some(v=>v!==null)){
    idx = 0;
    renderQuestion();
  }
  enterQuizMode();
  window.scrollTo({top:0,behavior:'smooth'});
});

/* ===== ä¿å­˜ ===== */
function persist(){
  try{
    localStorage.setItem(LS_ANS, JSON.stringify(answers));
    localStorage.setItem(LS_IDX, JSON.stringify(idx));
  }catch(_){}
}

/* ===== ã‚¹ã‚³ã‚¢è¨ˆç®— ===== */
/* å„å› å­0â€“4 â†’ 1â€“5ã¸ã‚·ãƒ•ãƒˆ â†’ 0â€“100ã€‚SCOLD/RUMINã¯é€†è»¢ã€‚ */
function computeScores(){
  const sums = {KIND:0,COMMON:0,NOW:0,REST:0,SCOLD:0,RUMIN:0};
  const counts = {KIND:0,COMMON:0,NOW:0,REST:0,SCOLD:0,RUMIN:0};
  QUESTIONS.forEach((q,i)=>{
    let v = answers[i];
    if(v == null) v = 0;
    sums[q.key] += v;
    counts[q.key] += 1;
  });

  const pct = {};
  FACTS.forEach(k=>{
    const avg0 = (sums[k]/(counts[k]||1)); // 0â€“4
    let base0 = avg0;
    if(REVERSED[k]){
      base0 = 4 - avg0; // åè»¢
    }
    const a15 = base0 + 1; // 1â€“5
    pct[k] = Math.round((a15-1)/4*100); // 0â€“100
  });

  // ç·åˆã‚¹ã‚³ã‚¢ï¼6å› å­pctå¹³å‡
  let sumPct = 0;
  FACTS.forEach(k=> sumPct += pct[k]);
  const totalPct = Math.round(sumPct / FACTS.length);

  return {pct,totalPct};
}

/* ===== çµæœè¡¨ç¤º ===== */
function showResult(){
  const {pct,totalPct} = computeScores();
  const grade = gradeFromScore(totalPct);

  // ãƒ©ãƒ³ã‚¯ãƒãƒƒã‚¸ in header
  if($rankBadge){
    $rankBadge.innerHTML =
      `<span>${grade.emo}</span><span>${grade.label}</span>`;
  }

  // ç”»åƒï¼ˆt01ã€œt05ã¯ã‚¹ã‚³ã‚¢å¸¯ã§å‰²å½“ï¼‰
  const IMG_BASE = '/shindan/assets/results/self-compassion-grade/';
  $resultImg.src = IMG_BASE + grade.img;
  $resultImg.alt = grade.alt || 'ã‚»ãƒ«ãƒ•ã‚±ã‚¢ã®äºŒäºº';

  // çµæœã‚¿ã‚¤ãƒˆãƒ«ãƒ»ã‚µãƒ–
  $resultTitle.textContent = `ã‚ãªãŸã®ã”è‡ªæ„›ã‚°ãƒ¬ãƒ¼ãƒ‰ï¼š${grade.label}`;
  $resultSubtitle.textContent = `ã‚»ãƒ«ãƒ•ã‚³ãƒ³ãƒ‘ãƒƒã‚·ãƒ§ãƒ³ç·åˆã‚¹ã‚³ã‚¢ï¼š${totalPct} / 100`;

  // ãƒãƒƒã‚¸é¡
  if($gradeBadge){
    $gradeBadge.innerHTML =
      `<span>${grade.emo}</span><span>${grade.label}</span>`;
  }
  if($scoreBadge){
    $scoreBadge.textContent = `ã‚¹ã‚³ã‚¢ ${totalPct} / 100`;
  }

  // æœ¬æ–‡ï¼šå¼·ã¿â†’è½ã¨ã—ç©´â†’ä»Šæ—¥ã®ä¸€æ‰‹
  const text = `${grade.title}
${grade.sub}
${grade.tip}`;
  $resultLines.textContent = text;

  // å› å­ãƒãƒ¼æç”»
  $bars.innerHTML = '';
  FACTS.forEach(k=>{
    const v = pct[k];
    const wrap = document.createElement('div');
    wrap.className = 'bar';
    const desc = FACT_DESC[k] || '';
    wrap.innerHTML = `
      <div class="h"><span>${FACT_LABEL[k]}</span><span>${v}%</span></div>
      <div class="track"><div class="fill" style="width:${v}%"></div></div>
      <div class="bar-desc">${desc}</div>
    `;
    $bars.appendChild(wrap);
  });

  // å®Œäº†ãƒ•ãƒ©ã‚°ï¼å‰å›å›ç­”ä¿å­˜
  try{ localStorage.setItem(LS_DONE, String(Date.now())); }catch(_){}
  try{
    localStorage.setItem(LS_LASTANS, JSON.stringify({answers: answers.slice(), ts: Date.now()}));
  }catch(_){}

  buildPrevAnswers();

  document.dispatchEvent(new Event('result:ready'));
}

/* ===== å‰å›å›ç­”ä¸€è¦§ ===== */
function buildPrevAnswers(){
  const $block = document.getElementById('prevBlock');
  const $list  = document.getElementById('prevList');
  if(!$block || !$list) return;

  let prev = null;
  try{
    prev = JSON.parse(localStorage.getItem(LS_LASTANS) || 'null');
  }catch(_){}

  if(!prev || !Array.isArray(prev.answers)) return;

  $list.innerHTML = '';
  prev.answers.forEach((v,i)=>{
    const li = document.createElement('li');
    li.className = 'prev-item';
    const lab = (typeof v === 'number' && v>=0 && v<LABELS.length) ? LABELS[v] : 'â€”';
    li.innerHTML =
      `<span class="prev-q">Q${i+1}ï¼š${QUESTIONS[i].t}</span><span class="prev-a">ã€Œ${lab}ã€</span>`;
    $list.appendChild(li);
  });

  $block.open = false;
}

/* ===== ãƒªã‚¹ã‚¿ãƒ¼ãƒˆ ===== */
function restartQuiz(){
  answers = new Array(QUESTIONS.length).fill(null);
  idx = 0;
  try{
    localStorage.removeItem(LS_ANS);
    localStorage.removeItem(LS_IDX);
  }catch(_){}
  enterPrologueMode();
  window.scrollTo({top:0,behavior:'smooth'});
  showToast(); // ã“ã“ã‚‚âœ…ã ã‘
}
$restart.addEventListener('click', restartQuiz);

/* ===== ãƒˆãƒ¼ã‚¹ãƒˆï¼ˆâœ…ã®ã¿ï¼‰ ===== */
let toastTimer = null;
function showToast(){
  if(!$toast) return;
  $toast.textContent = 'âœ…';
  $toast.classList.add('show');
  clearTimeout(toastTimer);
  toastTimer = setTimeout(()=> $toast.classList.remove('show'), 750);
}
</script>

<!-- ã‚ãªãŸã®ã“ã“ã‚Lvï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ã®ã¿ï¼‰ -->
<script>(function(){
  var DONE_KEY='specimens:open:byid', TOTAL_KEY='specimens:open:total';
  var MY_ID=document.body.getAttribute('data-id')||'self-compassion-grade';
  var marked=false;
  function mark(){ if(marked) return; marked=true;
    try{
      // ã‚ãªãŸã®ã“ã“ã‚Lvï¼ˆå…¨è¨ºæ–­åˆè¨ˆï¼‰
      var t=(+localStorage.getItem(TOTAL_KEY)||0)+1;
      localStorage.setItem(TOTAL_KEY,String(t));
      // è¨ºæ–­ã”ã¨ã®ã‚«ã‚¦ãƒ³ãƒˆ
      var map={}; try{ map=JSON.parse(localStorage.getItem(DONE_KEY)||'{}'); }catch(_){}
      map[MY_ID]=(map[MY_ID]||0)+1;
      localStorage.setItem(DONE_KEY, JSON.stringify(Object.assign({},map,{_ts:Date.now()})));
    }catch(_){}
  }
  document.addEventListener('result:ready', mark);
  setTimeout(mark, 2000); // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
}());</script>

</body>
</html>