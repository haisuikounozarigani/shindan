<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ä¸ƒå¤©ä½¿ã®å„ªã—ã•è¨ºæ–­</title>
<meta name="description" content="21å•ã§â€œã‚„ã•ã—ã•â€ã®å½¢ã‚’ãƒã‚§ãƒƒã‚¯ã€‚ä¸»å¤©ä½¿ã‚¿ã‚¤ãƒ—ï¼ˆ7ç¨®ï¼‰ã¨å› å­ãƒãƒ¼ã€ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ï¼ˆäºŒé‡ç¿¼ï¼‰ã€ç ”ç©¶ãƒ¡ãƒ¢ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚">
<meta name="theme-color" content="#f7f9ff">
<meta property="og:type" content="website">
<meta property="og:title" content="ä¸ƒå¤©ä½¿ã®å„ªã—ã•è¨ºæ–­">
<meta property="og:description" content="21å•ã§â€œã‚„ã•ã—ã•â€ã®å½¢ã‚’ãƒã‚§ãƒƒã‚¯ã€‚ä¸»å¤©ä½¿ã‚¿ã‚¤ãƒ—ï¼ˆ7ç¨®ï¼‰ã¨å› å­ãƒãƒ¼ã€ç ”ç©¶ãƒ¡ãƒ¢ã‚’è¡¨ç¤ºã€‚">
<meta property="og:url" content="https://haisuikounozarigani.github.io/shindan/angel-kindness.html">
<meta property="og:image" content="/shindan/assets/results/angel-kindness/01.png">
<style>
:root{
  --accent:#4aa8ff; --accent2:#ffd08c;
  --ink:#1f2732; --muted:#667087; --paper:#fff;
  --bg1:#f7f9ff; --bg2:#f6f3ff; --line:#e6ecf7;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; color:var(--ink);
  background:linear-gradient(180deg,var(--bg1),var(--bg2));
  font-family:"Noto Sans JP",system-ui,-apple-system,"Segoe UI",Roboto,"Hiragino Kaku Gothic ProN",sans-serif;
  -webkit-font-smoothing:antialiased;
}
a{color:inherit}
.wrap{max-width:980px;margin:18px auto;padding:0 14px}
header.hd{display:grid;grid-template-columns:56px 1fr;gap:12px;align-items:center;margin:8px 0}
.logo{width:56px;height:56px;border-radius:14px;background:linear-gradient(135deg,#e1f2ff,#fff2dd);display:grid;place-items:center;font-size:28px}
h1{margin:0;font-size:clamp(22px,4.6vw,34px);letter-spacing:.02em}
.sub{margin:4px 0 0;color:var(--muted);font-size:.96em}
.card{background:var(--paper);border:1px solid var(--line);border-radius:16px;padding:14px}
.section{margin:14px 0}
.pill{display:inline-block;padding:4px 8px;border:1px solid var(--line);border-radius:999px;background:#fff;color:#6b6a77;font-size:.88em}
.meta{display:flex;gap:8px;flex-wrap:wrap}
.sticky{position:sticky;top:0;z-index:10;margin:-6px -14px 12px;padding:8px 14px;background:rgba(255,255,255,.86);backdrop-filter:blur(6px) saturate(1.05);border-bottom:1px solid #e9edf7;display:flex;align-items:center;gap:10px}
.progress{height:8px;background:#edf2fb;border-radius:999px;flex:1;overflow:hidden}
.progress>span{display:block;height:100%;width:0;background:linear-gradient(90deg,var(--accent),var(--accent2))}
.btn{padding:10px 14px;border:1px solid var(--line);border-radius:12px;background:#fff;cursor:pointer}
.btn.primary{background:linear-gradient(90deg,var(--accent),var(--accent2));border-color:transparent;color:#fff;font-weight:700}
fieldset.q{border:1px solid var(--line);border-radius:12px;padding:10px;margin:10px 0;background:#fff}
legend{font-weight:700}
.scale{display:grid;grid-template-columns:repeat(5,minmax(66px,1fr));gap:8px;margin-top:8px}
.scale input{position:absolute;opacity:0;pointer-events:none}
.scale label{display:grid;place-items:center;border:1px solid #e5e9f3;border-radius:10px;padding:8px;cursor:pointer;user-select:none;background:#fff}
.scale input:checked+label{outline:2px solid var(--accent);border-color:transparent}
mark.need{animation:need 1.6s ease}
@keyframes need{0%{box-shadow:0 0 0 0 rgba(74,168,255,.45)}100%{box-shadow:0 0 0 0 rgba(74,168,255,0)}}

.result-head{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
.badge{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;background:linear-gradient(90deg,var(--accent),var(--accent2));color:#fff;font-weight:700}
.total{font-size:26px;font-weight:800}
.small{color:var(--muted);font-size:.92em}

.hero-square{display:grid;place-items:center;border:1px solid var(--line);border-radius:16px;background:#fff;overflow:hidden}
.hero-square figure{margin:0;width:min(560px,100%);max-width:100%;aspect-ratio:1/1;border-bottom:1px solid var(--line);background:#f7f9ff}
.hero-square img{width:100%;height:100%;object-fit:contain;display:block}
.hero-square figcaption{padding:10px;width:100%}
.hero-square .capline{font-weight:800;line-height:1.55;overflow-wrap:anywhere;word-break:break-word}
.hero-square .poem{font-style:italic;letter-spacing:.02em;margin-top:4px;color:#445;opacity:.9}
.hero-square .capmini{font-size:1em;line-height:1.85;color:var(--muted);overflow-wrap:anywhere;word-break:break-word}
.badge-size{display:inline-flex;align-items:center;gap:6px;padding:4px 8px;border-radius:999px;background:#fff;border:1px solid var(--line);font-size:.85em;margin-left:6px}

.grid2{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:12px}
.stat{border:1px solid var(--line);border-radius:12px;padding:10px;background:#fff}
.stat .big{font-size:22px;font-weight:800}
.hr{height:1px;background:var(--line);margin:10px 0}
.factor-mini{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:10px}
.guard{display:flex;align-items:center;gap:8px;border:1px solid var(--line);border-radius:12px;background:#fff;padding:8px 10px}
.guard .g-emo{font-size:18px}

.bar{border:1px solid var(--line);border-radius:12px;padding:10px;background:#fff}
.bar .row{height:10px;background:#edf2fb;border-radius:999px;overflow:hidden;margin-top:6px}
.bar .row>span{display:block;height:100%;width:0;background:linear-gradient(90deg,var(--accent),var(--accent2))}
.bar .mini{margin-top:6px;color:var(--muted);font-size:.9em;line-height:1.6}

.note{border:1px solid var(--line);border-radius:12px;background:#fff;padding:10px}
.note h4{margin:0 0 6px;font-size:16px}
.note .mini{display:inline-block;margin-left:6px;font-size:.82em;color:#6b6a77}
.note p{margin:6px 0;line-height:1.75}

.footer{color:var(--muted);font-size:.92em}
.warn{background:#f8fbff;border:1px solid #e1ebf7;border-radius:12px;padding:10px;margin:12px 0}
.back-area{display:flex;justify-content:center;margin-top:10px}
a.back{display:inline-flex;align-items:center;gap:6px;padding:10px 14px;border:1px solid var(--line);border-radius:12px;background:#fff;text-decoration:none}
.tags{display:flex;flex-wrap:wrap;gap:8px;margin-top:6px}
.tag{padding:3px 8px;border:1px solid var(--line);border-radius:999px;background:#fff;font-size:.84em}

@media (max-width: 560px){
  .wrap{padding:0 10px}
  .sticky{top:calc(env(safe-area-inset-top) + 0px); padding:8px 10px}
  .scale{grid-template-columns:repeat(2,1fr)}
  .scale label{padding:12px 8px;font-size:14px}
  .hero-square figure{width:100%}
  .grid2{grid-template-columns:1fr}
  .card{padding:12px}
  .hero-square .capline{font-size:clamp(16px,5.2vw,20px);line-height:1.65}
  .hero-square .capmini{font-size:clamp(14px,4.6vw,16px);line-height:1.95}
  .note h4{font-size:15px}
}
</style>
</head>
<body data-id="angel-kindness">
<main class="wrap" id="app">
  <header class="hd">
    <div class="logo">ğŸ‘¼</div>
    <div>
      <h1>ä¸ƒå¤©ä½¿ã®å„ªã—ã•è¨ºæ–­</h1>
      <p class="sub">21å•ï¼ˆ0ã€œ4ã®5ä»¶æ³•ï¼‰ã§â€œã‚„ã•ã—ã•â€ã®å½¢ã‚’ãã£ã¨å¯è¦–åŒ–ã€‚ä¸»å¤©ä½¿ã‚¿ã‚¤ãƒ—ï¼ˆ7ç¨®ï¼‰ã¨å› å­ãƒãƒ¼ã€å¿…è¦ãªã‚‰ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ï¼ˆäºŒé‡ç¿¼ï¼‰ã‚‚è¡¨ç¤ºã—ã¾ã™ã€‚</p>
    </div>
  </header>

  <div class="sticky" aria-live="polite">
    <span>ğŸ“Š</span>
    <div class="progress" aria-label="å›ç­”é€²æ—"><span id="prog"></span></div>
    <button class="btn primary" id="doScore">è¨ºæ–­ã™ã‚‹</button>
  </div>

  <section class="card section" id="desc">
    <h2 style="margin:4px 0 8px">èª¬æ˜</h2>
    <div class="meta" style="margin-bottom:8px">
      <span class="pill">è³ªå•æ•°ï¼š21</span>
      <span class="pill">å½¢å¼ï¼š0â€“4ï¼ˆ0=ã¾ã£ãŸããªã„ / 4=ã¨ã¦ã‚‚ï¼‰</span>
      <span class="pill">ä¸»å¤©ä½¿ã‚¿ã‚¤ãƒ—ï¼ˆ7ç¨®ï¼‰ï¼‹ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰åˆ¤å®š</span>
    </div>
    <p class="small">â€œã‚„ã•ã—ã•â€ã‚’<strong>å®ˆè­·ãƒ»ä¼å¿ƒãƒ»ç™’è¡Œãƒ»ç…§æ˜ãƒ»ç¥ˆè´ãƒ»åŠ±è³›ãƒ»æ–½ä¸</strong>ã®7ã¤ã«åˆ†è§£ã—ã¦æ‰±ã„ã¾ã™ã€‚UIä¸Šã«é€†è»¢é …ç›®ã®è¡¨ç¤ºã¯å‡ºã—ã¾ã›ã‚“ï¼ˆå†…éƒ¨ã§æ¡ç‚¹å‡¦ç†ï¼‰ã€‚</p>
  </section>

  <!-- è¨­å• -->
  <section class="card section" id="questions">
    <h2 style="margin:4px 0 8px">è¨­å•ï¼ˆ0=ã¾ã£ãŸããªã„ï¼1=ã‚ã¾ã‚Šãªã„ï¼2=åŠã€…ï¼3=ã ã„ãŸã„ï¼4=ã¨ã¦ã‚‚ï¼‰</h2>
    <div id="qWrap"></div>
    <div class="tags">
      <span class="tag">å› å­ï¼šå®ˆè­·ï¼ˆK1ï¼‰ï¼ä¼å¿ƒï¼ˆK2ï¼‰ï¼ç™’è¡Œï¼ˆK3ï¼‰ï¼ç…§æ˜ï¼ˆK4ï¼‰ï¼ç¥ˆè´ï¼ˆK5ï¼‰ï¼åŠ±è³›ï¼ˆK6ï¼‰ï¼æ–½ä¸ï¼ˆK7ï¼‰</span>
    </div>
    <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:10px">
      <button class="btn" id="clearAns">å›ç­”ã‚’ã‚¯ãƒªã‚¢</button>
      <button class="btn primary" id="doScore2">è¨ºæ–­ã™ã‚‹</button>
    </div>
  </section>

  <!-- çµæœ -->
  <section class="card section" id="result" aria-live="polite">
    <div id="resEmpty">
      <span class="badge">ã¾ã çµæœã¯ã‚ã‚Šã¾ã›ã‚“</span>
      <p class="small">å…¨21å•ã«å›ç­”ã—ã¦ã€Œè¨ºæ–­ã™ã‚‹ã€ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚</p>
    </div>

    <div id="resArea" style="display:none">
      <div class="result-head">
        <span class="badge">çµæœ</span>
        <div class="total" id="typeLine">â€”</div>
      </div>

      <!-- 1:1 æ­£æ–¹å½¢ -->
      <div class="hero-square section" role="region" aria-label="ã‚¿ã‚¤ãƒ—ã®ã‚¤ãƒ¡ãƒ¼ã‚¸">
        <figure>
          <img id="heroImg" src="/shindan/assets/results/angel-kindness/01.png" alt="å‰£ã¨ç›¾ã®ç´‹ç« " loading="lazy" width="600" height="600">
        </figure>
        <figcaption>
          <div class="title-row">
            <div class="capline" id="heroTitle">â€”</div>
            <span class="badge-size" id="sizeBadge" aria-label="ç·åˆAKI">â€”</span>
          </div>
          <div class="poem" id="heroPoem">â€”</div>
          <div class="capmini" id="heroCopy">â€”</div>
        </figcaption>
      </div>

      <!-- æ¦‚è¦ -->
      <div class="grid2">
        <article class="stat" aria-label="ç·åˆAKI">
          <div><strong>ç·åˆã‚„ã•ã—ã•æŒ‡æ•°ï¼ˆAKI / 0â€“4ï¼‰</strong></div>
          <div class="big"><span id="sumAvg">0.00</span> / 4.00</div>
          <div class="small" id="sumNote">â€”</div>
        </article>
        <article class="stat" aria-label="å› å­æ¦‚è¦">
          <div><strong>å› å­ï¼ˆK1â€“K7ï¼‰</strong></div>
          <div class="factor-mini" id="guardArea"><!-- JS --></div>
        </article>
      </div>

      <div class="hr"></div>
      <!-- å› å­ãƒãƒ¼ï¼‹ã‚¢ãƒ‰ãƒã‚¤ã‚¹ -->
      <div class="section">
        <h3 style="margin:8px 0">å› å­åˆ¥ã‚¹ã‚³ã‚¢ã¨ã‚¢ãƒ‰ãƒã‚¤ã‚¹</h3>
        <div id="bars" class="factor-mini"><!-- JS --></div>
      </div>

      <div class="hr"></div>
      <div id="longCopy" class="small"><!-- JSï¼šé•·æ–‡ã‚³ãƒ¡ãƒ³ãƒˆï¼ˆä¸Šä½/ä¸‹ä½ã®æ´»ã‹ã—æ–¹ï¼‰ --></div>

      <div class="hr"></div>
      <!-- ç ”ç©¶ãƒ¡ãƒ¢ -->
      <details class="section" open>
        <summary><strong>ç ”ç©¶ãƒ¡ãƒ¢</strong></summary>
        <ul class="small" id="resMemo" style="margin:6px 0 0 18px;line-height:1.8"><!-- JS --></ul>
        <p class="small" style="margin-top:6px">â€»ä¸€èˆ¬çš„ãªå‚¾å‘ã‚„ç›¸é–¢ã®è©±ã§ã™ã€‚å› æœã¯æ–­å®šã§ããšã€å€‹äººå·®ãŒå¤§ãã„ç‚¹ã«ã”ç•™æ„ãã ã•ã„ã€‚</p>
      </details>

      <div class="back-area" style="margin-top:12px">
        <a class="back" href="/shindan/" id="backLink" aria-label="è¨ºæ–­ä¸€è¦§ã«æˆ»ã‚‹">è¨ºæ–­ä¸€è¦§ã«æˆ»ã‚‹</a>
      </div>
    </div>
  </section>

  <section class="footer card">
    <h2 style="margin:4px 0 8px">ã”åˆ©ç”¨ã«ã‚ãŸã£ã¦</h2>
    <p class="warn"><strong>æ³¨æ„ï¼š</strong>ã“ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¯<b>ã‚¨ãƒ³ã‚¿ãƒ¡ç”¨ã®ã‚»ãƒ«ãƒ•ãƒã‚§ãƒƒã‚¯</b>ã§ã™ã€‚åŒ»ç™‚ãƒ»è¨ºæ–­ãƒ»æ²»ç™‚ãƒ»ã‚«ã‚¦ãƒ³ã‚»ãƒªãƒ³ã‚°ç­‰ã®ç›®çš„ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚çµæœã®è§£é‡ˆãƒ»åˆ©ç”¨ã¯ã”è‡ªèº«ã®åˆ¤æ–­ã¨è²¬ä»»ã«ã¦ãŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚<br>
å›ç­”ã¯ç«¯æœ«å†…ã§å‡¦ç†ãƒ»ä¿å­˜ã•ã‚Œã€å›ç­”å†…å®¹ã‚„å€‹äººã‚’ç‰¹å®šã§ãã‚‹æƒ…å ±ã¯ã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡ã•ã‚Œã¾ã›ã‚“ã€‚çµæœè¡¨ç¤ºæ™‚ã«åŒ¿åã®ä»¶æ•°ã‚«ã‚¦ãƒ³ãƒˆã®ã¿é€ä¿¡ã™ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚</p>
  </section>
</main>

<script>
(function(){
  // ====== ãƒšãƒ¼ã‚¸å®šç¾© ======
  var SLUG = "angel-kindness";
  var TITLE = "ä¸ƒå¤©ä½¿ã®å„ªã—ã•è¨ºæ–­";
  var IMG_BASE = "/shindan/assets/results/angel-kindness/"; // æœ«å°¾/
  var ANS_KEY = "specimens:"+SLUG+":answers";

  // ====== å› å­ãƒ»ç”»åƒãƒãƒƒãƒ— ======
  var FACTORS = {
    K1: {name:"å®ˆè­·",  icon:"ğŸ›¡ï¸", items:[1,2,3]},
    K2: {name:"ä¼å¿ƒ",  icon:"ğŸ•Šï¸", items:[4,5,6]},
    K3: {name:"ç™’è¡Œ",  icon:"ğŸ§º", items:[7,8,9]},
    K4: {name:"ç…§æ˜",  icon:"ğŸ”­", items:[10,11,12]},
    K5: {name:"ç¥ˆè´",  icon:"ğŸ•¯ï¸", items:[13,14,15]},
    K6: {name:"åŠ±è³›",  icon:"ğŸ–ï¸", items:[16,17,18]},
    K7: {name:"æ–½ä¸",  icon:"ğŸŒ¾", items:[19,20,21]}
  };
  var REVERSED = new Set([3,6,9,12,15,18,21]); // UIéè¡¨ç¤ºãƒ»å†…éƒ¨ã§åè»¢

  // ç”»åƒã¨æœ¬æ–‡
  var ANGELS = {
    K1:{id:"01", key:"michael",   name:"ãƒŸã‚«ã‚¨ãƒ«ï¼ˆå®ˆè­·ï¼‰",  alt:"å‰£ã¨ç›¾ã®ç´‹ç« ",
        poem:"å‰£ã¯ç·šã‚’å¼•ãã€ç›¾ã¯å±…å ´æ‰€ã‚’å®ˆã‚‹ã€‚",
        copy:"å¢ƒç•Œã‚’ç¤ºã—ã€å ´ã®å®‰å…¨ã‚’å®ˆã‚‹ã‚„ã•ã—ã•ã€‚NOã‚‚å«ã‚ã¦äººã‚’å®ˆã‚‹ã€‚å¼·ã•ã¨æ¸©åº¦ã®ä¸¡ç«‹ãŒæŒã¡å‘³ã€‚", hint:"NOã®å‰ã«ç†ç”±ã‚’ä¸€è¨€ã€‚"},
    K2:{id:"02", key:"gabriel",   name:"ã‚¬ãƒ–ãƒªã‚¨ãƒ«ï¼ˆä¼å¿ƒï¼‰",alt:"å·»ç‰©ã¨ç™¾åˆã®ç´‹ç« ",
        poem:"é™ã‹ãªå ±ã›ãŒã€å¿ƒã®çª“ã‚’ã‚ã‘ã‚‹ã€‚",
        copy:"è¨€è‘‰ã§ãã£ã¨æ”¯ãˆã‚‹å ±ã›ã®å¤©ä½¿ã€‚çŸ­ã„ä¸€è¨€ã§æ¸©åº¦ã‚’æ¸¡ã™ã€‚è©•ä¾¡èªã‚ˆã‚Šâ€œå…·ä½“èªâ€ã‚’é¸ã¹ã‚‹ã€‚", hint:"åè©ä¸€èªã§è¿”ã™ã€‚"},
    K3:{id:"03", key:"raphael",   name:"ãƒ©ãƒ•ã‚¡ã‚¨ãƒ«ï¼ˆç™’è¡Œï¼‰",alt:"æ–ã¨æ—…é„ã®ç´‹ç« ",
        poem:"æ‰‹ãŒå…ˆã«å‹•ãã€å‘¼å¸ãŒæ•´ã†ã€‚",
        copy:"ã¾ãšæ‰‹ãŒå‹•ãåŒä¼´å‹ã®ã‚„ã•ã—ã•ã€‚å°ã•ãªè² æ‹…ã‚’å¼•ãå–ã£ã¦ã€ç›¸æ‰‹ã®å‘¼å¸ã‚’æ•´ãˆã‚‹ã€‚", hint:"15åˆ†ã ã‘ã®æ ã‚’æ±ºã‚ã‚‹ã€‚"},
    K4:{id:"04", key:"uriel",     name:"ã‚¦ãƒªã‚¨ãƒ«ï¼ˆç…§æ˜ï¼‰", alt:"ç¯ç«ã¨æ›¸ã®ç´‹ç« ",
        poem:"ç¯ç«ã¯ä¸‰ã¤ã®ç®±ã‚’ç…§ã‚‰ã™ã€‚",
        copy:"é“ã‚’ç…§ã‚‰ã™æ´å¯Ÿã€‚ä¸‰ã¤ã®ç®±ã§è¦‹å–ã‚Šå›³ã‚’ä½œã‚Šã€æ¬¡ã®ä¸€æ­©ã‚’ä¸€ç·’ã«é¸ã¶ã€‚", hint:"ä¸‰ç®±ã§æ•´ç†ã€‚"},
    K5:{id:"05", key:"selaphiel", name:"ã‚»ãƒ©ãƒ•ã‚£ã‚¨ãƒ«ï¼ˆç¥ˆè´ï¼‰",alt:"é¦™ç‚‰ã¨è¼ªã®ç´‹ç« ",
        poem:"é¦™ãŒæº€ã¡ã€æ²ˆé»™ãŒå‘³æ–¹ã«ãªã‚‹ã€‚",
        copy:"é™ã‘ã•ã§åŒ…ã‚€å­˜åœ¨ã€‚æ€¥ãŒãšã€æ²ˆé»™ã‚’å‘³æ–¹ã«ç›¸æ‰‹ã®è¨€è‘‰ã‚’è¿ãˆã‚‹ã€‚", hint:"10ç§’æ²ˆé»™ã€‚"},
    K6:{id:"06", key:"jehudiel",  name:"ã‚¸ã‚§ãƒ•ãƒ‡ã‚£ã‚¨ãƒ«ï¼ˆåŠ±è³›ï¼‰",alt:"ç‹å† ã¨ãƒªãƒœãƒ³ç« ã®ç´‹ç« ",
        poem:"å°ã•ãªèŠ½ã«ã€å…‰ã®ãƒªãƒœãƒ³ã‚’çµã¶ã€‚",
        copy:"åŠªåŠ›ã®èŠ½ã‚’è¦‹ã¤ã‘ã¦ç§°ãˆã‚‹ã€‚å°ã•ãªé€²æ­©ã‚’å…‰ã‚‰ã›ã€ç¶šã‘ã‚‹åŠ›ã‚’ç”Ÿã‚€ã€‚", hint:"éç¨‹ã‚’è¨€èªåŒ–ã€‚"},
    K7:{id:"07", key:"barachiel", name:"ãƒãƒ©ã‚­ã‚¨ãƒ«ï¼ˆæ–½ä¸ï¼‰",alt:"è–”è–‡ã¨éº¦ã®ç´‹ç« ",
        poem:"è–”è–‡ã®é¦™ã«ã€éº¦ã®å¸­ãŒã²ã‚‰ãã€‚",
        copy:"åˆ†ã‘åˆã„ã€è¿ãˆå…¥ã‚Œã‚‹æ­“å¾…ã€‚å¸­ã‚’ä½œã‚Šã€æ™‚é–“ã‚„è³‡æºã‚’æ°—æŒã¡ã‚ˆãåˆ†ã‘ã‚‹ã€‚", hint:"è‡ªåˆ†ã®ä½™ç™½ã‚’ç¢ºä¿ã€‚"}
  };

  // ====== è¨­å•ï¼ˆ21å•ï¼‰ ======
  var ITEMS = [
    // K1 å®ˆè­·
    {id:1,  text:"ç›¸æ‰‹ã«ã‚‚è‡ªåˆ†ã«ã‚‚â€œå®‰å…¨ãªç·šâ€ã‚’ç¤ºã›ã‚‹ã€‚"},
    {id:2,  text:"ç„¡ç†ãªé ¼ã¿ã«ã¯ã€ä¸å¯§ã«NOã¨è¨€ãˆã‚‹ã€‚"},
    {id:3,  text:"é™ç•Œã§ã‚‚å¼•ãå—ã‘ã¦ã—ã¾ã†ã“ã¨ãŒå¤šã„ã€‚", rev:true},
    // K2 ä¼å¿ƒ
    {id:4,  text:"ã¤ã‚‰ã•ã«çŸ­ã„ä¸€è¨€ã§å¯„ã‚Šæ·»ãˆã‚‹ã€‚"},
    {id:5,  text:"ç›¸æ‰‹ã®æ°—æŒã¡ã‚’è¨€è‘‰ã«ã—ã¦è¿”ã›ã‚‹ã€‚"},
    {id:6,  text:"åŠ±ã¾ã—ãŒè©•ä¾¡ã£ã½ããªã£ã¦ã—ã¾ã†ã€‚", rev:true},
    // K3 ç™’è¡Œ
    {id:7,  text:"å›°ã£ã¦ã„ã‚‹äººã«å…·ä½“ã®æ‰‹ä¼ã„ã‚’ææ¡ˆã§ãã‚‹ã€‚"},
    {id:8,  text:"å°ã•ãªç”¨äº‹ã‚’å…ˆå›ã‚Šã—ã¦æ¸ˆã¾ã›ã‚‰ã‚Œã‚‹ã€‚"},
    {id:9,  text:"ã€Œé ‘å¼µã£ã¦ã€ã¨è¨€ã†ã ã‘ã§å‹•ã‘ãªã„ã“ã¨ãŒã‚ã‚‹ã€‚", rev:true},
    // K4 ç…§æ˜
    {id:10, text:"è¤‡é›‘ãªè©±ã‚’â€œä¸‰ã¤ã®å·¥ç¨‹â€ã«æ•´ç†ã—ã¦ä¸€ç·’ã«è¦‹ã‚‹ã€‚"},
    {id:11, text:"æ¬¡ã®ä¸€æ­©ã‚’é¸æŠè‚¢ã§ç¤ºã›ã‚‹ã€‚"},
    {id:12, text:"è‡ªåˆ†ã®è€ƒãˆã‚’æŠ¼ã—ã¤ã‘ãŒã¡ã«ãªã‚‹ã€‚", rev:true},
    // K5 ç¥ˆè´
    {id:13, text:"é®ã‚‰ãšæœ€å¾Œã¾ã§è´ã‘ã‚‹ã€‚"},
    {id:14, text:"â€œæ²ˆé»™10ç§’â€ã‚’æ€–ãŒã‚‰ãšä¿ã¦ã‚‹ã€‚"},
    {id:15, text:"è‰¯ã‹ã‚Œã¨æ€ã£ã¦ã™ãè§£æ±ºã«èµ°ã£ã¦ã—ã¾ã†ã€‚", rev:true},
    // K6 åŠ±è³›
    {id:16, text:"å°ã•ãªé€²æ­©ã‚’è¦‹ã¤ã‘ã¦è¨€è‘‰ã«ã§ãã‚‹ã€‚"},
    {id:17, text:"æˆæœã ã‘ã§ãªãåŠªåŠ›ã®éç¨‹ã‚‚èªã‚ã‚‰ã‚Œã‚‹ã€‚"},
    {id:18, text:"æ¯”ã¹è¨€è‘‰ï¼ˆã€Œèª°ã€…ã‚ˆã‚Šã€ï¼‰ã‚’ä½¿ã„ãŒã¡ã ã€‚", rev:true},
    // K7 æ–½ä¸
    {id:19, text:"æ™‚é–“ã‚„ç‰©ã‚’æ°—æŒã¡ã‚ˆãåˆ†ã‘åˆãˆã‚‹ã€‚"},
    {id:20, text:"åˆå¯¾é¢ã§ã‚‚â€œå±…å ´æ‰€ã‚’ä½œã‚‹â€ãµã‚‹ã¾ã„ãŒã§ãã‚‹ã€‚"},
    {id:21, text:"è‡ªåˆ†ã®ä½™è£•ãŒãªã„ã¨ã™ãã‚¼ãƒ­ã«ãªã£ã¦ã—ã¾ã†ã€‚", rev:true}
  ];
  var LABELS = ["ã¾ã£ãŸããªã„","ã‚ã¾ã‚Šãªã„","åŠã€…","ã ã„ãŸã„","ã¨ã¦ã‚‚"];

  // ====== å‚ç…§ ======
  var qWrap = document.getElementById("qWrap");
  var prog = document.getElementById("prog");
  var resEmpty = document.getElementById("resEmpty");
  var resArea = document.getElementById("resArea");
  var typeLine = document.getElementById("typeLine");
  var heroImg = document.getElementById("heroImg");
  var heroTitle = document.getElementById("heroTitle");
  var heroPoem = document.getElementById("heroPoem");
  var heroCopy = document.getElementById("heroCopy");
  var sizeBadgeEl = document.getElementById("sizeBadge");
  var sumAvg = document.getElementById("sumAvg");
  var sumNote = document.getElementById("sumNote");
  var guardArea = document.getElementById("guardArea");
  var bars = document.getElementById("bars");
  var longCopy = document.getElementById("longCopy");
  var resMemo = document.getElementById("resMemo");

  // ====== ä¿å­˜ç³» ======
  function saveAnswers(){
    try{
      var out = {};
      for(var i=0;i<ITEMS.length;i++){
        var id = ITEMS[i].id;
        var chk = qWrap.querySelector('#fs-'+id+' input[type="radio"]:checked');
        if(chk){ out[id] = parseInt(chk.value,10); }
      }
      localStorage.setItem(ANS_KEY, JSON.stringify({ts:Date.now(), ans:out}));
    }catch(e){}
  }
  function restoreAnswers(){
    try{
      var raw = localStorage.getItem(ANS_KEY);
      if(!raw) return;
      var data = JSON.parse(raw);
      var ans = (data && data.ans) || {};
      Object.keys(ans).forEach(function(id){
        var v = ans[id];
        var input = qWrap.querySelector('#q'+id+'-'+v);
        if(input){ input.checked = true; }
      });
      updateProgress();
    }catch(e){}
  }
  function wipeAnswers(){
    try{ localStorage.removeItem(ANS_KEY); }catch(e){}
  }

  // ====== UIç”Ÿæˆ ======
  function buildQuestions(){
    var html = "";
    for(var i=0;i<ITEMS.length;i++){
      var q = ITEMS[i];
      html += '<fieldset class="q" id="fs-'+q.id+'">'+
        '<legend>'+q.text+'</legend>'+
        '<div class="scale" role="radiogroup" aria-label="'+q.text+'">';
      for(var v=0;v<=4;v++){
        html += '<div style="position:relative">'+
          '<input id="q'+q.id+'-'+v+'" type="radio" name="q'+q.id+'" value="'+v+'">'+
          '<label for="q'+q.id+'-'+v+'" title="'+LABELS[v]+'">'+LABELS[v]+'</label>'+
        '</div>';
      }
      html += '</div></fieldset>';
    }
    qWrap.innerHTML = html;

    var radios = qWrap.querySelectorAll('input[type="radio"]');
    for(var r=0;r<radios.length;r++){
      radios[r].addEventListener('change', function(){
        saveAnswers(); updateProgress();
      }, false);
    }
    restoreAnswers();
  }
  function updateProgress(){
    var total = ITEMS.length;
    var answered = qWrap.querySelectorAll('input[type="radio"]:checked').length;
    prog.style.width = Math.round(100*answered/total) + "%";
  }

  // ====== æ¡ç‚¹ ======
  function score(){
    var missing = [];
    var ans = {};
    for(var i=0;i<ITEMS.length;i++){
      var id = ITEMS[i].id;
      var chk = qWrap.querySelector('#fs-'+id+' input[type="radio"]:checked');
      if(!chk){ missing.push(id); continue; }
      var raw = parseInt(chk.value,10);
      var def = ITEMS[i];
      var val = (def.rev || REVERSED.has(id)) ? (4 - raw) : raw;
      ans[id] = val;
    }
    if(missing.length){
      alert("æœªå›ç­”ãŒã‚ã‚Šã¾ã™ã€‚å…¨21å•ã«ãŠç­”ãˆãã ã•ã„ã€‚");
      var fs = document.getElementById('fs-'+missing[0]);
      if(fs){ fs.scrollIntoView({behavior:"smooth", block:"center"}); fs.classList.add("need"); setTimeout(function(){ fs.classList.remove("need"); },1600); }
      return;
    }

    // å› å­å¹³å‡
    function avgOf(ids){
      var sum = 0;
      for(var j=0;j<ids.length;j++){ sum += (ans[ids[j]]||0); }
      return sum / ids.length;
    }
    var by = {};
    Object.keys(FACTORS).forEach(function(k){
      by[k] = avgOf(FACTORS[k].items);
    });

    // ç·åˆAKIï¼7å› å­å¹³å‡
    var total = 0, n=0;
    Object.keys(by).forEach(function(k){ total += by[k]; n++; });
    var aki = Math.round((total/n)*100)/100;

    render({avg:aki, by:by});
  }

  // ====== è¡¨ç¤º ======
  function render(o){
    // ãƒˆãƒƒãƒ—/2ä½
    var entries = Object.keys(o.by).map(function(k){ return {k:k, v:o.by[k]}; });
    entries.sort(function(a,b){ return b.v - a.v; });
    var top = entries[0], second = entries[1];
    var delta = Math.abs(top.v - second.v);
    var hybrid = (delta <= 0.15);

    var A1 = ANGELS[top.k];
    var titleName = A1.name;
    var heroAlt = A1.alt;
    var heroImgId = A1.id;

    var headCopy = A1.copy;
    var poem = A1.poem;

    var subBadge = "AKI " + o.avg.toFixed(2) + " / 4.00";

    if(hybrid){
      // äºŒé‡ç¿¼
      var A2 = ANGELS[second.k];
      titleName = A1.name.replace(/ï¼ˆ.*?ï¼‰/,"") + " Ã— " + A2.name.replace(/ï¼ˆ.*?ï¼‰/,"") + "ï¼ˆäºŒé‡ç¿¼ï¼‰";
      poem = A1.poem + "ï½œ" + A2.poem;
      headCopy = "ä¸Šä½äºŒå› å­ãŒæ‹®æŠ—ã€‚<b>"+FACTORS[top.k].name+"</b>Ã—<b>"+FACTORS[second.k].name+"</b>ã®â€œäºŒé‡ç¿¼â€ã‚¿ã‚¤ãƒ—ã€‚çŠ¶æ³ã«å¿œã˜ã¦ç¿¼ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ã¨æœ€é©åŒ–ã—ã‚„ã™ã„ã€‚";
      subBadge += " ãƒ» äºŒé‡ç¿¼";
      // ç”»åƒã¯ç¬¬ä¸€å„ªå…ˆã®ã¾ã¾
    }

    // ç”»åƒ
    heroImg.src = IMG_BASE + heroImgId + ".png";
    heroImg.alt = heroAlt;
    heroTitle.innerHTML = "ã‚ãªãŸã®ä¸»å¤©ä½¿ã‚¿ã‚¤ãƒ—ï¼š<b>"+titleName+"</b>";
    heroPoem.textContent = poem;
    heroCopy.innerHTML = headCopy;
    sizeBadgeEl.textContent = subBadge;

    // ç·åˆ
    sumAvg.textContent = o.avg.toFixed(2);
    var note = (o.avg<1.2) ? "èŠ½å¹ãã®ãƒ•ã‚§ãƒ¼ã‚ºã€‚ã²ã¨ã¤ã®å ´é¢ã«â€œã²ã¨å·¥å¤«â€ã‚’è¶³ã™ã ã‘ã§ä½“æ„ŸãŒå¤‰ã‚ã‚Šã¾ã™ã€‚"
             : (o.avg<2.0) ? "ã‚„ã•ã—ã•ã®åŸºç¤ä½“åŠ›ãŒæ•´ã„å§‹ã‚ã¦ã„ã¾ã™ã€‚å¾—æ„ã®å› å­ã‹ã‚‰å®Ÿè·µé »åº¦ã‚’ä¸Šã’ã¦ã„ãæ®µéšã€‚"
             : (o.avg<2.8) ? "è¤‡æ•°å› å­ãŒå®‰å®šã€‚å ´ã«å¿œã˜ã¦ä½¿ã„åˆ†ã‘ã‚‹ã¨ã€è² æ‹…ãªãç¶šã‘ã‚‰ã‚Œã¾ã™ã€‚"
             : "ã‚„ã•ã—ã•ã®è¨­è¨ˆãŒæ´—ç·´ã€‚è‡ªåˆ†ã®ä½™ç™½ï¼ˆä¼‘æ¯ï¼‰ã‚’ç¢ºä¿ã—ã¤ã¤ç¶­æŒã§ãã‚‹ã¨ç›¤çŸ³ã€‚";
    sumNote.textContent = note;

    // æ¦‚è¦ã‚¿ã‚°
    var gHtml = "";
    Object.keys(FACTORS).forEach(function(k){
      var name = FACTORS[k].name, emo = FACTORS[k].icon, v=o.by[k], pct=Math.round(v/4*100);
      gHtml += '<div class="guard"><div class="g-emo" aria-hidden="true">'+emo+
               '</div><div><div><strong>'+name+'</strong> <span class="small">å¹³å‡ '+v.toFixed(2)+' / 4</span></div>'+
               '<div class="small" style="opacity:.9">å¸¯ï¼š'+pct+'%</div></div></div>';
    });
    guardArea.innerHTML = gHtml;

    // å› å­ãƒãƒ¼ï¼‹ã‚¢ãƒ‰ãƒã‚¤ã‚¹
    var ADVICE = {
      K1:{tend:"ç·šã‚’å¼•ã„ã¦å®ˆã‚‹ã®ãŒå¾—æ„ã€‚é ¼ã‚‰ã‚Œã‚‹ã¨å ´ãŒè½ã¡ç€ãã€‚",
          do:"NOã®å‰ã«â€œç†ç”±ã‚’ä¸€è¨€â€ã€‚å®‰å…¨ã®ç·šã‚’è¨€èªåŒ–ã€‚"},
      K2:{tend:"çŸ­ã„è¨€è‘‰ã§æ¸©åº¦ã‚’æ¸¡ã™ã®ãŒä¸Šæ‰‹ã€‚ç©ºæ°—ãŒæŸ”ã‚‰ãã€‚",
          do:"â€œåè©ä¸€èªã®è¦ç´„â€â†’çŸ­ã„ç›¸æ§Œâ†’ä¸€è¨€ã ã‘ã€‚"},
      K3:{tend:"ã¾ãšæ‰‹ãŒå‹•ãåŒä¼´å‹ã€‚å°ã•ãªè² æ‹…ã‚’å¼•ãå–ã‚Œã‚‹ã€‚",
          do:"â€œ15åˆ†ã ã‘â€ã®æ ã‚’æ±ºã‚ã¦æ‰‹ã‚’å‡ºã™ã€‚"},
      K4:{tend:"æ•´ç†ã¨é“ç­‹ã¥ãã‚ŠãŒå¼·ã¿ã€‚è¿·ã„ã«åœ°å›³ã‚’æ¸¡ã›ã‚‹ã€‚",
          do:"è©±ã‚’â€œä¸‰ç®±ï¼ˆç¾çŠ¶/åŸå› /æ¬¡ã®ä¸€æ­©ï¼‰â€ã«ä»•åˆ†ã‘ã€‚"},
      K5:{tend:"æ²ˆé»™ã‚’å‘³æ–¹ã«è´ã‘ã‚‹ã€‚ç›¸æ‰‹ã®è¨€è‘‰ãŒæ·±ã¾ã‚‹ã€‚",
          do:"10ç§’ã®æ²ˆé»™â†’ç›¸æ‰‹ã®èªã‚’ä¸€èªã ã‘è¿”ã™ã€‚"},
      K6:{tend:"åŠªåŠ›ã®èŠ½ã‚’è¦‹ã¤ã‘ã¦å…‰ã‚‰ã›ã‚‹ã€‚ç¶šã‘ã‚‹åŠ›ã‚’ç”Ÿã‚€ã€‚",
          do:"â€œéç¨‹ã®å…·ä½“â€ã‚’ä¸€ã¤è¨€èªåŒ–ã—ã¦ç§°ãˆã‚‹ã€‚"},
      K7:{tend:"æ­“å¾…ã¨åˆ†é…ãŒè‡ªç„¶ã€‚å ´ã«å±…å ´æ‰€ã‚’ä½œã‚Œã‚‹ã€‚",
          do:"è‡ªåˆ†ã®ä½™ç™½ï¼ˆæ™‚é–“/ä½“åŠ›ï¼‰ã‚’å…ˆã«ç¢ºä¿ã—ã¦ã‹ã‚‰ä¸ãˆã‚‹ã€‚"}
    };
    var bHtml = "";
    Object.keys(FACTORS).forEach(function(k){
      var label=FACTORS[k].name, v=o.by[k], pct=Math.round(v/4*100);
      var band = (pct<35)?"ä½":(pct<70)?"ä¸­":"é«˜";
      bHtml += '<article class="bar" aria-label="'+label+'">'+
        '<div><strong>'+label+'</strong>'+
          '<span class="pill" style="margin-left:6px">'+v.toFixed(2)+' / 4</span>'+
          '<span class="pill" style="margin-left:6px">'+pct+'%ï¼ˆ'+band+'ï¼‰</span></div>'+
        '<div class="row" aria-hidden="true"><span style="width:'+pct+'%"></span></div>'+
        '<div class="mini"><b>å‚¾å‘ï¼š</b>'+ADVICE[k].tend+' ï¼ <b>æ´»ã‹ã—æ–¹ï¼š</b>'+ADVICE[k].do+'</div>'+
      '</article>';
    });
    bars.innerHTML = bHtml;

    // é•·æ–‡ï¼ˆä¸Šä½ã¨ä¸‹ä½ã®çµ„ã¿åˆã‚ã›ææ¡ˆï¼‰
    var low = entries[entries.length-1];
    var msgTop = "ã„ã¾å¼·ã„ç¿¼ã¯ã€Œ<b>"+FACTORS[top.k].name+"</b>ã€ã€‚æ—¥å¸¸ã®å°ã•ãªå ´é¢ã§å›æ•°ã‚’å¢—ã‚„ã™ã¨ã€æ‰‹å¿œãˆãŒã•ã‚‰ã«å®‰å®šã—ã¾ã™ã€‚";
    var msg2nd = "æ¬¡ç‚¹ã¯ã€Œ<b>"+FACTORS[second.k].name+"</b>ã€ã€‚ã“ã®ç¿¼ã‚’å°‘ã—ã ã‘å…ˆã«å‡ºã™/å¾Œã§æ·»ãˆã‚‹ã€ãªã©é †ç•ªã®å·¥å¤«ãŒåŠ¹ãã‚„ã™ã„ã€‚";
    var msgLow = "æ§ãˆã‚ãªã®ã¯ã€Œ<b>"+FACTORS[low.k].name+"</b>ã€ã€‚ç„¡ç†ã«ä¼¸ã°ã™ã‚ˆã‚Šã€å¾—æ„ãªç¿¼ã®å»¶é•·ã§â€œ1å›ã ã‘è©¦ã™â€ãã‚‰ã„ãŒã¡ã‚‡ã†ã©è‰¯ã„ã€‚";
    longCopy.innerHTML = msgTop + "<br>"+ msg2nd + "<br>"+ msgLow;

    // ç ”ç©¶ãƒ¡ãƒ¢
    var memo = [
      "ãƒ»ã‚ã‚‹ç ”ç©¶ã§ã¯ã€å…±æ„Ÿçš„ãªå‚¾è´ï¼ˆé®ã‚‰ãªã„ãƒ»è¨€ã„æ›ãˆãƒ»æ²ˆé»™ã®æ´»ç”¨ï¼‰ãŒæ”¯æ´æ„Ÿã‚’é«˜ã‚ã‚‹ç¤ºå”†ã€‚",
      "ãƒ»çŸ­ã„â€œçµè«–ãƒ©ãƒ™ãƒ«â€ã‚„å…·ä½“èªã§è¿”ã™ã¨ã€ç†è§£åº¦ãƒ»ä¿¡é ¼ãŒä¸ŠãŒã‚Šã‚„ã™ã„ã¨ã„ã†å ±å‘Šã€‚",
      "ãƒ»â€œä¸‰ã¤ã«åŒºåˆ‡ã‚‹â€ã ã‘ã§èªçŸ¥è² è·ãŒä¸‹ãŒã‚Šã€åˆæ„å½¢æˆã‚’åŠ©ã‘ã‚‹å‚¾å‘ãŒç¤ºã•ã‚Œã‚‹ã€‚",
      "ãƒ»å°ã•ãªé€²æ­©ã‚’è¨€èªåŒ–ã—ã¦ç§°ãˆã‚‹ã¨ã€å†…ç™ºçš„å‹•æ©Ÿã¥ã‘ãŒç¶­æŒã•ã‚Œã‚„ã™ã„ã¨ã„ã†çŸ¥è¦‹ã€‚",
      "ãƒ»å¢ƒç•Œï¼ˆNOã®è¨€èªåŒ–ï¼‰ã¯å¯¾äººã‚¹ãƒˆãƒ¬ã‚¹ã‚’ä¸‹ã’ã€é•·æœŸçš„ãªã‚„ã•ã—ã•ã®æŒç¶šã«å¯„ä¸ã—ã†ã‚‹ç¤ºå”†ã€‚"
    ];
    resMemo.innerHTML = memo.map(function(s){ return "<li>"+s+"</li>"; }).join("");

    // è¡¨ç¤ºåˆ‡æ›¿
    resEmpty.style.display = "none";
    resArea.style.display = "block";
    document.getElementById("result").scrollIntoView({behavior:"smooth", block:"start"});

    // ä¸€è¦§ã€Œã¤ã¥ãã‹ã‚‰å†é–‹ã€
    try{
      document.dispatchEvent(new Event('result:ready'));
      localStorage.setItem("specimens:last", JSON.stringify({ id: SLUG, title: TITLE, href: location.pathname }));
    }catch(e){}
  }

  // ====== ã‚¯ãƒªã‚¢ ======
  function clearAnswers(){
    var radios = qWrap.querySelectorAll('input[type="radio"]');
    for(var i=0;i<radios.length;i++){ radios[i].checked=false; }
    wipeAnswers();
    prog.style.width = "0%";
    resEmpty.style.display = "";
    resArea.style.display = "none";
    var app = document.getElementById("app");
    if(app){ app.scrollIntoView({behavior:"smooth", block:"start"}); }
  }

  // ====== åˆæœŸåŒ– ======
  if(document.readyState === "loading"){
    document.addEventListener("DOMContentLoaded", function(){ buildQuestions(); });
  }else{
    buildQuestions();
  }
  document.getElementById("doScore").addEventListener("click", score, false);
  document.getElementById("doScore2").addEventListener("click", score, false);
  document.getElementById("clearAns").addEventListener("click", clearAnswers, false);
  var back = document.getElementById("backLink");
  if(back){
    back.addEventListener("click", function(){
      try{
        document.dispatchEvent(new Event('result:ready'));
      localStorage.setItem("specimens:last", JSON.stringify({ id: SLUG, title: TITLE, href: location.pathname }));
      }catch(e){}
    }, false);
  }
})();
</script>
<script>
/* ã“ã“ã‚Lv/æ¸ˆã‚«ã‚¦ãƒ³ãƒˆï¼ˆçµæœæç”»ã®åˆå›³ã§ä¸€åº¦ã ã‘ï¼‰ */
(function(){
  'use strict';
  var DONE_KEY    = 'specimens:open:byid';         // æ¸ˆãƒãƒƒãƒ—
  var TOTAL_KEY   = 'specimens:open:total';        // ã‚ãªãŸã®ã“ã“ã‚Lvï¼ˆåˆè¨ˆï¼‰
  var GLOBAL_LAST = 'specimens:open:global:last';  // ä¸€è¦§ã®åˆæœŸè¡¨ç¤ºã‚­ãƒ£ãƒƒã‚·ãƒ¥
  var MY_ID = (document.body && document.body.getAttribute('data-id')) || 'unknown';

  // ã¿ã‚“ãªã®Lvï¼ˆCountAPIï¼‰
  var COUNTAPI_NS  = 'haisuikounozarigani_shindan';
  var COUNTAPI_KEY = 'specimens_open_total';
  function hitEveryone(){
    var url = 'https://api.countapi.xyz/hit/'+COUNTAPI_NS+'/'+COUNTAPI_KEY;
    if(navigator.sendBeacon){ try{ navigator.sendBeacon(url); }catch(_){ } }
    else{ fetch(url, {mode:'cors', cache:'no-store', keepalive:true}).catch(function(){}); }
  }

  var marked = false;
  function markOnce(){
    if(marked) return; marked = true;
    try{
      // ã‚ãªãŸã®ã“ã“ã‚Lv +1
      localStorage.setItem(TOTAL_KEY, String((+localStorage.getItem(TOTAL_KEY) || 0) + 1));
      // æ¸ˆãƒãƒƒãƒ— +1ï¼ˆä»–ã‚¿ãƒ–å³æ™‚åæ˜ ç”¨ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—æ··ãœï¼‰
      var map={}; try{ map = JSON.parse(localStorage.getItem(DONE_KEY) || '{}'); }catch(_){}
      map[MY_ID] = (map[MY_ID] || 0) + 1;
      localStorage.setItem(DONE_KEY, JSON.stringify(Object.assign({}, map, {_ts: Date.now()})));
      // ã¿ã‚“ãªã®Lv +1 ã¨è¦‹æ „ãˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ +1
      hitEveryone();
      try{ localStorage.setItem(GLOBAL_LAST, String((+localStorage.getItem(GLOBAL_LAST) || 0) + 1)); }catch(_){}
    }catch(_){}
  }

  // çµæœæç”»ã®åˆå›³ã§åŠ ç®—ã€ä¿é™ºã§2ç§’å¾Œã«ã‚‚ä¸€åº¦ã ã‘
  document.addEventListener('result:ready', markOnce);
  setTimeout(markOnce, 2000);
})();
</script>
</body>
</html>