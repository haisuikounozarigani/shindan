<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ã‚¹ãƒˆãƒ¼ã‚«ãƒ¼èƒŒå¾ŒéœŠè¨ºæ–­</title>
<meta name="description" content="ã¤ã„â€œè¦‹å®ˆã‚ŠãŒè¿‘ã™ãã‚‹â€ã“ã¨ã¯ãªã„ï¼Ÿ 15å•ã§ã€Œè¦³å¯Ÿãã›ï¼å¢ƒç•Œç·šï¼å¾…æ©Ÿè€æ€§ï¼è§£é‡ˆãƒ–ãƒ¬ãƒ¼ã‚­ï¼è¡å‹•ã‚¹ãƒˆãƒƒãƒ—ã€ã‚’æ•°å€¤åŒ–ã€‚ã‚„ã•ã—ã„è·é›¢æ„Ÿã®ã‚³ãƒ„ã‚’ãã£ã¨å¯è¦–åŒ–ã—ã¾ã™ã€‚">
<meta name="theme-color" content="#f7f9ff">
<!-- OG -->
<meta property="og:type" content="website">
<meta property="og:title" content="ã‚¹ãƒˆãƒ¼ã‚«ãƒ¼èƒŒå¾ŒéœŠè¨ºæ–­">
<meta property="og:description" content="15å•ã§â€œè¦‹å®ˆã‚ŠãŒè¿‘ã™ãã‚‹ã‚¯ã‚»â€ã‚’å¯è¦–åŒ–ã€‚è·é›¢æ„Ÿã‚¹ã‚­ãƒ«ã‚’ãƒãƒ¼ã¨ï¼…ã§è¡¨ç¤ºã—ã¾ã™ã€‚">
<meta property="og:url" content="https://haisuikounozarigani.github.io/shindan/stalker-ghost.html">
<meta property="og:image" content="/shindan/assets/results/stalker-ghost/t01.webp">
<style>
:root{
  --accent:#4aa8ff; --accent2:#a48bff;
  --ink:#1f2732; --muted:#667087; --paper:#fff;
  --bg1:#f7f9ff; --bg2:#f6f3ff; --line:#e6ecf7;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; color:var(--ink);
  background:linear-gradient(180deg,var(--bg1),var(--bg2));
  font-family:"Noto Sans JP",system-ui,-apple-system,"Segoe UI",Roboto,"Hiragino Kaku Gothic ProN",sans-serif;
}
a{color:inherit}
.wrap{max-width:980px;margin:18px auto;padding:0 14px}
header.hd{display:grid;grid-template-columns:56px 1fr;gap:12px;align-items:center;margin:8px 0}
.logo{width:56px;height:56px;border-radius:14px;background:linear-gradient(135deg,#e1f2ff,#ece6ff);display:grid;place-items:center;font-size:28px}
h1{margin:0;font-size:clamp(22px,4.6vw,34px);letter-spacing:.02em}
.sub{margin:4px 0 0;color:var(--muted);font-size:.96em}
.card{background:var(--paper);border:1px solid var(--line);border-radius:16px;padding:14px}
.section{margin:14px 0}
.pill{display:inline-block;padding:4px 8px;border:1px solid var(--line);border-radius:999px;background:#fff;color:#6b6a77;font-size:.88em}
.meta{display:flex;gap:8px;flex-wrap:wrap}
.sticky{position:sticky;top:0;z-index:10;margin:-6px -14px 12px;padding:8px 14px;background:rgba(255,255,255,.8);backdrop-filter:blur(6px) saturate(1.05);border-bottom:1px solid #e9edf7;display:flex;align-items:center;gap:10px}
.progress{height:8px;background:#edf2fb;border-radius:999px;flex:1;overflow:hidden}
.progress>span{
  display:block;height:100%;width:0;
  background:linear-gradient(90deg,var(--accent),var(--accent2));
  transition:width .25s ease;
}
.btn{padding:10px 14px;border:1px solid var(--line);border-radius:12px;background:#fff;cursor:pointer}
.btn.primary{background:linear-gradient(90deg,var(--accent),var(--accent2));border-color:transparent;color:#fff;font-weight:700}
fieldset.q{border:1px solid var(--line);border-radius:12px;padding:10px;margin:10px 0;background:#fff}
legend{font-weight:700}
.scale{display:grid;grid-template-columns:repeat(5,minmax(66px,1fr));gap:8px;margin-top:8px}
.scale input{position:absolute;opacity:0;pointer-events:none}
.scale label{display:grid;place-items:center;border:1px solid #e5e9f3;border-radius:10px;padding:8px;cursor:pointer;user-select:none;background:#fff}
.scale input:checked+label{outline:2px solid var(--accent);border-color:transparent}
mark.need{animation:need 1.6s ease}
@keyframes need{0%{box-shadow:0 0 0 0 rgba(74,168,255,.45)}100%{box-shadow:0 0 0 0 rgba(74,168,255,0)}}
.result-head{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
.badge{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;background:linear-gradient(90deg,var(--accent),var(--accent2));color:#fff;font-weight:700}
.total{font-size:26px;font-weight:800}
.small{color:var(--muted);font-size:.92em}

/* ãƒ’ãƒ¼ãƒ­ãƒ¼ï¼ˆopennesså½¢å¼ã‚’è¸è¥²ï¼‰ */
.hero-vert{display:grid;place-items:center;border:1px solid var(--line);border-radius:16px;background:#fff;overflow:hidden}
.hero-vert figure{margin:0;width:min(720px,100%);max-width:100%;aspect-ratio:1/1;border-bottom:1px solid var(--line);background:#f7f9ff}
.hero-vert img{width:100%;height:100%;object-fit:cover;display:block}
.hero-vert figcaption{padding:10px;width:100%}
.hero-vert .capline{font-weight:800;line-height:1.55;overflow-wrap:anywhere;word-break:break-word;white-space:normal}
.hero-vert .poem{font-style:italic;letter-spacing:.02em;margin-top:4px;color:#445;opacity:.9}
.hero-vert .capmini{font-size:1em;line-height:1.85;color:var(--muted);overflow-wrap:anywhere;word-break:break-word;white-space:normal}

.grid2{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:12px}
.stat{border:1px solid var(--line);border-radius:12px;padding:10px;background:#fff}
.stat .big{font-size:22px;font-weight:800}
.hr{height:1px;background:var(--line);margin:10px 0}
.factor-mini{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:10px}
.bar{border:1px solid var(--line);border-radius:12px;padding:10px;background:#fff}
.bar .row{height:10px;background:#edf2fb;border-radius:999px;overflow:hidden;margin-top:6px}
.bar .row>span{display:block;height:100%;width:0;background:linear-gradient(90deg,var(--accent),var(--accent2))}
.note{border:1px solid var(--line);border-radius:12px;background:#fff;padding:10px}
.note h4{margin:0 0 6px;font-size:16px}
.note p{margin:6px 0;line-height:1.75}
.footer{color:var(--muted);font-size:.92em}
.warn{background:#f8fbff;border:1px solid #e1ebf7;border-radius:12px;padding:10px;margin:12px 0}
.back-area{display:flex;justify-content:center;margin-top:10px}
a.back{display:inline-flex;align-items:center;gap:6px;padding:10px 14px;border:1px solid var(--line);border-radius:12px;background:#fff;text-decoration:none}
.badge-size{display:inline-flex;align-items:center;gap:6px;padding:4px 8px;border-radius:999px;background:#fff;border:1px solid var(--line);font-size:.85em;margin-left:6px}
.title-row{display:flex;align-items:center;gap:6px;flex-wrap:wrap}

/* å…±æœ‰ãƒœã‚¿ãƒ³ */
.share-row{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
.btn.tw::before{content:"ğ•";margin-right:.25em}
.btn.line::before{content:"ğŸ’¬";margin-right:.25em}
.btn.ig::before{content:"ğŸ“¸";margin-right:.25em}

@media (max-width: 560px){
  .wrap{padding:0 10px}
  .sticky{top:calc(env(safe-area-inset-top) + 0px); padding:8px 10px}
  .scale{grid-template-columns:repeat(2,1fr)}
  .scale label{padding:12px 8px;font-size:14px}
  .hero-vert figure{width:100%}
  .grid2{grid-template-columns:1fr}
  .badge-size{font-size:.8em}
  .card{padding:12px}
  .hero-vert .capline{font-size:clamp(16px,5.2vw,20px);line-height:1.65}
  .hero-vert .capmini{font-size:clamp(14px,4.6vw,16px);line-height:1.95}
  .note h4{font-size:15px}
}
</style>
</head>
<body data-id="stalker-ghost">
<main class="wrap" id="app">
  <header class="hd">
    <div class="logo">ğŸ‘»</div>
    <div>
      <h1>ã‚¹ãƒˆãƒ¼ã‚«ãƒ¼èƒŒå¾ŒéœŠè¨ºæ–­</h1>
      <p class="sub">15å•ï¼ˆ0ã€œ4ã®5ä»¶æ³•ï¼‰ã€‚ç·åˆã‚¹ã‚³ã‚¢ã¨å› å­ãƒãƒ¼ã€ç ”ç©¶ãƒ¡ãƒ¢ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚</p>
    </div>
  </header>

  <div class="sticky" aria-live="polite">
    <span>ğŸ“Š</span>
    <div class="progress" aria-label="å›ç­”é€²æ—" role="progressbar" aria-valuemin="0" aria-valuemax="15">
  <span id="prog"></span>
</div>
    <button class="btn primary" id="doScore">è¨ºæ–­ã™ã‚‹</button>
  </div>

  <section class="card section" id="desc">
    <h2 style="margin:4px 0 8px">èª¬æ˜</h2>
    <div class="meta" style="margin-bottom:8px">
      <span class="pill">è³ªå•æ•°ï¼š15</span>
      <span class="pill">å½¢å¼ï¼š0â€“4ï¼ˆ0=ã„ã„ãˆ / 4=ã¨ã¦ã‚‚ã‚ã‚‹ï¼‰</span>
      <span class="pill">ç·åˆï¼š0â€“4ï¼ˆ5å› å­å¹³å‡ï¼‰</span>
    </div>
    <p class="small">â€œèƒŒå¾ŒéœŠâ€ã¯æ¯”å–©ã§ã™ã€‚ã“ã“ã§ã¯<strong>è·é›¢æ„Ÿã®ã‚¹ã‚­ãƒ«</strong>ã‚’5å› å­ï¼ˆè¦³å¯Ÿãã›ï¼å¢ƒç•Œç·šï¼è¿”ä¿¡å¾…ã¡ï¼è§£é‡ˆãƒ–ãƒ¬ãƒ¼ã‚­ï¼è¡å‹•ã‚¹ãƒˆãƒƒãƒ—ï¼‰ã§ãã£ã¨å¯è¦–åŒ–ã—ã¾ã™ã€‚â€»ã‚¨ãƒ³ã‚¿ãƒ¡è‡ªå·±ç†è§£ç”¨ã€‚</p>
  </section>

  <!-- è¨­å• -->
  <section class="card section" id="questions">
    <h2 style="margin:4px 0 8px">è¨­å•ï¼ˆ0=ã„ã„ãˆï¼1=ã‚ã¾ã‚Šãªã„ï¼2=ã¨ãã©ãï¼3=ã‚ˆãã‚ã‚‹ï¼4=ã¨ã¦ã‚‚ã‚ã‚‹ï¼‰</h2>
    <div id="qWrap"></div>
    <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:10px">
      <button class="btn" id="clearAns">å›ç­”ã‚’ã‚¯ãƒªã‚¢</button>
      <button class="btn primary" id="doScore2">è¨ºæ–­ã™ã‚‹</button>
    </div>
  </section>

  <!-- çµæœ -->
  <section class="card section" id="result" aria-live="polite">
    <div id="resEmpty">
      <span class="badge">ã¾ã çµæœã¯ã‚ã‚Šã¾ã›ã‚“</span>
      <p class="small">å…¨15å•ã«å›ç­”ã—ã¦ã€Œè¨ºæ–­ã™ã‚‹ã€ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚</p>
    </div>

    <div id="resArea" style="display:none">
      <div class="result-head">
        <span class="badge">çµæœ</span>
        <div class="total" id="typeLine">â€”</div>
      </div>

      <!-- ãƒ’ãƒ¼ãƒ­ãƒ¼ï¼ˆ1:1ãƒ»ã‚¿ã‚¤ãƒˆãƒ«â†’ç”»åƒâ†’ã‚³ãƒ¡ãƒ³ãƒˆã®é †ã‚’ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ã§è¡¨ç¾ï¼‰ -->
      <div class="hero-vert section" role="region" aria-label="ã‚¿ã‚¤ãƒ—ã‚¤ãƒ¡ãƒ¼ã‚¸">
        <figure>
          <img id="heroImg" src="/shindan/assets/results/stalker-ghost/t01.webp" alt="çµæœã‚¤ãƒ¡ãƒ¼ã‚¸" loading="lazy" width="1200" height="1200">
        </figure>
        <figcaption>
          <div class="title-row">
            <div class="capline" id="heroTitle">â€”</div>
            <span class="badge-size" id="sizeBadge" aria-label="ç·åˆå¹³å‡">â€”</span>
          </div>
          <div class="poem" id="heroPoem">â€”</div>
          <div class="capmini" id="heroCopy">â€”</div>
          <div class="share-row" id="shareRow" hidden>
            <a id="shareTw" class="btn tw" href="#" target="_blank" rel="noopener">ã§å…±æœ‰</a>
            <a id="shareLn" class="btn line" href="#" target="_blank" rel="noopener">LINEã§é€ã‚‹</a>
            <a id="shareIg" class="btn ig" href="#" aria-label="Instagramã§ã‚·ã‚§ã‚¢">Instagramã§ã‚·ã‚§ã‚¢</a>
          </div>
        </figcaption>
      </div>

      <!-- æ•°å€¤ãªã© -->
      <div class="grid2">
        <article class="stat" aria-label="ç·åˆã‚¹ã‚³ã‚¢">
          <div><strong>ç·åˆï¼ˆ0â€“4ï¼‰</strong></div>
          <div class="big"><span id="sumAvg">0.00</span> / 4.00 <span class="small" id="sumPct">= 0%</span></div>
          <div class="small" id="sumNote">â€”</div>
        </article>
      </div>

      <div class="hr"></div>
      <!-- å› å­ãƒãƒ¼ -->
      <div class="section">
        <h3 style="margin:8px 0">å› å­åˆ¥ã‚¹ã‚³ã‚¢</h3>
        <div id="bars" class="factor-mini"><!-- JS --></div>
      </div>

      <div class="hr"></div>
      <div id="longCopy" class="small"><!-- JS é•·æ–‡ã‚³ãƒ¡ãƒ³ãƒˆ --></div>

      <div class="hr"></div>
      <!-- ç ”ç©¶ãƒ¡ãƒ¢ï¼ˆè¡Œé ­ã€Œã‚ã‚‹ç ”ç©¶ã§ã¯ã€ã€ã§ç¾…åˆ—ï¼‰ -->
      <details class="section" open>
        <summary><strong>ã‚ã‚‹ç ”ç©¶ã§ã¯â€¦</strong></summary>
        <ul class="small" id="resMemo" style="margin:6px 0 0 18px;line-height:1.8"><!-- JS --></ul>
        <p class="small" style="margin-top:6px">â€»ç›¸é–¢ä¸­å¿ƒã§å› æœã¯æ–­å®šã§ãã¾ã›ã‚“ã€‚å€‹äººå·®ãŒå¤§ãã„æ€§è³ªãŒã‚ã‚Šã¾ã™ã€‚åŒ»ç™‚ãƒ»æ¡ç”¨ãªã©ã®ç”¨é€”ã«ã¯ä½¿ãˆã¾ã›ã‚“ã€‚</p>
      </details>

      <div class="back-area" style="margin-top:12px">
        <a class="back" href="/shindan/" id="backLink" aria-label="è¨ºæ–­ä¸€è¦§ã«æˆ»ã‚‹">è¨ºæ–­ä¸€è¦§ã«æˆ»ã‚‹</a>
      </div>
    </div>
  </section>

  <section class="footer card">
    <h2 style="margin:4px 0 8px">ã”åˆ©ç”¨ã«ã‚ãŸã£ã¦</h2>
    <p class="warn"><strong>æ³¨æ„ï¼š</strong>ã“ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¯<b>ã‚¨ãƒ³ã‚¿ãƒ¡ç”¨ã®è‡ªå·±ç†è§£</b>ã§ã™ã€‚ç¾å®Ÿã®è¢«å®³ãƒ»åŠ å®³ã®åˆ¤æ–­ã‚„åŒ»ç™‚ãƒ»æ¡ç”¨ã«ã¯ä½¿ãˆã¾ã›ã‚“ã€‚å¿…è¦ãªå ´åˆã¯é–¢ä¿‚æ©Ÿé–¢ãƒ»å°‚é–€å®¶ã«ã”ç›¸è«‡ãã ã•ã„ã€‚<br>
ãƒ‡ãƒ¼ã‚¿ã¯ç«¯æœ«å†…ã§å‡¦ç†ã•ã‚Œã€å€‹äººã‚’ç‰¹å®šã™ã‚‹æƒ…å ±ã®é€ä¿¡ãƒ»åé›†ã¯è¡Œã„ã¾ã›ã‚“ï¼ˆã”åˆ©ç”¨ç’°å¢ƒã«ã‚ˆã‚Šã‚¢ã‚¯ã‚»ã‚¹è§£æç­‰ãŒå‹•ä½œã™ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ï¼‰ã€‚</p>
  </section>
</main>

<script>
(function(){
  // ====== ãƒšãƒ¼ã‚¸æƒ…å ± ======
  var SLUG = "stalker-ghost";
  var TITLE = "ã‚¹ãƒˆãƒ¼ã‚«ãƒ¼èƒŒå¾ŒéœŠè¨ºæ–­";
  var IMG_BASE = "/shindan/assets/results/stalker-ghost/"; // æœ«å°¾/
  var ANS_KEY = "specimens:"+SLUG+":answers"; // å›ç­”ä¿å­˜ã‚­ãƒ¼

  // ====== å› å­ãƒ»è¨­å• ======
  var FACTORS = {
    OBS:{ name:"è¦³å¯Ÿãã›ï¼ˆè¦‹ã«è¡ŒããŒã¡ï¼‰", items:["I01","I02","I03"] },
    BDY:{ name:"å¢ƒç•Œç·šã®ã‚„ã‚ã‚‰ã‹ã•",       items:["I04","I05","I06"] },
    WAI:{ name:"è¿”ä¿¡å¾…ã¡è€æ€§",             items:["I07","I08","I09"] },
    BRK:{ name:"æ‹¡å¤§è§£é‡ˆãƒ–ãƒ¬ãƒ¼ã‚­",         items:["I10","I11","I12"] },
    STP:{ name:"è¡å‹•ã‚¹ãƒˆãƒƒãƒ‘ãƒ¼",           items:["I13","I14","I15"] }
  };
  var ITEMS = [
    {id:"I01",text:"SNSã‚„ãƒ¡ãƒƒã‚»ã®è¶³ã‚ã¨ãƒ»æ—¢èª­ã‚’ä¸€æ—¥ã«ä½•åº¦ã‚‚ç¢ºèªã—ã¦ã—ã¾ã†ã€‚"},
    {id:"I02",text:"æ–°ç€ãŒãªã„ã¨ãã€ä»–ã®æ‰‹ãŒã‹ã‚Šï¼ˆåˆ¥SNSã‚„å…±é€šã®å ´ï¼‰ã¾ã§æ¢ã—ã«ã„ãã€‚"},
    {id:"I03",text:"é€šçŸ¥ãŒé³´ã‚‹ãŸã³ã«æ‰‹ãŒæ­¢ã¾ã‚Šã€ã¤ã„ç¢ºèªã—ã¦ã—ã¾ã†ã€‚"},
    {id:"I04",text:"è¦ªã—ããªã‚‹ã¨ã€å ´æ‰€ã‚„æ™‚é–“ã®ç·šå¼•ããŒã¤ã„æ›–æ˜§ã«ãªã‚ŠãŒã¡ã ã€‚"},
    {id:"I05",text:"ç›¸æ‰‹ã®äºˆå®šã‚„å±…å ´æ‰€ã‚’ã€è¨±å¯å‰ã§ã‚‚èããŸããªã‚‹ã“ã¨ãŒã‚ã‚‹ã€‚"},
    {id:"I06",text:"ç›¸æ‰‹ãŒOKã¨è¨€ã†ã¾ã§è¸ã¿è¾¼ã¾ãªã„è‡ªä¿¡ãŒã‚ã‚‹ã€‚", rev:true},
    {id:"I07",text:"è¿”ä¿¡ãŒé…ã„ã¨ãã‚‚ã€Œäº‹æƒ…ãŒã‚ã‚‹ã‹ã‚‚ã€ã¨æ€ã£ã¦å¾…ã¦ã‚‹ã€‚"},
    {id:"I08",text:"æœªèª­ãƒ»æ—¢èª­ã‚¹ãƒ«ãƒ¼ã§ã‚‚ã€ãã®æ—¥ã®è‡ªåˆ†ã®äºˆå®šã«é›†ä¸­ã§ãã‚‹ã€‚"},
    {id:"I09",text:"è¿”ä¿¡ã‚’æ€¥ã‹ã™ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ã£ã¦ã—ã¾ã†ã“ã¨ãŒã‚ã‚‹ã€‚", rev:true},
    {id:"I10",text:"æ›–æ˜§ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ã€ã™ãæ±ºã‚ã¤ã‘ãšã€Œã¾ã åˆ†ã‹ã‚‰ãªã„ã€ã¨ä¿ç•™ã§ãã‚‹ã€‚"},
    {id:"I11",text:"ã„ã„æ–¹ãƒ»æ‚ªã„æ–¹ã®ä¸¡æ–¹ã‚’æƒ³å®šã—ã¦ã€è½ã¡ç€ã„ã¦ã‹ã‚‰è€ƒãˆç›´ã›ã‚‹ã€‚"},
    {id:"I12",text:"ã€ŒãŸã¶ã‚“å«Œã‚ã‚ŒãŸã€ã¨æ—©ã‚ã«çµè«–ã¥ã‘ã¦ã—ã¾ã†ã€‚", rev:true},
    {id:"I13",text:"æ„Ÿæƒ…ãŒå¼·ã„ã»ã©ã€ä¸€æ‹ãŠã„ã¦æ·±å‘¼å¸ã—ã¦ã‹ã‚‰é€ä¿¡ãƒ»è¡Œå‹•ã™ã‚‹ã€‚"},
    {id:"I14",text:"è¿½ã„ã‹ã‘ãŸããªã£ãŸã‚‰ã€æ•£æ­©ã‚„ä½œæ¥­ãªã©åˆ¥è¡Œå‹•ã«åˆ‡ã‚Šæ›¿ãˆã‚‰ã‚Œã‚‹ã€‚"},
    {id:"I15",text:"æ·±å¤œã®é€£çµ¡ã‚„é€£æŠ•ã‚’ã‚„ã£ã¦ã—ã¾ã†ã€‚", rev:true}
  ];
  var LABELS = ["ã„ã„ãˆ","ã‚ã¾ã‚Šãªã„","ã¨ãã©ã","ã‚ˆãã‚ã‚‹","ã¨ã¦ã‚‚ã‚ã‚‹"];
  var REVERSED = new Set(["I06","I09","I12","I15"]);
  var HYBRID_DELTA = 8;

  // ====== ã‚¿ã‚¤ãƒ—å®šç¾©ï¼ˆã‚¿ã‚¤ãƒˆãƒ«ãƒ»ã‚³ãƒ”ãƒ¼ãƒ»1è¡Œã‚±ã‚¢ãƒ»ç ”ç©¶ãƒ¡ãƒ¢ï¼‰ ======
  var TYPES = {
    OBS:{ key:"OBS", title:"ã¾ãªã–ã—ãƒ”ã‚¿éœŠ", img:"t01.webp", alt:"è¶³ã‚ã¨ã¨ãƒ¬ãƒ¼ãƒ€ãƒ¼ã®ç´‹ç« ",
      poem:"å°ã•ãªå¤‰åŒ–ã‚’è¦‹é€ƒã•ãªã„ã€é‹­ã„ã¾ãªã–ã—ã€‚",
      copy:"è¦³å¯Ÿã®ã‚¢ãƒ³ãƒ†ãƒŠãŒé‹­ã„ã‚¿ã‚¤ãƒ—ã€‚å°ã•ãªå¤‰åŒ–ã«æ°—ã¥ã‘ã‚‹åˆ†ã€ç¢ºèªã®å›æ•°ãŒå¢—ãˆã‚„ã™ã„å‚¾å‘ã‚‚ã€‚ä½¿ã„ã©ã“ã‚ã‚’é¸ã¹ã°é ¼ã‚Œã‚‹â€œè¦‹å®ˆã‚ŠåŠ›â€ã§ã™ã€‚ãƒ’ãƒ³ãƒˆï¼šé€šçŸ¥ã‚’â€œã¾ã¨ã‚ã¦è¦‹ã‚‹æ™‚é–“â€ã‚’æ±ºã‚ã‚‹ã ã‘ã§ã€å¿ƒã®ä½™ç™½ãŒæˆ»ã‚Šã¾ã™ã€‚",
      long:"ã‚ãªãŸã®å¼·ã¿ã¯ã€Œæ°—ã¥ãã®é€Ÿã•ã€ã€‚ç›¸æ‰‹ã®èª¿å­ã‚„çŠ¶æ³ã‚’å¯Ÿã—ã‚„ã™ãã€æ°—é…ã‚Šã«åŒ–ã‘ã‚‹è³‡è³ªã§ã™ã€‚ä¸€æ–¹ã§ç¢ºèªãŒç¶šãã¨ã€æ³¨æ„ãŒåˆ†æ•£ã—ã¦ç–²ã‚Œã‚„ã™ã„é¢ã‚‚ã€‚ã¾ãšã¯â€œé³´ã£ãŸã‚‰è¦‹ã‚‹â€ã‚’â€œæ™‚é–“ã‚’æ±ºã‚ã¦è¦‹ã‚‹â€ã«ç½®ãæ›ãˆã€é€£ç¶šã‚¿ãƒƒãƒ—ã‚’ãƒ–ãƒ­ãƒƒã‚¯ã€‚æ›–æ˜§ãªã‚µã‚¤ãƒ³ã¯ä¸€æ—¦ãƒ¡ãƒ¢ã«åœã‚ã€ç¿Œæ—¥ã‚‚ã†ä¸€åº¦ã ã‘è¦‹è¿”ã™â€”â€”ã“ã®äºŒæ®µéšã ã‘ã§ã€è¡Œå‹•ã®ã‚­ãƒ¬ã¨å®‰å¿ƒæ„ŸãŒä¸¡ç«‹ã—ã¾ã™ã€‚",
      memo:[
        "é€šçŸ¥ã‚„æ–­ç‰‡æƒ…å ±ã¯ä¸å®‰ã¨åã™ã†ã‚’å¢—ã‚„ã™ç¤ºå”†ã€‚",
        "ãƒãƒƒãƒå‡¦ç†ï¼ˆã¾ã¨ã‚ç¢ºèªï¼‰ãŒä¸»è¦³çš„ã‚¹ãƒˆãƒ¬ã‚¹ã‚’ä¸‹ã’ã‚‹é–¢é€£ã€‚",
        "å¤–çš„æ‰‹ãŒã‹ã‚Šã®åˆ¶é™ãŒè¡å‹•è¡Œå‹•ã®é »åº¦ã‚’ä¸‹ã’ã‚‹å¯èƒ½æ€§ã€‚",
        "ãƒ¡ãƒ¢åŒ–â†’å†è©•ä¾¡ãŒè§£é‡ˆã®é£›èºã‚’æŠ‘ãˆã‚‹ç¤ºå”†ã€‚"
      ]
    },
    BDY:{ key:"BDY", title:"å¢ƒç•Œãµã‚ã‚ŠéœŠ", img:"t02.webp", alt:"ç‚¹ç·šã‚µãƒ¼ã‚¯ãƒ«ã¨å°ã•ãªéµã®ç´‹ç« ",
      poem:"è¿‘ã•ã‚’å¤§åˆ‡ã«ã™ã‚‹ã€ã‚„ã‚ã‚‰ã‹ãªè¼ªéƒ­ã€‚",
      copy:"è¿‘ã•ã‚’å¤§åˆ‡ã«ã™ã‚‹ãƒãƒ¼ãƒˆã®æŒã¡ä¸»ã€‚æ¸©ã‹ã•ã®è£ã§ã€åˆå›³ã®ç¢ºèªãŒå¾Œå›ã—ã«ãªã‚Šã‚„ã™ã„ã‹ã‚‰ã€åˆæ„ã®ä¸€è¨€ã‚’å…ˆã«æ·»ãˆã‚‹ã ã‘ã§å®‰å¿ƒåº¦UPã€‚ãƒ’ãƒ³ãƒˆï¼šã€Œä»Šã“ã®è©±ã—ã¦ã‚‚å¤§ä¸ˆå¤«ï¼Ÿã€ã®å®šå‹æ–‡ã‚’ãŠæ°—ã«å…¥ã‚Šç™»éŒ²ã€‚",
      long:"ã‚ãªãŸã®â€œè·é›¢ã®è¿‘ã•â€ã¯ã€å®‰å¿ƒæ„Ÿã‚’è‚²ã‚€ç´ æ•µãªè³‡è³ªã€‚ãŸã ã€è¸ã¿è¾¼ã¿ã®æ—©ã•ãŒç›¸æ‰‹ã®éƒ½åˆã¨ã‚ºãƒ¬ã‚‹ã¨èª¤è§£ã‚„ç–²ã‚Œã«ã¤ãªãŒã‚‹ã“ã¨ã‚‚ã€‚åŠ¹æœçš„ãªã®ã¯åˆå›³ã®å…ˆå‡ºã—â€”â€”ã€Œä»Šã¡ã‚‡ã£ã¨ã„ã„ï¼Ÿã€ã‚’æœ€åˆã«ç½®ãã ã‘ã§è¨±å¯ãƒ»ä¸è¨±å¯ãŒè¦‹ãˆã€é–¢ä¿‚ã®è»½ã•ãŒå¤‰ã‚ã‚Šã¾ã™ã€‚æ™‚é–“å¸¯ãƒ»é »åº¦ã®ç›®å®‰ã‚’å…±é€šè¨€èªã«ã™ã‚‹ã®ã‚‚â—ã€‚å°ã•ãªåˆæ„ãŒç©ã¿é‡ãªã‚‹ã¨ã€è¿‘ã•ã¯â€œã‚„ã•ã—ã•â€ã¨ã—ã¦å—ã‘å–ã‚‰ã‚Œã¾ã™ã€‚",
      memo:[
        "æœŸå¾…å€¤åˆã‚ã›ï¼ˆåˆæ„ï¼‰ãŒæ‘©æ“¦ã‚’æ¸›ã‚‰ã™ç¤ºå”†ã€‚",
        "æ™‚é–“å¸¯ãƒ«ãƒ¼ãƒ«ã®å…±æœ‰ãŒæº€è¶³åº¦ã«é–¢é€£ã€‚",
        "Iãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆç§ã¯ï¼‰ãŒåç™ºã‚’ä¸‹ã’å”åŠ›ã‚’ä¿ƒã™å¯èƒ½æ€§ã€‚",
        "ç¤¾ä¼šçš„åˆå›³ã®æ˜ç¢ºåŒ–ãŒå®‰å¿ƒæ„Ÿã®åœŸå°ã«é–¢é€£ã€‚"
      ]
    },
    WAI:{ key:"WAI", title:"å¾…æ©Ÿä»™äººéœŠ", img:"t03.webp", alt:"ç ‚æ™‚è¨ˆã¨é›²ã®ç´‹ç« ",
      poem:"å¾…ã¦ã‚‹é™ã‘ã•ã€æˆ»ã‚Œã‚‹åˆ‡æ›¿ã€‚",
      copy:"â€œå¾…ã¤åŠ›â€ãŒè½ã¡ç€ãã‚’ç”Ÿã‚€ã‚¿ã‚¤ãƒ—ã€‚æœªèª­ã§ã‚‚è‡ªåˆ†ã®äºˆå®šã«æˆ»ã‚Œã‚‹åˆ‡æ›¿ä¸Šæ‰‹ã€‚ãŸã¾ã«â€œå¿˜ã‚Œã™ãâ€ã ã‘æ³¨æ„ã—ã¦ã€è¦ä»¶ã¯çŸ­ãæ˜ã‚‹ãã€‚ãƒ’ãƒ³ãƒˆï¼šè¿”ä¿¡ãŒæ¥ãŸã‚‰ã€ŒåŠ©ã‹ã£ãŸï¼ã€ã®ä¸€è¨€ã§å¥½å¾ªç’°ã€‚",
      long:"ã‚ãªãŸã®å¾…æ©Ÿè€æ€§ã¯å¤§ããªå¼·ã¿ã€‚ç›¸æ‰‹ã®äº‹æƒ…ã‚’æƒ³åƒã§ãã€é–¢ä¿‚ã®åœ§ã‚’ä¸‹ã’ã¾ã™ã€‚èª²é¡Œã¯ã€å¿…è¦ãªã¨ãã«â€œå¾…ã¡ã£ã±ãªã—â€ã«ãªã‚‰ãªã„ã“ã¨ã€‚è¦ä»¶ã¯çµè«–â†’æœŸé™â†’ä¸€è¨€ã®é †ã§çŸ­ãé€ã‚‹ã¨ã€ç›¸æ‰‹ã‚‚å¿œç­”ã—ã‚„ã™ãã€ã‚ãªãŸã®è½ã¡ç€ããŒã•ã‚‰ã«æ´»ãã¾ã™ã€‚æœªèª­æ™‚ã¯â€œè‡ªåˆ†ã®äºˆå®šã¸å¾©å¸°â€ã‚’åˆå›³ã«ã€ã‚¿ã‚¹ã‚¯ã‚’ä¸€åŒºåˆ‡ã‚Šé€²ã‚ã‚‹ã¨æº€è¶³æ„ŸãŒå¢—ã—ã¾ã™ã€‚",
      memo:[
        "æ›–æ˜§ãªé…å»¶ã¯ä¸å®‰ã‚’é«˜ã‚ã†ã‚‹ãŒã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«åŒ–ã§ç·©å’Œã®ç¤ºå”†ã€‚",
        "å®Ÿè¡Œæ„å›³ï¼ˆif-thenï¼‰ãŒåˆ‡æ›¿æˆåŠŸç‡ã‚’ä¸Šã’ã‚‹é–¢é€£ã€‚",
        "çŸ­æ–‡ãƒ»å…·ä½“ã®ä¾é ¼ãŒè¿”ä¿¡ç‡ã‚’é«˜ã‚ã‚‹å¯èƒ½æ€§ã€‚",
        "è‡ªå¾‹çš„æ³¨æ„è»¢æ›ãŒåã™ã†æ¸›å°‘ã«é–¢é€£ã€‚"
      ]
    },
    BRK:{ key:"BRK", title:"ä¿ç•™ãƒŠãƒ“éœŠ", img:"t04.webp", alt:"ãƒãƒ–ãƒ«ã¨æ——ã®ç´‹ç« ",
      poem:"æ‹™é€Ÿã‚’é¿ã‘ã‚‹ã€ã‚„ã•ã—ã„ä¿ç•™ã€‚",
      copy:"â€œã¾ã åˆ†ã‹ã‚‰ãªã„â€ã‚’å¤§äº‹ã«ã§ãã‚‹ç†æ€§çš„ã‚¿ã‚¤ãƒ—ã€‚æ±ºã‚ã¤ã‘ãªã„å§¿å‹¢ãŒå®‰å¿ƒã‚’ç”Ÿã¿ã¾ã™ã€‚ãŸã¾ã«å„ªæŸ”ä¸æ–­ã«ãªã£ãŸã‚‰ã€æœŸé™ã‚’åˆ‡ã£ã¦å†åˆ¤æ–­ã€‚ãƒ’ãƒ³ãƒˆï¼šä¿ç•™ãƒ¡ãƒ¢ã«æ—¥ä»˜ã‚’ä»˜ã‘ã¦â€œã„ã¤å†ç¢ºèªã™ã‚‹ã‹â€ã‚’æ˜ç¢ºã«ã€‚",
      long:"ã‚ãªãŸã¯ä¸ç¢ºå®Ÿã•ã«è€ãˆã‚‹åŠ›ãŒé«˜ãã€æ—©åˆç‚¹ã‹ã‚‰è·é›¢ã‚’å–ã‚Œã¾ã™ã€‚äººé–“é–¢ä¿‚ã§ã¯èª¤è§£ã®ç«ç¨®ã‚’å°ã•ãã§ãã‚‹å¸Œå°‘ãªè³‡è³ªã€‚ãŸã ã€åˆ¤æ–­ã‚’å»¶ã°ã—ã™ãã‚‹ã¨ç›¸æ‰‹ãŒè¿·ã†ã“ã¨ã‚‚ã€‚ä¿ç•™â†’å†åˆ¤æ–­ã®æœŸæ—¥ã‚’å…ˆã«æ±ºã‚ã‚‹ã ã‘ã§ã€ç†æ€§ã¨ã‚¹ãƒ”ãƒ¼ãƒ‰ã®ä¸¡ç«‹ãŒå¯èƒ½ã«ã€‚ç›¸æ‰‹ã®â€œè‰¯ã„è§£é‡ˆâ€ã‚‚ä¸€åº¦ç½®ã„ã¦ãŠããƒãƒ©ãƒ³ã‚¹æ„Ÿè¦šãŒã€é•·æœŸçš„ãªä¿¡é ¼ã‚’ã¤ãã‚Šã¾ã™ã€‚",
      memo:[
        "æ›–æ˜§ã•è€æ€§ãŒåå¿œã®éå‰°åŒ–ã‚’æŠ‘ãˆã‚‹ç¤ºå”†ã€‚",
        "å†è©•ä¾¡ï¼ˆreappraisalï¼‰ãŒæƒ…å‹•èª¿æ•´ã«é–¢é€£ã€‚",
        "æœŸæ—¥ã®è¨­å®šãŒæ„æ€æ±ºå®šã®è³ªã‚’å®‰å®šã•ã›ã‚‹å¯èƒ½æ€§ã€‚",
        "ãƒ¡ã‚¿èªçŸ¥ãƒ¡ãƒ¢ãŒè§£é‡ˆã®åã‚Šã‚’æ¸›ã‚‰ã™ç¤ºå”†ã€‚"
      ]
    },
    STP:{ key:"STP", title:"ä¸€æ‹è³¢è€…éœŠ", img:"t05.webp", alt:"ãƒãƒ¼ã‚ºï¼ˆIIï¼‰ã¨ãƒ©ãƒ³ã‚¿ãƒ³ã®ç´‹ç« ",
      poem:"æ„Ÿæƒ…ã®æ³¢ã«ã€ç¯ã‚’ã¨ã‚‚ã™é–“åˆã„ã€‚",
      copy:"æ„Ÿæƒ…ãŒå¼·ã„æ™‚ã»ã©ä¸€æ‹ãŠã‘ã‚‹â€œåŠ¹ããƒ–ãƒ¬ãƒ¼ã‚­â€ã®æŒã¡ä¸»ã€‚é€ä¿¡å‰ã®æ·±å‘¼å¸ã‚„ä¸‹æ›¸ãä¿å­˜ãŒã€ã‚ãªãŸã®é­…åŠ›ã‚’ã‚‚ã£ã¨ä¼ã‚ã‚Šã‚„ã™ãã—ã¾ã™ã€‚ãƒ’ãƒ³ãƒˆï¼šæ·±å¤œã¯â€œä¸‹æ›¸ãã¾ã§â€ã®ãƒ«ãƒ¼ãƒ«ã§ç¿Œæœã«è¦‹ç›´ã—ã€‚",
      long:"ã‚ãªãŸã¯è¡Œå‹•ã®â€œé–“â€ã‚’ä½œã‚Œã‚‹äººã€‚ã“ã‚Œã¯è¡å‹•ã‹ã‚‰é–¢ä¿‚ã‚’å®ˆã‚‹æœ€é«˜ã®ã‚¹ã‚­ãƒ«ã§ã™ã€‚ã¨ãã«å¤œé–“ã‚„é€£æŠ•ã®å ´é¢ã§ã¯ã€ä¸‹æ›¸ãâ†’ç¿Œæœãƒã‚§ãƒƒã‚¯â†’é€ä¿¡ã®ä¸‰æ®µéšãŒåŠ¹æœçš„ã€‚æ€’ã‚Šãƒ»ä¸å®‰ã®ãƒ”ãƒ¼ã‚¯ã¯æ™‚é–“ã§å¿…ãšä¸‹ãŒã‚‹ã®ã§ã€æ„Ÿæƒ…ã®æ³¢ã¨è³¢ãä»˜ãåˆãˆã¾ã™ã€‚å°ã•ãªæˆåŠŸä½“é¨“ãŒç©ã¿é‡ãªã‚‹ã¨ã€è‡ªå·±åŠ¹åŠ›æ„ŸãŒä¸ŠãŒã‚Šã€ç›¸æ‰‹ã«ã‚‚å®‰å¿ƒãŒä¼ã‚ã‚Šã¾ã™ã€‚",
      memo:[
        "åå¿œæŠ‘åˆ¶ã®ç·´ç¿’ãŒè¡å‹•è¡Œå‹•ã‚’æ¸›ã‚‰ã™ç¤ºå”†ã€‚",
        "ç¡çœ å‰ã®èˆˆå¥®åˆºæ¿€ãŒæ€è€ƒã®éç†±ã‚’æ‹›ãã‚„ã™ã„é–¢é€£ã€‚",
        "æ™‚é–“è·é›¢ï¼ˆç¿Œæœï¼‰ãŒæ€’ã‚Šã®å¼·åº¦ã‚’è‡ªç„¶ä½ä¸‹ã•ã›ã‚‹å¯èƒ½æ€§ã€‚",
        "ä¸‹æ›¸ãæ–‡åŒ–ãŒèª¤é€ä¿¡ãƒ»å¾Œæ‚”ã®ä½æ¸›ã«æœ‰åŠ¹ã€‚"
      ]
    }
  };

  // ====== è¦ç´ å‚ç…§ ======
  var qWrap   = document.getElementById("qWrap");
  var prog    = document.getElementById("prog");
  var resEmpty= document.getElementById("resEmpty");
  var resArea = document.getElementById("resArea");
  var typeLine= document.getElementById("typeLine");
  var heroImg = document.getElementById("heroImg");
  var heroTitle= document.getElementById("heroTitle");
  var heroPoem = document.getElementById("heroPoem");
  var heroCopy = document.getElementById("heroCopy");
  var sizeBadgeEl= document.getElementById("sizeBadge");
  var sumAvg  = document.getElementById("sumAvg");
  var sumPct  = document.getElementById("sumPct");
  var sumNote = document.getElementById("sumNote");
  var bars    = document.getElementById("bars");
  var longCopy= document.getElementById("longCopy");
  var resMemo = document.getElementById("resMemo");
  var shareRow= document.getElementById("shareRow");
  var shareTw = document.getElementById("shareTw");
  var shareLn = document.getElementById("shareLn");
  var shareIg = document.getElementById("shareIg");

  // ====== è¨­å•ç”Ÿæˆ ======
  function buildQuestions(){
    var html = "";
    for(var i=0;i<ITEMS.length;i++){
      var q = ITEMS[i];
      html += '<fieldset class="q" id="fs-'+q.id+'">'+
        '<legend>'+q.text+'</legend>'+
        '<div class="scale" role="radiogroup" aria-label="'+q.text+'">';
      for(var v=0;v<=4;v++){
        html += '<div style="position:relative">'+
          '<input id="q'+q.id+'-'+v+'" type="radio" name="q'+q.id+'" value="'+v+'">'+
          '<label for="q'+q.id+'-'+v+'" title="'+LABELS[v]+'">'+LABELS[v]+'</label>'+
        '</div>';
      }
      html += '</div></fieldset>';
    }
    qWrap.innerHTML = html;

    var radios = qWrap.querySelectorAll('input[type="radio"]');
    for(var r=0;r<radios.length;r++){
      radios[r].addEventListener('change', function(){
        saveAnswers(); updateProgress();
      }, false);
    }
    restoreAnswers(); updateProgress();
  }

  // ====== ä¿å­˜/å¾©å…ƒ ======
  function saveAnswers(){
    try{
      var out = {};
      for(var i=0;i<ITEMS.length;i++){
        var id = ITEMS[i].id;
        var chk = qWrap.querySelector('#fs-'+id+' input[type="radio"]:checked');
        if(chk){ out[id] = parseInt(chk.value,10); }
      }
      localStorage.setItem(ANS_KEY, JSON.stringify({ts:Date.now(), ans:out}));
    }catch(e){}
  }
  function restoreAnswers(){
    try{
      var raw = localStorage.getItem(ANS_KEY);
      if(!raw) return;
      var data = JSON.parse(raw);
      var ans = (data && data.ans) || {};
      Object.keys(ans).forEach(function(id){
        var v = ans[id];
        var input = qWrap.querySelector('#q'+id+'-'+v);
        if(input){ input.checked = true; }
      });
    }catch(e){}
  }
  function wipeAnswers(){
    try{ localStorage.removeItem(ANS_KEY); }catch(e){}
  }

  function updateProgress(){
  var total = ITEMS.length;
  var answered = 0;
  for(var i=0;i<ITEMS.length;i++){
    if(qWrap.querySelector('input[name="q'+ITEMS[i].id+'"]:checked')) answered++;
  }
  var pct = Math.round(100*answered/total);
  prog.style.width = pct + "%";
  // ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ç”¨ï¼ˆæ•°å€¤ã‚‚æ›´æ–°ï¼‰
  var bar = prog.parentElement;
  if(bar){
    bar.setAttribute("aria-valuenow", answered);
    bar.setAttribute("aria-label", "å›ç­”é€²æ—ï¼š"+answered+" / "+total);
  }
}

  // ====== ã‚¹ã‚³ã‚¢è¨ˆç®— ======
  function valOf(id, raw){ var v=Number(raw); return REVERSED.has(id)?(4-v):v; }
  function score(){
    var missing = [];
    var ans = {};
    for(var i=0;i<ITEMS.length;i++){
      var id = ITEMS[i].id;
      var chk = qWrap.querySelector('#fs-'+id+' input[type="radio"]:checked');
      if(!chk){ missing.push(id); continue; }
      ans[id] = parseInt(chk.value,10);
    }
    if(missing.length){
      alert("æœªå›ç­”ãŒã‚ã‚Šã¾ã™ã€‚å…¨15å•ã«ãŠç­”ãˆãã ã•ã„ã€‚");
      var fs = document.getElementById('fs-'+missing[0]);
      if(fs){ fs.scrollIntoView({behavior:"smooth", block:"center"}); fs.classList.add("need"); setTimeout(function(){ fs.classList.remove("need"); },1600); }
      return;
    }

    var fScore = {}, fPct = {};
    Object.keys(FACTORS).forEach(function(key){
      var ids = FACTORS[key].items;
      var sum = ids.reduce(function(s,id){ return s + valOf(id, ans[id]); },0);
      var avg = sum / ids.length; // 0-4
      fScore[key] = avg;
      fPct[key] = Math.round((avg/4)*100);
    });

    var keys = Object.keys(FACTORS);
    var totalAvg = keys.reduce(function(s,k){ return s + fScore[k]; },0) / keys.length;
    var totalPct = Math.round((totalAvg/4)*100);

    var order = keys.slice().sort(function(a,b){ return fPct[b]-fPct[a]; });
    var top = order[0], second = order[1];
    var diff = fPct[top]-fPct[second];
    var hybrid = (diff<=HYBRID_DELTA);

    render({ fScore, fPct, totalAvg, totalPct, top, second, diff, hybrid });
  }

  function render(o){
    var primary = TYPES[o.top], secondary = TYPES[o.second];

    // ã‚¿ã‚¤ãƒˆãƒ«è¡Œ
    var typeText = 'ã‚¿ã‚¤ãƒ—ï¼š'+primary.title+'ï¼ˆ'+FACTORS[o.top].name+'ï¼‰';
    if(o.hybrid){ typeText += ' ï¼ ç¬¬2ä½ï¼š'+secondary.title+'ï¼ˆ'+FACTORS[o.second].name+'ï¼‰'; }
    typeLine.textContent = typeText;

    // ãƒ’ãƒ¼ãƒ­ãƒ¼
    heroImg.src = IMG_BASE + primary.img;
    heroImg.alt = primary.alt;
    heroTitle.textContent = primary.title + (o.hybrid ? ' Ã— '+secondary.title : '');
    heroPoem.textContent  = 'â€œè¦‹å®ˆã‚ŠãŒè¿‘ã™ãã‚‹ã‚¯ã‚»â€ã®ç‚¹æ¤œè¦–ç‚¹ã§è¡¨ç¤ºã—ã¦ã„ã¾ã™ã€‚';
    heroCopy.textContent  = primary.copy;
    sizeBadgeEl.textContent = "ç·åˆ " + o.totalAvg.toFixed(2) + " / 4.00";

    // ç·åˆ
    sumAvg.textContent = o.totalAvg.toFixed(2);
    sumPct.textContent = "= " + o.totalPct + "%";
    sumNote.textContent = "ä¸Šä½å› å­ï¼š"+FACTORS[o.top].name + (o.hybrid ? "ï¼ˆç¬¬2ä½ï¼š"+FACTORS[o.second].name+"ãƒ»å·®"+o.diff+"%ï¼‰" : "");

    // å› å­ãƒãƒ¼
    var bHtml = "";
    Object.keys(FACTORS).forEach(function(key){
      var def = FACTORS[key];
      var avg = o.fScore[key], pct = o.fPct[key];
      bHtml += '<article class="bar" aria-label="'+def.name+'">'+
        '<div><strong>'+def.name+'</strong><span class="pill" style="margin-left:6px">'+avg.toFixed(2)+' / 4</span>'+
        '<span class="pill" style="margin-left:6px">'+pct+'%</span></div>'+
        '<div class="row" aria-hidden="true"><span style="width:'+pct+'%"></span></div>'+
      '</article>';
    });
    bars.innerHTML = bHtml;

    // é•·æ–‡ & ç ”ç©¶ãƒ¡ãƒ¢
    longCopy.textContent = primary.long;
    resMemo.innerHTML = (primary.memo||[]).map(function(s){ return "<li>"+s+"</li>"; }).join("");

    // å…±æœ‰ãƒªãƒ³ã‚¯ç”Ÿæˆ
    var shareText = 'ã€ã‚¹ãƒˆãƒ¼ã‚«ãƒ¼èƒŒå¾ŒéœŠè¨ºæ–­ã€çµæœï¼š' + primary.title + (o.hybrid ? ' Ã— ' + secondary.title : '') +
                    'ï½œç·åˆ ' + o.totalAvg.toFixed(2) + ' / 4ï¼ˆ' + o.totalPct + '%ï¼‰';
    var url = location.href.split('#')[0];

    var tw = 'https://twitter.com/intent/tweet?text=' + encodeURIComponent(shareText) + '&url=' + encodeURIComponent(url);
    shareTw.href = tw;

    var ln = 'https://line.me/R/msg/text/?' + encodeURIComponent(shareText + ' ' + url);
    shareLn.href = ln;

    shareIg.onclick = function(e){
      e.preventDefault();
      var caption = shareText + ' ' + url;
      copyToClipboard(caption).then(function(){
        var opened = false;
        try{ var w = window.open('instagram://app','_blank'); opened = !!w; }catch(_){}
        if(!opened){ window.open('https://www.instagram.com/','_blank'); }
        toast('ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸã€‚Instagramã§è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ã€‚');
      });
    };
    shareRow.hidden = false;

    // è¡¨ç¤º
    resEmpty.style.display = "none";
    resArea.style.display  = "block";
    document.getElementById("result").scrollIntoView({behavior:"smooth", block:"start"});

    try{
      document.dispatchEvent(new Event('result:ready'));
      localStorage.setItem("specimens:last", JSON.stringify({ id: SLUG, title: TITLE, href: location.pathname }));
    }catch(e){}
  }

  // å…±æœ‰ãƒ˜ãƒ«ãƒ‘ãƒ¼
  function copyToClipboard(text){
    if(navigator.clipboard && navigator.clipboard.writeText){
      return navigator.clipboard.writeText(text);
    }
    return new Promise(function(res){
      var ta=document.createElement('textarea'); ta.value=text;
      document.body.appendChild(ta); ta.select();
      try{ document.execCommand('copy'); }catch(_){}
      document.body.removeChild(ta); res();
    });
  }
  function toast(msg){
    var t=document.createElement('div');
    t.textContent=msg;
    t.style.position='fixed'; t.style.left='50%'; t.style.bottom='20px';
    t.style.transform='translateX(-50%)'; t.style.background='rgba(31,39,50,.92)';
    t.style.color='#fff'; t.style.padding='8px 12px'; t.style.borderRadius='10px';
    t.style.zIndex=9999; t.style.fontSize='13px';
    document.body.appendChild(t);
    setTimeout(function(){ t.remove(); },1500);
  }

  // ã‚¯ãƒªã‚¢
  function clearAnswers(){
    var radios = qWrap.querySelectorAll('input[type="radio"]');
    for(var i=0;i<radios.length;i++){ radios[i].checked=false; }
    wipeAnswers();
    prog.style.width = "0%";
    resEmpty.style.display = "";
    resArea.style.display = "none";
    var app = document.getElementById("app");
    if(app){ app.scrollIntoView({behavior:"smooth", block:"start"}); }
  }

  // åˆæœŸåŒ–
  if(document.readyState === "loading"){
    document.addEventListener("DOMContentLoaded", function(){ buildQuestions(); });
  }else{
    buildQuestions();
  }
  document.getElementById("doScore").addEventListener("click", score, false);
  document.getElementById("doScore2").addEventListener("click", score, false);
  document.getElementById("clearAns").addEventListener("click", clearAnswers, false);
  var back = document.getElementById("backLink");
  if(back){
    back.addEventListener("click", function(){
      try{
        document.dispatchEvent(new Event('result:ready'));
      localStorage.setItem("specimens:last", JSON.stringify({ id: SLUG, title: TITLE, href: location.pathname }));
      }catch(e){}
    }, false);
  }
})();
</script>
<script>
/* ============================================================
   è¨ºæ–­ãƒšãƒ¼ã‚¸å…±é€šã‚¹ãƒ‹ãƒšãƒƒãƒˆï¼ˆã“ã“ã‚Lv/æ¸ˆã‚«ã‚¦ãƒ³ãƒˆï¼‹å›ç­”ä¿å­˜ã®æ±ç”¨ï¼‰
   1) å›ç­”ã®è‡ªå‹•ä¿å­˜ãƒ»è‡ªå‹•å¾©å…ƒï¼ˆå…¥åŠ›ä¸­ã‚‚é€æ¬¡ä¿å­˜ï¼‰
   2) çµæœè¡¨ç¤ºã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ã€Œæ¸ˆã€ï¼‹ ã‚ãªãŸã®Lv +1
   3) ã¿ã‚“ãªã®ã“ã“ã‚Lvï¼ˆCountAPIï¼‰ã« +1ï¼ˆå¤±æ•—ã¯ç„¡è¦–ï¼‰
============================================================ */
(function(){
  'use strict';
  var DONE_KEY   = 'specimens:open:byid';
  var TOTAL_KEY  = 'specimens:open:total';
  var GLOBAL_LAST= 'specimens:open:global:last';
  var MY_ID = (document.body && document.body.getAttribute('data-id')) || 'unknown';

  // ã¿ã‚“ãªã®Lvï¼ˆCountAPIï¼‰
  var COUNTAPI_NS  = 'haisuikounozarigani_shindan';
  var COUNTAPI_KEY = 'specimens_open_total';
  function countapiHit(){
    var url = 'https://api.countapi.xyz/hit/'+COUNTAPI_NS+'/'+COUNTAPI_KEY;
    if(navigator.sendBeacon){ try{ navigator.sendBeacon(url); }catch(_){ } }
    else{ fetch(url, {mode:'cors', cache:'no-store', keepalive:true}).catch(function(){}); }
  }

  // ã“ã®è¨ºæ–­ã ã‘ã®å›ç­”ç®±ï¼ˆnameå±æ€§ã«è‡ªå‹•å¯¾å¿œï¼‰
  var ANSWER_KEY = 'specimens:answers:' + MY_ID;
  function loadState(){ try{ return JSON.parse(localStorage.getItem(ANSWER_KEY) || '{}'); }catch(_){ return {}; } }
  function saveState(o){ try{ localStorage.setItem(ANSWER_KEY, JSON.stringify(o)); }catch(_){ } }
  function saveField(el){
    if(!el || !el.name) return;
    var st = loadState(), nm = el.name;
    if(el.type==='radio'){
      var c=(el.form||document).querySelector('input[type="radio"][name="'+nm+'"]:checked');
      st[nm]=c?{t:'r',v:c.value}:{t:'r',v:null};
    }else if(el.type==='checkbox'){
      var arr=[]; (el.form||document).querySelectorAll('input[type="checkbox"][name="'+nm+'"]').forEach(function(x){ if(x.checked) arr.push(x.value||'on'); });
      st[nm]={t:'c',v:arr};
    }else if(el.tagName==='SELECT'){
      if(el.multiple){ var mv=[]; [].slice.call(el.options).forEach(function(o){ if(o.selected) mv.push(o.value); }); st[nm]={t:'m',v:mv}; }
      else{ st[nm]={t:'s',v:el.value}; }
    }else{
      st[nm]={t:'t',v:el.value};
    }
    saveState(st);
  }
  function restoreOnce(){
    var st=loadState(), names=Object.keys(st); if(!names.length) return false;
    names.forEach(function(nm){
      var info=st[nm]; if(!info) return;
      if(info.t==='r'){
        var r=document.querySelector('input[type="radio"][name="'+nm+'"][value="'+CSS.escape(String(info.v))+'"]');
        if(r){ r.checked=true; r.dispatchEvent(new Event('change',{bubbles:true})); }
      }else if(info.t==='c'){
        var set=new Set(info.v||[]); document.querySelectorAll('input[type="checkbox"][name="'+nm+'"]').forEach(function(c){ c.checked=set.has(c.value||'on'); });
      }else if(info.t==='m'){
        var sel=document.querySelector('select[name="'+nm+'"]'); if(sel){ var setm=new Set(info.v||[]); [].slice.call(sel.options).forEach(function(o){ o.selected=setm.has(o.value); } }
      }else if(info.t==='s'){
        var s=document.querySelector('select[name="'+nm+'"]'); if(s){ s.value=info.v; }
      }else{
        var t=document.querySelector('[name="'+nm+'"]'); if(t){ t.value=info.v==null?'':String(info.v); }
      }
    });
    try{ document.dispatchEvent(new Event('change',{bubbles:true})); }catch(_){}
    return true;
  }
  document.addEventListener('change', function(e){ var el=e.target; if(el && el.matches && el.matches('input[name], select[name], textarea[name]')) saveField(el); }, true);
  document.addEventListener('input',  function(e){ var el=e.target; if(el && el.matches && el.matches('input[type="text"][name], input:not([type])[name], textarea[name]')) saveField(el); }, true);
  (function(){ var TRY=12,i=0; function tick(){ i++; if(document.querySelector('input[name],select[name],textarea[name]')){ restoreOnce(); return; } if(i<TRY) setTimeout(tick,300); } if(/complete|interactive/.test(document.readyState)) tick(); else document.addEventListener('DOMContentLoaded', tick); })();

  // çµæœæç”»ã®åˆå›³ã§ä¸€åº¦ã ã‘åŠ ç®—
  var marked=false;
  function markOnce(){
    if(marked) return; marked=true;
    try{
      localStorage.setItem(TOTAL_KEY, String((+localStorage.getItem(TOTAL_KEY)||0)+1));
      var map={}; try{ map=JSON.parse(localStorage.getItem(DONE_KEY)||'{}'); }catch(_){}
      map[MY_ID]=(map[MY_ID]||0)+1;
      localStorage.setItem(DONE_KEY, JSON.stringify(Object.assign({},map,{_ts:Date.now()})));
      countapiHit();
      try{ localStorage.setItem(GLOBAL_LAST, String((+localStorage.getItem(GLOBAL_LAST)||0)+1)); }catch(_){}
    }catch(_){}
  }
  document.addEventListener('result:ready', markOnce);
  setTimeout(markOnce, 2000); // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
})();
</script>
</body>
</html>